import{_ as F}from"./KPI-CgPCSXLM.js";import{_ as U}from"./AsyncValue-BCIGDDyq.js";import{_ as O}from"./SelectChain-ClEdh_yb.js";import{_ as z}from"./InputText-CK-O5NIm.js";import{c as E,d as Q}from"./llamalend-JN_epZkq.js";import{d as N,r as M,f as S,h as b,o as v,w as m,W as L,u as n,a as d,b as r,t as V,c as P,F as K,_ as W,e as D,a5 as j,a6 as q,$ as x,O as G}from"./index-CVF9rKRH.js";import{_ as H}from"./NoData-B0hVIBjH.js";import{_ as J}from"./Table-D9nxCgCO.js";import{_ as X}from"./TokenIcon-L_lPcRfd.js";import{_ as Y}from"./IconExpander-B0WZ9UZe.js";import{a as Z,_ as ee}from"./TabItem.vue_vue_type_script_setup_true_lang-D5aE_SfB.js";import{t as T}from"./util-M70Hx2OY.js";import{u as ae}from"./UseSort-l0VfCGiO.js";import{a as oe}from"./index-Cx-9-RIQ.js";import"./Number-CgtTSdt4.js";import"./ChainIcon-Ddu-FRd-.js";import"./timestamp-CeU_tFUE.js";import"./useQuery-DlYtpHcB.js";const te={class:"end"},ne={class:"end"},se={class:"end"},le={class:"end"},re={class:"end"},ie={class:"end"},ue=N({__name:"TableMarkets",props:{pairs:{},loading:{type:Boolean},chain:{}},emits:["select"],setup(I,{emit:k}){const _=k,h=["","","Name",{id:"borrow",label:"Borrow Rate",align:"end",sort:!0},{id:"lend",label:"Lend Rate",align:"end",sort:!0},{id:"tvl",label:"TVL",align:"end",sort:!0},{id:"loans",label:"Loans",align:"end",sort:!0}],{sorting:f,onSort:B}=ae("tvl"),c=M("long");function $(t){t===0?c.value="long":t===1?c.value="short":c.value="long"}const y=S(()=>I.pairs.map(({long:t,short:s})=>c.value==="long"?t:s).filter(t=>!!t).orderBy(t=>{switch(f.value.column){case"borrow":return t.apyBorrow;case"lend":return t.apyLend;case"tvl":return T(t);case"loans":return t.nLoans}},f.value.order));function C(t){return t.name.replace(/(-long|-short)/i,"")}const R=t=>c.value==="long"?t.collateralToken.address:t.borrowedToken.address;return(t,s)=>{const w=ee,l=Z,a=Y,i=X,u=U,o=J,p=H,g=W;return v(),b(g,{title:"Markets",loading:t.loading},{actions:m(()=>[r(l,{class:"types",onTab:s[0]||(s[0]=e=>$(e.index))},{default:m(()=>[r(w,{header:"Long"}),r(w,{header:"Short"})]),_:1})]),default:m(()=>[n(y).length>0?(v(),b(o,{key:0,class:"markets-table",rows:n(y),columns:h,sorting:n(f),onSortColumn:n(B),onSelect:s[1]||(s[1]=e=>_("select",e))},{row:m(({item:e})=>[e?(v(),P(K,{key:0},[r(a),r(i,{chain:t.chain,address:R(e)},null,8,["chain","address"]),d("div",null,V(C(e)),1),d("div",te,[e.apyBorrow?(v(),b(u,{key:0,type:"percentage",value:e.apyBorrow},null,8,["value"])):L("",!0)]),d("div",ne,[e.apyLend?(v(),b(u,{key:0,type:"percentage",value:e.apyLend},null,8,["value"])):L("",!0)]),d("div",se,[n(T)(e)?(v(),b(u,{key:0,type:"dollar",value:n(T)(e)},null,8,["value"])):L("",!0)]),d("div",le,V(e.nLoans),1)],64)):L("",!0)]),"row-aggregation":m(()=>[s[2]||(s[2]=d("div",null,null,-1)),s[3]||(s[3]=d("div",null,null,-1)),s[4]||(s[4]=d("div",null,null,-1)),s[5]||(s[5]=d("div",null,null,-1)),s[6]||(s[6]=d("div",null,null,-1)),d("div",re,[r(u,{type:"dollar",value:n(y).filter(e=>e).map(e=>e).sumBy(n(T))},null,8,["value"])]),d("div",ie,V(n(y).filter(e=>e).map(e=>e).sumBy(e=>e.nLoans)),1)]),_:1},8,["rows","sorting","onSortColumn"])):t.loading?L("",!0):(v(),b(p,{key:1,message:`There are no ${n(c)} markets for ${t.chain}`},null,8,["message"]))]),_:1},8,["loading"])}}}),de=D(ue,[["__scopeId","data-v-02c8e754"]]),ce={class:"dashboard"},pe={class:"toolbar"},me=N({__name:"LlamaLend.page",setup(I){const k=oe("chain"),_=S({get(){return k.value?k.value:"ethereum"},set(l){k.value=l}}),h=M(""),f=S(()=>B.value.filter(({long:l,short:a})=>{const i=h.value.toLocaleLowerCase().split(" ");return(o=>i.some(p=>o.toLocaleLowerCase().includes(p)))(`${(l==null?void 0:l.name)??""}${(a==null?void 0:a.name)??""}`)})),B=S(()=>{const l=["crvusd"],a=($.value??[]).map(o=>({market:o,isLong:l.includes(o.borrowedToken.symbol.toLocaleLowerCase()),isShort:l.includes(o.collateralToken.symbol.toLocaleLowerCase())})).filter(({isLong:o,isShort:p})=>o||p),i=[],u=new Set;for(const{market:o,isLong:p,isShort:g}of a){if(u.has(o.controller))continue;u.add(o.controller);const e=a.find(A=>A.market.borrowedToken.address===o.collateralToken.address&&A.market.collateralToken.address===o.borrowedToken.address);e&&u.add(e.market.controller),i.push({long:p?o:e==null?void 0:e.market,short:g?o:e==null?void 0:e.market})}return i}),{isFetching:c,data:$}=E(_),{data:y}=Q(),{crumbs:C}=j(q());C.value=[{id:"llamalend",label:"Llama Lend",pathName:"llamalend",params:()=>({chain:_.value})},{id:"market",label:"Select market for details",hint:!0}];const R=x(),t=async l=>{l&&await R.push({name:"llamalendmarket",params:{tab:"",chain:_.value,marketAddr:l.controller}})},s=l=>f.value.map(a=>l==="long"?a.long:a.short).filter(a=>!!a).sumBy(a=>a.totalDebtUsd),w=l=>{const a=f.value.map(i=>l==="long"?i.long:i.short).filter(i=>!!i).reduce(({debt:i,assets:u},o)=>({debt:i+o.totalDebtUsd,assets:u+o.totalAssetsUsd}),{debt:0,assets:0});return a.assets===0?0:a.debt/a.assets*100};return(l,a)=>{const i=z,u=O,o=U,p=F;return v(),P("div",ce,[d("div",pe,[r(i,{modelValue:n(h),"onUpdate:modelValue":a[0]||(a[0]=g=>G(h)?h.value=g:null),search:"",placeholder:"Search for..."},null,8,["modelValue"]),r(u,{class:"chain-select",chain:n(_),chains:n(y),onSelectChain:a[1]||(a[1]=g=>_.value=g==="all"?"ethereum":g)},null,8,["chain","chains"])]),r(p,{style:{"grid-area":"kpi1"},label:"Open Interest (long)","has-value":!n(c)},{default:m(()=>[r(o,{type:"dollar",value:s("long")},null,8,["value"])]),_:1},8,["has-value"]),r(p,{style:{"grid-area":"kpi2"},label:"Open Interest (short)","has-value":!n(c)},{default:m(()=>[r(o,{type:"dollar",value:s("short")},null,8,["value"])]),_:1},8,["has-value"]),r(p,{style:{"grid-area":"kpi3"},"tooltip-type":"icon",label:"Average Utilization Rate (long)",tooltip:"Aggregate debt divided by aggregate assets","has-value":!n(c)},{default:m(()=>[r(o,{type:"percentage",value:w("long")},null,8,["value"])]),_:1},8,["has-value"]),r(p,{style:{"grid-area":"kpi4"},"tooltip-type":"icon",label:"Average Utilization Rate (short)",tooltip:"Aggregate debt divided by aggregate assets","has-value":!n(c)},{default:m(()=>[r(o,{type:"percentage",value:w("short")},null,8,["value"])]),_:1},8,["has-value"]),r(n(de),{style:{"grid-area":"markets"},pairs:n(f),loading:n(c),chain:n(_),onSelect:t},null,8,["pairs","loading","chain"])])}}}),Ae=D(me,[["__scopeId","data-v-188c78d8"]]);export{Ae as default};
