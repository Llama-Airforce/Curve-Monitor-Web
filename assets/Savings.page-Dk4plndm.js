import{_ as N}from"./KPI-B53x3jTq.js";import{_ as V}from"./AsyncValue-C0jBgRNU.js";import{t as $,g as T,f as w,a as Y}from"./timestamp-Dfir0V72.js";import{u as k}from"./useQuery-B6SWxrK9.js";import{a8 as O,d as v,T as D,U as E,f as F,V as W,h as S,o as b,w as d,a as u,b as i,u as s,_ as B,K as Q,X as H,t as C,i as P,e as q,c as z}from"./index-CB0lbOkp.js";import{u as A,b as L,c as j,_ as R,a as U}from"./UseLightweightChart-D45Z5owe.js";import{r as K,u as J}from"./Number-BucUTk9j.js";import{_ as M}from"./Table-NQndpLny.js";import{a as X,_ as G}from"./UsePagination-BGn7VvEt.js";import{u as Z}from"./UseRelativeTime-Dw2NdyiO.js";import"./Object-DOSYkgA0.js";const x=e=>({type:e.action_type,sender:e.sender,owner:e.owner,receiver:e.receiver?e.receiver:void 0,assets:BigInt(e.assets),supply:BigInt(e.shares),blockNumber:e.block_number,timestamp:$(e.timestamp),txHash:e.transaction_hash}),ee=e=>({timestamp:$(e.timestamp),assets:e.assets,supply:e.supply,apyProjected:Number(e.proj_apy)}),te=e=>({lastUpdated:$(e.last_updated),lastUpdatedBlock:e.last_updated_block,aprProjected:e.proj_apr,supply:e.supply});async function se(e){const t=T(e),l=await w(`${t}/v1/crvusd/savings/statistics`);return te(l)}async function ae(e,t){const l=T(t),p=await w(`${l}/v1/crvusd/savings/events?page=${e}&per_page=10`);return{count:p.count,events:p.events.map(x)}}async function ne(e=1,t="hour",l,p,c){const o=T(c),{start:n,end:g}=Y({daysRange:10});return(await w(`${o}/v1/crvusd/savings/yield?agg_number=${e}&agg_units=${t}&start=${n}&end=${g}`)).data.map(ee)}function re(){return{initialData:[],initialDataUpdatedAt:0}}function oe(){return k({queryKey:["scrvusd-stats"],queryFn:()=>se()})}function ie(e){return k({queryKey:["scrvusd-events",e],queryFn:({queryKey:[,t]})=>ae(t),placeholderData:O})}function I(){return k({queryKey:["scrvusd-yield"],queryFn:()=>ne(),...re()})}const ce={style:{display:"flex"}},le={ref:"chartRef",class:"chart"},pe=v({__name:"ChartTVL",setup(e){const{isFetching:t,data:l}=I(),p=D(),c=E("card"),{chart:o,series:n}=A({createChartOptions:j(),series:{type:"Area",name:"tvl",options:F(()=>({priceFormat:{type:"custom",formatter:a=>`$${K(a,1,"dollar")}${J(a)}`},lineWidth:2,lineType:L.WithSteps,lineColor:p.value.colors.blue,topColor:"rgb(32, 129, 240, 0.2)",bottomColor:"rgba(32, 129, 240, 0)",lastValueVisible:!1,priceLineVisible:!1}))}});W(g);function g(){if(!o.value||!n.tvl)return;const a=l.value.map(r=>({time:r.timestamp.getUTCTimestamp(),value:r.assets})).uniqWith((r,_)=>r.time===_.time).orderBy(r=>r.time,"asc");a.length>0&&n.tvl.setData(a),o.value.timeScale().fitContent()}return(a,r)=>{const _=R,h=U,f=B;return b(),S(f,{ref_key:"card",ref:c,title:"TVL",loading:s(t)},{actions:d(()=>[u("div",ce,[i(_,{filename:"rates",series:s(n)},null,8,["series"]),i(h,{chart:s(o),target:s(c)},null,8,["chart","target"])])]),default:d(()=>[u("div",le,null,512)]),_:1},8,["loading"])}}}),ue={style:{display:"flex"}},_e={ref:"chartRef",class:"chart"},de=v({__name:"ChartYield",setup(e){const{isFetching:t,data:l}=I(),p=D(),c=E("card"),{chart:o,series:n}=A({createChartOptions:j(),series:{type:"Area",name:"apy",options:F(()=>({priceFormat:{type:"custom",formatter:a=>`${K(a,0,"percentage")}%`},lineWidth:2,lineType:L.WithSteps,lineColor:p.value.colors.blue,topColor:"rgb(32, 129, 240, 0.2)",bottomColor:"rgba(32, 129, 240, 0)",lastValueVisible:!1,priceLineVisible:!1}))}});W(g);function g(){if(!o.value||!n.apy)return;const a=l.value.map(r=>({time:r.timestamp.getUTCTimestamp(),value:r.apyProjected})).uniqWith((r,_)=>r.time===_.time).orderBy(r=>r.time,"asc");a.length>0&&n.apy.setData(a),o.value.timeScale().fitContent()}return(a,r)=>{const _=R,h=U,f=B;return b(),S(f,{ref_key:"card",ref:c,title:"Yield",loading:s(t)},{actions:d(()=>[u("div",ue,[i(_,{filename:"rates",series:s(n)},null,8,["series"]),i(h,{chart:s(o),target:s(c)},null,8,["chart","target"])])]),default:d(()=>[u("div",_e,null,512)]),_:1},8,["loading"])}}}),me={class:"end"},ge=["href"],he={class:"end"},fe=["href"],ye=v({__name:"TableEvents",setup(e){const{page:t,onPage:l}=X(),p=Q(t,200),{isFetching:c,data:o}=ie(p),{relativeTime:n}=Z();return(g,a)=>{const r=G,_=V,h=M,f=B;return b(),S(f,{title:"Events",loading:s(c)},{actions:d(()=>{var y;return[i(r,{"items-count":((y=s(o))==null?void 0:y.count)??0,"items-per-page":10,page:s(t),onPage:s(l)},null,8,["items-count","page","onPage"])]}),default:d(()=>{var y;return[i(h,{loading:s(c),rows:((y=s(o))==null?void 0:y.events)??[],columns:["Type",{label:"Amount",align:"end"},"Owner",{label:"Time",align:"end"}]},{row:d(({item:m})=>[u("div",{class:H(["type",{green:m.type==="deposit",red:m.type==="withdraw"}])},C(m.type),3),u("div",me,[i(_,{value:Number(m.assets)/10**18,precision:0},null,8,["value"])]),u("div",null,[u("a",{target:"_blank",href:`https://etherscan.io/address/${m.owner}`,onClick:a[0]||(a[0]=P(()=>{},["stop"]))},C(m.owner),9,ge)]),u("div",he,[u("a",{target:"_blank",href:`https://etherscan.io/tx/${m.txHash}`,onClick:a[1]||(a[1]=P(()=>{},["stop"]))},C(s(n)(m.timestamp.getUTCTimestamp())),9,fe)])]),_:1},8,["loading","rows"])]}),_:1},8,["loading"])}}}),ve=q(ye,[["__scopeId","data-v-9b4d465d"]]),be={class:"dashboard"},Ce=v({__name:"Savings.page",setup(e){const{data:t}=oe();return(l,p)=>{const c=V,o=N;return b(),z("div",be,[i(o,{style:{"grid-area":"kpi1"},label:"APR (Projected)","has-value":!!s(t)},{default:d(()=>{var n;return[i(c,{type:"percentage",value:(n=s(t))==null?void 0:n.aprProjected},null,8,["value"])]}),_:1},8,["has-value"]),i(o,{style:{"grid-area":"kpi2"},label:"Shares","has-value":!!s(t)},{default:d(()=>{var n;return[i(c,{value:(n=s(t))==null?void 0:n.supply},null,8,["value"])]}),_:1},8,["has-value"]),i(ve,{style:{"grid-area":"events"}}),i(de,{style:{"grid-area":"yield"}}),i(pe,{style:{"grid-area":"tvl"}})])}}}),We=q(Ce,[["__scopeId","data-v-d3c76d88"]]);export{We as default};
