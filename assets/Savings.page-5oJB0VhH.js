import{_ as N}from"./KPI-DZsIdWbR.js";import{_ as D}from"./AsyncValue-zD0lFhv8.js";import{t as C,g as w,f as T,a as Y}from"./timestamp-Dfir0V72.js";import{u as k}from"./useQuery-DIn02iD8.js";import{a9 as O,d as y,T as E,U as q,f as A,V as F,h as S,o as $,w as d,a as p,b as i,u as a,_ as B,K as Q,X as H,t as b,i as P,e as j,c as z}from"./index-BQLunFHs.js";import{u as L,c as R,a as U,_ as V,b as K}from"./UseLightweightChart-BmE4U9L3.js";import{r as W,u as J}from"./Number-BynZIa1V.js";import{_ as M}from"./Table-grbj9OGM.js";import{a as X,_ as G}from"./UsePagination-ioVJPNW3.js";import{u as Z}from"./UseRelativeTime-CPj9MdVH.js";import"./Object-DOSYkgA0.js";const x=e=>({type:e.action_type,sender:e.sender,owner:e.owner,receiver:e.receiver?e.receiver:void 0,assets:BigInt(e.assets),supply:BigInt(e.shares),blockNumber:e.block_number,timestamp:C(e.timestamp),txHash:e.transaction_hash}),ee=e=>({timestamp:C(e.timestamp),assets:e.assets,supply:e.supply,apyProjected:Number(e.proj_apy)}),te=e=>({lastUpdated:C(e.last_updated),lastUpdatedBlock:e.last_updated_block,aprProjected:e.proj_apr,supply:e.supply});async function ae(e){const t=w(e),l=await T(`${t}/v1/crvusd/savings/statistics`);return te(l)}async function se(e,t){const l=w(t),u=await T(`${l}/v1/crvusd/savings/events?page=${e}&per_page=10`);return{count:u.count,events:u.events.map(x)}}async function ne(e=1,t="hour",l,u,c){const o=w(c),{start:n,end:g}=Y({daysRange:10});return(await T(`${o}/v1/crvusd/savings/yield?agg_number=${e}&agg_units=${t}&start=${n}&end=${g}`)).data.map(ee)}function re(){return{initialData:[],initialDataUpdatedAt:0}}function oe(){return k({queryKey:["scrvusd-stats"],queryFn:()=>ae()})}function ie(e){return k({queryKey:["scrvusd-events",e],queryFn:({queryKey:[,t]})=>se(t),placeholderData:O})}function I(){return k({queryKey:["scrvusd-yield"],queryFn:()=>ne(),...re()})}const ce={style:{display:"flex"}},le={ref:"chartRef",class:"chart"},ue=y({__name:"ChartTVL",setup(e){const{isFetching:t,data:l}=I(),u=E(),c=q("card"),{chart:o,series:n}=L({createChartOptions:U(),series:R({name:"tvl",color:A(()=>u.value.colors.blue),formatter:s=>`$${W(s,1,"dollar")}${J(s)}`})});F(g);function g(){if(!o.value||!n.tvl)return;const s=l.value.map(r=>({time:r.timestamp.getUTCTimestamp(),value:r.assets})).uniqWith((r,_)=>r.time===_.time).orderBy(r=>r.time,"asc");s.length>0&&n.tvl.setData(s),o.value.timeScale().fitContent()}return(s,r)=>{const _=V,h=K,f=B;return $(),S(f,{ref_key:"card",ref:c,title:"TVL",loading:a(t)},{actions:d(()=>[p("div",ce,[i(_,{filename:"rates",series:a(n)},null,8,["series"]),i(h,{chart:a(o),target:a(c)},null,8,["chart","target"])])]),default:d(()=>[p("div",le,null,512)]),_:1},8,["loading"])}}}),pe={style:{display:"flex"}},_e={ref:"chartRef",class:"chart"},de=y({__name:"ChartYield",setup(e){const{isFetching:t,data:l}=I(),u=E(),c=q("card"),{chart:o,series:n}=L({createChartOptions:U(),series:R({name:"apy",color:A(()=>u.value.colors.blue),formatter:s=>`${W(s,0,"percentage")}%`})});F(g);function g(){if(!o.value||!n.apy)return;const s=l.value.map(r=>({time:r.timestamp.getUTCTimestamp(),value:r.apyProjected})).uniqWith((r,_)=>r.time===_.time).orderBy(r=>r.time,"asc");s.length>0&&n.apy.setData(s),o.value.timeScale().fitContent()}return(s,r)=>{const _=V,h=K,f=B;return $(),S(f,{ref_key:"card",ref:c,title:"Yield",loading:a(t)},{actions:d(()=>[p("div",pe,[i(_,{filename:"rates",series:a(n)},null,8,["series"]),i(h,{chart:a(o),target:a(c)},null,8,["chart","target"])])]),default:d(()=>[p("div",_e,null,512)]),_:1},8,["loading"])}}}),me={class:"end"},ge=["href"],he={class:"end"},fe=["href"],ve=y({__name:"TableEvents",setup(e){const{page:t,onPage:l}=X(),u=Q(t,200),{isFetching:c,data:o}=ie(u),{relativeTime:n}=Z();return(g,s)=>{const r=G,_=D,h=M,f=B;return $(),S(f,{title:"Events",loading:a(c)},{actions:d(()=>{var v;return[i(r,{"items-count":((v=a(o))==null?void 0:v.count)??0,"items-per-page":10,page:a(t),onPage:a(l)},null,8,["items-count","page","onPage"])]}),default:d(()=>{var v;return[i(h,{loading:a(c),rows:((v=a(o))==null?void 0:v.events)??[],columns:["Type",{label:"Amount",align:"end"},"Owner",{label:"Time",align:"end"}]},{row:d(({item:m})=>[p("div",{class:H(["type",{green:m.type==="deposit",red:m.type==="withdraw"}])},b(m.type),3),p("div",me,[i(_,{value:Number(m.assets)/10**18,precision:0},null,8,["value"])]),p("div",null,[p("a",{target:"_blank",href:`https://etherscan.io/address/${m.owner}`,onClick:s[0]||(s[0]=P(()=>{},["stop"]))},b(m.owner),9,ge)]),p("div",he,[p("a",{target:"_blank",href:`https://etherscan.io/tx/${m.txHash}`,onClick:s[1]||(s[1]=P(()=>{},["stop"]))},b(a(n)(m.timestamp.getUTCTimestamp())),9,fe)])]),_:1},8,["loading","rows"])]}),_:1},8,["loading"])}}}),ye=j(ve,[["__scopeId","data-v-9b4d465d"]]),$e={class:"dashboard"},be=y({__name:"Savings.page",setup(e){const{data:t}=oe();return(l,u)=>{const c=D,o=N;return $(),z("div",$e,[i(o,{style:{"grid-area":"kpi1"},label:"APR (Projected)","has-value":!!a(t)},{default:d(()=>{var n;return[i(c,{type:"percentage",value:(n=a(t))==null?void 0:n.aprProjected},null,8,["value"])]}),_:1},8,["has-value"]),i(o,{style:{"grid-area":"kpi2"},label:"Shares","has-value":!!a(t)},{default:d(()=>{var n;return[i(c,{value:(n=a(t))==null?void 0:n.supply},null,8,["value"])]}),_:1},8,["has-value"]),i(ye,{style:{"grid-area":"events"}}),i(de,{style:{"grid-area":"yield"}}),i(ue,{style:{"grid-area":"tvl"}})])}}}),Fe=j(be,[["__scopeId","data-v-d3c76d88"]]);export{Fe as default};
