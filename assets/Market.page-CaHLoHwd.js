import{_ as X,a as Y}from"./TabItem.vue_vue_type_script_setup_true_lang-DcHCyqQN.js";import{d as $,g as b,T as O,f as k,V as D,h as y,o as h,_ as F,u as e,w as p,a as g,r as C,b as s,O as Z,e as L,c as S,t as w,W as R,S as H,j as x,a5 as ee,a6 as ae,N as te,R as se,a3 as E}from"./index-CSl7mF5e.js";import{e as I,u as ne}from"./crvusd-DagEUe3v.js";import{u as j,a as oe,b as re,c as ie,d as le,e as ce,f as de,T as ue,_ as me,g as _e,h as pe,i as ve,j as he,k as ge,l as fe,m as ke,n as be,o as ye,C as $e,p as Ce,q as Te}from"./TableTrades-SHFad__u.js";import{u as M,c as P,a as Q,k as we,G as Le,r as qe}from"./UseLightweightChart-DUPQG9vB.js";import"./ChartStylesApex-BX9E4dzz.js";import{_ as Ae}from"./KPI-D93aqXd-.js";import{_ as Se}from"./AsyncValue-CiuJBQIu.js";import"./UseLegend-DysMgXIn.js";import"./ButtonToggle-BJ8XOVEI.js";/* empty css                                                                         */import{r as U,u as G}from"./Number-Clxxgc0l.js";import{_ as Fe}from"./InputNumber-CPkctVQt.js";import{_ as K,a as Re}from"./Table-Dd5yrYS9.js";import{L as z}from"./link-ClgwhiOp.js";import{_ as Ve}from"./TokenIcon-BSE-EGDE.js";import{a as Be}from"./index-BrXWXWPw.js";import{u as Oe}from"./UseTabNavigation-DVz1joRQ.js";import"./timestamp-DkvXAN4c.js";import"./api-Bhu-jkhy.js";import"./useQuery-BH3fKRjE.js";import"./UsePagination-U5dRa32E.js";import"./UseRelativeTime-SWUrWtsc.js";import"./Object-DOSYkgA0.js";/* empty css                                                                    */const De={ref:"chartRef",class:"chart"},Ie=$({__name:"ChartMarketAvailableCap",props:{market:{}},setup(o){const{isFetching:a,data:d}=I(b(()=>o.market)),u=O(),{chart:n,series:l}=M({createChartOptions:Q(),series:P({name:"available",color:k(()=>u.value.colors.blue),formatter:t=>`$${U(t,0,"dollar")}${G(t)}`})});D(r);function r(){!n.value||!l.available||(l.available.setData(d.value.map(t=>({time:t.timestamp.getUTCTimestamp(),value:t.borrowable})).uniqWith((t,i)=>t.time===i.time).orderBy(t=>t.time,"asc").dropWhile(t=>t.value===0)),n.value.timeScale().fitContent())}return(t,i)=>{const _=F;return h(),y(_,{title:"Borrowable & Debt Ceiling",loading:e(a)},{default:p(()=>[g("div",De,null,512)]),_:1},8,["loading"])}}}),Me={ref:"chartRef",class:"chart"},Qe=$({__name:"ChartMarketLoans",props:{market:{}},setup(o){const{isFetching:a,data:d}=I(b(()=>o.market)),u=O(),{chart:n,series:l}=M({createChartOptions:Q(),series:{type:we,name:"loans",options:k(()=>({color:u.value.colors.yellow,lastValueVisible:!1,priceFormat:{type:"volume"},priceLineVisible:!1}))}});D(r);function r(){!n.value||!l.loans||(l.loans.setData(d.value.map(t=>({time:t.timestamp.getUTCTimestamp(),value:t.nLoans})).uniqWith((t,i)=>t.time===i.time).orderBy(t=>t.time,"asc")),n.value.timeScale().fitContent())}return(t,i)=>{const _=F;return h(),y(_,{title:"Loans",loading:e(a)},{default:p(()=>[g("div",Me,null,512)]),_:1},8,["loading"])}}}),Ne={ref:"chartRef",class:"chart"},We=$({__name:"ChartMarketRates",props:{market:{}},setup(o){const{isFetching:a,data:d}=I(b(()=>o.market)),u=O(),n=C(null),{chart:l,series:r}=M({createChartOptions:Q(),series:[P({name:"rates",color:k(()=>u.value.colors.blue),formatter:i}),{type:Le,name:"ema",options:k(()=>({priceFormat:{type:"custom",formatter:i},lineWidth:2,lineType:qe.WithSteps,color:u.value.colors.yellow,lastValueVisible:!1,priceLineVisible:!1}))}]});D(t);function t(){if(!l.value||!r.rates||!r.ema)return;const v=d.value.map(m=>({time:m.timestamp.getUTCTimestamp(),value:m.rate})).uniqWith((m,T)=>m.time===T.time).orderBy(m=>m.time,"asc"),f=_(v.map(m=>m.value),n.value??31).zip(v).map(m=>({time:m[1].time,value:m[0]}));r.ema.setData(f),r.rates.setData(v),l.value.timeScale().fitContent()}function i(v){return`${U(v*100,0,"percentage")}%`}const _=(v,c=7)=>v.map((f,m)=>{const T=Math.max(m-(c-1),0),N=m+1,V=v.slice(T,N);return V.sumBy(B=>B)/V.length});return(v,c)=>{const f=Fe,m=F;return h(),y(m,{title:"Rates",loading:e(a)},{actions:p(()=>[s(f,{modelValue:e(n),"onUpdate:modelValue":c[0]||(c[0]=T=>Z(n)?n.value=T:null),class:"avg-span",placeholder:"Avg span (days)",min:1,max:1/0},null,8,["modelValue"])]),default:p(()=>[g("div",Ne,null,512)]),_:1},8,["loading"])}}}),Ee=L(We,[["__scopeId","data-v-4c10cf91"]]),Pe={ref:"chartRef",class:"chart"},Ue=$({__name:"ChartMarketVolume",props:{market:{},chain:{}},setup(o){const{isFetching:a,data:d}=j("crvusd",k(()=>o.market?.llamma),b(()=>o.chain)),u=O(),{chart:n,series:l}=M({createChartOptions:Q(),series:P({name:"volume",color:k(()=>u.value.colors.blue),formatter:t=>`$${U(t,0,"dollar")}${G(t)}`})});D(r);function r(){if(!n.value||!l.volume)return;const t=(d.value??[]).map(i=>({time:i.time.getUTCTimestamp(),value:i.volume})).uniqWith((i,_)=>i.time===_.time).orderBy(i=>i.time,"asc");t.length>0&&l.volume.setData(t),n.value.timeScale().fitContent()}return(t,i)=>{const _=F;return h(),y(_,{title:"Volume",loading:e(a)},{default:p(()=>[g("div",Pe,null,512)]),_:1},8,["loading"])}}}),He={class:"dashboard-grid"},je=$({__name:"Liquidations",props:{market:{},chain:{}},setup(o){const a=k(()=>o.market?.address),{isFetching:d,data:u}=oe(C("crvusd"),b(()=>o.chain),a),{isFetching:n,data:l}=I(b(()=>o.market)),r=k(()=>l.value.map(({timestamp:q,priceOracle:A})=>({timestamp:q,priceOracle:A}))),t=k(()=>l.value.map(({timestamp:q,discountLiquidation:A})=>({timestamp:q,discount:A}))),i=k(()=>l.value.map(({timestamp:q,totalCollateralUsd:A,totalDebt:J})=>({timestamp:q,ratio:A/J}))),{isFetching:_,data:v}=re(C("crvusd"),b(()=>o.chain),a),{isFetching:c,data:f}=ie(C("crvusd"),b(()=>o.chain),a),{isFetching:m,data:T}=le(C("crvusd"),b(()=>o.chain),a),{isFetching:N,data:V}=ce(C("crvusd"),b(()=>o.chain),a),{isFetching:W,data:B}=de(C("crvusd"),b(()=>o.chain),a);return(q,A)=>(h(),S("div",He,[s(e(ue),{overview:e(u),loading:e(d)},null,8,["overview","loading"]),s(e(me),{ratios:e(v),"prices-oracle":e(r),loading:e(_)||e(n)},null,8,["ratios","prices-oracle","loading"]),s(e(_e),{losses:e(B),loading:e(W)},null,8,["losses","loading"]),s(e(pe),{losses:e(B),loading:e(W)},null,8,["losses","loading"]),s(e(ve),{deciles:e(V),loading:e(N)},null,8,["deciles","loading"]),s(e(he),{ratios:e(i),loading:e(n)},null,8,["ratios","loading"]),s(e(ge),{liqs:e(f),loading:e(c)},null,8,["liqs","loading"]),s(e(fe),{liqs:e(T),loading:e(m)},null,8,["liqs","loading"]),s(e(ke),{discounts:e(t),liqs:e(T),loading:e(n)||e(m)},null,8,["discounts","liqs","loading"])]))}}),Ge=L(je,[["__scopeId","data-v-6ad4864c"]]),Ke=["href"],ze={key:1},Je=$({__name:"Addresses",props:{market:{}},setup(o){const a=k(()=>[{description:"Controller",address:o.market?.address},{description:"Factory",address:o.market?.factoryAddress},{description:"Llamma",address:o.market?.llamma}]),d=n=>`https://etherscan.io/address/${n}`,u=async n=>{await navigator.clipboard.writeText(n)};return(n,l)=>{const r=z,t=H,i=K,_=F;return h(),y(_,{class:"addresses",title:"Addresses"},{default:p(()=>[s(i,{class:"addresses-table",rows:e(a)},{row:p(({item:{description:v,address:c}})=>[g("div",null,w(v),1),g("div",null,[c?(h(),S("a",{key:0,class:"font-mono",target:"_blank",href:d(c)},w(c),9,Ke)):(h(),S("span",ze,"?"))]),g("div",null,[c?(h(),y(t,{key:0,onClick:f=>u(c)},{default:p(()=>[s(r)]),_:2},1032,["onClick"])):R("",!0)])]),_:1},8,["rows"])]),_:1})}}}),Xe=L(Je,[["__scopeId","data-v-2bb26947"]]),Ye={class:"token-info"},Ze=["href"],xe={class:"token-info"},ea=["href"],aa=$({__name:"Properties",props:{market:{},chain:{}},setup(o){const a=k(()=>({type:"token",symbol:o.market?.collateralToken?.symbol??"?",address:o.market?.collateralToken?.address??"?"})),d=k(()=>({type:"token",symbol:o.market?.stablecoinToken?.symbol??"?",address:o.market?.stablecoinToken?.address??"?"})),u=l=>`https://etherscan.io/address/${l}`,n=async l=>{await navigator.clipboard.writeText(l)};return(l,r)=>{const t=Ve,i=z,_=H,v=Re,c=K,f=F;return h(),y(f,{class:"properties",title:"Properties"},{default:p(()=>[s(c,{class:"properties-table"},{default:p(()=>[s(v,null,{default:p(()=>[r[2]||(r[2]=g("div",null,"Collateral",-1)),g("div",Ye,[s(t,{chain:l.chain,address:e(a).address},null,8,["chain","address"]),g("div",null,w(e(a).symbol),1),g("div",null,[g("a",{class:"font-mono",target:"_blank",href:u(e(a).address)},w(e(a).address),9,Ze)]),g("div",null,[s(_,{onClick:r[0]||(r[0]=m=>n(e(a).address))},{default:p(()=>[s(i)]),_:1})])])]),_:1,__:[2]}),s(v,null,{default:p(()=>[r[3]||(r[3]=g("div",null,"Borrowed",-1)),g("div",xe,[s(t,{chain:l.chain,address:e(d).address},null,8,["chain","address"]),g("div",null,w(e(d).symbol),1),g("div",null,[g("a",{class:"font-mono",target:"_blank",href:u(e(d).address)},w(e(d).address),9,ea)]),g("div",null,[s(_,{onClick:r[1]||(r[1]=m=>n(e(d).address))},{default:p(()=>[s(i)]),_:1})])])]),_:1,__:[3]})]),_:1})]),_:1})}}}),ta=L(aa,[["__scopeId","data-v-61c51caa"]]),sa={class:"dashboard-grid"},na=$({__name:"MarketOverview",props:{market:{},chain:{}},setup(o){return(a,d)=>{const u=Se,n=Ae;return h(),S("div",sa,[s(n,{style:{"grid-area":"kpi1"},label:"Borrow Rate","has-value":!!a.market},{default:p(()=>[s(u,{type:"percentage",value:100*(a.market?.rate??0)},null,8,["value"])]),_:1},8,["has-value"]),s(n,{style:{"grid-area":"kpi2"},label:"Borrowed","has-value":!!a.market},{default:p(()=>[s(u,{type:"dollar",value:a.market?.borrowed},null,8,["value"])]),_:1},8,["has-value"]),s(n,{style:{"grid-area":"kpi3"},label:"Borrowable","has-value":!!a.market},{default:p(()=>[s(u,{type:"dollar",value:a.market?.borrowable},null,8,["value"])]),_:1},8,["has-value"]),s(n,{style:{"grid-area":"kpi4"},label:"Loans","has-value":!!a.market},{default:p(()=>[x(w(a.market?.loans??0),1)]),_:1},8,["has-value"]),s(e(Ee),{style:{"grid-area":"rates"},market:a.market},null,8,["market"]),s(e(Ie),{style:{"grid-area":"cap"},market:a.market},null,8,["market"]),s(e(Qe),{style:{"grid-area":"loans"},market:a.market},null,8,["market"]),s(e(Ue),{style:{"grid-area":"volume"},market:a.market,chain:a.chain},null,8,["market","chain"]),s(e(ta),{style:{"grid-area":"properties"},market:a.market,chain:a.chain},null,8,["market","chain"]),s(e(Xe),{style:{"grid-area":"addresses"},market:a.market,chain:a.chain},null,8,["market","chain"])])}}}),oa=L(na,[["__scopeId","data-v-efc50c6b"]]),ra={class:"dashboard-grid"},ia=$({__name:"Trading",props:{market:{},chain:{}},setup(o){const a=k(()=>o.market?.llamma),{isFetching:d,data:u}=j("crvusd",a,b(()=>o.chain)),n=C(1),{isFetching:l,data:r}=be("crvusd",a,b(()=>o.chain),n),t=C(1),{isFetching:i,data:_}=ye("crvusd",a,b(()=>o.chain),t);return(v,c)=>(h(),S("div",ra,[s(e($e),{style:{"grid-area":"ohlc"},ohlc:e(u)??[],loading:e(d)},null,8,["ohlc","loading"]),s(e(Ce),{style:{"grid-area":"trades"},trades:e(r)?.trades??[],count:e(r)?.count??0,chain:v.chain,loading:e(l),onPage:c[0]||(c[0]=f=>n.value=f)},null,8,["trades","count","chain","loading"]),s(e(Te),{style:{"grid-area":"events"},events:e(_)?.events??[],count:e(_)?.count??0,loading:e(i),onPage:c[1]||(c[1]=f=>t.value=f)},null,8,["events","count","loading"])]))}}),la=L(ia,[["__scopeId","data-v-13550918"]]),ca={class:"dashboard"},da=$({__name:"Market.page",setup(o){const a=Be("marketAddr"),{isFetching:d,data:u}=ne(),n=k(()=>u.value.find(i=>i.address===a.value)),{crumbs:l}=ee(ae());te(n,i=>{l.value=[{id:"crvusd",label:"crvUSD",pathName:"crvusd"},{id:"market",label:`Market: ${i?.name??"?"}`}]},{immediate:!0});const{tabActive:r,tabActiveIndex:t}=Oe(["overview","trading","liquidations"],"crvusdmarket",()=>({marketAddr:a.value}));return(i,_)=>{const v=se,c=X,f=Y;return h(),S("div",ca,[s(v,{loading:e(d)},null,8,["loading"]),!e(d)&&e(n)?(h(),y(f,{key:0,active:e(t),onTab:_[0]||(_[0]=m=>t.value=m.index)},{default:p(()=>[s(c,{header:"Overview"},{default:p(()=>[(h(),y(E,null,[e(r)==="overview"?(h(),y(oa,{key:0,chain:"ethereum",market:e(n)},null,8,["market"])):R("",!0)],1024))]),_:1}),s(c,{header:"Trading"},{default:p(()=>[(h(),y(E,null,[e(r)==="trading"?(h(),y(la,{key:0,chain:"ethereum",market:e(n)},null,8,["market"])):R("",!0)],1024))]),_:1}),s(c,{header:"Liquidations"},{default:p(()=>[(h(),y(E,null,[e(r)==="liquidations"?(h(),y(Ge,{key:0,chain:"ethereum",market:e(n)},null,8,["market"])):R("",!0)],1024))]),_:1})]),_:1},8,["active"])):R("",!0)])}}}),Ia=L(da,[["__scopeId","data-v-3ac83fbe"]]);export{Ia as default};
