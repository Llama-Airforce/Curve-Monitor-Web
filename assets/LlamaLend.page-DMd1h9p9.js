import{_ as F}from"./KPI-BhaaqFtT.js";import{_ as U}from"./AsyncValue-CX8qpoPL.js";import{_ as O}from"./SelectChain-BGkibeja.js";import{_ as z}from"./InputText-BuCLQbVa.js";import{c as E,d as Q}from"./llamalend-B6lHNmDX.js";import{d as N,r as M,f as S,h as b,o as v,w as m,W as L,u as n,a as d,b as l,t as V,c as P,F as K,_ as W,e as D,a5 as j,a6 as q,$ as x,O as G}from"./index-_TFeqcMs.js";import{_ as H}from"./NoData-BDEbAqJy.js";import{_ as J}from"./Table-Bc-2DkaV.js";import{_ as X}from"./TokenIcon-DXNBLGYW.js";import{_ as Y}from"./IconExpander-DhrmarO0.js";import{a as Z,_ as ee}from"./TabItem.vue_vue_type_script_setup_true_lang-BYlRH6_7.js";import{t as T}from"./util-M70Hx2OY.js";import{u as oe}from"./UseSort-B8Z-0PQo.js";import{a as ae}from"./index-DQSWrnbB.js";import"./Number-DFPP41yl.js";import"./ChainIcon-Bw-458SV.js";import"./timestamp-X9wFVw8g.js";import"./timestamp-DkvXAN4c.js";import"./useQuery-DI0f2pKh.js";const te={class:"end"},ne={class:"end"},se={class:"end"},le={class:"end"},re={class:"end"},ie={class:"end"},ue=N({__name:"TableMarkets",props:{pairs:{},loading:{type:Boolean},chain:{}},emits:["select"],setup(I,{emit:k}){const _=k,f=["","","Name",{id:"borrow",label:"Borrow Rate",align:"end",sort:!0},{id:"lend",label:"Lend Rate",align:"end",sort:!0},{id:"tvl",label:"TVL",align:"end",sort:!0},{id:"loans",label:"Loans",align:"end",sort:!0}],{sorting:h,onSort:B}=oe("tvl"),c=M("long");function $(a){a===0?c.value="long":a===1?c.value="short":c.value="long"}const y=S(()=>I.pairs.map(({long:a,short:s})=>c.value==="long"?a:s).filter(a=>!!a).orderBy(a=>{switch(h.value.column){case"borrow":return a.apyBorrow;case"lend":return a.apyLend;case"tvl":return T(a);case"loans":return a.nLoans}},h.value.order));function C(a){return a.name.replace(/(-long|-short)/i,"")}const R=a=>c.value==="long"?a.collateralToken.address:a.borrowedToken.address;return(a,s)=>{const w=ee,r=Z,t=Y,i=X,u=U,o=J,p=H,g=W;return v(),b(g,{title:"Markets",loading:a.loading},{actions:m(()=>[l(r,{class:"types",onTab:s[0]||(s[0]=e=>$(e.index))},{default:m(()=>[l(w,{header:"Long"}),l(w,{header:"Short"})]),_:1})]),default:m(()=>[n(y).length>0?(v(),b(o,{key:0,class:"markets-table",rows:n(y),columns:f,sorting:n(h),onSortColumn:n(B),onSelect:s[1]||(s[1]=e=>_("select",e))},{row:m(({item:e})=>[e?(v(),P(K,{key:0},[l(t),l(i,{chain:a.chain,address:R(e)},null,8,["chain","address"]),d("div",null,V(C(e)),1),d("div",te,[e.apyBorrow?(v(),b(u,{key:0,type:"percentage",value:e.apyBorrow},null,8,["value"])):L("",!0)]),d("div",ne,[e.apyLend?(v(),b(u,{key:0,type:"percentage",value:e.apyLend},null,8,["value"])):L("",!0)]),d("div",se,[n(T)(e)?(v(),b(u,{key:0,type:"dollar",value:n(T)(e)},null,8,["value"])):L("",!0)]),d("div",le,V(e.nLoans),1)],64)):L("",!0)]),"row-aggregation":m(()=>[s[2]||(s[2]=d("div",null,null,-1)),s[3]||(s[3]=d("div",null,null,-1)),s[4]||(s[4]=d("div",null,null,-1)),s[5]||(s[5]=d("div",null,null,-1)),s[6]||(s[6]=d("div",null,null,-1)),d("div",re,[l(u,{type:"dollar",value:n(y).filter(e=>e).map(e=>e).sumBy(n(T))},null,8,["value"])]),d("div",ie,V(n(y).filter(e=>e).map(e=>e).sumBy(e=>e.nLoans)),1)]),_:1},8,["rows","sorting","onSortColumn"])):a.loading?L("",!0):(v(),b(p,{key:1,message:`There are no ${n(c)} markets for ${a.chain}`},null,8,["message"]))]),_:1},8,["loading"])}}}),de=D(ue,[["__scopeId","data-v-02c8e754"]]),ce={class:"dashboard"},pe={class:"toolbar"},me=N({__name:"LlamaLend.page",setup(I){const k=ae("chain"),_=S({get(){return k.value?k.value:"ethereum"},set(r){k.value=r}}),f=M(""),h=S(()=>B.value.filter(({long:r,short:t})=>{const i=f.value.toLocaleLowerCase().split(" ");return(o=>i.some(p=>o.toLocaleLowerCase().includes(p)))(`${r?.name??""}${t?.name??""}`)})),B=S(()=>{const r=["crvusd"],t=($.value??[]).map(o=>({market:o,isLong:r.includes(o.borrowedToken.symbol.toLocaleLowerCase()),isShort:r.includes(o.collateralToken.symbol.toLocaleLowerCase())})).filter(({isLong:o,isShort:p})=>o||p),i=[],u=new Set;for(const{market:o,isLong:p,isShort:g}of t){if(u.has(o.controller))continue;u.add(o.controller);const e=t.find(A=>A.market.borrowedToken.address===o.collateralToken.address&&A.market.collateralToken.address===o.borrowedToken.address);e&&u.add(e.market.controller),i.push({long:p?o:e?.market,short:g?o:e?.market})}return i}),{isFetching:c,data:$}=E(_),{data:y}=Q(),{crumbs:C}=j(q());C.value=[{id:"llamalend",label:"Llama Lend",pathName:"llamalend",params:()=>({chain:_.value})},{id:"market",label:"Select market for details",hint:!0}];const R=x(),a=async r=>{r&&await R.push({name:"llamalendmarket",params:{tab:"",chain:_.value,marketAddr:r.controller}})},s=r=>h.value.map(t=>r==="long"?t.long:t.short).filter(t=>!!t).sumBy(t=>t.totalDebtUsd),w=r=>{const t=h.value.map(i=>r==="long"?i.long:i.short).filter(i=>!!i).reduce(({debt:i,assets:u},o)=>({debt:i+o.totalDebtUsd,assets:u+o.totalAssetsUsd}),{debt:0,assets:0});return t.assets===0?0:t.debt/t.assets*100};return(r,t)=>{const i=z,u=O,o=U,p=F;return v(),P("div",ce,[d("div",pe,[l(i,{modelValue:n(f),"onUpdate:modelValue":t[0]||(t[0]=g=>G(f)?f.value=g:null),search:"",placeholder:"Search for..."},null,8,["modelValue"]),l(u,{class:"chain-select",chain:n(_),chains:n(y),onSelectChain:t[1]||(t[1]=g=>_.value=g==="all"?"ethereum":g)},null,8,["chain","chains"])]),l(p,{style:{"grid-area":"kpi1"},label:"Open Interest (long)","has-value":!n(c)},{default:m(()=>[l(o,{type:"dollar",value:s("long")},null,8,["value"])]),_:1},8,["has-value"]),l(p,{style:{"grid-area":"kpi2"},label:"Open Interest (short)","has-value":!n(c)},{default:m(()=>[l(o,{type:"dollar",value:s("short")},null,8,["value"])]),_:1},8,["has-value"]),l(p,{style:{"grid-area":"kpi3"},"tooltip-type":"icon",label:"Average Utilization Rate (long)",tooltip:"Aggregate debt divided by aggregate assets","has-value":!n(c)},{default:m(()=>[l(o,{type:"percentage",value:w("long")},null,8,["value"])]),_:1},8,["has-value"]),l(p,{style:{"grid-area":"kpi4"},"tooltip-type":"icon",label:"Average Utilization Rate (short)",tooltip:"Aggregate debt divided by aggregate assets","has-value":!n(c)},{default:m(()=>[l(o,{type:"percentage",value:w("short")},null,8,["value"])]),_:1},8,["has-value"]),l(n(de),{style:{"grid-area":"markets"},pairs:n(h),loading:n(c),chain:n(_),onSelect:a},null,8,["pairs","loading","chain"])])}}}),Ue=D(me,[["__scopeId","data-v-188c78d8"]]);export{Ue as default};
