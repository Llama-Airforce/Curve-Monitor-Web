import{ai as b,aj as C,ak as $,ae as w,aC as Q,d as y,E as R,al as N,h as T,o as f,w as _,a as o,u as t,b as u,Q as O,t as v,V as P,K as S,_ as k,g as V,X as D,Y as E,z as q,a5 as A,Z as B,a6 as H,c as z,aa as M}from"./index-BYnNAfSP.js";import{_ as J}from"./Table-CkrHHA0S.js";import{a as X,_ as Z}from"./UsePagination-6my4nle6.js";import{u as j,b as F,c as U,_ as K,a as W}from"./UseLightweightChart-DudqJuBl.js";import"./Object-DOSYkgA0.js";const G=e=>({type:e.action_type,sender:e.sender,owner:e.owner,receiver:e.receiver?e.receiver:void 0,assets:BigInt(e.assets),supply:BigInt(e.shares),blockNumber:e.block_number,timestamp:b(e.timestamp),txHash:e.transaction_hash}),x=e=>({timestamp:b(e.timestamp),assets:e.assets,supply:e.supply,apyProjected:e.proj_apy}),ee=e=>({lastUpdated:b(e.last_updated),lastUpdatedBlock:e.last_updated_block,aprProjected:e.proj_apr,supply:e.supply});async function te(e){const a=C(e),i=await $(`${a}/v1/crvusd/savings/statistics`);return ee(i)}async function ae(e,a){const i=C(a),p=await $(`${i}/v1/crvusd/savings/events?page=${e}&per_page=10`);return{count:p.count,events:p.events.map(G)}}async function se(e){const a=C(e),i=Math.floor(new Date().getTime()/1e3),p=i-10*24*60*60;return(await $(`${a}/v1/crvusd/savings/yield?agg_number=1&agg_units=hour&start=${p}&end=${i}`)).data.map(x)}function ne(){return{initialData:[],initialDataUpdatedAt:0}}function re(){return w({queryKey:["scrvusd-stats"],queryFn:()=>te()})}function oe(e){return w({queryKey:["scrvusd-events",e],queryFn:({queryKey:[,a]})=>ae(a),placeholderData:Q})}function Y(){return w({queryKey:["scrvusd-yield"],queryFn:()=>se(),...ne()})}const ie={class:"end"},ce=["href"],le={class:"end"},pe=["href"],ue=y({__name:"TableEvents",setup(e){const{page:a,onPage:i}=X(),p=R(a,200),{isFetching:l,data:c}=oe(p),{relativeTime:r}=N();return(h,s)=>{const n=Z,d=P,I=J,L=k;return f(),T(L,{title:"Events",loading:t(l)},{actions:_(()=>{var g;return[o(n,{"items-count":((g=t(c))==null?void 0:g.count)??0,"items-per-page":10,page:t(a),onPage:t(i)},null,8,["items-count","page","onPage"])]}),default:_(()=>{var g;return[o(I,{loading:t(l),rows:((g=t(c))==null?void 0:g.events)??[],columns:["Type",{label:"Amount",align:"end"},"Owner",{label:"Time",align:"end"}]},{row:_(({item:m})=>[u("div",{class:O(["type",{green:m.type==="deposit",red:m.type==="withdraw"}])},v(m.type),3),u("div",ie,[o(d,{value:Number(m.assets)/10**18,precision:0},null,8,["value"])]),u("div",null,[u("a",{target:"_blank",href:`https://etherscan.io/address/${m.owner}`,onClick:s[0]||(s[0]=S(()=>{},["stop"]))},v(m.owner),9,ce)]),u("div",le,[u("a",{target:"_blank",href:`https://etherscan.io/tx/${m.txHash}`,onClick:s[1]||(s[1]=S(()=>{},["stop"]))},v(t(r)(m.timestamp.getUTCTimestamp())),9,pe)])]),_:1},8,["loading","rows"])]}),_:1},8,["loading"])}}}),de=V(ue,[["__scopeId","data-v-9b4d465d"]]),_e={style:{display:"flex"}},me={ref:"chartRef",class:"chart"},ge=y({__name:"ChartYield",setup(e){const{isFetching:a,data:i}=Y(),p=D(),l=E("card"),{chart:c,series:r}=j({createChartOptions:U(),series:{type:"Area",name:"apy",options:q(()=>({priceFormat:{type:"custom",formatter:s=>`${A(s,0,"percentage")}%`},lineWidth:2,lineType:F.WithSteps,lineColor:p.value.colors.blue,topColor:"rgb(32, 129, 240, 0.2)",bottomColor:"rgba(32, 129, 240, 0)",lastValueVisible:!1,priceLineVisible:!1}))}});B(h);function h(){if(!c.value||!r.apy)return;const s=i.value.map(n=>({time:n.timestamp.getUTCTimestamp(),value:n.apyProjected})).uniqWith((n,d)=>n.time===d.time).orderBy(n=>n.time,"asc");s.length>0&&r.apy.setData(s),c.value.timeScale().fitContent()}return(s,n)=>{const d=k;return f(),T(d,{ref_key:"card",ref:l,title:"Yield",loading:t(a)},{actions:_(()=>[u("div",_e,[o(t(K),{filename:"rates",series:t(r)},null,8,["series"]),o(t(W),{chart:t(c),target:t(l)},null,8,["chart","target"])])]),default:_(()=>[u("div",me,null,512)]),_:1},8,["loading"])}}}),he={style:{display:"flex"}},ye={ref:"chartRef",class:"chart"},fe=y({__name:"ChartTVL",setup(e){const{isFetching:a,data:i}=Y(),p=D(),l=E("card"),{chart:c,series:r}=j({createChartOptions:U(),series:{type:"Area",name:"tvl",options:q(()=>({priceFormat:{type:"custom",formatter:s=>`$${A(s,1,"dollar")}${H(s)}`},lineWidth:2,lineType:F.WithSteps,lineColor:p.value.colors.blue,topColor:"rgb(32, 129, 240, 0.2)",bottomColor:"rgba(32, 129, 240, 0)",lastValueVisible:!1,priceLineVisible:!1}))}});B(h);function h(){if(!c.value||!r.tvl)return;const s=i.value.map(n=>({time:n.timestamp.getUTCTimestamp(),value:n.assets})).uniqWith((n,d)=>n.time===d.time).orderBy(n=>n.time,"asc");s.length>0&&r.tvl.setData(s),c.value.timeScale().fitContent()}return(s,n)=>{const d=k;return f(),T(d,{ref_key:"card",ref:l,title:"TVL",loading:t(a)},{actions:_(()=>[u("div",he,[o(t(K),{filename:"rates",series:t(r)},null,8,["series"]),o(t(W),{chart:t(c),target:t(l)},null,8,["chart","target"])])]),default:_(()=>[u("div",ye,null,512)]),_:1},8,["loading"])}}}),ve={class:"dashboard"},be=y({__name:"Savings.page",setup(e){const{data:a}=re();return(i,p)=>{const l=P,c=M;return f(),z("div",ve,[o(c,{style:{"grid-area":"kpi1"},label:"APR (Projected)","has-value":!!t(a)},{default:_(()=>{var r;return[o(l,{type:"percentage",value:(r=t(a))==null?void 0:r.aprProjected},null,8,["value"])]}),_:1},8,["has-value"]),o(c,{style:{"grid-area":"kpi2"},label:"Shares","has-value":!!t(a)},{default:_(()=>{var r;return[o(l,{value:(r=t(a))==null?void 0:r.supply},null,8,["value"])]}),_:1},8,["has-value"]),o(de,{style:{"grid-area":"events"}}),o(ge,{style:{"grid-area":"yield"}}),o(fe,{style:{"grid-area":"tvl"}})])}}}),Se=V(be,[["__scopeId","data-v-fb6a7473"]]);export{Se as default};
