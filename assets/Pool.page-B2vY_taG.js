import{_ as ie,a as re}from"./TabItem.vue_vue_type_script_setup_true_lang-7nwGOWad.js";import{d as M,h as F,o as V,a4 as le,w as h,a as $,t as H,e as O,T as P,f as C,r as Y,g as E,U as Q,V as A,_ as I,u as o,b as _,c as G,a7 as Z,Y as ce,W as q,j,F as ue,l as me,a5 as de,a6 as pe,N as ve,R as fe,a3 as ee}from"./index-OWfv7D6D.js";import{a as _e,b as he,c as ge,d as be}from"./pools-DLTBky0o.js";import{u as z,_ as J}from"./UseLegend-CZg2ARZl.js";import{u as U,G as N,r as oe,a as R,b as x,x as ye,c as se,_ as X}from"./UseLightweightChart-5DJFz7CU.js";import{u as Ce}from"./queries-oMIyfgcv.js";import{r as D,u as W}from"./Number-BRYmvycz.js";import{_ as ke}from"./AsyncValue-DDW1NTUE.js";import{a as $e,_ as Ve}from"./KPI-DwF44GTx.js";import{_ as Se}from"./TokenIcon-CKkX8RH-.js";import{_ as ne}from"./ButtonToggle-w-zejexY.js";import{g as Te}from"./api-BCRV542q.js";import{u as we}from"./useQuery-D6Uj_9f4.js";import{a as te}from"./index-BXfH6LhG.js";import{u as Be}from"./UseTabNavigation-BdLH7XfW.js";import"./fetch-bVCl_krR.js";import"./timestamp-CoE2HNXc.js";import"./UseHost-gZJsfpqI.js";import"./Object-DOSYkgA0.js";import"./Helper-4cOdg0Kq.js";const Fe={class:"option"},Me={class:"label"},De=M({__name:"SelectDuration",props:{duration:{default:()=>({value:1,unit:"month"})}},emits:["select"],setup(u,{emit:m}){const d=m,s=[{value:1,unit:"hour"},{value:1,unit:"day"},{value:1,unit:"week"},{value:1,unit:"month"},{value:1,unit:"year"}],v=b=>{d("select",b)};return(b,n)=>{const i=le;return V(),F(i,{options:s.map(p=>p),selected:b.duration,onSelect:v},{option:h(({option:p})=>[$("div",Fe,[$("div",Me,H(p.value)+" "+H(p.unit),1)])]),_:1},8,["options","selected"])}}}),ae=O(De,[["__scopeId","data-v-0bc945d9"]]),Le={style:{display:"flex"}},Ae={style:{display:"flex","flex-wrap":"wrap",gap:"2rem"}},We={class:"time"},Oe={class:"time"},Pe={ref:"chartRef",class:"chart"},Ie=M({__name:"ChartMEV",props:{pool:{}},setup(u){function m(e,a){var g;const l=(g=e.replace("#","").match(/.{2}/g))==null?void 0:g.map(f=>parseInt(f,16));return l?`#${l.map(f=>Math.max(0,Math.floor(f*(1-a)))).map(f=>f.toString(16).padStart(2,"0")).join("")}`:e}const d=P(),s=C(()=>({volume:d.value.colors.red,bars:[d.value.colorsArray[1],m(d.value.colorsArray[1],.33),d.value.colorsArray[0],m(d.value.colorsArray[0],.33)]})),{items:v,toggles:b,disabled:n}=z(()=>[{id:"atomic",label:"Atomic",color:s.value.bars[0],togglable:!0},{id:"cexdex",label:"Cexdex",color:s.value.bars[1],togglable:!0},{id:"within",label:"Within",color:s.value.bars[2],togglable:!0},{id:"outside",label:"Outside",color:s.value.bars[3],togglable:!0},{id:"total",label:"Volume (Total)",color:s.value.volume,togglable:!0}]),i=Y({value:1,unit:"week"}),p=Y({value:1,unit:"hour"}),{isFetching:t,data:r}=Ce(E(()=>u.pool),i,p),c=Q("card"),{chart:T,series:w}=U({createChartOptions:R(),series:[{type:"StackedBars",name:"data",options:C(()=>({priceFormat:{type:"custom",formatter:e=>`$${D(e,1,"dollar")}${W(e)}`},colors:v.value.map((e,a)=>({item:e,i:a})).filter(({item:e})=>!n.value.includes(e.id)).map(({i:e})=>e).map(e=>s.value.bars[e]),lastValueVisible:!1,priceLineVisible:!1}))},{type:N,name:"volume",options:C(()=>({priceFormat:{type:"custom",formatter:e=>`${D(e,1,"dollar")}${W(e)}`},lineWidth:2,lineType:oe.Curved,color:s.value.volume,lastValueVisible:!1,priceLineVisible:!1}))}]});A(L);function L(){if(!T.value||!w.volume||!w.data)return;const e=n.value.includes("total")?[]:r.value.map(a=>({time:a.interval_start_unixtime,value:a.full_volume})).uniqWith((a,l)=>a.time===l.time).orderBy(a=>a.time,"asc");e.length>1?(w.volume.setData(e),w.volume.applyOptions({visible:!0})):w.volume.applyOptions({visible:!1}),w.data.setData(r.value.map(a=>({time:a.interval_start_unixtime,values:[...n.value.includes("atomic")?[]:[a.atomicArbVolume],...n.value.includes("cexdex")?[]:[a.cexDexArbVolume],...n.value.includes("within")?[]:[a.sandwichVolume_LossWithin],...n.value.includes("outside")?[]:[a.sandwichVolume_LossOutside]]})).uniqWith((a,l)=>a.time===l.time).orderBy(a=>a.time,"asc")),T.value.timeScale().fitContent()}return(e,a)=>{const l=x,y=J,g=I;return V(),F(g,{ref_key:"card",ref:c,title:"MEV",loading:o(t)},{actions:h(()=>[$("div",Le,[_(l,{chart:o(T),target:o(c)},null,8,["chart","target"])])]),"actions-secondary":h(()=>[$("div",Ae,[_(y,{items:o(v),disabled:o(n),onToggle:a[0]||(a[0]=f=>o(b)[f].value=!o(b)[f].value)},null,8,["items","disabled"]),$("div",We,[a[3]||(a[3]=$("span",null,"Duration:",-1)),_(ae,{duration:o(i),onSelect:a[1]||(a[1]=f=>i.value=f)},null,8,["duration"])]),$("div",Oe,[a[4]||(a[4]=$("span",null,"Interval:",-1)),_(ae,{duration:o(p),onSelect:a[2]||(a[2]=f=>p.value=f)},null,8,["duration"])])])]),default:h(()=>[$("div",Pe,null,512)]),_:1},8,["loading"])}}}),Ue=O(Ie,[["__scopeId","data-v-7cf8ebb6"]]),Re={class:"dashboard-grid"},Ee=M({__name:"MEV",props:{pool:{}},setup(u){const m=C(()=>u.pool.address);return(d,s)=>(V(),G("div",Re,[_(Ue,{style:{"grid-area":"chart"},pool:o(m)},null,8,["pool"])]))}}),qe=O(Ee,[["__scopeId","data-v-a5261ecc"]]),Ne={class:"actions"},Qe={ref:"chartRef",class:"chart"},xe="chart_pool_balances_dollars",je="chart_pool_balances_type",Ge=M({__name:"ChartBalances",props:{balances:{},title:{},showDollars:{type:Boolean,default:!0},chartType:{default:"area"}},setup(u){const m=P(),{items:d,toggles:s,disabled:v}=z(()=>u.balances.map(({symbol:e},a)=>({id:e,label:e,color:m.value.colorsArray[a],togglable:!0}))),b=Q("card"),n=Z(xe,!1),i=["unstacked","stacked","100%"],p=[{id:"unstacked",label:"Unstacked"},{id:"stacked",label:"Stacked"},{id:"100%",label:"Stacked (100%)"}],t=Z(je,i[0]),{chart:r,series:c}=U({createChartOptions:R(),series:[...u.balances.map(({symbol:e},a)=>({type:N,name:e,options:C(()=>({lineWidth:2,lineType:oe.WithSteps,color:m.value.colorsArray[a],lastValueVisible:!1,priceLineVisible:!1}))})),{type:"StackedArea",name:"stackedArea",options:C(()=>({colors:d.value.map((e,a)=>({item:e,i:a})).filter(({item:e})=>!v.value.includes(e.id)).map(({i:e})=>e).map(e=>m.value.colorsArray[e]).map(e=>({line:e,area:e+"15"})),lineWidth:2,lastValueVisible:!1,priceLineVisible:!1}))},{type:"StackedBars",name:"stackedBars",options:C(()=>({colors:d.value.map((e,a)=>({item:e,i:a})).filter(({item:e})=>!v.value.includes(e.id)).map(({i:e})=>e).map(e=>m.value.colorsArray[e]),lineWidth:2,lastValueVisible:!1,priceLineVisible:!1}))}]});A(()=>{r.value&&r.value.applyOptions({localization:{priceFormatter:t.value==="100%"?e=>`${D(e,0,"percentage")}%`:e=>`${D(e,1,"dollar")}${W(e)}`}})}),A(T);function T(){if(!(!r.value||Object.values(c).length<0)){for(const e of Object.values(c))e==null||e.setData([]);t.value==="unstacked"?w():L(t.value==="100%"),r.value.timeScale().fitContent()}}function w(){var e,a;for(const{symbol:l,balances:y}of u.balances.values()){if(!s[l].value){(e=c[l])==null||e.setData([]);continue}const g=u.showDollars&&n.value,f=y.map(S=>({time:S.timestamp.getUTCTimestamp(),value:g?S.balance*S.tokenPrice:S.balance})).uniqWith((S,k)=>S.time===k.time).orderBy(S=>S.time,"asc");f.length>0&&((a=c[l])==null||a.setData(f))}}function L(e){if(!c.stackedArea||!c.stackedBars)return;const a=u.showDollars&&n.value,l=[...u.balances.values()].filter(({symbol:y,balances:g})=>s[y].value&&g.length>0).flatMap(({symbol:y,balances:g})=>g.map(f=>({symbol:y,timestamp:f.timestamp,balance:a?f.balance*f.tokenPrice:f.balance}))).groupBy(y=>y.timestamp.getTime()).entries().map(([y,g])=>{const f=e&&g.sumBy(k=>k.balance)||1,S=g.map(k=>e?k.balance/f*100:k.balance);return{time:Number(y)/1e3,values:S}}).uniqWith((y,g)=>y.time===g.time).orderBy(y=>y.time,"asc");l.length>0&&(u.chartType==="area"?(c.stackedArea.setData(l),c.stackedBars.setData([])):(c.stackedArea.setData([]),c.stackedBars.setData(l)))}return(e,a)=>{const l=le,y=ne,g=$e,f=x,S=J,k=I;return V(),F(k,{ref_key:"card",ref:b,class:"stack-actions",title:e.title??"Balances"},{actions:h(()=>[$("div",Ne,[ce(e.$slots,"actions",{},void 0,!0),_(l,{options:p,selected:p.find(B=>B.id===o(t))??p[0],onSelect:a[0]||(a[0]=B=>t.value=B.id)},{option:h(({option:B})=>[j(H(B.label),1)]),_:1},8,["selected"]),e.showDollars?(V(),F(g,{key:0},{trigger:h(()=>[_(y,{"model-value":o(n),onClick:a[1]||(a[1]=B=>n.value=!o(n))},{default:h(()=>a[3]||(a[3]=[j(" $ ")])),_:1,__:[3]},8,["model-value"])]),default:h(()=>[a[4]||(a[4]=j(" Show token balances in USD. "))]),_:1,__:[4]})):q("",!0),_(f,{chart:o(r),target:o(b)},null,8,["chart","target"])])]),"actions-secondary":h(()=>[_(S,{items:o(d),disabled:o(v),onToggle:a[2]||(a[2]=B=>o(s)[B].value=!o(s)[B].value)},null,8,["items","disabled"])]),default:h(()=>[$("div",Qe,null,512)]),_:3},8,["title"])}}}),Ke=O(Ge,[["__scopeId","data-v-ca373428"]]),He={class:"controls"},Ye={ref:"chartRef",class:"chart"},ze=M({__name:"ChartPrice",props:{ohlc:{},minMove:{default:()=>{}}},setup(u){const m=P(),d=Y(!1);let s=1,v=0;const{chart:b,series:n}=U({createChartOptions:R(),series:{type:ye,name:"ohlc",options:C(()=>{const{colors:t}=m.value;return{priceFormat:{type:"custom",formatter:p,minMove:u.minMove},upColor:t.green,borderUpColor:t.green,wickUpColor:t.green,downColor:t.red,borderDownColor:t.red,wickDownColor:t.red}})}});A(i);function i(){if(!b.value||!n.ohlc)return;const t=d.value?-1:1,r=u.ohlc.map(c=>({time:c.time.getUTCTimestamp(),open:Math.pow(c.open,t),high:Math.pow(c.high,t),low:Math.pow(c.low,t),close:Math.pow(c.close,t)})).uniqWith((c,T)=>c.time===T.time).orderBy(c=>c.time,"asc");n.ohlc.setData(r),v=Math.min(...r.map(c=>c.low)),s=Math.max(...r.map(c=>c.high)),b.value.timeScale().fitContent()}function p(t){const r=s-v,c=r>1?r-Math.floor(r):r,T=-Math.floor(Math.log10(c)+1)+2;return`${D(t,T,"dollar")}${W(t)}`}return(t,r)=>{const c=ne,T=I;return V(),F(T,{title:"Price"},{actions:h(()=>[$("div",He,[_(c,{"model-value":o(d),onClick:r[0]||(r[0]=w=>d.value=!o(d))},{default:h(()=>r[1]||(r[1]=[j(" Invert ")])),_:1,__:[1]},8,["model-value"])])]),default:h(()=>[$("div",Ye,null,512)]),_:1})}}}),Je=O(ze,[["__scopeId","data-v-2ec926d9"]]),Xe={style:{display:"flex"}},Ze={ref:"chartRef",class:"chart"},et=M({__name:"ChartTvl",props:{tvl:{}},setup(u){const m=P(),d=Q("card"),{chart:s,series:v}=U({createChartOptions:R(),series:se({name:"tvl",color:C(()=>m.value.colors.blue),formatter:n=>`$${D(n,1,"dollar")}${W(n)}`})});A(b);function b(){if(!s.value||!v.tvl)return;const n=u.tvl.map(i=>({time:i.timestamp.getUTCTimestamp(),value:i.tvl})).uniqWith((i,p)=>i.time===p.time).orderBy(i=>i.time,"asc");n.length>0&&v.tvl.setData(n),s.value.timeScale().fitContent()}return(n,i)=>{const p=X,t=x,r=I;return V(),F(r,{ref_key:"card",ref:d,title:"TVL"},{actions:h(()=>[$("div",Xe,[_(p,{filename:"tvl",series:o(v)},null,8,["series"]),_(t,{chart:o(s),target:o(d)},null,8,["chart","target"])])]),default:h(()=>[$("div",Ze,null,512)]),_:1},512)}}}),tt={style:{display:"flex"}},at={ref:"chartRef",class:"chart"},lt=M({__name:"ChartVolume",props:{volume:{}},setup(u){const m=P(),d=Q("card"),{chart:s,series:v}=U({createChartOptions:R(),series:se({name:"volume",color:C(()=>m.value.colors.blue),formatter:n=>`$${D(n,1,"dollar")}${W(n)}`})});A(b);function b(){if(!s.value||!v.volume)return;const n=u.volume.map(i=>({time:i.timestamp.getUTCTimestamp(),value:i.volume})).uniqWith((i,p)=>i.time===p.time).orderBy(i=>i.time,"asc");n.length>0&&v.volume.setData(n),s.value.timeScale().fitContent()}return(n,i)=>{const p=X,t=x,r=I;return V(),F(r,{ref_key:"card",ref:d,title:"Volume"},{actions:h(()=>[$("div",tt,[_(p,{filename:"volume",series:o(v)},null,8,["series"]),_(t,{chart:o(s),target:o(d)},null,8,["chart","target"])])]),default:h(()=>[$("div",at,null,512)]),_:1},512)}}});function ot(u,m,d,s){return we({queryKey:["curve-token-price",m,d,s],queryFn:({queryKey:[,v,b,n]})=>Te(u.value,v,b,n),enabled:C(()=>!!u.value&&!!m.value&&!!d.value&&!!s.value),initialData:[],initialDataUpdatedAt:0})}const st={style:{display:"flex"}},nt={ref:"chartRef",class:"chart"},it=M({__name:"ChartParameters",props:{parameters:{}},setup(u){const m=P(),{items:d,toggles:s,disabled:v}=z(()=>{const{blue:t,yellow:r,purple:c}=m.value.colors;return[{id:"fees",label:"Fee",color:t,togglable:!0},{id:"a",label:"A",color:r,togglable:!0},{id:"offpegFeeMultiplier",label:"Offpeg Fee Multiplier",color:c,togglable:!0}]});s.offpegFeeMultiplier.value=!1;const b=Q("card"),{chart:n,series:i}=U({createChartOptions:R(C(()=>({leftPriceScale:{visible:s.a.value||s.offpegFeeMultiplier.value}}))),series:[{type:N,name:"fees",options:C(()=>({priceFormat:{type:"custom",formatter:t=>`$${D(t,1,"dollar")}${W(t)}`,minMove:1},lineWidth:2,color:m.value.colors.blue,lastValueVisible:!1,priceLineVisible:!1}))},{type:N,name:"a",options:C(()=>({priceFormat:{type:"custom",formatter:t=>`${Math.round(t)}`,minMove:1},priceScaleId:"left",lineWidth:2,color:m.value.colors.yellow,lastValueVisible:!1,priceLineVisible:!1}))},{type:N,name:"offpegFeeMultiplier",options:C(()=>({priceScaleId:"left",lineWidth:2,color:m.value.colors.purple,lastValueVisible:!1,priceLineVisible:!1}))}]});A(p);function p(){!n.value||!i.fees||!i.a||!i.offpegFeeMultiplier||(i.fees.setData(u.parameters.map(t=>({time:t.timestamp.getUTCTimestamp(),value:t.fees})).uniqWith((t,r)=>t.time===r.time).orderBy(t=>t.time,"asc")),i.a.setData(u.parameters.map(t=>({time:t.timestamp.getUTCTimestamp(),value:t.a})).uniqWith((t,r)=>t.time===r.time).orderBy(t=>t.time,"asc")),i.offpegFeeMultiplier.setData(u.parameters.map(t=>({time:t.timestamp.getUTCTimestamp(),value:t.offpegFeeMultiplier})).uniqWith((t,r)=>t.time===r.time).orderBy(t=>t.time,"asc")),i.fees.applyOptions({visible:s.fees.value}),i.a.applyOptions({visible:s.a.value}),i.offpegFeeMultiplier.applyOptions({visible:s.offpegFeeMultiplier.value}),n.value.timeScale().fitContent())}return(t,r)=>{const c=X,T=x,w=J,L=I;return V(),F(L,{ref_key:"card",ref:b,title:"Parameters & Fees",class:"stack-actions"},{actions:h(()=>[$("div",st,[_(c,{filename:"parameters_and_fees",series:o(i)},null,8,["series"]),_(T,{chart:o(n),target:o(b)},null,8,["chart","target"])])]),"actions-secondary":h(()=>[_(w,{items:o(d),disabled:o(v),onToggle:r[0]||(r[0]=e=>o(s)[e].value=!o(s)[e].value)},null,8,["items","disabled"])]),default:h(()=>[$("div",nt,null,512)]),_:1},512)}}}),rt={class:"dashboard-grid"},ct={class:"tokens"},ut=M({__name:"PoolOverview",props:{pool:{},chain:{}},setup(u){const m=C(()=>{var l;return(l=u.pool)==null?void 0:l.address}),d=C(()=>{var l;return(l=u.pool)==null?void 0:l.coins[0].address}),s=C(()=>{var l;return(l=u.pool)==null?void 0:l.coins[1].address}),{isFetching:v,data:b}=ot(E(()=>u.chain),m,d,s),{isFetching:n,data:i}=_e(E(()=>u.chain),m),{isFetching:p,data:t}=he(E(()=>u.chain),m),{isFetching:r,data:c}=ge(E(()=>u.chain),m),T=C(()=>i.value.map(l=>({timestamp:l.timestamp,volume:l.volume}))),w=C(()=>t.value.map(l=>({timestamp:l.timestamp,tvl:l.tvlUSD}))),L=C(()=>u.pool?u.pool.coins.map(l=>({symbol:l.symbol,balances:t.value.map(y=>({timestamp:y.timestamp,balance:y.balances[l.poolIndex],tokenPrice:y.tokenPrices[l.poolIndex]}))})):[]),e=C(()=>r.value||n.value),a=C(()=>[...c.value,...i.value].groupBy(l=>l.timestamp.getTime()).entries().filter(([,l])=>l.length===2).map(([,l])=>{var B;const y=l[0].timestamp,g=l.find(K=>"a"in K),f=(g==null?void 0:g.offpegFeeMultiplier)??0,S=(g==null?void 0:g.a)??0,k=((B=l.find(K=>"volume"in K))==null?void 0:B.fees)??0;return{timestamp:y,fees:k,a:S,offpegFeeMultiplier:f}}));return(l,y)=>{const g=Se,f=Ve,S=ke;return V(),G("div",rt,[_(f,{style:{"grid-area":"kpi1"},label:"Tokens","has-value":!!l.pool},{default:h(()=>{var k;return[$("div",ct,[(V(!0),G(ue,null,me(((k=l.pool)==null?void 0:k.coins)??[],B=>(V(),F(g,{key:B.address,clickable:"",chain:l.chain,address:B.address},null,8,["chain","address"]))),128))])]}),_:1},8,["has-value"]),_(f,{style:{"grid-area":"kpi2"},label:"TVL","has-value":!!l.pool},{default:h(()=>{var k;return[_(S,{type:"dollar",value:((k=l.pool)==null?void 0:k.tvlUsd)??0},null,8,["value"])]}),_:1},8,["has-value"]),_(f,{style:{"grid-area":"kpi3"},label:"Volume (24h)","has-value":!!l.pool},{default:h(()=>{var k;return[_(S,{type:"dollar",value:((k=l.pool)==null?void 0:k.tradingVolume24h)??0},null,8,["value"])]}),_:1},8,["has-value"]),_(f,{style:{"grid-area":"kpi4"},label:"Fees (24h)","has-value":!!l.pool},{default:h(()=>{var k;return[_(S,{type:"dollar",value:((k=l.pool)==null?void 0:k.tradingFee24h)??0},null,8,["value"])]}),_:1},8,["has-value"]),_(Je,{style:{"grid-area":"price"},ohlc:o(b),loading:o(v)},null,8,["ohlc","loading"]),_(lt,{style:{"grid-area":"volume"},volume:o(T),loading:o(n)},null,8,["volume","loading"]),_(et,{style:{"grid-area":"tvl"},tvl:o(w),loading:o(p)},null,8,["tvl","loading"]),_(Ke,{style:{"grid-area":"balances"},balances:o(L),loading:o(p)},null,8,["balances","loading"]),_(it,{style:{"grid-area":"parameters"},parameters:o(a),loading:o(e)},null,8,["parameters","loading"])])}}}),mt=O(ut,[["__scopeId","data-v-b4aea8e2"]]),dt={class:"dashboard"},pt=M({__name:"Pool.page",setup(u){const m=te("chain"),d=te("poolAddr"),{isFetching:s,data:v}=be(m,d.value),{crumbs:b}=de(pe());ve(v,p=>{b.value=[{id:"pools",label:"Pools",pathName:"pools",params:()=>({chain:m.value})},{id:"pool",label:`Pool: ${(p==null?void 0:p.name)??"?"}`}]},{immediate:!0});const{tabActive:n,tabActiveIndex:i}=Be(["overview","mev"],"poolspool",()=>({chain:m.value,poolAddr:d.value}));return(p,t)=>{const r=fe,c=ie,T=re;return V(),G("div",dt,[_(r,{loading:o(s)},null,8,["loading"]),!o(s)&&o(v)?(V(),F(T,{key:0,active:o(i),onTab:t[0]||(t[0]=w=>i.value=w.index)},{default:h(()=>[_(c,{header:"Overview"},{default:h(()=>[(V(),F(ee,null,[o(n)==="overview"?(V(),F(mt,{key:0,pool:o(v),chain:o(m)},null,8,["pool","chain"])):q("",!0)],1024))]),_:1}),o(m)==="ethereum"&&o(v)?(V(),F(c,{key:0,header:"MEV"},{default:h(()=>[(V(),F(ee,null,[o(n)==="mev"?(V(),F(qe,{key:0,pool:o(v)},null,8,["pool"])):q("",!0)],1024))]),_:1})):q("",!0)]),_:1},8,["active"])):q("",!0)])}}}),Wt=O(pt,[["__scopeId","data-v-e7d124fd"]]);export{Wt as default};
