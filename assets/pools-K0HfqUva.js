import{f as q,g as R,t as P}from"./timestamp-X9wFVw8g.js";import{t as w,f as m,g as h,a as F}from"./timestamp-DkvXAN4c.js";import{Q as S,u as d}from"./useQuery-D8XvWkTZ.js";import{ab as k,ac as b,ad as K,ae as C,f as u,u as v,af as E,ag as M,N as g,ah as V,ai as T,aj as U,a9 as A}from"./index-m8__8Pbb.js";import{u as H}from"./UseHost-DA63TOHp.js";function _(e,t){const s=new Set(t);return e.filter(a=>!s.has(a))}function j(e,t,s){const a=e.slice(0);return a[t]=s,a}var z=class extends k{#a;#e;#r;#i;#t;#s;#n;#o;#u=[];constructor(e,t,s){super(),this.#a=e,this.#i=s,this.#r=[],this.#t=[],this.#e=[],this.setQueries(t)}onSubscribe(){this.listeners.size===1&&this.#t.forEach(e=>{e.subscribe(t=>{this.#h(e,t)})})}onUnsubscribe(){this.listeners.size||this.destroy()}destroy(){this.listeners=new Set,this.#t.forEach(e=>{e.destroy()})}setQueries(e,t){this.#r=e,this.#i=t,b.batch(()=>{const s=this.#t,a=this.#p(this.#r);this.#u=a,a.forEach(n=>n.observer.setOptions(n.defaultedQueryOptions));const r=a.map(n=>n.observer),i=r.map(n=>n.getCurrentResult()),o=r.some((n,l)=>n!==s[l]);s.length===r.length&&!o||(this.#t=r,this.#e=i,this.hasListeners()&&(_(s,r).forEach(n=>{n.destroy()}),_(r,s).forEach(n=>{n.subscribe(l=>{this.#h(n,l)})}),this.#d()))})}getCurrentResult(){return this.#e}getQueries(){return this.#t.map(e=>e.getCurrentQuery())}getObservers(){return this.#t}getOptimisticResult(e,t){const s=this.#p(e),a=s.map(r=>r.observer.getOptimisticResult(r.defaultedQueryOptions));return[a,r=>this.#c(r??a,t),()=>this.#l(a,s)]}#l(e,t){return t.map((s,a)=>{const r=e[a];return s.defaultedQueryOptions.notifyOnChangeProps?r:s.observer.trackResult(r,i=>{t.forEach(o=>{o.observer.trackProp(i)})})})}#c(e,t){return t?((!this.#s||this.#e!==this.#o||t!==this.#n)&&(this.#n=t,this.#o=this.#e,this.#s=K(this.#s,t(e))),this.#s):e}#p(e){const t=new Map(this.#t.map(a=>[a.options.queryHash,a])),s=[];return e.forEach(a=>{const r=this.#a.defaultQueryOptions(a),i=t.get(r.queryHash);i?s.push({defaultedQueryOptions:r,observer:i}):s.push({defaultedQueryOptions:r,observer:new S(this.#a,r)})}),s}#h(e,t){const s=this.#t.indexOf(e);s!==-1&&(this.#e=j(this.#e,s,t),this.#d())}#d(){if(this.hasListeners()){const e=this.#s,t=this.#l(this.#e,this.#u),s=this.#c(t,this.#i?.combine);e!==s&&b.batch(()=>{this.listeners.forEach(a=>{a(this.#e)})})}}};function I({queries:e,...t},s){const a=C(),r=u(()=>v(e).map(f=>{const p=E(f);typeof p.enabled=="function"&&(p.enabled=f.enabled());const y=a.defaultQueryOptions(p);return y._optimisticResults=a.isRestoring?.value?"isRestoring":"optimistic",y})),i=new z(a,r.value,t),o=()=>{const[c,f]=i.getOptimisticResult(r.value,t.combine);return f(c.map((p,y)=>({...p,refetch:async(...$)=>{const[{[y]:D}]=i.getOptimisticResult(r.value,t.combine);return D.refetch(...$)}})))},n=M(o());let l=()=>{};return a.isRestoring&&g(a.isRestoring,c=>{c||(l(),l=i.subscribe(()=>{n.value=o()}),n.value=o())},{immediate:!0}),g(r,c=>{i.setQueries(c,t),n.value=o()}),V(()=>{l()}),t.shallow?T(n):U(n)}const J=e=>({tvl:e.total_tvl,tradingVolume24h:e.trading_volume_24h,tradingFee24h:e.trading_fee_24h,liquidityVolume24h:e.liquidity_volume_24h,liquidityFee24h:e.liquidity_fee_24h}),O=e=>({name:e.name,address:e.address,numCoins:e.n_coins,tvlUsd:e.tvl_usd,tradingVolume24h:e.trading_volume_24h,tradingFee24h:e.trading_fee_24h,liquidityVolume24h:e.liquidity_volume_24h,liquidityFee24h:e.liquidity_fee_24h,coins:e.coins?.map(t=>({poolIndex:t.pool_index,symbol:t.symbol,address:t.address}))??[],baseDailyApr:e.base_daily_apr,baseWeeklyApr:e.base_weekly_apr,virtualPrice:e.virtual_price,poolMethods:e.pool_methods?.map(t=>t)??[]}),L=e=>({timestamp:w(e.timestamp),volume:e.volume,fees:e.fees}),W=e=>({timestamp:w(e.timestamp),tvlUSD:e.tvl_usd??0,balances:[...e.balances],tokenPrices:[...e.token_prices]});async function G(e,t=1,s=9999,a){const r=h(a),i=await m(`${r}/v1/chains/${e}?page=${t}&per_page=${s}`);return{chain:i.chain,totals:J(i.total),pools:i.data.map(O)}}async function Q(e,t,s){const a=h(s),r=await m(`${a}/v1/pools/${e}/${t}`);return O(r)}async function N(e,t,s){const a=h(s),{start:r,end:i}=F({daysRange:90});return(await m(`${a}/v1/snapshots/${e}/${t}/tvl?interval=day&start=${r}&end=${i}`)).data.map(W)}function ae(e){return d({queryKey:["curve-pools",e],queryFn:async({queryKey:[,t]})=>{const s=await H();return G(t,1,9999,{host:s})},placeholderData:A,enabled:u(()=>!!e.value)})}function re(e,t){return d({queryKey:["curve-pool",t],queryFn:async({queryKey:[,s]})=>Q(e.value,s),enabled:u(()=>!!e.value)})}function ie(e,t){const s=u(()=>t.value.map(a=>({queryKey:["curve-pool",a],queryFn:()=>Q(e.value,a),enabled:u(()=>!!e.value)})));return I({queries:s})}async function B(e,t,s,a){const r=h(a),{start:i,end:o}=R({daysRange:s});return(await q(`${r}/v1/volume/usd/${e}/${t}?interval=day&start=${i}&end=${o}`)).data.map(L)}function ne(e,t,s=90){const a=u(()=>v(s));return d({queryKey:["curve-pool-volume",t,a],queryFn:async({queryKey:[,r]})=>B(e.value,r,a.value),enabled:u(()=>!!e.value&&!!t.value),initialData:[],initialDataUpdatedAt:0})}function oe(e,t){return d({queryKey:["curve-pool-tvl",t],queryFn:async({queryKey:[,s]})=>N(e.value,s),enabled:u(()=>!!e.value&&!!t.value),initialData:[],initialDataUpdatedAt:0})}const X=e=>({timestamp:P(e.timestamp),a:e.a,fee:e.fee,adminFee:e.admin_fee,virtualPrice:e.virtual_price,xcpProfit:e.xcp_profit??void 0,xcpProfitA:e.xcp_profit_a??void 0,baseDailyApr:e.base_daily_apr,baseWeeklyApr:e.base_weekly_apr,offpegFeeMultiplier:e.offpeg_fee_multiplier??void 0,gamma:e.gamma??void 0,midFee:e.mid_fee??void 0,outFee:e.out_fee??void 0,feeGamma:e.fee_gamma??void 0,allowedExtraProfit:e.allowed_extra_profit??void 0,adjustmentStep:e.adjustment_step??void 0,maHalfTime:e.ma_half_time??void 0,priceScale:[...e.price_scale??[]],priceOracle:[...e.price_oracle??[]]});async function Y(e,t,s,a){const r=h(a),{start:i,end:o}=R({daysRange:s});return(await q(`${r}/v1/snapshots/${e}/${t}?unit=day&start=${i}&end=${o}`)).data.map(X)}function ue(e,t,s=90){const a=u(()=>v(s));return d({queryKey:["curve-pool-snapshots",t,a],queryFn:async({queryKey:[,r]})=>Y(e.value,r,a.value),enabled:u(()=>!!e.value&&!!t.value),initialData:[],initialDataUpdatedAt:0})}export{ne as a,ue as b,oe as c,re as d,ie as e,ae as u};
