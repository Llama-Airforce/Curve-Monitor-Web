import{t as u,f as n,g as d,b as _}from"./timestamp-Dfir0V72.js";import{u as i}from"./useQuery-DHettQXn.js";import{f as r}from"./index-D_ZRdWWY.js";const p=e=>({name:e.name,controller:e.controller,vault:e.vault,llamma:e.llamma,policy:e.policy,oracle:e.oracle,oraclePools:e.oracle_pools,rate:e.rate,apyBorrow:e.borrow_apy,apyLend:e.lend_apy,nLoans:e.n_loans,priceOracle:e.price_oracle,ammPrice:e.amm_price,basePrice:e.base_price,totalDebt:e.total_debt,totalAssets:e.total_assets,totalDebtUsd:e.total_debt_usd,totalAssetsUsd:e.total_assets_usd,minted:e.minted,redeemed:e.redeemed,mintedUsd:e.minted_usd,redeemedUsd:e.redeemed_usd,loanDiscount:e.loan_discount,liquidationDiscount:e.liquidation_discount,minBand:e.min_band,maxBand:e.max_band,collateralBalance:e.collateral_balance,borrowedBalance:e.borrowed_balance,collateralBalanceUsd:e.collateral_balance_usd,borrowedBalanceUsd:e.borrowed_balance_usd,collateralToken:{symbol:e.collateral_token.symbol,address:e.collateral_token.address},borrowedToken:{symbol:e.borrowed_token.symbol,address:e.borrowed_token.address},leverage:e.leverage}),m=e=>({rate:parseFloat(e.rate),borrowApy:parseFloat(e.borrow_apy)/100,lendApy:parseFloat(e.lend_apy)/100,numLoans:e.n_loans,priceOracle:parseFloat(e.price_oracle),ammPrice:parseFloat(e.amm_price),totalDebt:parseFloat(e.total_debt),totalDebtUsd:parseFloat(e.total_debt_usd),totalAssets:parseFloat(e.total_assets),totalAssetsUsd:parseFloat(e.total_assets_usd),minted:parseFloat(e.minted),redeemed:parseFloat(e.redeemed),collateralBalance:parseFloat(e.collateral_balance),collateralBalanceUsd:parseFloat(e.collateral_balance_usd),borrowedBalance:parseFloat(e.borrowed_balance),borrowedBalanceUsd:parseFloat(e.borrowed_balance_usd),timestamp:u(e.timestamp),discountLiquidation:e.liquidation_discount,discountLoan:e.loan_discount}),b=e=>e.markets.map(a=>({name:a.market_name,controller:a.controller,snapshotFirst:u(a.first_snapshot),snapshotLast:u(a.last_snapshot)})),v=e=>({health:e.health,healthFull:e.health_full,n:e.n,n1:e.n1,n2:e.n2,debt:e.debt,collateral:e.collateral,collateralUp:e.collateral_up,borrowed:e.borrowed,softLiquidation:e.soft_liquidation,totalDeposited:e.total_deposited,loss:e.loss,lossPct:e.loss_pct,oraclePrice:e.oracle_price,blockNumber:e.block_number,timestamp:u(e.timestamp)}),g=e=>e.data.map(v),h=e=>({controller:e.controller,user:e.user,totalDeposit:e.total_deposit,totalDepositUsd:e.total_deposit_usd_value,totalDepositFromUser:e.total_deposit_from_user,totalDepositFromUserPrecise:e.total_deposit_from_user_precise,totalDepositPrecise:e.total_deposit_precise,totalBorrowed:e.total_borrowed,totalBorrowedPrecise:e.total_borrowed_precise,events:e.data.map(a=>({timestamp:u(a.dt),txHash:a.transaction_hash,type:a.type,user:a.user,collateralChange:a.collateral_change,collateralChangeUsd:a.collateral_change_usd??void 0,loanChange:a.loan_change,loanChangeUsd:a.loan_change_usd??void 0,liquidation:a.liquidation===null?void 0:{user:a.liquidation.user,liquidator:a.liquidation.liquidator,collateralReceived:a.liquidation.collateral_received,collateralReceivedUsd:a.liquidation.collateral_received_usd,stablecoinReceived:a.liquidation.stablecoin_received,stablecoinReceivedUsd:a.liquidation.stablecoin_received_usd,debt:a.liquidation.debt,debtUsd:a.liquidation.debt_usd},leverage:a.leverage===null?void 0:{type:a.leverage.event_type,user:a.leverage.user,userCollateral:a.leverage.user_collateral,userCollateralFromBorrowed:a.leverage.user_collateral_from_borrowed,userCollateralUsed:a.leverage.user_collateral_used,userBorrowed:a.leverage.user_borrowed,debt:a.leverage.debt,leverageCollateral:a.leverage.leverage_collateral,stateCollateralUsed:a.leverage.state_collateral_used,borrowedFromStateCollateral:a.leverage.borrowed_from_state_collateral,borrowedFromUserCollateral:a.leverage.borrowed_from_user_collateral},n1:a.n1,n2:a.n2,oraclePrice:a.oracle_price}))});async function f(e){const a=d(e);return n(`${a}/v1/lending/chains`).then(t=>t.data)}async function q(e,a={fetch_on_chain:!0},t){const l=d(t);return(await n(`${l}/v1/lending/markets/${e}${_(a)}`)).data.map(p)}async function w(e,a,t={fetch_on_chain:!0,agg:"day"},l){const o=d(l);return(await n(`${o}/v1/lending/markets/${e}/${a}/snapshots${_(t)}`)).data.map(m)}async function U(e,a,t){const l=d(t),o=await n(`${l}/v1/lending/users/${a}/${e}?page=1&per_page=100&include_closed=false`);return b(o)}async function y(e,a,t,l){const o=d(l),s=await n(`${o}/v1/lending/users/${a}/${e}/${t}/snapshots?page=1&per_page=100`);return g(s)}async function F(e,a,t,l){const o=d(l),s=await n(`${o}/v1/lending/collateral_events/${a}/${t}/${e}`);return h(s)}function c(){return{initialData:[],initialDataUpdatedAt:0}}function C(){return i({queryKey:["llamalend-chains"],queryFn:()=>f(),initialData:["ethereum","arbitrum"],initialDataUpdatedAt:0})}function B(e){return i({queryKey:["llamalend-markets",e],queryFn:({queryKey:[,a]})=>q(a)})}function M(e,a){return i({queryKey:["llamalend-market-snapshots",r(()=>{var t;return(t=e.value)==null?void 0:t.controller})],queryFn:({queryKey:[,t]})=>w(a.value,t),...c(),enabled:r(()=>!!e.value&&!!a.value)})}function K(e,a){return i({queryKey:["llamalend-user-markets",r(()=>e.value),r(()=>a.value)],queryFn:({queryKey:[,t,l]})=>U(t,l),enabled:r(()=>!!e.value&&!!a.value),...c()})}function P(e,a,t){return i({queryKey:["llamalend-user-market-snapshots",r(()=>e.value),r(()=>a.value),r(()=>t.value)],queryFn:({queryKey:[,l,o,s]})=>y(l,o,s),enabled:r(()=>!!e.value&&!!a.value&&!!t.value),...c()})}function A(e,a,t){return i({queryKey:["llamalend-user-market-events",r(()=>e.value),r(()=>a.value),r(()=>t.value)],queryFn:({queryKey:[,l,o,s]})=>F(l,o,s),enabled:r(()=>!!e.value&&!!a.value&&!!t.value)})}export{A as a,K as b,B as c,C as d,M as e,P as u};
