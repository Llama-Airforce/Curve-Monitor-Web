import{t as d,f as i,g as c,b as _,a as v}from"./timestamp-CeU_tFUE.js";import{g as y}from"./api-BL5-_Coi.js";import{u as n}from"./useQuery-DlYtpHcB.js";import{f as l,u as b}from"./index-CVF9rKRH.js";const h=e=>({name:e.collateral_token.symbol,address:e.address,factoryAddress:e.factory_address,llamma:e.llamma,rate:e.rate,borrowed:e.total_debt,borrowable:e.borrowable,collateralAmount:e.collateral_amount,collateralAmountUsd:e.collateral_amount_usd,debtCeiling:e.debt_ceiling,loans:e.n_loans,collateralToken:{symbol:e.collateral_token.symbol,address:e.collateral_token.address},stablecoinToken:{symbol:e.stablecoin_token.symbol,address:e.stablecoin_token.address},fees:{pending:e.pending_fees,collected:e.collected_fees}}),f=e=>({timestamp:d(e.dt),rate:e.rate,nLoans:e.n_loans,minted:e.minted,redeemed:e.redeemed,totalCollateral:e.total_collateral,totalCollateralUsd:e.total_collateral_usd,totalStablecoin:e.total_stablecoin,totalDebt:e.total_debt,priceAMM:e.amm_price,priceOracle:e.price_oracle,borrowable:e.borrowable,discountLiquidation:e.liquidation_discount,discountLoan:e.loan_discount}),g=e=>({address:e.address,pool:e.pool,poolAddress:e.pool_address,pair:e.pair.map(t=>({symbol:t.symbol,address:t.address})),active:e.active,totalDebt:e.total_debt,totalProfit:e.total_profit}),q=e=>({timestamp:d(e.timestamp),market:e.market,supply:e.supply,borrowable:e.borrowable}),k=e=>e.markets.map(t=>({collateral:t.collateral,controller:t.controller,snapshotFirst:d(t.first_snapshot),snapshotLast:d(t.last_snapshot)})),U=e=>({health:e.health,healthFull:e.health_full,n:e.n,n1:e.n1,n2:e.n2,debt:e.debt,collateral:e.collateral,collateralUp:e.collateral_up,stablecoin:e.stablecoin,softLiquidation:e.soft_liquidation,totalDeposited:e.total_deposited,loss:e.loss,lossPct:e.loss_pct,oraclePrice:e.oracle_price,blockNumber:e.block_number,timestamp:d(e.timestamp)}),$=e=>e.data.map(U),w=e=>({controller:e.controller,user:e.user,totalDeposit:e.total_deposit,totalDepositPrecise:e.total_deposit_precise,totalDepositUsd:e.total_deposit_usd_value,totalBorrowed:e.total_borrowed,totalBorrowedPrecise:e.total_borrowed_precise,events:e.data.map(t=>({timestamp:d(t.dt),txHash:t.transaction_hash,type:t.type,user:t.user,collateralChange:t.collateral_change,collateralChangeUsd:t.collateral_change_usd??void 0,loanChange:t.loan_change,loanChangeUsd:t.loan_change_usd??void 0,liquidation:t.liquidation===null?void 0:{user:t.liquidation.user,liquidator:t.liquidation.liquidator,collateralReceived:t.liquidation.collateral_received,collateralReceivedUsd:t.liquidation.collateral_received_usd,stablecoinReceived:t.liquidation.stablecoin_received,debt:t.liquidation.debt},n1:t.n1,n2:t.n2,oraclePrice:t.oracle_price}))});async function K(e,t={fetch_on_chain:!0},a){const r=c(a);return(await i(`${r}/v1/crvusd/markets/${e}${_(t)}`)).data.map(h)}async function M(e,t,a={fetch_on_chain:!0,agg:"day"},r){const s=c(r);return(await i(`${s}/v1/crvusd/markets/${e}/${t}/snapshots${_(a)}`)).data.map(f)}async function S(e,t,a){const r=c(a),s=v({daysRange:t});return(await i(`${r}/v1/crvusd/markets/${e}/supply${_(s)}`)).data.map(q)}async function C(e,t){const a=c(t);return(await i(`${a}/v1/crvusd/pegkeepers/${e}`)).keepers.map(g)}async function D(e,t,a){const r=c(a),s=await i(`${r}/v1/crvusd/users/${t}/${e}?page=1&per_page=100&include_closed=false`);return k(s)}async function A(e,t,a,r){const s=c(r),o=await i(`${s}/v1/crvusd/users/${t}/${e}/${a}/snapshots?page=1&per_page=100`);return $(o)}async function F(e,t,a,r){const s=c(r),o=await i(`${s}/v1/crvusd/collateral_events/${t}/${a}/${e}`);return w(o)}function p(){return{initialData:[],initialDataUpdatedAt:0}}function T(e=30){const t=l(()=>b(e));return n({queryKey:["crvusd-supply",t],queryFn:()=>S("ethereum",t.value),...p()})}function B(e){return n({queryKey:["crvusd-market-snapshots",l(()=>{var t;return(t=e.value)==null?void 0:t.address})],queryFn:({queryKey:[,t]})=>M("ethereum",t),enabled:l(()=>!!e.value),...p()})}function H(e){return n({queryKey:["crvusd-keepers-prices",l(()=>[...new Set(e.value.map(t=>t.poolAddress))])],queryFn:async()=>{const t=e.value.map(async s=>{const o=s.pair.find(u=>u.symbol!=="crvUSD"),m=s.pair.find(u=>u.symbol==="crvUSD");return!o||!m?[]:(await y("ethereum",s.poolAddress,o.address,m.address)).map(u=>({time:u.time,price:(u.high+u.low)/2,coin:o.symbol}))}),r=(await Promise.all(t)).flat().groupBy(s=>s.time.getTime()).entries().map(([s,o])=>({timestamp:Number(s)/1e3,...Object.fromEntries(o.map(m=>[m.coin,m.price]))}));return r.length>0?r:[{timestamp:0}]},initialData:[{timestamp:0}],initialDataUpdatedAt:0})}function O(){return n({queryKey:["crvusd-markets"],queryFn:()=>K("ethereum",{page:1}),...p()})}function N(){return n({queryKey:["crvusd-keepers"],queryFn:()=>C("ethereum"),...p()})}function j(e,t){return n({queryKey:["crvusd-user-markets",l(()=>e.value),l(()=>t.value)],queryFn:({queryKey:[,a,r]})=>D(a,r),enabled:l(()=>!!e.value&&!!t.value),...p()})}function J(e,t,a){return n({queryKey:["crvusd-user-market-snapshots",l(()=>e.value),l(()=>t.value),l(()=>a.value)],queryFn:({queryKey:[,r,s,o]})=>A(r,s,o),enabled:l(()=>!!e.value&&!!t.value&&!!a.value),...p()})}function V(e,t,a){return n({queryKey:["crvusd-user-market-events",l(()=>e.value),l(()=>t.value),l(()=>a.value)],queryFn:({queryKey:[,r,s,o]})=>F(r,s,o),enabled:l(()=>!!e.value&&!!t.value&&!!a.value)})}export{J as a,V as b,j as c,T as d,B as e,N as f,H as g,O as u};
