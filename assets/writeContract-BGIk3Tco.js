const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/secp256k1-B3AIqguY.js","assets/index-BhzktTK4.js","assets/index-Bc6W-7zj.css","assets/getAction-XdBiA_oI.js"])))=>i.map(i=>d[i]);
import{k as ge,l as Ve,m as je,n as Oe,o as xe,T as Ke,b as x,q as We,r as Ye,s as Je,t as re,v as we,w as Pe,I as Qe,x as Be,y as Ie,W as Xe,e as Ze,j as et,h as K,i as tt}from"./getAction-XdBiA_oI.js";import{B as G,z as Fe,aI as nt,s as ee,D as ie,p as st,aJ as Y,aK as Ge,aL as S,x as V,aM as q,aN as C,aO as Te,aP as W,aF as j,aQ as rt,aR as J,aS as ce,aT as ot,aU as at,aV as it,aW as te,aX as ct,aY as N,y as ut,aZ as dt,a_ as ue,a$ as ne,b0 as ft,b1 as de,b2 as lt,b3 as ht,b4 as bt,b5 as pt,b6 as mt,b7 as yt,b8 as gt,b9 as xt}from"./index-BhzktTK4.js";class ke extends G{constructor({docsPath:t}={}){super(["Could not find an Account to execute with this Action.","Please provide an Account with the `account` argument on the Action, or by supplying an `account` to the Client."].join(`
`),{docsPath:t,docsSlug:"account",name:"AccountNotFoundError"})}}class Q extends G{constructor({docsPath:t,metaMessages:n,type:s}){super(`Account type "${s}" is not supported.`,{docsPath:t,metaMessages:n,name:"AccountTypeNotSupportedError"})}}function wt(e){const t=Fe(`0x${e.substring(4)}`).substring(26);return nt(`0x${t}`)}async function Pt({hash:e,signature:t}){const n=ee(e)?e:ie(e),{secp256k1:s}=await st(async()=>{const{secp256k1:a}=await import("./secp256k1-B3AIqguY.js");return{secp256k1:a}},__vite__mapDeps([0,1,2,3]));return`0x${(()=>{if(typeof t=="object"&&"r"in t&&"s"in t){const{r:u,s:l,v:c,yParity:f}=t,p=Number(f??c),b=fe(p);return new s.Signature(Y(u),Y(l)).addRecoveryBit(b)}const a=ee(t)?t:ie(t);if(Ge(a)!==65)throw new Error("invalid signature length");const d=S(`0x${a.slice(130)}`),i=fe(d);return s.Signature.fromCompact(a.substring(2,130)).addRecoveryBit(i)})().recoverPublicKey(n.substring(2)).toHex(!1)}`}function fe(e){if(e===0||e===1)return e;if(e===27)return 0;if(e===28)return 1;throw new Error("Invalid yParityOrV value")}async function Bt({hash:e,signature:t}){return wt(await Pt({hash:e,signature:t}))}function It(e,t="hex"){const n=Ne(e),s=ge(new Uint8Array(n.length));return n.encode(s),t==="hex"?V(s.bytes):s.bytes}function Ne(e){return Array.isArray(e)?Ft(e.map(t=>Ne(t))):Gt(e)}function Ft(e){const t=e.reduce((r,o)=>r+o.length,0),n=Ce(t);return{length:t<=55?1+t:1+n+t,encode(r){t<=55?r.pushByte(192+t):(r.pushByte(247+n),n===1?r.pushUint8(t):n===2?r.pushUint16(t):n===3?r.pushUint24(t):r.pushUint32(t));for(const{encode:o}of e)o(r)}}}function Gt(e){const t=typeof e=="string"?q(e):e,n=Ce(t.length);return{length:t.length===1&&t[0]<128?1:t.length<=55?1+t.length:1+n+t.length,encode(r){t.length===1&&t[0]<128?r.pushBytes(t):t.length<=55?(r.pushByte(128+t.length),r.pushBytes(t)):(r.pushByte(183+n),n===1?r.pushUint8(t.length):n===2?r.pushUint16(t.length):n===3?r.pushUint24(t.length):r.pushUint32(t.length),r.pushBytes(t))}}}function Ce(e){if(e<2**8)return 1;if(e<2**16)return 2;if(e<2**24)return 3;if(e<2**32)return 4;throw new G("Length is too large.")}function Tt(e){const{chainId:t,nonce:n,to:s}=e,r=e.contractAddress??e.address,o=Fe(Ve(["0x05",It([t?C(t):"0x",r,n?C(n):"0x"])]));return s==="bytes"?q(o):o}async function ve(e){const{authorization:t,signature:n}=e;return Bt({hash:Tt(t),signature:n??t})}function kt({chain:e,currentChainId:t}){if(!e)throw new je;if(t!==e.id)throw new Oe({chain:e,currentChainId:t})}function Nt(e,{docsPath:t,...n}){const s=(()=>{const r=xe(e,n);return r instanceof Te?e:r})();return new Ke(s,{docsPath:t,...n})}async function Ee(e){const t=await e.request({method:"eth_chainId"},{dedupe:!0});return S(t)}class Ct extends G{constructor(){super("`baseFeeMultiplier` must be greater than 1.",{name:"BaseFeeScalarError"})}}class oe extends G{constructor(){super("Chain does not support EIP-1559 fees.",{name:"Eip1559FeesNotSupportedError"})}}class vt extends G{constructor({maxPriorityFeePerGas:t}){super(`\`maxFeePerGas\` cannot be less than the \`maxPriorityFeePerGas\` (${W(t)} gwei).`,{name:"MaxFeePerGasTooLowError"})}}class _e extends G{constructor({blockHash:t,blockNumber:n}){let s="Block";t&&(s=`Block at hash "${t}"`),n&&(s=`Block at number "${n}"`),super(`${s} could not be found.`,{name:"BlockNotFoundError"})}}const Ae={"0x0":"legacy","0x1":"eip2930","0x2":"eip1559","0x3":"eip4844","0x4":"eip7702"};function He(e){const t={...e,blockHash:e.blockHash?e.blockHash:null,blockNumber:e.blockNumber?BigInt(e.blockNumber):null,chainId:e.chainId?S(e.chainId):void 0,gas:e.gas?BigInt(e.gas):void 0,gasPrice:e.gasPrice?BigInt(e.gasPrice):void 0,maxFeePerBlobGas:e.maxFeePerBlobGas?BigInt(e.maxFeePerBlobGas):void 0,maxFeePerGas:e.maxFeePerGas?BigInt(e.maxFeePerGas):void 0,maxPriorityFeePerGas:e.maxPriorityFeePerGas?BigInt(e.maxPriorityFeePerGas):void 0,nonce:e.nonce?S(e.nonce):void 0,to:e.to?e.to:null,transactionIndex:e.transactionIndex?Number(e.transactionIndex):null,type:e.type?Ae[e.type]:void 0,typeHex:e.type?e.type:void 0,value:e.value?BigInt(e.value):void 0,v:e.v?BigInt(e.v):void 0};return e.authorizationList&&(t.authorizationList=Et(e.authorizationList)),t.yParity=(()=>{if(e.yParity)return Number(e.yParity);if(typeof t.v=="bigint"){if(t.v===0n||t.v===27n)return 0;if(t.v===1n||t.v===28n)return 1;if(t.v>=35n)return t.v%2n===0n?1:0}})(),t.type==="legacy"&&(delete t.accessList,delete t.maxFeePerBlobGas,delete t.maxFeePerGas,delete t.maxPriorityFeePerGas,delete t.yParity),t.type==="eip2930"&&(delete t.maxFeePerBlobGas,delete t.maxFeePerGas,delete t.maxPriorityFeePerGas),t.type==="eip1559"&&delete t.maxFeePerBlobGas,t}function Et(e){return e.map(t=>({address:t.address,chainId:Number(t.chainId),nonce:Number(t.nonce),r:t.r,s:t.s,yParity:Number(t.yParity)}))}function _t(e){const t=(e.transactions??[]).map(n=>typeof n=="string"?n:He(n));return{...e,baseFeePerGas:e.baseFeePerGas?BigInt(e.baseFeePerGas):null,blobGasUsed:e.blobGasUsed?BigInt(e.blobGasUsed):void 0,difficulty:e.difficulty?BigInt(e.difficulty):void 0,excessBlobGas:e.excessBlobGas?BigInt(e.excessBlobGas):void 0,gasLimit:e.gasLimit?BigInt(e.gasLimit):void 0,gasUsed:e.gasUsed?BigInt(e.gasUsed):void 0,hash:e.hash?e.hash:null,logsBloom:e.logsBloom?e.logsBloom:null,nonce:e.nonce?e.nonce:null,number:e.number?BigInt(e.number):null,size:e.size?BigInt(e.size):void 0,timestamp:e.timestamp?BigInt(e.timestamp):void 0,transactions:t,totalDifficulty:e.totalDifficulty?BigInt(e.totalDifficulty):null}}async function R(e,{blockHash:t,blockNumber:n,blockTag:s,includeTransactions:r}={}){var l,c,f;const o=s??"latest",a=r??!1,d=n!==void 0?C(n):void 0;let i=null;if(t?i=await e.request({method:"eth_getBlockByHash",params:[t,a]},{dedupe:!0}):i=await e.request({method:"eth_getBlockByNumber",params:[d||o,a]},{dedupe:!!d}),!i)throw new _e({blockHash:t,blockNumber:n});return(((f=(c=(l=e.chain)==null?void 0:l.formatters)==null?void 0:c.block)==null?void 0:f.format)||_t)(i)}async function Ue(e){const t=await e.request({method:"eth_gasPrice"});return BigInt(t)}async function At(e,t){var o,a;const{block:n,chain:s=e.chain,request:r}=t||{};try{const d=((o=s==null?void 0:s.fees)==null?void 0:o.maxPriorityFeePerGas)??((a=s==null?void 0:s.fees)==null?void 0:a.defaultPriorityFee);if(typeof d=="function"){const u=n||await x(e,R,"getBlock")({}),l=await d({block:u,client:e,request:r});if(l===null)throw new Error;return l}if(typeof d<"u")return d;const i=await e.request({method:"eth_maxPriorityFeePerGas"});return Y(i)}catch{const[d,i]=await Promise.all([n?Promise.resolve(n):x(e,R,"getBlock")({}),x(e,Ue,"getGasPrice")({})]);if(typeof d.baseFeePerGas!="bigint")throw new oe;const u=i-d.baseFeePerGas;return u<0n?0n:u}}async function le(e,t){var f,p;const{block:n,chain:s=e.chain,request:r,type:o="eip1559"}=t||{},a=await(async()=>{var b,m;return typeof((b=s==null?void 0:s.fees)==null?void 0:b.baseFeeMultiplier)=="function"?s.fees.baseFeeMultiplier({block:n,client:e,request:r}):((m=s==null?void 0:s.fees)==null?void 0:m.baseFeeMultiplier)??1.2})();if(a<1)throw new Ct;const i=10**(((f=a.toString().split(".")[1])==null?void 0:f.length)??0),u=b=>b*BigInt(Math.ceil(a*i))/BigInt(i),l=n||await x(e,R,"getBlock")({});if(typeof((p=s==null?void 0:s.fees)==null?void 0:p.estimateFeesPerGas)=="function"){const b=await s.fees.estimateFeesPerGas({block:n,client:e,multiply:u,request:r,type:o});if(b!==null)return b}if(o==="eip1559"){if(typeof l.baseFeePerGas!="bigint")throw new oe;const b=typeof(r==null?void 0:r.maxPriorityFeePerGas)=="bigint"?r.maxPriorityFeePerGas:await At(e,{block:l,chain:s,request:r}),m=u(l.baseFeePerGas);return{maxFeePerGas:(r==null?void 0:r.maxFeePerGas)??m+b,maxPriorityFeePerGas:b}}return{gasPrice:(r==null?void 0:r.gasPrice)??u(await x(e,Ue,"getGasPrice")({}))}}class Ht extends G{constructor(t,{account:n,docsPath:s,chain:r,data:o,gas:a,gasPrice:d,maxFeePerGas:i,maxPriorityFeePerGas:u,nonce:l,to:c,value:f}){var b;const p=We({from:n==null?void 0:n.address,to:c,value:typeof f<"u"&&`${Ye(f)} ${((b=r==null?void 0:r.nativeCurrency)==null?void 0:b.symbol)||"ETH"}`,data:o,gas:a,gasPrice:typeof d<"u"&&`${W(d)} gwei`,maxFeePerGas:typeof i<"u"&&`${W(i)} gwei`,maxPriorityFeePerGas:typeof u<"u"&&`${W(u)} gwei`,nonce:l});super(t.shortMessage,{cause:t,docsPath:s,metaMessages:[...t.metaMessages?[...t.metaMessages," "]:[],"Estimate Gas Arguments:",p].filter(Boolean),name:"EstimateGasExecutionError"}),Object.defineProperty(this,"cause",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.cause=t}}function Ut(e,{docsPath:t,...n}){const s=(()=>{const r=xe(e,n);return r instanceof Te?e:r})();return new Ht(s,{docsPath:t,...n})}async function Lt(e,{address:t,blockNumber:n,blockTag:s="latest"}){const r=typeof n=="bigint"?C(n):void 0,o=await e.request({method:"eth_getBalance",params:[t,r||s]});return BigInt(o)}async function zt(e,t){var r,o,a;const{account:n=e.account}=t,s=n?j(n):void 0;try{let v=function(H){const{block:D,request:U,rpcStateOverride:M}=H;return e.request({method:"eth_estimateGas",params:M?[U,D??"latest",M]:D?[U,D]:[U]})};const{accessList:d,authorizationList:i,blobs:u,blobVersionedHashes:l,blockNumber:c,blockTag:f,data:p,gas:b,gasPrice:m,maxFeePerBlobGas:B,maxFeePerGas:h,maxPriorityFeePerGas:y,nonce:g,value:L,stateOverride:k,...w}=await $e(e,{...t,parameters:(s==null?void 0:s.type)==="local"?void 0:["blobVersionedHashes"]}),T=(typeof c=="bigint"?C(c):void 0)||f,P=Je(k),E=await(async()=>{if(w.to)return w.to;if(i&&i.length>0)return await ve({authorization:i[0]}).catch(()=>{throw new G("`to` is required. Could not infer from `authorizationList`")})})();re(t);const F=(a=(o=(r=e.chain)==null?void 0:r.formatters)==null?void 0:o.transactionRequest)==null?void 0:a.format,$=(F||we)({...Pe(w,{format:F}),from:s==null?void 0:s.address,accessList:d,authorizationList:i,blobs:u,blobVersionedHashes:l,data:p,gas:b,gasPrice:m,maxFeePerBlobGas:B,maxFeePerGas:h,maxPriorityFeePerGas:y,nonce:g,to:E,value:L});let z=BigInt(await v({block:T,request:$,rpcStateOverride:P}));if(i){const H=await Lt(e,{address:$.from}),D=await Promise.all(i.map(async U=>{const{address:M}=U,Re=await v({block:T,request:{authorizationList:void 0,data:p,from:s==null?void 0:s.address,to:M,value:C(H)},rpcStateOverride:P}).catch(()=>100000n);return 2n*BigInt(Re)}));z+=D.reduce((U,M)=>U+M,0n)}return z}catch(d){throw Ut(d,{...t,account:s,chain:e.chain})}}async function Mt(e,{address:t,blockTag:n="latest",blockNumber:s}){const r=await e.request({method:"eth_getTransactionCount",params:[t,typeof s=="bigint"?C(s):n]},{dedupe:!!s});return S(r)}function Le(e){const{kzg:t}=e,n=e.to??(typeof e.blobs[0]=="string"?"hex":"bytes"),s=typeof e.blobs[0]=="string"?e.blobs.map(o=>q(o)):e.blobs,r=[];for(const o of s)r.push(Uint8Array.from(t.blobToKzgCommitment(o)));return n==="bytes"?r:r.map(o=>V(o))}function ze(e){const{kzg:t}=e,n=e.to??(typeof e.blobs[0]=="string"?"hex":"bytes"),s=typeof e.blobs[0]=="string"?e.blobs.map(a=>q(a)):e.blobs,r=typeof e.commitments[0]=="string"?e.commitments.map(a=>q(a)):e.commitments,o=[];for(let a=0;a<s.length;a++){const d=s[a],i=r[a];o.push(Uint8Array.from(t.computeBlobKzgProof(d,i)))}return n==="bytes"?o:o.map(a=>V(a))}function St(e,t,n,s){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,n,s);const r=BigInt(32),o=BigInt(4294967295),a=Number(n>>r&o),d=Number(n&o),i=s?4:0,u=s?0:4;e.setUint32(t+i,a,s),e.setUint32(t+u,d,s)}function qt(e,t,n){return e&t^~e&n}function $t(e,t,n){return e&t^e&n^t&n}class Dt extends rt{constructor(t,n,s,r){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=t,this.outputLen=n,this.padOffset=s,this.isLE=r,this.buffer=new Uint8Array(t),this.view=J(this.buffer)}update(t){ce(this),t=ot(t),at(t);const{view:n,buffer:s,blockLen:r}=this,o=t.length;for(let a=0;a<o;){const d=Math.min(r-this.pos,o-a);if(d===r){const i=J(t);for(;r<=o-a;a+=r)this.process(i,a);continue}s.set(t.subarray(a,a+d),this.pos),this.pos+=d,a+=d,this.pos===r&&(this.process(n,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){ce(this),it(t,this),this.finished=!0;const{buffer:n,view:s,blockLen:r,isLE:o}=this;let{pos:a}=this;n[a++]=128,te(this.buffer.subarray(a)),this.padOffset>r-a&&(this.process(s,0),a=0);for(let c=a;c<r;c++)n[c]=0;St(s,r-8,BigInt(this.length*8),o),this.process(s,0);const d=J(t),i=this.outputLen;if(i%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const u=i/4,l=this.get();if(u>l.length)throw new Error("_sha2: outputLen bigger than state");for(let c=0;c<u;c++)d.setUint32(4*c,l[c],o)}digest(){const{buffer:t,outputLen:n}=this;this.digestInto(t);const s=t.slice(0,n);return this.destroy(),s}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:n,buffer:s,length:r,finished:o,destroyed:a,pos:d}=this;return t.destroyed=a,t.finished=o,t.length=r,t.pos=d,r%n&&t.buffer.set(s),t}clone(){return this._cloneInto()}}const _=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Rt=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),A=new Uint32Array(64);class Vt extends Dt{constructor(t=32){super(64,t,8,!1),this.A=_[0]|0,this.B=_[1]|0,this.C=_[2]|0,this.D=_[3]|0,this.E=_[4]|0,this.F=_[5]|0,this.G=_[6]|0,this.H=_[7]|0}get(){const{A:t,B:n,C:s,D:r,E:o,F:a,G:d,H:i}=this;return[t,n,s,r,o,a,d,i]}set(t,n,s,r,o,a,d,i){this.A=t|0,this.B=n|0,this.C=s|0,this.D=r|0,this.E=o|0,this.F=a|0,this.G=d|0,this.H=i|0}process(t,n){for(let c=0;c<16;c++,n+=4)A[c]=t.getUint32(n,!1);for(let c=16;c<64;c++){const f=A[c-15],p=A[c-2],b=N(f,7)^N(f,18)^f>>>3,m=N(p,17)^N(p,19)^p>>>10;A[c]=m+A[c-7]+b+A[c-16]|0}let{A:s,B:r,C:o,D:a,E:d,F:i,G:u,H:l}=this;for(let c=0;c<64;c++){const f=N(d,6)^N(d,11)^N(d,25),p=l+f+qt(d,i,u)+Rt[c]+A[c]|0,m=(N(s,2)^N(s,13)^N(s,22))+$t(s,r,o)|0;l=u,u=i,i=d,d=a+p|0,a=o,o=r,r=s,s=p+m|0}s=s+this.A|0,r=r+this.B|0,o=o+this.C|0,a=a+this.D|0,d=d+this.E|0,i=i+this.F|0,u=u+this.G|0,l=l+this.H|0,this.set(s,r,o,a,d,i,u,l)}roundClean(){te(A)}destroy(){this.set(0,0,0,0,0,0,0,0),te(this.buffer)}}const jt=ct(()=>new Vt),Ot=jt;function Kt(e,t){return Ot(ee(e,{strict:!1})?ut(e):e)}function Wt(e){const{commitment:t,version:n=1}=e,s=e.to??(typeof t=="string"?"hex":"bytes"),r=Kt(t);return r.set([n],0),s==="bytes"?r:V(r)}function Yt(e){const{commitments:t,version:n}=e,s=e.to,r=[];for(const o of t)r.push(Wt({commitment:o,to:s,version:n}));return r}const he=6,Me=32,ae=4096,Se=Me*ae,be=Se*he-1-1*ae*he;class Jt extends G{constructor({maxSize:t,size:n}){super("Blob size is too large.",{metaMessages:[`Max: ${t} bytes`,`Given: ${n} bytes`],name:"BlobSizeTooLargeError"})}}class Qt extends G{constructor(){super("Blob data must not be empty.",{name:"EmptyBlobError"})}}function Xt(e){const t=typeof e.data=="string"?q(e.data):e.data,n=Ge(t);if(!n)throw new Qt;if(n>be)throw new Jt({maxSize:be,size:n});const s=[];let r=!0,o=0;for(;r;){const a=ge(new Uint8Array(Se));let d=0;for(;d<ae;){const i=t.slice(o,o+(Me-1));if(a.pushByte(0),a.pushBytes(i),i.length<31){a.pushByte(128),r=!1;break}d++,o+=31}s.push(a)}return s.map(a=>V(a.bytes))}function Zt(e){const{data:t,kzg:n,to:s}=e,r=e.blobs??Xt({data:t}),o=e.commitments??Le({blobs:r,kzg:n,to:s}),a=e.proofs??ze({blobs:r,commitments:o,kzg:n,to:s}),d=[];for(let i=0;i<r.length;i++)d.push({blob:r[i],commitment:o[i],proof:a[i]});return d}function en(e){if(e.type)return e.type;if(typeof e.authorizationList<"u")return"eip7702";if(typeof e.blobs<"u"||typeof e.blobVersionedHashes<"u"||typeof e.maxFeePerBlobGas<"u"||typeof e.sidecars<"u")return"eip4844";if(typeof e.maxFeePerGas<"u"||typeof e.maxPriorityFeePerGas<"u")return"eip1559";if(typeof e.gasPrice<"u")return typeof e.accessList<"u"?"eip2930":"legacy";throw new Qe({transaction:e})}const qe=["blobVersionedHashes","chainId","fees","gas","nonce","type"],pe=new Map;async function $e(e,t){const{account:n=e.account,blobs:s,chain:r,gas:o,kzg:a,nonce:d,nonceManager:i,parameters:u=qe,type:l}=t,c=n&&j(n),f={...t,...c?{from:c==null?void 0:c.address}:{}};let p;async function b(){return p||(p=await x(e,R,"getBlock")({blockTag:"latest"}),p)}let m;async function B(){return m||(r?r.id:typeof t.chainId<"u"?t.chainId:(m=await x(e,Ee,"getChainId")({}),m))}if(u.includes("nonce")&&typeof d>"u"&&c)if(i){const h=await B();f.nonce=await i.consume({address:c.address,chainId:h,client:e})}else f.nonce=await x(e,Mt,"getTransactionCount")({address:c.address,blockTag:"pending"});if((u.includes("blobVersionedHashes")||u.includes("sidecars"))&&s&&a){const h=Le({blobs:s,kzg:a});if(u.includes("blobVersionedHashes")){const y=Yt({commitments:h,to:"hex"});f.blobVersionedHashes=y}if(u.includes("sidecars")){const y=ze({blobs:s,commitments:h,kzg:a}),g=Zt({blobs:s,commitments:h,proofs:y,to:"hex"});f.sidecars=g}}if(u.includes("chainId")&&(f.chainId=await B()),(u.includes("fees")||u.includes("type"))&&typeof l>"u")try{f.type=en(f)}catch{let h=pe.get(e.uid);if(typeof h>"u"){const y=await b();h=typeof(y==null?void 0:y.baseFeePerGas)=="bigint",pe.set(e.uid,h)}f.type=h?"eip1559":"legacy"}if(u.includes("fees"))if(f.type!=="legacy"&&f.type!=="eip2930"){if(typeof f.maxFeePerGas>"u"||typeof f.maxPriorityFeePerGas>"u"){const h=await b(),{maxFeePerGas:y,maxPriorityFeePerGas:g}=await le(e,{block:h,chain:r,request:f});if(typeof t.maxPriorityFeePerGas>"u"&&t.maxFeePerGas&&t.maxFeePerGas<g)throw new vt({maxPriorityFeePerGas:g});f.maxPriorityFeePerGas=g,f.maxFeePerGas=y}}else{if(typeof t.maxFeePerGas<"u"||typeof t.maxPriorityFeePerGas<"u")throw new oe;if(typeof t.gasPrice>"u"){const h=await b(),{gasPrice:y}=await le(e,{block:h,chain:r,request:f,type:"legacy"});f.gasPrice=y}}return u.includes("gas")&&typeof o>"u"&&(f.gas=await x(e,zt,"estimateGas")({...f,account:c&&{address:c.address,type:"json-rpc"}})),re(f),delete f.parameters,f}async function tn(e,{serializedTransaction:t}){return e.request({method:"eth_sendRawTransaction",params:[t]},{retryCount:0})}const X=new dt(128);async function nn(e,t){var y,g,L,k;const{account:n=e.account,chain:s=e.chain,accessList:r,authorizationList:o,blobs:a,data:d,gas:i,gasPrice:u,maxFeePerBlobGas:l,maxFeePerGas:c,maxPriorityFeePerGas:f,nonce:p,type:b,value:m,...B}=t;if(typeof n>"u")throw new ke({docsPath:"/docs/actions/wallet/sendTransaction"});const h=n?j(n):null;try{re(t);const w=await(async()=>{if(t.to)return t.to;if(t.to!==null&&o&&o.length>0)return await ve({authorization:o[0]}).catch(()=>{throw new G("`to` is required. Could not infer from `authorizationList`.")})})();if((h==null?void 0:h.type)==="json-rpc"||h===null){let I;s!==null&&(I=await x(e,Ee,"getChainId")({}),kt({currentChainId:I,chain:s}));const T=(L=(g=(y=e.chain)==null?void 0:y.formatters)==null?void 0:g.transactionRequest)==null?void 0:L.format,E=(T||we)({...Pe(B,{format:T}),accessList:r,authorizationList:o,blobs:a,chainId:I,data:d,from:h==null?void 0:h.address,gas:i,gasPrice:u,maxFeePerBlobGas:l,maxFeePerGas:c,maxPriorityFeePerGas:f,nonce:p,to:w,type:b,value:m}),F=X.get(e.uid),O=F?"wallet_sendTransaction":"eth_sendTransaction";try{return await e.request({method:O,params:[E]},{retryCount:0})}catch($){if(F===!1)throw $;const v=$;if(v.name==="InvalidInputRpcError"||v.name==="InvalidParamsRpcError"||v.name==="MethodNotFoundRpcError"||v.name==="MethodNotSupportedRpcError")return await e.request({method:"wallet_sendTransaction",params:[E]},{retryCount:0}).then(z=>(X.set(e.uid,!0),z)).catch(z=>{const H=z;throw H.name==="MethodNotFoundRpcError"||H.name==="MethodNotSupportedRpcError"?(X.set(e.uid,!1),v):H});throw v}}if((h==null?void 0:h.type)==="local"){const I=await x(e,$e,"prepareTransactionRequest")({account:h,accessList:r,authorizationList:o,blobs:a,chain:s,data:d,gas:i,gasPrice:u,maxFeePerBlobGas:l,maxFeePerGas:c,maxPriorityFeePerGas:f,nonce:p,nonceManager:h.nonceManager,parameters:[...qe,"sidecars"],type:b,value:m,...B,to:w}),T=(k=s==null?void 0:s.serializers)==null?void 0:k.transaction,P=await h.signTransaction(I,{serializer:T});return await x(e,tn,"sendRawTransaction")({serializedTransaction:P})}throw(h==null?void 0:h.type)==="smart"?new Q({metaMessages:["Consider using the `sendUserOperation` Action instead."],docsPath:"/docs/actions/bundler/sendUserOperation",type:"smart"}):new Q({docsPath:"/docs/actions/wallet/sendTransaction",type:h==null?void 0:h.type})}catch(w){throw w instanceof Q?w:Nt(w,{...t,account:h,chain:t.chain||void 0})}}const sn=new Map,rn=new Map;function on(e){const t=(r,o)=>({clear:()=>o.delete(r),get:()=>o.get(r),set:a=>o.set(r,a)}),n=t(e,sn),s=t(e,rn);return{clear:()=>{n.clear(),s.clear()},promise:n,response:s}}async function an(e,{cacheKey:t,cacheTime:n=Number.POSITIVE_INFINITY}){const s=on(t),r=s.response.get();if(r&&n>0&&new Date().getTime()-r.created.getTime()<n)return r.data;let o=s.promise.get();o||(o=e(),s.promise.set(o));try{const a=await o;return s.response.set({created:new Date,data:a}),a}finally{s.promise.clear()}}const cn=e=>`blockNumber.${e}`;async function un(e,{cacheTime:t=e.cacheTime}={}){const n=await an(()=>e.request({method:"eth_blockNumber"}),{cacheKey:cn(e.uid),cacheTime:t});return BigInt(n)}function dn(e,{args:t,eventName:n}={}){return{...e,blockHash:e.blockHash?e.blockHash:null,blockNumber:e.blockNumber?BigInt(e.blockNumber):null,logIndex:e.logIndex?Number(e.logIndex):null,transactionHash:e.transactionHash?e.transactionHash:null,transactionIndex:e.transactionIndex?Number(e.transactionIndex):null,...n?{args:t,eventName:n}:{}}}async function De(e,{blockHash:t,blockNumber:n,blockTag:s,hash:r,index:o}){var l,c,f;const a=s||"latest",d=n!==void 0?C(n):void 0;let i=null;if(r?i=await e.request({method:"eth_getTransactionByHash",params:[r]},{dedupe:!0}):t?i=await e.request({method:"eth_getTransactionByBlockHashAndIndex",params:[t,C(o)]},{dedupe:!0}):i=await e.request({method:"eth_getTransactionByBlockNumberAndIndex",params:[d||a,C(o)]},{dedupe:!!d}),!i)throw new Be({blockHash:t,blockNumber:n,blockTag:a,hash:r,index:o});return(((f=(c=(l=e.chain)==null?void 0:l.formatters)==null?void 0:c.transaction)==null?void 0:f.format)||He)(i)}const fn={"0x0":"reverted","0x1":"success"};function ln(e){const t={...e,blockNumber:e.blockNumber?BigInt(e.blockNumber):null,contractAddress:e.contractAddress?e.contractAddress:null,cumulativeGasUsed:e.cumulativeGasUsed?BigInt(e.cumulativeGasUsed):null,effectiveGasPrice:e.effectiveGasPrice?BigInt(e.effectiveGasPrice):null,gasUsed:e.gasUsed?BigInt(e.gasUsed):null,logs:e.logs?e.logs.map(n=>dn(n)):null,to:e.to?e.to:null,transactionIndex:e.transactionIndex?S(e.transactionIndex):null,status:e.status?fn[e.status]:null,type:e.type?Ae[e.type]||e.type:null};return e.blobGasPrice&&(t.blobGasPrice=BigInt(e.blobGasPrice)),e.blobGasUsed&&(t.blobGasUsed=BigInt(e.blobGasUsed)),t}async function me(e,{hash:t}){var r,o,a;const n=await e.request({method:"eth_getTransactionReceipt",params:[t]},{dedupe:!0});if(!n)throw new Ie({hash:t});return(((a=(o=(r=e.chain)==null?void 0:r.formatters)==null?void 0:o.transactionReceipt)==null?void 0:a.format)||ln)(n)}const Z=new Map,ye=new Map;let hn=0;function se(e,t,n){const s=++hn,r=()=>Z.get(e)||[],o=()=>{const l=r();Z.set(e,l.filter(c=>c.id!==s))},a=()=>{const l=r();if(!l.some(f=>f.id===s))return;const c=ye.get(e);if(l.length===1&&c){const f=c();f instanceof Promise&&f.catch(()=>{})}o()},d=r();if(Z.set(e,[...d,{id:s,fns:t}]),d&&d.length>0)return a;const i={};for(const l in t)i[l]=(...c)=>{var p,b;const f=r();if(f.length!==0)for(const m of f)(b=(p=m.fns)[l])==null||b.call(p,...c)};const u=n(i);return typeof u=="function"&&ye.set(e,u),a}function bn(e,{emitOnBegin:t,initialWaitTime:n,interval:s}){let r=!0;const o=()=>r=!1;return(async()=>{let d;t&&(d=await e({unpoll:o}));const i=await(n==null?void 0:n(d))??s;await ue(i);const u=async()=>{r&&(await e({unpoll:o}),await ue(s),u())};u()})(),o}function pn(e,{emitOnBegin:t=!1,emitMissed:n=!1,onBlockNumber:s,onError:r,poll:o,pollingInterval:a=e.pollingInterval}){const d=typeof o<"u"?o:!(e.transport.type==="webSocket"||e.transport.type==="fallback"&&e.transport.transports[0].config.type==="webSocket");let i;return d?(()=>{const c=ne(["watchBlockNumber",e.uid,t,n,a]);return se(c,{onBlockNumber:s,onError:r},f=>bn(async()=>{var p;try{const b=await x(e,un,"getBlockNumber")({cacheTime:0});if(i){if(b===i)return;if(b-i>1&&n)for(let m=i+1n;m<b;m++)f.onBlockNumber(m,i),i=m}(!i||b>i)&&(f.onBlockNumber(b,i),i=b)}catch(b){(p=f.onError)==null||p.call(f,b)}},{emitOnBegin:t,interval:a}))})():(()=>{const c=ne(["watchBlockNumber",e.uid,t,n]);return se(c,{onBlockNumber:s,onError:r},f=>{let p=!0,b=()=>p=!1;return(async()=>{try{const m=(()=>{if(e.transport.type==="fallback"){const h=e.transport.transports.find(y=>y.config.type==="webSocket");return h?h.value:e.transport}return e.transport})(),{unsubscribe:B}=await m.subscribe({params:["newHeads"],onData(h){var g;if(!p)return;const y=Y((g=h.result)==null?void 0:g.number);f.onBlockNumber(y,i),i=y},onError(h){var y;(y=f.onError)==null||y.call(f,h)}});b=B,p||b()}catch(m){r==null||r(m)}})(),()=>b()})})()}async function mn(e,{confirmations:t=1,hash:n,onReplaced:s,pollingInterval:r=e.pollingInterval,retryCount:o=6,retryDelay:a=({count:i})=>~~(1<<i)*200,timeout:d=18e4}){const i=ne(["waitForTransactionReceipt",e.uid,n]);let u,l,c,f=!1,p,b;const{promise:m,resolve:B,reject:h}=ft(),y=d?setTimeout(()=>{b(),p(),h(new Xe({hash:n}))},d):void 0;return p=se(i,{onReplaced:s,resolve:B,reject:h},g=>{b=x(e,pn,"watchBlockNumber")({emitMissed:!0,emitOnBegin:!0,poll:!0,pollingInterval:r,async onBlockNumber(L){const k=I=>{clearTimeout(y),b(),I(),p()};let w=L;if(!f)try{if(c){if(t>1&&(!c.blockNumber||w-c.blockNumber+1n<t))return;k(()=>g.resolve(c));return}if(u||(f=!0,await de(async()=>{u=await x(e,De,"getTransaction")({hash:n}),u.blockNumber&&(w=u.blockNumber)},{delay:a,retryCount:o}),f=!1),c=await x(e,me,"getTransactionReceipt")({hash:n}),t>1&&(!c.blockNumber||w-c.blockNumber+1n<t))return;k(()=>g.resolve(c))}catch(I){if(I instanceof Be||I instanceof Ie){if(!u){f=!1;return}try{l=u,f=!0;const T=await de(()=>x(e,R,"getBlock")({blockNumber:w,includeTransactions:!0}),{delay:a,retryCount:o,shouldRetry:({error:F})=>F instanceof _e});f=!1;const P=T.transactions.find(({from:F,nonce:O})=>F===l.from&&O===l.nonce);if(!P||(c=await x(e,me,"getTransactionReceipt")({hash:P.hash}),t>1&&(!c.blockNumber||w-c.blockNumber+1n<t)))return;let E="replaced";P.to===l.to&&P.value===l.value&&P.input===l.input?E="repriced":P.from===P.to&&P.value===0n&&(E="cancelled"),k(()=>{var F;(F=g.onReplaced)==null||F.call(g,{reason:E,replacedTransaction:l,transaction:P,transactionReceipt:c}),g.resolve(c)})}catch(T){k(()=>g.reject(T))}}else k(()=>g.reject(I))}}})}),m}async function yn(e,t){const{abi:n,account:s=e.account,address:r,args:o,dataSuffix:a,functionName:d,...i}=t;if(typeof s>"u")throw new ke({docsPath:"/docs/contract/writeContract"});const u=s?j(s):null,l=Ze({abi:n,args:o,functionName:d});try{return await x(e,nn,"sendTransaction")({data:`${l}${a?a.replace("0x",""):""}`,to:r,account:u,...i})}catch(c){throw et(c,{abi:n,address:r,args:o,docsPath:"/docs/contract/writeContract",functionName:d,sender:u==null?void 0:u.address})}}function gn(e,t={}){const{key:n="custom",methods:s,name:r="Custom Provider",retryDelay:o}=t;return({retryCount:a})=>lt({key:n,methods:s,name:r,request:e.request.bind(e),retryCount:t.retryCount??a,retryDelay:o,type:"custom"})}async function xn(e,t={}){let n;if(t.connector){const{connector:u}=t;if(e.state.status==="reconnecting"&&!u.getAccounts&&!u.getChainId)throw new ht({connector:u});const[l,c]=await Promise.all([u.getAccounts().catch(f=>{if(t.account===null)return[];throw f}),u.getChainId()]);n={accounts:l,chainId:c,connector:u}}else n=e.state.connections.get(e.state.current);if(!n)throw new bt;const s=t.chainId??n.chainId,r=await n.connector.getChainId();if(r!==n.chainId)throw new pt({connectionChainId:n.chainId,connectorChainId:r});const o=n.connector;if(o.getClient)return o.getClient({chainId:s});const a=j(t.account??n.accounts[0]);if(a&&(a.address=mt(a.address)),t.account&&!n.accounts.some(u=>u.toLowerCase()===a.address.toLowerCase()))throw new yt({address:a.address,connector:o});const d=e.chains.find(u=>u.id===s),i=await n.connector.getProvider({chainId:s});return gt({account:a,chain:d,name:"Connector Client",transport:u=>gn(i)({...u,retryCount:0})})}async function Bn(e,t){const{chainId:n,timeout:s=0,...r}=t,o=e.getClient({chainId:n}),d=await K(o,mn,"waitForTransactionReceipt")({...r,timeout:s});if(d.status==="reverted"){const u=await K(o,De,"getTransaction")({hash:d.transactionHash}),c=await K(o,tt,"call")({...u,data:u.input,gasPrice:u.type!=="eip1559"?u.gasPrice:void 0,maxFeePerGas:u.type==="eip1559"?u.maxFeePerGas:void 0,maxPriorityFeePerGas:u.type==="eip1559"?u.maxPriorityFeePerGas:void 0}),f=c!=null&&c.data?xt(`0x${c.data.substring(138)}`):"unknown reason";throw new Error(f)}return{...d,chainId:o.chain.id}}async function In(e,t){const{account:n,chainId:s,connector:r,...o}=t;let a;return typeof n=="object"&&(n==null?void 0:n.type)==="local"?a=e.getClient({chainId:s}):a=await xn(e,{account:n??void 0,chainId:s,connector:r}),await K(a,yn,"writeContract")({...o,...n?{account:n}:{},chain:s?{id:s}:null})}export{In as a,xn as g,jt as s,Bn as w};
