import{_ as R}from"./KPI-DGW8n61r.js";import{_ as P}from"./AsyncValue-D2chhg9L.js";import{u as b}from"./useQuery-LuUyZeGb.js";import{t as C,g as $,f as T}from"./timestamp-C4C6eGnP.js";import{a8 as N,d as h,K as O,e as w,o as y,w as _,b as o,u as t,f as u,T as Q,i as v,h as S,g as k,_ as V,W as D,X as q,c as A,Y as B,a as H}from"./index-aGD7oz-u.js";import{_ as M}from"./Table-QwvIK97f.js";import{a as z,_ as J}from"./UsePagination-Brqc18kQ.js";import{u as X}from"./UseRelativeTime-C3ugIKV7.js";import{u as E,a as F,c as j}from"./UseLightweightChart-DAGdKVOX.js";import{_ as U,a as W}from"./BtnChartLWFullscreen.vue_vue_type_script_setup_true_lang-Dw_e5NUf.js";import{r as K,u as G}from"./Number-CJjP1isT.js";import"./Object-DOSYkgA0.js";const Z=e=>({type:e.action_type,sender:e.sender,owner:e.owner,receiver:e.receiver?e.receiver:void 0,assets:BigInt(e.assets),supply:BigInt(e.shares),blockNumber:e.block_number,timestamp:C(e.timestamp),txHash:e.transaction_hash}),x=e=>({timestamp:C(e.timestamp),assets:e.assets,supply:e.supply,apyProjected:e.proj_apy}),ee=e=>({lastUpdated:C(e.last_updated),lastUpdatedBlock:e.last_updated_block,aprProjected:e.proj_apr,supply:e.supply});async function te(e){const s=$(e),i=await T(`${s}/v1/crvusd/savings/statistics`);return ee(i)}async function se(e,s){const i=$(s),p=await T(`${i}/v1/crvusd/savings/events?page=${e}&per_page=10`);return{count:p.count,events:p.events.map(Z)}}async function ae(e){const s=$(e),i=Math.floor(new Date().getTime()/1e3),p=i-10*24*60*60;return(await T(`${s}/v1/crvusd/savings/yield?agg_number=1&agg_units=hour&start=${p}&end=${i}`)).data.map(x)}function ne(){return{initialData:[],initialDataUpdatedAt:0}}function re(){return b({queryKey:["scrvusd-stats"],queryFn:()=>te()})}function oe(e){return b({queryKey:["scrvusd-events",e],queryFn:({queryKey:[,s]})=>se(s),placeholderData:N})}function Y(){return b({queryKey:["scrvusd-yield"],queryFn:()=>ae(),...ne()})}const ie={class:"end"},ce=["href"],le={class:"end"},pe=["href"],ue=h({__name:"TableEvents",setup(e){const{page:s,onPage:i}=z(),p=O(s,200),{isFetching:l,data:c}=oe(p),{relativeTime:r}=X();return(f,a)=>{const n=J,d=P,I=M,L=k;return y(),w(L,{title:"Events",loading:t(l)},{actions:_(()=>{var g;return[o(n,{"items-count":((g=t(c))==null?void 0:g.count)??0,"items-per-page":10,page:t(s),onPage:t(i)},null,8,["items-count","page","onPage"])]}),default:_(()=>{var g;return[o(I,{loading:t(l),rows:((g=t(c))==null?void 0:g.events)??[],columns:["Type",{label:"Amount",align:"end"},"Owner",{label:"Time",align:"end"}]},{row:_(({item:m})=>[u("div",{class:Q(["type",{green:m.type==="deposit",red:m.type==="withdraw"}])},v(m.type),3),u("div",ie,[o(d,{value:Number(m.assets)/10**18,precision:0},null,8,["value"])]),u("div",null,[u("a",{target:"_blank",href:`https://etherscan.io/address/${m.owner}`,onClick:a[0]||(a[0]=S(()=>{},["stop"]))},v(m.owner),9,ce)]),u("div",le,[u("a",{target:"_blank",href:`https://etherscan.io/tx/${m.txHash}`,onClick:a[1]||(a[1]=S(()=>{},["stop"]))},v(t(r)(m.timestamp.getUTCTimestamp())),9,pe)])]),_:1},8,["loading","rows"])]}),_:1},8,["loading"])}}}),de=V(ue,[["__scopeId","data-v-9b4d465d"]]),_e={style:{display:"flex"}},me={ref:"chartRef",class:"chart"},ge=h({__name:"ChartYield",setup(e){const{isFetching:s,data:i}=Y(),p=D(),l=q("card"),{chart:c,series:r}=E({createChartOptions:j(),series:{type:"Area",name:"apy",options:A(()=>({priceFormat:{type:"custom",formatter:a=>`${K(a,0,"percentage")}%`},lineWidth:2,lineType:F.WithSteps,lineColor:p.value.colors.blue,topColor:"rgb(32, 129, 240, 0.2)",bottomColor:"rgba(32, 129, 240, 0)",lastValueVisible:!1,priceLineVisible:!1}))}});B(f);function f(){if(!c.value||!r.apy)return;const a=i.value.map(n=>({time:n.timestamp.getUTCTimestamp(),value:n.apyProjected})).uniqWith((n,d)=>n.time===d.time).orderBy(n=>n.time,"asc");a.length>0&&r.apy.setData(a),c.value.timeScale().fitContent()}return(a,n)=>{const d=k;return y(),w(d,{ref_key:"card",ref:l,title:"Yield",loading:t(s)},{actions:_(()=>[u("div",_e,[o(t(U),{filename:"rates",series:t(r)},null,8,["series"]),o(t(W),{chart:t(c),target:t(l)},null,8,["chart","target"])])]),default:_(()=>[u("div",me,null,512)]),_:1},8,["loading"])}}}),fe={style:{display:"flex"}},he={ref:"chartRef",class:"chart"},ye=h({__name:"ChartTVL",setup(e){const{isFetching:s,data:i}=Y(),p=D(),l=q("card"),{chart:c,series:r}=E({createChartOptions:j(),series:{type:"Area",name:"tvl",options:A(()=>({priceFormat:{type:"custom",formatter:a=>`$${K(a,1,"dollar")}${G(a)}`},lineWidth:2,lineType:F.WithSteps,lineColor:p.value.colors.blue,topColor:"rgb(32, 129, 240, 0.2)",bottomColor:"rgba(32, 129, 240, 0)",lastValueVisible:!1,priceLineVisible:!1}))}});B(f);function f(){if(!c.value||!r.tvl)return;const a=i.value.map(n=>({time:n.timestamp.getUTCTimestamp(),value:n.assets})).uniqWith((n,d)=>n.time===d.time).orderBy(n=>n.time,"asc");a.length>0&&r.tvl.setData(a),c.value.timeScale().fitContent()}return(a,n)=>{const d=k;return y(),w(d,{ref_key:"card",ref:l,title:"TVL",loading:t(s)},{actions:_(()=>[u("div",fe,[o(t(U),{filename:"rates",series:t(r)},null,8,["series"]),o(t(W),{chart:t(c),target:t(l)},null,8,["chart","target"])])]),default:_(()=>[u("div",he,null,512)]),_:1},8,["loading"])}}}),ve={class:"dashboard"},be=h({__name:"Savings.page",setup(e){const{data:s}=re();return(i,p)=>{const l=P,c=R;return y(),H("div",ve,[o(c,{style:{"grid-area":"kpi1"},label:"APR (Projected)","has-value":!!t(s)},{default:_(()=>{var r;return[o(l,{type:"percentage",value:(r=t(s))==null?void 0:r.aprProjected},null,8,["value"])]}),_:1},8,["has-value"]),o(c,{style:{"grid-area":"kpi2"},label:"Shares","has-value":!!t(s)},{default:_(()=>{var r;return[o(l,{value:(r=t(s))==null?void 0:r.supply},null,8,["value"])]}),_:1},8,["has-value"]),o(de,{style:{"grid-area":"events"}}),o(ge,{style:{"grid-area":"yield"}}),o(ye,{style:{"grid-area":"tvl"}})])}}}),Ee=V(be,[["__scopeId","data-v-fb6a7473"]]);export{Ee as default};
