import{_ as le,a as se}from"./TabItem.vue_vue_type_script_setup_true_lang-Brn5Dep7.js";import{d as A,h as w,o as k,a3 as z,w as g,a as $,t as K,e as F,T as M,f as S,r as G,g as q,U as Q,V as P,_ as I,u as t,b as f,c as N,a6 as Y,j as x,F as ne,l as re,a4 as ie,a5 as ce,N as ue,W as U,R as me,a2 as J}from"./index-CEOjmKtR.js";import{a as de,b as pe,c as ve}from"./pools-CgHm0DYs.js";import{u as ee,_ as te}from"./UseLegend-DXfplF16.js";import{u as R,d as j,a as E,b as H,_ as ae}from"./UseLightweightChart-D6IbOW_8.js";import{u as _e}from"./queries-6FbpJQ1n.js";import{r as W,u as O}from"./Number-nBy8KE7n.js";import{_ as he}from"./AsyncValue-k8yzPf6l.js";import{a as fe,_ as ge}from"./KPI-C9fTZmfG.js";import{_ as be}from"./TokenIcon-BUfLytfP.js";import{g as ye}from"./api-DFkSxUea.js";import{u as Ce}from"./useQuery-C8O3Jmvc.js";import{_ as oe}from"./ButtonToggle-DOQ7XXrK.js";import{a as X}from"./index-C0PzODp0.js";import{u as $e}from"./UseTabNavigation--UtxkSuI.js";import"./timestamp-Dfir0V72.js";import"./UseHost-BKgG8fzn.js";import"./Object-DOSYkgA0.js";import"./Helper-BXUrr2bb.js";const ke={class:"option"},Se={class:"label"},Ve=A({__name:"SelectDuration",props:{duration:{default:()=>({value:1,unit:"month"})}},emits:["select"],setup(_,{emit:p}){const u=p,n=[{value:1,unit:"hour"},{value:1,unit:"day"},{value:1,unit:"week"},{value:1,unit:"month"},{value:1,unit:"year"}],h=y=>{u("select",y)};return(y,l)=>{const m=z;return k(),w(m,{options:n.map(d=>d),selected:y.duration,onSelect:h},{option:g(({option:d})=>[$("div",ke,[$("div",Se,K(d.value)+" "+K(d.unit),1)])]),_:1},8,["options","selected"])}}}),Z=F(Ve,[["__scopeId","data-v-0bc945d9"]]),we={style:{display:"flex"}},Te={style:{display:"flex","flex-wrap":"wrap",gap:"2rem"}},Le={class:"time"},Ae={class:"time"},Be={ref:"chartRef",class:"chart"},De=A({__name:"ChartMEV",props:{pool:{}},setup(_){function p(e,a){var C;const s=(C=e.replace("#","").match(/.{2}/g))==null?void 0:C.map(b=>parseInt(b,16));return s?`#${s.map(b=>Math.max(0,Math.floor(b*(1-a)))).map(b=>b.toString(16).padStart(2,"0")).join("")}`:e}const u=M(),n=S(()=>({volume:u.value.colors.red,bars:[u.value.colorsArray[1],p(u.value.colorsArray[1],.33),u.value.colorsArray[0],p(u.value.colorsArray[0],.33)]})),{items:h,toggles:y,disabled:l}=ee(()=>[{id:"atomic",label:"Atomic",color:n.value.bars[0],togglable:!0},{id:"cexdex",label:"Cexdex",color:n.value.bars[1],togglable:!0},{id:"within",label:"Within",color:n.value.bars[2],togglable:!0},{id:"outside",label:"Outside",color:n.value.bars[3],togglable:!0},{id:"total",label:"Volume (Total)",color:n.value.volume,togglable:!0}]),m=G({value:1,unit:"week"}),d=G({value:1,unit:"hour"}),{isFetching:i,data:v}=_e(q(()=>_.pool),m,d),c=Q("card"),{chart:V,series:o}=R({createChartOptions:E(),series:[{type:"StackedBars",name:"data",options:S(()=>({priceFormat:{type:"custom",formatter:e=>`$${W(e,1,"dollar")}${O(e)}`},colors:h.value.map((e,a)=>({item:e,i:a})).filter(({item:e})=>!l.value.includes(e.id)).map(({i:e})=>e).map(e=>n.value.bars[e]),lastValueVisible:!1,priceLineVisible:!1}))},{type:"Line",name:"volume",options:S(()=>({priceFormat:{type:"custom",formatter:e=>`${W(e,1,"dollar")}${O(e)}`},lineWidth:2,lineType:j.Curved,color:n.value.volume,lastValueVisible:!1,priceLineVisible:!1}))}]});P(B);function B(){if(!V.value||!o.volume||!o.data)return;const e=l.value.includes("total")?[]:v.value.map(s=>({time:s.interval_start_unixtime,value:s.full_volume})).uniqWith((s,r)=>s.time===r.time).orderBy(s=>s.time,"asc");e.length>1?(o.volume.setData(e),o.volume.applyOptions({visible:!0})):o.volume.applyOptions({visible:!1});const a=v.value.map(s=>({time:s.interval_start_unixtime,values:[...l.value.includes("atomic")?[]:[s.atomicArbVolume],...l.value.includes("cexdex")?[]:[s.cexDexArbVolume],...l.value.includes("within")?[]:[s.sandwichVolume_LossWithin],...l.value.includes("outside")?[]:[s.sandwichVolume_LossOutside]]})).uniqWith((s,r)=>s.time===r.time).orderBy(s=>s.time,"asc");a.length>0&&o.data.setData(a),V.value.timeScale().fitContent()}return(e,a)=>{const s=H,r=te,C=I;return k(),w(C,{ref_key:"card",ref:c,title:"MEV",loading:t(i)},{actions:g(()=>[$("div",we,[f(s,{chart:t(V),target:t(c)},null,8,["chart","target"])])]),"actions-secondary":g(()=>[$("div",Te,[f(r,{items:t(h),disabled:t(l),onToggle:a[0]||(a[0]=b=>t(y)[b].value=!t(y)[b].value)},null,8,["items","disabled"]),$("div",Le,[a[3]||(a[3]=$("span",null,"Duration:",-1)),f(Z,{duration:t(m),onSelect:a[1]||(a[1]=b=>m.value=b)},null,8,["duration"])]),$("div",Ae,[a[4]||(a[4]=$("span",null,"Interval:",-1)),f(Z,{duration:t(d),onSelect:a[2]||(a[2]=b=>d.value=b)},null,8,["duration"])])])]),default:g(()=>[$("div",Be,null,512)]),_:1},8,["loading"])}}}),We=F(De,[["__scopeId","data-v-e3d4b0db"]]),Oe={class:"dashboard-grid"},Fe=A({__name:"MEV",props:{pool:{}},setup(_){const p=S(()=>_.pool.address);return(u,n)=>(k(),N("div",Oe,[f(We,{style:{"grid-area":"chart"},pool:t(p)},null,8,["pool"])]))}}),Me=F(Fe,[["__scopeId","data-v-a5261ecc"]]);function Pe(_,p,u,n){return Ce({queryKey:["curve-token-price",p,u,n],queryFn:({queryKey:[,h,y,l]})=>ye(_.value,h,y,l),enabled:S(()=>!!_.value&&!!p.value&&!!u.value&&!!n.value),initialData:[],initialDataUpdatedAt:0})}const Ie={style:{display:"flex"}},Re={ref:"chartRef",class:"chart"},Ee="chart_pool_balances_dollars",Ue="chart_pool_balances_type",qe=A({__name:"ChartBalances",props:{balances:{}},setup(_){const p=M(),{items:u,toggles:n,disabled:h}=ee(()=>_.balances.map(({symbol:e},a)=>({id:e,label:e,color:p.value.colorsArray[a],togglable:!0}))),y=Q("card"),l=Y(Ee,!1),m=["unstacked","stacked","100%"],d=[{id:"unstacked",label:"Unstacked"},{id:"stacked",label:"Stacked"},{id:"100%",label:"Stacked (100%)"}],i=Y(Ue,m[0]),{chart:v,series:c}=R({createChartOptions:E(),series:[..._.balances.map(({symbol:e},a)=>({type:"Line",name:e,options:S(()=>({priceFormat:{type:"custom",formatter:s=>`${W(s,1,"dollar")}${O(s)}`},lineWidth:2,lineType:j.WithSteps,color:p.value.colorsArray[a],lastValueVisible:!1,priceLineVisible:!1}))})),{type:"StackedArea",name:"stacked",options:S(()=>({priceFormat:{type:"custom",formatter:e=>`${W(e,1,"dollar")}${O(e)}`},colors:u.value.map((e,a)=>({item:e,i:a})).filter(({item:e})=>!h.value.includes(e.id)).map(({i:e})=>e).map(e=>p.value.colorsArray[e]).map(e=>({line:e,area:e+"15"})),lineWidth:2,lastValueVisible:!1,priceLineVisible:!1}))}]});P(V);function V(){if(!(!v.value||Object.values(c).length<0)){for(const e of Object.values(c))e==null||e.setData([]);i.value==="unstacked"?o():B(i.value==="100%"),v.value.timeScale().fitContent()}}function o(){var e,a;for(const{symbol:s,balances:r}of _.balances.values()){if(!n[s].value){(e=c[s])==null||e.setData([]);continue}const C=l.value,b=r.map(T=>({time:T.timestamp.getUTCTimestamp(),value:C?T.balance*T.tokenPrice:T.balance})).uniqWith((T,D)=>T.time===D.time).orderBy(T=>T.time,"asc");b.length>0&&((a=c[s])==null||a.setData(b))}}function B(e){if(!c.stacked)return;const a=l.value,s=[..._.balances.values()].filter(({symbol:r,balances:C})=>n[r].value&&C.length>0).flatMap(({symbol:r,balances:C})=>C.map(b=>({symbol:r,timestamp:b.timestamp,balance:a?b.balance*b.tokenPrice:b.balance}))).groupBy(r=>r.timestamp.getTime()).entries().map(([r,C])=>{const b=e?C.reduce((D,L)=>D+L.balance,0):1,T=C.map(D=>e?D.balance/b*100:D.balance);return{time:Number(r)/1e3,values:T}}).uniqWith((r,C)=>r.time===C.time).orderBy(r=>r.time,"asc");s.length>0&&c.stacked.setData(s)}return(e,a)=>{const s=z,r=oe,C=fe,b=H,T=te,D=I;return k(),w(D,{ref_key:"card",ref:y,class:"stack-actions",title:"Balances"},{actions:g(()=>[$("div",Ie,[f(s,{options:d,selected:d.find(L=>L.id===t(i))??d[0],onSelect:a[0]||(a[0]=L=>i.value=L.id)},{option:g(({option:L})=>[x(K(L.label),1)]),_:1},8,["selected"]),f(C,null,{trigger:g(()=>[f(r,{style:{"margin-right":"1rem"},"model-value":t(l),onClick:a[1]||(a[1]=L=>l.value=!t(l))},{default:g(()=>a[3]||(a[3]=[x(" $ ")])),_:1},8,["model-value"])]),default:g(()=>[a[4]||(a[4]=x(" Show token balances in USD. "))]),_:1}),f(b,{chart:t(v),target:t(y)},null,8,["chart","target"])])]),"actions-secondary":g(()=>[f(T,{items:t(u),disabled:t(h),onToggle:a[2]||(a[2]=L=>t(n)[L].value=!t(n)[L].value)},null,8,["items","disabled"])]),default:g(()=>[$("div",Re,null,512)]),_:1},512)}}}),xe=F(qe,[["__scopeId","data-v-c6693101"]]),Ne={class:"controls"},Qe={ref:"chartRef",class:"chart"},je=A({__name:"ChartPrice",props:{ohlc:{}},setup(_){const p=M(),u=G(!1);let n=1,h=0;const{chart:y,series:l}=R({createChartOptions:E(),series:{type:"Candlestick",name:"ohlc",options:S(()=>{const{colors:i}=p.value;return{priceFormat:{type:"custom",formatter:d},upColor:i.green,borderUpColor:i.green,wickUpColor:i.green,downColor:i.red,borderDownColor:i.red,wickDownColor:i.red}})}});P(m);function m(){if(!y.value||!l.ohlc)return;const i=u.value?-1:1,v=_.ohlc.map(c=>({time:c.time.getUTCTimestamp(),open:Math.pow(c.open,i),high:Math.pow(c.high,i),low:Math.pow(c.low,i),close:Math.pow(c.close,i)})).uniqWith((c,V)=>c.time===V.time).orderBy(c=>c.time,"asc");v.length>0&&(l.ohlc.setData(v),h=Math.min(...v.map(c=>c.low)),n=Math.max(...v.map(c=>c.high))),y.value.timeScale().fitContent()}function d(i){const v=n-h,c=v>1?v-Math.floor(v):v,V=-Math.floor(Math.log10(c)+1)+2;return`${W(i,V,"dollar")}${O(i)}`}return(i,v)=>{const c=oe,V=I;return k(),w(V,{title:"Price"},{actions:g(()=>[$("div",Ne,[f(c,{"model-value":t(u),onClick:v[0]||(v[0]=o=>u.value=!t(u))},{default:g(()=>v[1]||(v[1]=[x(" Invert ")])),_:1},8,["model-value"])])]),default:g(()=>[$("div",Qe,null,512)]),_:1})}}}),He=F(je,[["__scopeId","data-v-33c41817"]]),Ke={style:{display:"flex"}},Ge={ref:"chartRef",class:"chart"},Ye=A({__name:"ChartTvl",props:{tvl:{}},setup(_){const p=M(),u=Q("card"),{chart:n,series:h}=R({createChartOptions:E(),series:{type:"Area",name:"tvl",options:S(()=>({priceFormat:{type:"custom",formatter:l=>`$${W(l,1,"dollar")}${O(l)}`},lineWidth:2,lineType:j.WithSteps,lineColor:p.value.colors.blue,topColor:"rgb(32, 129, 240, 0.2)",bottomColor:"rgba(32, 129, 240, 0)",lastValueVisible:!1,priceLineVisible:!1}))}});P(y);function y(){if(!n.value||!h.tvl)return;const l=_.tvl.map(m=>({time:m.timestamp.getUTCTimestamp(),value:m.tvl})).uniqWith((m,d)=>m.time===d.time).orderBy(m=>m.time,"asc");l.length>0&&h.tvl.setData(l),n.value.timeScale().fitContent()}return(l,m)=>{const d=ae,i=H,v=I;return k(),w(v,{ref_key:"card",ref:u,title:"TVL"},{actions:g(()=>[$("div",Ke,[f(d,{filename:"tvl",series:t(h)},null,8,["series"]),f(i,{chart:t(n),target:t(u)},null,8,["chart","target"])])]),default:g(()=>[$("div",Ge,null,512)]),_:1},512)}}}),Je={style:{display:"flex"}},Xe={ref:"chartRef",class:"chart"},Ze=A({__name:"ChartVolume",props:{volume:{}},setup(_){const p=M(),u=Q("card"),{chart:n,series:h}=R({createChartOptions:E(),series:{type:"Area",name:"volume",options:S(()=>({priceFormat:{type:"custom",formatter:l=>`$${W(l,1,"dollar")}${O(l)}`},lineWidth:2,lineType:j.WithSteps,lineColor:p.value.colors.blue,topColor:"rgb(32, 129, 240, 0.2)",bottomColor:"rgba(32, 129, 240, 0)",lastValueVisible:!1,priceLineVisible:!1}))}});P(y);function y(){if(!n.value||!h.volume)return;const l=_.volume.map(m=>({time:m.timestamp.getUTCTimestamp(),value:m.volume})).uniqWith((m,d)=>m.time===d.time).orderBy(m=>m.time,"asc");l.length>0&&h.volume.setData(l),n.value.timeScale().fitContent()}return(l,m)=>{const d=ae,i=H,v=I;return k(),w(v,{ref_key:"card",ref:u,title:"Volume"},{actions:g(()=>[$("div",Je,[f(d,{filename:"volume",series:t(h)},null,8,["series"]),f(i,{chart:t(n),target:t(u)},null,8,["chart","target"])])]),default:g(()=>[$("div",Xe,null,512)]),_:1},512)}}}),ze={class:"dashboard-grid"},et={class:"tokens"},tt=A({__name:"PoolOverview",props:{pool:{},chain:{}},setup(_){const p=S(()=>{var o;return(o=_.pool)==null?void 0:o.address}),u=S(()=>{var o;return(o=_.pool)==null?void 0:o.coins[0].address}),n=S(()=>{var o;return(o=_.pool)==null?void 0:o.coins[1].address}),{isFetching:h,data:y}=Pe(q(()=>_.chain),p,u,n),{isFetching:l,data:m}=de(q(()=>_.chain),p),{isFetching:d,data:i}=pe(q(()=>_.chain),p),v=S(()=>m.value.map(o=>({timestamp:o.timestamp,volume:o.volume}))),c=S(()=>i.value.map(o=>({timestamp:o.timestamp,tvl:o.tvlUSD}))),V=S(()=>_.pool?_.pool.coins.map(o=>({symbol:o.symbol,balances:i.value.map(B=>({timestamp:B.timestamp,balance:B.balances[o.poolIndex],tokenPrice:B.tokenPrices[o.poolIndex]}))})):[]);return(o,B)=>{const e=be,a=ge,s=he;return k(),N("div",ze,[f(a,{style:{"grid-area":"kpi1"},label:"Tokens","has-value":!!o.pool},{default:g(()=>{var r;return[$("div",et,[(k(!0),N(ne,null,re(((r=o.pool)==null?void 0:r.coins)??[],C=>(k(),w(e,{key:C.address,clickable:"",chain:o.chain,address:C.address},null,8,["chain","address"]))),128))])]}),_:1},8,["has-value"]),f(a,{style:{"grid-area":"kpi2"},label:"TVL","has-value":!!o.pool},{default:g(()=>{var r;return[f(s,{type:"dollar",value:((r=o.pool)==null?void 0:r.tvlUsd)??0},null,8,["value"])]}),_:1},8,["has-value"]),f(a,{style:{"grid-area":"kpi3"},label:"Volume (24h)","has-value":!!o.pool},{default:g(()=>{var r;return[f(s,{type:"dollar",value:((r=o.pool)==null?void 0:r.tradingVolume24h)??0},null,8,["value"])]}),_:1},8,["has-value"]),f(a,{style:{"grid-area":"kpi4"},label:"Fees (24h)","has-value":!!o.pool},{default:g(()=>{var r;return[f(s,{type:"dollar",value:((r=o.pool)==null?void 0:r.tradingFee24h)??0},null,8,["value"])]}),_:1},8,["has-value"]),f(He,{style:{"grid-area":"price"},ohlc:t(y),loading:t(h)},null,8,["ohlc","loading"]),f(Ze,{style:{"grid-area":"volume"},volume:t(v),loading:t(l)},null,8,["volume","loading"]),f(Ye,{style:{"grid-area":"tvl"},tvl:t(c),loading:t(d)},null,8,["tvl","loading"]),f(xe,{style:{"grid-area":"balances"},balances:t(V),loading:t(d)},null,8,["balances","loading"])])}}}),at=F(tt,[["__scopeId","data-v-9bb8a429"]]),ot={class:"dashboard"},lt=A({__name:"Pool.page",setup(_){const p=X("chain"),u=X("poolAddr"),{isFetching:n,data:h}=ve(p,u.value),{crumbs:y}=ie(ce());ue(h,d=>{y.value=[{id:"pools",label:"Pools",pathName:"pools",params:()=>({chain:p.value})},{id:"pool",label:`Pool: ${(d==null?void 0:d.name)??"?"}`}]},{immediate:!0});const{tabActive:l,tabActiveIndex:m}=$e(["overview","mev"],"poolspool",()=>({chain:p.value,poolAddr:u.value}));return(d,i)=>{const v=me,c=le,V=se;return k(),N("div",ot,[f(v,{loading:t(n)},null,8,["loading"]),!t(n)&&t(h)?(k(),w(V,{key:0,active:t(m),onTab:i[0]||(i[0]=o=>m.value=o.index)},{default:g(()=>[f(c,{header:"Overview"},{default:g(()=>[(k(),w(J,null,[t(l)==="overview"?(k(),w(at,{key:0,pool:t(h),chain:t(p)},null,8,["pool","chain"])):U("",!0)],1024))]),_:1}),t(p)==="ethereum"&&t(h)?(k(),w(c,{key:0,header:"MEV"},{default:g(()=>[(k(),w(J,null,[t(l)==="mev"?(k(),w(Me,{key:0,pool:t(h)},null,8,["pool"])):U("",!0)],1024))]),_:1})):U("",!0)]),_:1},8,["active"])):U("",!0)])}}}),St=F(lt,[["__scopeId","data-v-e7d124fd"]]);export{St as default};
