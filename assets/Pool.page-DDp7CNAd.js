import{_ as ne,a as ie}from"./TabItem.vue_vue_type_script_setup_true_lang-DTnBKj3C.js";import{d as B,h as w,o as $,a4 as ae,w as f,a as C,t as K,e as O,T as P,f as k,r as H,g as E,U as Q,V as M,_ as I,u as o,b as _,c as G,a7 as X,Y as re,W as q,j,F as ce,l as ue,a5 as me,a6 as de,N as pe,R as ve,a3 as Z}from"./index-FHVaDRST.js";import{a as _e,b as fe,c as he,d as ge}from"./pools-Bdfmgvmf.js";import{u as Y,_ as z}from"./UseLegend-BcqQyVPI.js";import{u as U,G as N,r as oe,a as R,b as x,x as be,c as le,_ as J}from"./UseLightweightChart-LmeMZLGt.js";import{u as ye}from"./queries-CTlt9aCA.js";import{r as L,u as W}from"./Number-DuH4s3V0.js";import{_ as Ce}from"./AsyncValue-BoBenxWk.js";import{a as ke,_ as $e}from"./KPI-1_1fHazw.js";import{_ as Ve}from"./TokenIcon-EvGOSubR.js";import{_ as se}from"./ButtonToggle-CRZGorLn.js";import{g as Se}from"./api-BCRV542q.js";import{u as Te}from"./useQuery-V2p3ekVy.js";import{a as ee}from"./index-2mlvS6pG.js";import{u as we}from"./UseTabNavigation-fYiZR9VS.js";import"./fetch-bVCl_krR.js";import"./timestamp-CoE2HNXc.js";import"./UseHost-3WV3kxth.js";import"./Object-DOSYkgA0.js";import"./Helper-KO9bQA3T.js";const Be={class:"option"},De={class:"label"},Fe=B({__name:"SelectDuration",props:{duration:{default:()=>({value:1,unit:"month"})}},emits:["select"],setup(c,{emit:u}){const d=u,i=[{value:1,unit:"hour"},{value:1,unit:"day"},{value:1,unit:"week"},{value:1,unit:"month"},{value:1,unit:"year"}],v=h=>{d("select",h)};return(h,l)=>{const s=ae;return $(),w(s,{options:i.map(p=>p),selected:h.duration,onSelect:v},{option:f(({option:p})=>[C("div",Be,[C("div",De,K(p.value)+" "+K(p.unit),1)])]),_:1},8,["options","selected"])}}}),te=O(Fe,[["__scopeId","data-v-0bc945d9"]]),Le={style:{display:"flex"}},Ae={style:{display:"flex","flex-wrap":"wrap",gap:"2rem"}},Me={class:"time"},We={class:"time"},Oe={ref:"chartRef",class:"chart"},Pe=B({__name:"ChartMEV",props:{pool:{}},setup(c){function u(e,a){var b;const y=(b=e.replace("#","").match(/.{2}/g))==null?void 0:b.map(m=>parseInt(m,16));return y?`#${y.map(m=>Math.max(0,Math.floor(m*(1-a)))).map(m=>m.toString(16).padStart(2,"0")).join("")}`:e}const d=P(),i=k(()=>({volume:d.value.colors.red,bars:[d.value.colorsArray[1],u(d.value.colorsArray[1],.33),d.value.colorsArray[0],u(d.value.colorsArray[0],.33)]})),{items:v,toggles:h,disabled:l}=Y(()=>[{id:"atomic",label:"Atomic",color:i.value.bars[0],togglable:!0},{id:"cexdex",label:"Cexdex",color:i.value.bars[1],togglable:!0},{id:"within",label:"Within",color:i.value.bars[2],togglable:!0},{id:"outside",label:"Outside",color:i.value.bars[3],togglable:!0},{id:"total",label:"Volume (Total)",color:i.value.volume,togglable:!0}]),s=H({value:1,unit:"week"}),p=H({value:1,unit:"hour"}),{isFetching:t,data:n}=ye(E(()=>c.pool),s,p),r=Q("card"),{chart:V,series:S}=U({createChartOptions:R(),series:[{type:"StackedBars",name:"data",options:k(()=>({priceFormat:{type:"custom",formatter:e=>`$${L(e,1,"dollar")}${W(e)}`},colors:v.value.map((e,a)=>({item:e,i:a})).filter(({item:e})=>!l.value.includes(e.id)).map(({i:e})=>e).map(e=>i.value.bars[e]),lastValueVisible:!1,priceLineVisible:!1}))},{type:N,name:"volume",options:k(()=>({priceFormat:{type:"custom",formatter:e=>`${L(e,1,"dollar")}${W(e)}`},lineWidth:2,lineType:oe.Curved,color:i.value.volume,lastValueVisible:!1,priceLineVisible:!1}))}]});M(A);function A(){if(!V.value||!S.volume||!S.data)return;const e=l.value.includes("total")?[]:n.value.map(a=>({time:a.interval_start_unixtime,value:a.full_volume})).uniqWith((a,y)=>a.time===y.time).orderBy(a=>a.time,"asc");e.length>1?(S.volume.setData(e),S.volume.applyOptions({visible:!0})):S.volume.applyOptions({visible:!1}),S.data.setData(n.value.map(a=>({time:a.interval_start_unixtime,values:[...l.value.includes("atomic")?[]:[a.atomicArbVolume],...l.value.includes("cexdex")?[]:[a.cexDexArbVolume],...l.value.includes("within")?[]:[a.sandwichVolume_LossWithin],...l.value.includes("outside")?[]:[a.sandwichVolume_LossOutside]]})).uniqWith((a,y)=>a.time===y.time).orderBy(a=>a.time,"asc")),V.value.timeScale().fitContent()}return(e,a)=>{const y=x,g=z,b=I;return $(),w(b,{ref_key:"card",ref:r,title:"MEV",loading:o(t)},{actions:f(()=>[C("div",Le,[_(y,{chart:o(V),target:o(r)},null,8,["chart","target"])])]),"actions-secondary":f(()=>[C("div",Ae,[_(g,{items:o(v),disabled:o(l),onToggle:a[0]||(a[0]=m=>o(h)[m].value=!o(h)[m].value)},null,8,["items","disabled"]),C("div",Me,[a[3]||(a[3]=C("span",null,"Duration:",-1)),_(te,{duration:o(s),onSelect:a[1]||(a[1]=m=>s.value=m)},null,8,["duration"])]),C("div",We,[a[4]||(a[4]=C("span",null,"Interval:",-1)),_(te,{duration:o(p),onSelect:a[2]||(a[2]=m=>p.value=m)},null,8,["duration"])])])]),default:f(()=>[C("div",Oe,null,512)]),_:1},8,["loading"])}}}),Ie=O(Pe,[["__scopeId","data-v-7cf8ebb6"]]),Ue={class:"dashboard-grid"},Re=B({__name:"MEV",props:{pool:{}},setup(c){const u=k(()=>c.pool.address);return(d,i)=>($(),G("div",Ue,[_(Ie,{style:{"grid-area":"chart"},pool:o(u)},null,8,["pool"])]))}}),Ee=O(Re,[["__scopeId","data-v-a5261ecc"]]),qe={class:"actions"},Ne={ref:"chartRef",class:"chart"},Qe="chart_pool_balances_dollars",xe="chart_pool_balances_type",je=B({__name:"ChartBalances",props:{balances:{},title:{},showDollars:{type:Boolean,default:!0},chartType:{default:"area"}},setup(c){const u=P(),{items:d,toggles:i,disabled:v}=Y(()=>c.balances.map(({symbol:e},a)=>({id:e,label:e,color:u.value.colorsArray[a],togglable:!0}))),h=Q("card"),l=X(Qe,!1),s=["unstacked","stacked","100%"],p=[{id:"unstacked",label:"Unstacked"},{id:"stacked",label:"Stacked"},{id:"100%",label:"Stacked (100%)"}],t=X(xe,s[0]),{chart:n,series:r}=U({createChartOptions:R(),series:[...c.balances.map(({symbol:e},a)=>({type:N,name:e,options:k(()=>({lineWidth:2,lineType:oe.WithSteps,color:u.value.colorsArray[a],lastValueVisible:!1,priceLineVisible:!1}))})),{type:"StackedArea",name:"stackedArea",options:k(()=>({colors:d.value.map((e,a)=>({item:e,i:a})).filter(({item:e})=>!v.value.includes(e.id)).map(({i:e})=>e).map(e=>u.value.colorsArray[e]).map(e=>({line:e,area:e+"15"})),lineWidth:2,lastValueVisible:!1,priceLineVisible:!1}))},{type:"StackedBars",name:"stackedBars",options:k(()=>({colors:d.value.map((e,a)=>({item:e,i:a})).filter(({item:e})=>!v.value.includes(e.id)).map(({i:e})=>e).map(e=>u.value.colorsArray[e]),lineWidth:2,lastValueVisible:!1,priceLineVisible:!1}))}]});M(()=>{n.value&&n.value.applyOptions({localization:{priceFormatter:t.value==="100%"?e=>`${L(e,0,"percentage")}%`:e=>`${L(e,1,"dollar")}${W(e)}`}})}),M(V);function V(){if(!(!n.value||Object.values(r).length<0)){for(const e of Object.values(r))e==null||e.setData([]);t.value==="unstacked"?S():A(t.value==="100%"),n.value.timeScale().fitContent()}}function S(){var e,a;for(const{symbol:y,balances:g}of c.balances.values()){if(!i[y].value){(e=r[y])==null||e.setData([]);continue}const b=c.showDollars&&l.value,m=g.map(T=>({time:T.timestamp.getUTCTimestamp(),value:b?T.balance*T.tokenPrice:T.balance})).uniqWith((T,F)=>T.time===F.time).orderBy(T=>T.time,"asc");m.length>0&&((a=r[y])==null||a.setData(m))}}function A(e){if(!r.stackedArea||!r.stackedBars)return;const a=c.showDollars&&l.value,y=[...c.balances.values()].filter(({symbol:g,balances:b})=>i[g].value&&b.length>0).flatMap(({symbol:g,balances:b})=>b.map(m=>({symbol:g,timestamp:m.timestamp,balance:a?m.balance*m.tokenPrice:m.balance}))).groupBy(g=>g.timestamp.getTime()).entries().map(([g,b])=>{const m=e&&b.sumBy(F=>F.balance)||1,T=b.map(F=>e?F.balance/m*100:F.balance);return{time:Number(g)/1e3,values:T}}).uniqWith((g,b)=>g.time===b.time).orderBy(g=>g.time,"asc");y.length>0&&(c.chartType==="area"?(r.stackedArea.setData(y),r.stackedBars.setData([])):(r.stackedArea.setData([]),r.stackedBars.setData(y)))}return(e,a)=>{const y=ae,g=se,b=ke,m=x,T=z,F=I;return $(),w(F,{ref_key:"card",ref:h,class:"stack-actions",title:e.title??"Balances"},{actions:f(()=>[C("div",qe,[re(e.$slots,"actions",{},void 0,!0),_(y,{options:p,selected:p.find(D=>D.id===o(t))??p[0],onSelect:a[0]||(a[0]=D=>t.value=D.id)},{option:f(({option:D})=>[j(K(D.label),1)]),_:1},8,["selected"]),e.showDollars?($(),w(b,{key:0},{trigger:f(()=>[_(g,{"model-value":o(l),onClick:a[1]||(a[1]=D=>l.value=!o(l))},{default:f(()=>a[3]||(a[3]=[j(" $ ")])),_:1,__:[3]},8,["model-value"])]),default:f(()=>[a[4]||(a[4]=j(" Show token balances in USD. "))]),_:1,__:[4]})):q("",!0),_(m,{chart:o(n),target:o(h)},null,8,["chart","target"])])]),"actions-secondary":f(()=>[_(T,{items:o(d),disabled:o(v),onToggle:a[2]||(a[2]=D=>o(i)[D].value=!o(i)[D].value)},null,8,["items","disabled"])]),default:f(()=>[C("div",Ne,null,512)]),_:3},8,["title"])}}}),Ge=O(je,[["__scopeId","data-v-ca373428"]]),Ke={class:"controls"},He={ref:"chartRef",class:"chart"},Ye=B({__name:"ChartPrice",props:{ohlc:{},minMove:{default:()=>{}}},setup(c){const u=P(),d=H(!1);let i=1,v=0;const{chart:h,series:l}=U({createChartOptions:R(),series:{type:be,name:"ohlc",options:k(()=>{const{colors:t}=u.value;return{priceFormat:{type:"custom",formatter:p,minMove:c.minMove},upColor:t.green,borderUpColor:t.green,wickUpColor:t.green,downColor:t.red,borderDownColor:t.red,wickDownColor:t.red}})}});M(s);function s(){if(!h.value||!l.ohlc)return;const t=d.value?-1:1,n=c.ohlc.map(r=>({time:r.time.getUTCTimestamp(),open:Math.pow(r.open,t),high:Math.pow(r.high,t),low:Math.pow(r.low,t),close:Math.pow(r.close,t)})).uniqWith((r,V)=>r.time===V.time).orderBy(r=>r.time,"asc");l.ohlc.setData(n),v=Math.min(...n.map(r=>r.low)),i=Math.max(...n.map(r=>r.high)),h.value.timeScale().fitContent()}function p(t){const n=i-v,r=n>1?n-Math.floor(n):n,V=-Math.floor(Math.log10(r)+1)+2;return`${L(t,V,"dollar")}${W(t)}`}return(t,n)=>{const r=se,V=I;return $(),w(V,{title:"Price"},{actions:f(()=>[C("div",Ke,[_(r,{"model-value":o(d),onClick:n[0]||(n[0]=S=>d.value=!o(d))},{default:f(()=>n[1]||(n[1]=[j(" Invert ")])),_:1,__:[1]},8,["model-value"])])]),default:f(()=>[C("div",He,null,512)]),_:1})}}}),ze=O(Ye,[["__scopeId","data-v-2ec926d9"]]),Je={style:{display:"flex"}},Xe={ref:"chartRef",class:"chart"},Ze=B({__name:"ChartTvl",props:{tvl:{}},setup(c){const u=P(),d=Q("card"),{chart:i,series:v}=U({createChartOptions:R(),series:le({name:"tvl",color:k(()=>u.value.colors.blue),formatter:l=>`$${L(l,1,"dollar")}${W(l)}`})});M(h);function h(){if(!i.value||!v.tvl)return;const l=c.tvl.map(s=>({time:s.timestamp.getUTCTimestamp(),value:s.tvl})).uniqWith((s,p)=>s.time===p.time).orderBy(s=>s.time,"asc");l.length>0&&v.tvl.setData(l),i.value.timeScale().fitContent()}return(l,s)=>{const p=J,t=x,n=I;return $(),w(n,{ref_key:"card",ref:d,title:"TVL"},{actions:f(()=>[C("div",Je,[_(p,{filename:"tvl",series:o(v)},null,8,["series"]),_(t,{chart:o(i),target:o(d)},null,8,["chart","target"])])]),default:f(()=>[C("div",Xe,null,512)]),_:1},512)}}}),et={style:{display:"flex"}},tt={ref:"chartRef",class:"chart"},at=B({__name:"ChartVolume",props:{volume:{}},setup(c){const u=P(),d=Q("card"),{chart:i,series:v}=U({createChartOptions:R(),series:le({name:"volume",color:k(()=>u.value.colors.blue),formatter:l=>`$${L(l,1,"dollar")}${W(l)}`})});M(h);function h(){if(!i.value||!v.volume)return;const l=c.volume.map(s=>({time:s.timestamp.getUTCTimestamp(),value:s.volume})).uniqWith((s,p)=>s.time===p.time).orderBy(s=>s.time,"asc");l.length>0&&v.volume.setData(l),i.value.timeScale().fitContent()}return(l,s)=>{const p=J,t=x,n=I;return $(),w(n,{ref_key:"card",ref:d,title:"Volume"},{actions:f(()=>[C("div",et,[_(p,{filename:"volume",series:o(v)},null,8,["series"]),_(t,{chart:o(i),target:o(d)},null,8,["chart","target"])])]),default:f(()=>[C("div",tt,null,512)]),_:1},512)}}});function ot(c,u,d,i){return Te({queryKey:["curve-token-price",u,d,i],queryFn:({queryKey:[,v,h,l]})=>Se(c.value,v,h,l),enabled:k(()=>!!c.value&&!!u.value&&!!d.value&&!!i.value),initialData:[],initialDataUpdatedAt:0})}const lt={style:{display:"flex"}},st={ref:"chartRef",class:"chart"},nt=B({__name:"ChartParameters",props:{snapshots:{}},setup(c){const u=P(),{items:d,toggles:i,disabled:v}=Y(()=>{const{blue:t,yellow:n,purple:r}=u.value.colors;return[{id:"fee",label:"Fee",color:t,togglable:!0},{id:"a",label:"A",color:n,togglable:!0},{id:"offpegFeeMultiplier",label:"Offpeg Fee Multiplier",color:r,togglable:!0}]}),h=Q("card"),{chart:l,series:s}=U({createChartOptions:R(),series:[{type:N,name:"fee",options:k(()=>({priceFormat:{type:"custom",formatter:t=>`${L(t,0,"dollar")}${W(t)}`,minMove:1},lineWidth:2,color:u.value.colors.blue,lastValueVisible:!1,priceLineVisible:!1}))},{type:N,name:"a",options:k(()=>({lineWidth:2,color:u.value.colors.yellow,lastValueVisible:!1,priceLineVisible:!1}))},{type:N,name:"offpegFeeMultiplier",options:k(()=>({lineWidth:2,color:u.value.colors.purple,lastValueVisible:!1,priceLineVisible:!1}))}]});M(p);function p(){!l.value||!s.fee||!s.a||!s.offpegFeeMultiplier||(s.fee.setData(c.snapshots.map(t=>({time:t.timestamp.getUTCTimestamp(),value:t.fee})).uniqWith((t,n)=>t.time===n.time).orderBy(t=>t.time,"asc")),s.a.setData(c.snapshots.map(t=>({time:t.timestamp.getUTCTimestamp(),value:t.a})).uniqWith((t,n)=>t.time===n.time).orderBy(t=>t.time,"asc")),s.offpegFeeMultiplier.setData(c.snapshots.map(t=>({time:t.timestamp.getUTCTimestamp(),value:t.offpegFeeMultiplier})).uniqWith((t,n)=>t.time===n.time).orderBy(t=>t.time,"asc")),s.fee.applyOptions({visible:i.fee.value}),s.a.applyOptions({visible:i.a.value}),s.offpegFeeMultiplier.applyOptions({visible:i.offpegFeeMultiplier.value}),l.value.timeScale().fitContent())}return(t,n)=>{const r=J,V=x,S=z,A=I;return $(),w(A,{ref_key:"card",ref:h,title:"Parameters & Fees",class:"stack-actions"},{actions:f(()=>[C("div",lt,[_(r,{filename:"parameters_and_fees",series:o(s)},null,8,["series"]),_(V,{chart:o(l),target:o(h)},null,8,["chart","target"])])]),"actions-secondary":f(()=>[_(S,{items:o(d),disabled:o(v),onToggle:n[0]||(n[0]=e=>o(i)[e].value=!o(i)[e].value)},null,8,["items","disabled"])]),default:f(()=>[C("div",st,null,512)]),_:1},512)}}}),it={class:"dashboard-grid"},rt={class:"tokens"},ct=B({__name:"PoolOverview",props:{pool:{},chain:{}},setup(c){const u=k(()=>{var e;return(e=c.pool)==null?void 0:e.address}),d=k(()=>{var e;return(e=c.pool)==null?void 0:e.coins[0].address}),i=k(()=>{var e;return(e=c.pool)==null?void 0:e.coins[1].address}),{isFetching:v,data:h}=ot(E(()=>c.chain),u,d,i),{isFetching:l,data:s}=_e(E(()=>c.chain),u),{isFetching:p,data:t}=fe(E(()=>c.chain),u),{isFetching:n,data:r}=he(E(()=>c.chain),u),V=k(()=>s.value.map(e=>({timestamp:e.timestamp,volume:e.volume}))),S=k(()=>t.value.map(e=>({timestamp:e.timestamp,tvl:e.tvlUSD}))),A=k(()=>c.pool?c.pool.coins.map(e=>({symbol:e.symbol,balances:t.value.map(a=>({timestamp:a.timestamp,balance:a.balances[e.poolIndex],tokenPrice:a.tokenPrices[e.poolIndex]}))})):[]);return(e,a)=>{const y=Ve,g=$e,b=Ce;return $(),G("div",it,[_(g,{style:{"grid-area":"kpi1"},label:"Tokens","has-value":!!e.pool},{default:f(()=>{var m;return[C("div",rt,[($(!0),G(ce,null,ue(((m=e.pool)==null?void 0:m.coins)??[],T=>($(),w(y,{key:T.address,clickable:"",chain:e.chain,address:T.address},null,8,["chain","address"]))),128))])]}),_:1},8,["has-value"]),_(g,{style:{"grid-area":"kpi2"},label:"TVL","has-value":!!e.pool},{default:f(()=>{var m;return[_(b,{type:"dollar",value:((m=e.pool)==null?void 0:m.tvlUsd)??0},null,8,["value"])]}),_:1},8,["has-value"]),_(g,{style:{"grid-area":"kpi3"},label:"Volume (24h)","has-value":!!e.pool},{default:f(()=>{var m;return[_(b,{type:"dollar",value:((m=e.pool)==null?void 0:m.tradingVolume24h)??0},null,8,["value"])]}),_:1},8,["has-value"]),_(g,{style:{"grid-area":"kpi4"},label:"Fees (24h)","has-value":!!e.pool},{default:f(()=>{var m;return[_(b,{type:"dollar",value:((m=e.pool)==null?void 0:m.tradingFee24h)??0},null,8,["value"])]}),_:1},8,["has-value"]),_(ze,{style:{"grid-area":"price"},ohlc:o(h),loading:o(v)},null,8,["ohlc","loading"]),_(at,{style:{"grid-area":"volume"},volume:o(V),loading:o(l)},null,8,["volume","loading"]),_(Ze,{style:{"grid-area":"tvl"},tvl:o(S),loading:o(p)},null,8,["tvl","loading"]),_(Ge,{style:{"grid-area":"balances"},balances:o(A),loading:o(p)},null,8,["balances","loading"]),_(nt,{style:{"grid-area":"parameters"},snapshots:o(r),loading:o(n)},null,8,["snapshots","loading"])])}}}),ut=O(ct,[["__scopeId","data-v-896f8d7a"]]),mt={class:"dashboard"},dt=B({__name:"Pool.page",setup(c){const u=ee("chain"),d=ee("poolAddr"),{isFetching:i,data:v}=ge(u,d.value),{crumbs:h}=me(de());pe(v,p=>{h.value=[{id:"pools",label:"Pools",pathName:"pools",params:()=>({chain:u.value})},{id:"pool",label:`Pool: ${(p==null?void 0:p.name)??"?"}`}]},{immediate:!0});const{tabActive:l,tabActiveIndex:s}=we(["overview","mev"],"poolspool",()=>({chain:u.value,poolAddr:d.value}));return(p,t)=>{const n=ve,r=ne,V=ie;return $(),G("div",mt,[_(n,{loading:o(i)},null,8,["loading"]),!o(i)&&o(v)?($(),w(V,{key:0,active:o(s),onTab:t[0]||(t[0]=S=>s.value=S.index)},{default:f(()=>[_(r,{header:"Overview"},{default:f(()=>[($(),w(Z,null,[o(l)==="overview"?($(),w(ut,{key:0,pool:o(v),chain:o(u)},null,8,["pool","chain"])):q("",!0)],1024))]),_:1}),o(u)==="ethereum"&&o(v)?($(),w(r,{key:0,header:"MEV"},{default:f(()=>[($(),w(Z,null,[o(l)==="mev"?($(),w(Ee,{key:0,pool:o(v)},null,8,["pool"])):q("",!0)],1024))]),_:1})):q("",!0)]),_:1},8,["active"])):q("",!0)])}}}),Mt=O(dt,[["__scopeId","data-v-e7d124fd"]]);export{Mt as default};
