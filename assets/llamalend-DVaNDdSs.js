import{f as m,a as b,t as _}from"./timestamp-X9wFVw8g.js";import{t as u,f as i,g as n,b as p}from"./timestamp-DkvXAN4c.js";import{u as d}from"./useQuery-BT8h_fmv.js";import{f as l}from"./index-CSwO_UPo.js";const v=e=>({name:e.name,controller:e.controller,vault:e.vault,llamma:e.llamma,policy:e.policy,oracle:e.oracle,oraclePools:e.oracle_pools,rate:e.rate,apyBorrow:e.borrow_apy,apyLend:e.lend_apy,aprLend:e.lend_apr,aprLendCrv0Boost:e.lend_apr_crv_0_boost,aprLendCrvMaxBoost:e.lend_apr_crv_max_boost,nLoans:e.n_loans,priceOracle:e.price_oracle,ammPrice:e.amm_price,basePrice:e.base_price,totalDebt:e.total_debt,totalAssets:e.total_assets,totalDebtUsd:e.total_debt_usd,totalAssetsUsd:e.total_assets_usd,minted:e.minted,redeemed:e.redeemed,mintedUsd:e.minted_usd,redeemedUsd:e.redeemed_usd,loanDiscount:e.loan_discount,liquidationDiscount:e.liquidation_discount,minBand:e.min_band,maxBand:e.max_band,collateralBalance:e.collateral_balance,borrowedBalance:e.borrowed_balance,collateralBalanceUsd:e.collateral_balance_usd,borrowedBalanceUsd:e.borrowed_balance_usd,collateralToken:{symbol:e.collateral_token.symbol,address:e.collateral_token.address,rebasingYield:e.collateral_token.rebasing_yield},borrowedToken:{symbol:e.borrowed_token.symbol,address:e.borrowed_token.address,rebasingYield:e.borrowed_token.rebasing_yield},leverage:e.leverage,extraRewardApr:e.extra_reward_apr.map(a=>({address:a.address,symbol:a.symbol,rate:a.apr}))}),g=e=>({rate:parseFloat(e.rate),borrowApy:e.borrow_apy/100,lendApy:e.lend_apy/100,lendApr:e.lend_apr/100,lendAprCrv0Boost:e.lend_apr_crv_0_boost/100,lendAprCrvMaxBoost:e.lend_apr_crv_max_boost/100,numLoans:e.n_loans,priceOracle:parseFloat(e.price_oracle),ammPrice:parseFloat(e.amm_price),totalDebt:parseFloat(e.total_debt),totalDebtUsd:parseFloat(e.total_debt_usd),totalAssets:parseFloat(e.total_assets),totalAssetsUsd:parseFloat(e.total_assets_usd),minted:parseFloat(e.minted),redeemed:parseFloat(e.redeemed),collateralBalance:parseFloat(e.collateral_balance),collateralBalanceUsd:parseFloat(e.collateral_balance_usd),borrowedBalance:parseFloat(e.borrowed_balance),borrowedBalanceUsd:parseFloat(e.borrowed_balance_usd),timestamp:u(e.timestamp),discountLiquidation:e.liquidation_discount,discountLoan:e.loan_discount,basePrice:parseFloat(e.base_price),mintedUsd:parseFloat(e.minted_usd),redeemedUsd:parseFloat(e.redeemed_usd),minBand:parseFloat(e.min_band),maxBand:parseFloat(e.max_band),ammA:parseFloat(e.amm_a),sumDebtSquared:parseFloat(e.sum_debt_squared),extraRewardApr:e.extra_rewards_apr.map(a=>({address:a.address,symbol:a.symbol,rate:a.apr})),collateralToken:{symbol:e.collateral_token.symbol,address:e.collateral_token.address,rebasingYield:e.collateral_token.rebasing_yield},borrowedToken:{symbol:e.borrowed_token.symbol,address:e.borrowed_token.address,rebasingYield:e.borrowed_token.rebasing_yield}}),h=e=>e.markets.map(a=>({name:a.market_name,controller:a.controller,snapshotFirst:u(a.first_snapshot),snapshotLast:u(a.last_snapshot)})),y=e=>({health:e.health,healthFull:e.health_full,n:e.n,n1:e.n1,n2:e.n2,debt:e.debt,collateral:e.collateral,collateralUp:e.collateral_up,borrowed:e.borrowed,softLiquidation:e.soft_liquidation,totalDeposited:e.total_deposited,loss:e.loss,lossPct:e.loss_pct,oraclePrice:e.oracle_price,blockNumber:e.block_number,timestamp:u(e.timestamp)}),w=e=>e.data.map(y),f=e=>({controller:e.controller,user:e.user,totalDeposit:e.total_deposit,totalDepositUsd:e.total_deposit_usd_value,totalDepositFromUser:e.total_deposit_from_user,totalDepositFromUserPrecise:e.total_deposit_from_user_precise,totalDepositPrecise:e.total_deposit_precise,totalBorrowed:e.total_borrowed,totalBorrowedPrecise:e.total_borrowed_precise,events:e.data.map(a=>({timestamp:u(a.dt),txHash:a.transaction_hash,type:a.type,user:a.user,collateralChange:a.collateral_change,collateralChangeUsd:a.collateral_change_usd??void 0,loanChange:a.loan_change,loanChangeUsd:a.loan_change_usd??void 0,liquidation:a.liquidation===null?void 0:{user:a.liquidation.user,liquidator:a.liquidation.liquidator,collateralReceived:a.liquidation.collateral_received,collateralReceivedUsd:a.liquidation.collateral_received_usd,stablecoinReceived:a.liquidation.stablecoin_received,stablecoinReceivedUsd:a.liquidation.stablecoin_received_usd,debt:a.liquidation.debt,debtUsd:a.liquidation.debt_usd},leverage:a.leverage===null?void 0:{type:a.leverage.event_type,user:a.leverage.user,userCollateral:a.leverage.user_collateral,userCollateralFromBorrowed:a.leverage.user_collateral_from_borrowed,userCollateralUsed:a.leverage.user_collateral_used,userBorrowed:a.leverage.user_borrowed,debt:a.leverage.debt,leverageCollateral:a.leverage.leverage_collateral,stateCollateralUsed:a.leverage.state_collateral_used,borrowedFromStateCollateral:a.leverage.borrowed_from_state_collateral,borrowedFromUserCollateral:a.leverage.borrowed_from_user_collateral},n1:a.n1,n2:a.n2,oraclePrice:a.oracle_price}))});async function q(e){const a=n(e);return i(`${a}/v1/lending/chains`).then(r=>r.data)}async function F(e,a={},r){const t=n(r);return(await i(`${t}/v1/lending/markets/${e}${p(a)}`)).data.map(v)}async function U(e,a,r={fetch_on_chain:!0,agg:"day"},t){const o=n(t);return(await i(`${o}/v1/lending/markets/${e}/${a}/snapshots${p(r)}`)).data.map(g)}async function k(e,a,r){const t=n(r),o=await i(`${t}/v1/lending/users/${a}/${e}?page=1&per_page=100&include_closed=false`);return h(o)}async function $(e,a,r,t){const o=n(t),s=await i(`${o}/v1/lending/users/${a}/${e}/${r}/snapshots?page=1&per_page=100`);return w(s)}async function B(e,a,r,t){const o=n(t),s=await i(`${o}/v1/lending/collateral_events/${a}/${r}/${e}`);return f(s)}function c(){return{initialData:[],initialDataUpdatedAt:0}}function P(){return d({queryKey:["llamalend-chains"],queryFn:()=>q(),initialData:["ethereum","arbitrum"],initialDataUpdatedAt:0})}function S(e){return d({queryKey:["llamalend-markets",e],queryFn:({queryKey:[,a]})=>F(a)})}function Q(e,a){return d({queryKey:["llamalend-market-snapshots",l(()=>e.value?.controller)],queryFn:({queryKey:[,r]})=>U(a.value,r),...c(),enabled:l(()=>!!e.value&&!!a.value)})}function R(e,a){return d({queryKey:["llamalend-user-markets",l(()=>e.value),l(()=>a.value)],queryFn:({queryKey:[,r,t]})=>k(r,t),enabled:l(()=>!!e.value&&!!a.value),...c()})}function E(e,a,r){return d({queryKey:["llamalend-user-market-snapshots",l(()=>e.value),l(()=>a.value),l(()=>r.value)],queryFn:({queryKey:[,t,o,s]})=>$(t,o,s),enabled:l(()=>!!e.value&&!!a.value&&!!r.value),...c()})}function T(e,a,r){return d({queryKey:["llamalend-user-market-events",l(()=>e.value),l(()=>a.value),l(()=>r.value)],queryFn:({queryKey:[,t,o,s]})=>B(t,o,s),enabled:l(()=>!!e.value&&!!a.value&&!!r.value)})}const C=e=>({user:e.user,first:_(e.first),last:_(e.last),debt:parseFloat(e.debt),health:parseFloat(e.health),healthFull:parseFloat(e.health_full),loss:parseFloat(e.loss),borrowed:parseFloat(e.borrowed),collateral:parseFloat(e.collateral),softLiquidation:e.soft_liquidation});async function D(e,a,r,t){const o=n(t);return(await m(`${o}/v1/lending/users/${e}/${a}/users${b(r)}`)).data.map(C)}function Y(e,a){return d({queryKey:["llamalend-market-all-users",l(()=>e.value),l(()=>a.value)],queryFn:({queryKey:[,r,t]})=>D(r,t,{per_page:1e3}),enabled:l(()=>!!e.value&&!!a.value)})}export{T as a,R as b,S as c,P as d,Q as e,Y as f,E as u};
