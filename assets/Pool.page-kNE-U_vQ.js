import{_ as le,a as se}from"./TabItem.vue_vue_type_script_setup_true_lang-BDNOuZWw.js";import{c as V,d as D,W as P,X as x,a6 as G,Y as W,e as T,o as k,g as F,w as b,f as C,b as f,u as t,a3 as Z,j as E,i as H,_ as M,r as K,t as q,a as N,F as ne,l as ie,a4 as re,a5 as ce,N as ue,V as U,R as me,a2 as Y}from"./index-CNLf27K2.js";import{a as de,b as pe,c as ve}from"./pools-BIOYzSHC.js";import{_ as _e}from"./AsyncValue-BsSjP6NC.js";import{a as fe,_ as he}from"./KPI-CFnB-4Aw.js";import{_ as ge}from"./TokenIcon-Cos8Lrwq.js";import{g as be}from"./api-Bfvlvlrj.js";import{u as ye}from"./useQuery-S4XKk8db.js";import{u as z,_ as ee}from"./UseLegend-BBpoe3vM.js";import{_ as te}from"./ButtonToggle-DXPgJ1p1.js";import{u as I,b as Q,c as R,a as j,_ as ae}from"./UseLightweightChart-CeNkyobe.js";import{r as O,u as B}from"./Number-CfWKiuRs.js";import{u as Ce}from"./queries-D33h44dD.js";import{a as X}from"./index-CG4Pb4u2.js";import{u as $e}from"./UseTabNavigation-B-3Uxf7J.js";import"./timestamp-C4C6eGnP.js";import"./UseHost-D3Uos7Qu.js";import"./Object-DOSYkgA0.js";import"./Helper-BYX2UyMe.js";function ke(p,d,c,n){return ye({queryKey:["curve-token-price",d,c,n],queryFn:({queryKey:[,v,y,l]})=>be(p.value,v,y,l),enabled:V(()=>!!p.value&&!!d.value&&!!c.value&&!!n.value),initialData:[],initialDataUpdatedAt:0})}const Se={style:{display:"flex"}},Ve={ref:"chartRef",class:"chart"},we="chart_pool_balances_dollars",Te="chart_pool_balances_type",Ae=D({__name:"ChartBalances",props:{balances:{}},setup(p){const d=P(),{items:c,toggles:n,disabled:v}=z(()=>p.balances.map(({symbol:e},a)=>({id:e,label:e,color:d.value.colorsArray[a],togglable:!0}))),y=x("card"),l=G(we,!1),u=["unstacked","stacked","100%"],m=[{id:"unstacked",label:"Unstacked"},{id:"stacked",label:"Stacked"},{id:"100%",label:"Stacked (100%)"}],_=G(Te,u[0]),{chart:h,series:r}=I({createChartOptions:R(),series:[...p.balances.map(({symbol:e},a)=>({type:"Line",name:e,options:V(()=>({priceFormat:{type:"custom",formatter:s=>`${O(s,1,"dollar")}${B(s)}`},lineWidth:2,lineType:Q.WithSteps,color:d.value.colorsArray[a],lastValueVisible:!1,priceLineVisible:!1}))})),{type:"StackedArea",name:"stacked",options:V(()=>({priceFormat:{type:"custom",formatter:e=>`${O(e,1,"dollar")}${B(e)}`},colors:c.value.map((e,a)=>({item:e,i:a})).filter(({item:e})=>!v.value.includes(e.id)).map(({i:e})=>e).map(e=>d.value.colorsArray[e]).map(e=>({line:e,area:e+"15"})),lineWidth:2,lastValueVisible:!1,priceLineVisible:!1}))}]});W(w);function w(){if(!(!h.value||Object.values(r).length<0)){for(const e of Object.values(r))e==null||e.setData([]);_.value==="unstacked"?o():L(_.value==="100%"),h.value.timeScale().fitContent()}}function o(){var e,a;for(const{symbol:s,balances:i}of p.balances.values()){if(!n[s].value){(e=r[s])==null||e.setData([]);continue}const g=l.value,$=i.map(A=>({time:A.timestamp.getUTCTimestamp(),value:g?A.balance*A.tokenPrice:A.balance})).uniqWith((A,S)=>A.time===S.time).orderBy(A=>A.time,"asc");$.length>0&&((a=r[s])==null||a.setData($))}}function L(e){if(!r.stacked)return;const a=l.value,s=[...p.balances.values()].filter(({symbol:i,balances:g})=>n[i].value&&g.length>0).flatMap(({symbol:i,balances:g})=>g.map($=>({symbol:i,timestamp:$.timestamp,balance:a?$.balance*$.tokenPrice:$.balance}))).groupBy(i=>i.timestamp.getTime()).entries().map(([i,g])=>{const $=e?g.reduce((S,oe)=>S+oe.balance,0):1,A=g.map(S=>e?S.balance/$*100:S.balance);return{time:Number(i)/1e3,values:A}}).uniqWith((i,g)=>i.time===g.time).orderBy(i=>i.time,"asc");s.length>0&&r.stacked.setData(s)}return(e,a)=>{const s=Z,i=te,g=fe,$=ee,A=F;return k(),T(A,{ref_key:"card",ref:y,class:"stack-actions",title:"Balances"},{actions:b(()=>[C("div",Se,[f(s,{options:m,selected:m.find(S=>S.id===t(_))??m[0],onSelect:a[0]||(a[0]=S=>_.value=S.id)},{option:b(({option:S})=>[E(H(S.label),1)]),_:1},8,["selected"]),f(g,null,{trigger:b(()=>[f(i,{style:{"margin-right":"1rem"},"model-value":t(l),onClick:a[1]||(a[1]=S=>l.value=!t(l))},{default:b(()=>a[3]||(a[3]=[E(" $ ")])),_:1},8,["model-value"])]),default:b(()=>[a[4]||(a[4]=E(" Show token balances in USD. "))]),_:1}),f(t(j),{chart:t(h),target:t(y)},null,8,["chart","target"])])]),"actions-secondary":b(()=>[f($,{items:t(c),disabled:t(v),onToggle:a[2]||(a[2]=S=>t(n)[S].value=!t(n)[S].value)},null,8,["items","disabled"])]),default:b(()=>[C("div",Ve,null,512)]),_:1},512)}}}),De=M(Ae,[["__scopeId","data-v-f67ab417"]]),Le={style:{display:"flex"}},Oe={ref:"chartRef",class:"chart"},Be=D({__name:"ChartTvl",props:{tvl:{}},setup(p){const d=P(),c=x("card"),{chart:n,series:v}=I({createChartOptions:R(),series:{type:"Area",name:"tvl",options:V(()=>({priceFormat:{type:"custom",formatter:l=>`$${O(l,1,"dollar")}${B(l)}`},lineWidth:2,lineType:Q.WithSteps,lineColor:d.value.colors.blue,topColor:"rgb(32, 129, 240, 0.2)",bottomColor:"rgba(32, 129, 240, 0)",lastValueVisible:!1,priceLineVisible:!1}))}});W(y);function y(){if(!n.value||!v.tvl)return;const l=p.tvl.map(u=>({time:u.timestamp.getUTCTimestamp(),value:u.tvl})).uniqWith((u,m)=>u.time===m.time).orderBy(u=>u.time,"asc");l.length>0&&v.tvl.setData(l),n.value.timeScale().fitContent()}return(l,u)=>{const m=F;return k(),T(m,{ref_key:"card",ref:c,title:"TVL"},{actions:b(()=>[C("div",Le,[f(t(ae),{filename:"tvl",series:t(v)},null,8,["series"]),f(t(j),{chart:t(n),target:t(c)},null,8,["chart","target"])])]),default:b(()=>[C("div",Oe,null,512)]),_:1},512)}}}),Me={style:{display:"flex"}},Pe={ref:"chartRef",class:"chart"},We=D({__name:"ChartVolume",props:{volume:{}},setup(p){const d=P(),c=x("card"),{chart:n,series:v}=I({createChartOptions:R(),series:{type:"Area",name:"volume",options:V(()=>({priceFormat:{type:"custom",formatter:l=>`$${O(l,1,"dollar")}${B(l)}`},lineWidth:2,lineType:Q.WithSteps,lineColor:d.value.colors.blue,topColor:"rgb(32, 129, 240, 0.2)",bottomColor:"rgba(32, 129, 240, 0)",lastValueVisible:!1,priceLineVisible:!1}))}});W(y);function y(){if(!n.value||!v.volume)return;const l=p.volume.map(u=>({time:u.timestamp.getUTCTimestamp(),value:u.volume})).uniqWith((u,m)=>u.time===m.time).orderBy(u=>u.time,"asc");l.length>0&&v.volume.setData(l),n.value.timeScale().fitContent()}return(l,u)=>{const m=F;return k(),T(m,{ref_key:"card",ref:c,title:"Volume"},{actions:b(()=>[C("div",Me,[f(t(ae),{filename:"volume",series:t(v)},null,8,["series"]),f(t(j),{chart:t(n),target:t(c)},null,8,["chart","target"])])]),default:b(()=>[C("div",Pe,null,512)]),_:1},512)}}}),Fe={class:"controls"},Ie={ref:"chartRef",class:"chart"},Re=D({__name:"ChartPrice",props:{ohlc:{}},setup(p){const d=P(),c=K(!1);let n=1,v=0;const{chart:y,series:l}=I({createChartOptions:R(),series:{type:"Candlestick",name:"ohlc",options:V(()=>{const{colors:_}=d.value;return{priceFormat:{type:"custom",formatter:m},upColor:_.green,borderUpColor:_.green,wickUpColor:_.green,downColor:_.red,borderDownColor:_.red,wickDownColor:_.red}})}});W(u);function u(){if(!y.value||!l.ohlc)return;const _=c.value?-1:1,h=p.ohlc.map(r=>({time:r.time.getUTCTimestamp(),open:Math.pow(r.open,_),high:Math.pow(r.high,_),low:Math.pow(r.low,_),close:Math.pow(r.close,_)})).uniqWith((r,w)=>r.time===w.time).orderBy(r=>r.time,"asc");h.length>0&&(l.ohlc.setData(h),v=Math.min(...h.map(r=>r.low)),n=Math.max(...h.map(r=>r.high))),y.value.timeScale().fitContent()}function m(_){const h=n-v,r=h>1?h-Math.floor(h):h,w=-Math.floor(Math.log10(r)+1)+2;return`${O(_,w,"dollar")}${B(_)}`}return(_,h)=>{const r=te,w=F;return k(),T(w,{title:"Price"},{actions:b(()=>[C("div",Fe,[f(r,{"model-value":t(c),onClick:h[0]||(h[0]=o=>c.value=!t(c))},{default:b(()=>h[1]||(h[1]=[E(" Invert ")])),_:1},8,["model-value"])])]),default:b(()=>[C("div",Ie,null,512)]),_:1})}}}),Ue=M(Re,[["__scopeId","data-v-499fd575"]]),Ee={class:"dashboard-grid"},qe={class:"tokens"},Ne=D({__name:"PoolOverview",props:{pool:{},chain:{}},setup(p){const d=V(()=>{var o;return(o=p.pool)==null?void 0:o.address}),c=V(()=>{var o;return(o=p.pool)==null?void 0:o.coins[0].address}),n=V(()=>{var o;return(o=p.pool)==null?void 0:o.coins[1].address}),{isFetching:v,data:y}=ke(q(()=>p.chain),d,c,n),{isFetching:l,data:u}=de(q(()=>p.chain),d),{isFetching:m,data:_}=pe(q(()=>p.chain),d),h=V(()=>u.value.map(o=>({timestamp:o.timestamp,volume:o.volume}))),r=V(()=>_.value.map(o=>({timestamp:o.timestamp,tvl:o.tvlUSD}))),w=V(()=>p.pool?p.pool.coins.map(o=>({symbol:o.symbol,balances:_.value.map(L=>({timestamp:L.timestamp,balance:L.balances[o.poolIndex],tokenPrice:L.tokenPrices[o.poolIndex]}))})):[]);return(o,L)=>{const e=ge,a=he,s=_e;return k(),N("div",Ee,[f(a,{style:{"grid-area":"kpi1"},label:"Tokens","has-value":!!o.pool},{default:b(()=>{var i;return[C("div",qe,[(k(!0),N(ne,null,ie(((i=o.pool)==null?void 0:i.coins)??[],g=>(k(),T(e,{key:g.address,clickable:"",chain:o.chain,address:g.address},null,8,["chain","address"]))),128))])]}),_:1},8,["has-value"]),f(a,{style:{"grid-area":"kpi2"},label:"TVL","has-value":!!o.pool},{default:b(()=>{var i;return[f(s,{type:"dollar",value:((i=o.pool)==null?void 0:i.tvlUsd)??0},null,8,["value"])]}),_:1},8,["has-value"]),f(a,{style:{"grid-area":"kpi3"},label:"Volume (24h)","has-value":!!o.pool},{default:b(()=>{var i;return[f(s,{type:"dollar",value:((i=o.pool)==null?void 0:i.tradingVolume24h)??0},null,8,["value"])]}),_:1},8,["has-value"]),f(a,{style:{"grid-area":"kpi4"},label:"Fees (24h)","has-value":!!o.pool},{default:b(()=>{var i;return[f(s,{type:"dollar",value:((i=o.pool)==null?void 0:i.tradingFee24h)??0},null,8,["value"])]}),_:1},8,["has-value"]),f(Ue,{style:{"grid-area":"price"},ohlc:t(y),loading:t(v)},null,8,["ohlc","loading"]),f(We,{style:{"grid-area":"volume"},volume:t(h),loading:t(l)},null,8,["volume","loading"]),f(Be,{style:{"grid-area":"tvl"},tvl:t(r),loading:t(m)},null,8,["tvl","loading"]),f(De,{style:{"grid-area":"balances"},balances:t(w),loading:t(m)},null,8,["balances","loading"])])}}}),xe=M(Ne,[["__scopeId","data-v-03cada61"]]),Qe={class:"option"},je={class:"label"},He=D({__name:"SelectDuration",props:{duration:{default:()=>({value:1,unit:"month"})}},emits:["select"],setup(p,{emit:d}){const c=d,n=[{value:1,unit:"hour"},{value:1,unit:"day"},{value:1,unit:"week"},{value:1,unit:"month"},{value:1,unit:"year"}],v=y=>{c("select",y)};return(y,l)=>{const u=Z;return k(),T(u,{options:n.map(m=>m),selected:y.duration,onSelect:v},{option:b(({option:m})=>[C("div",Qe,[C("div",je,H(m.value)+" "+H(m.unit),1)])]),_:1},8,["options","selected"])}}}),J=M(He,[["__scopeId","data-v-fb78b1f7"]]),Ke={style:{display:"flex"}},Ge={style:{display:"flex","flex-wrap":"wrap",gap:"2rem"}},Ye={class:"time"},Xe={class:"time"},Je={ref:"chartRef",class:"chart"},Ze=D({__name:"ChartMEV",props:{pool:{}},setup(p){function d(e,a){var g;const s=(g=e.replace("#","").match(/.{2}/g))==null?void 0:g.map($=>parseInt($,16));return s?`#${s.map($=>Math.max(0,Math.floor($*(1-a)))).map($=>$.toString(16).padStart(2,"0")).join("")}`:e}const c=P(),n=V(()=>({volume:c.value.colors.red,bars:[c.value.colorsArray[1],d(c.value.colorsArray[1],.33),c.value.colorsArray[0],d(c.value.colorsArray[0],.33)]})),{items:v,toggles:y,disabled:l}=z(()=>[{id:"atomic",label:"Atomic",color:n.value.bars[0],togglable:!0},{id:"cexdex",label:"Cexdex",color:n.value.bars[1],togglable:!0},{id:"within",label:"Within",color:n.value.bars[2],togglable:!0},{id:"outside",label:"Outside",color:n.value.bars[3],togglable:!0},{id:"total",label:"Volume (Total)",color:n.value.volume,togglable:!0}]),u=K({value:1,unit:"month"}),m=K({value:1,unit:"day"}),{isFetching:_,data:h}=Ce(q(()=>p.pool),u,m),r=x("card"),{chart:w,series:o}=I({createChartOptions:R(),series:[{type:"StackedBars",name:"data",options:V(()=>({priceFormat:{type:"custom",formatter:e=>`$${O(e,1,"dollar")}${B(e)}`},colors:v.value.map((e,a)=>({item:e,i:a})).filter(({item:e})=>!l.value.includes(e.id)).map(({i:e})=>e).map(e=>n.value.bars[e]),lastValueVisible:!1,priceLineVisible:!1}))},{type:"Line",name:"volume",options:V(()=>({priceFormat:{type:"custom",formatter:e=>`${O(e,1,"dollar")}${B(e)}`},lineWidth:2,lineType:Q.Curved,color:n.value.volume,lastValueVisible:!1,priceLineVisible:!1}))}]});W(L);function L(){if(!w.value||!o.volume||!o.data)return;const e=l.value.includes("total")?[]:h.value.map(s=>({time:s.interval_start_unixtime,value:s.full_volume})).uniqWith((s,i)=>s.time===i.time).orderBy(s=>s.time,"asc");e.length>1?(o.volume.setData(e),o.volume.applyOptions({visible:!0})):o.volume.applyOptions({visible:!1});const a=h.value.map(s=>({time:s.interval_start_unixtime,values:[...l.value.includes("atomic")?[]:[s.atomicArbVolume],...l.value.includes("cexdex")?[]:[s.cexDexArbVolume],...l.value.includes("within")?[]:[s.sandwichVolume_LossWithin],...l.value.includes("outside")?[]:[s.sandwichVolume_LossOutside]]})).uniqWith((s,i)=>s.time===i.time).orderBy(s=>s.time,"asc");a.length>0&&o.data.setData(a),w.value.timeScale().fitContent()}return(e,a)=>{const s=ee,i=F;return k(),T(i,{ref_key:"card",ref:r,title:"MEV",loading:t(_)},{actions:b(()=>[C("div",Ke,[f(t(j),{chart:t(w),target:t(r)},null,8,["chart","target"])])]),"actions-secondary":b(()=>[C("div",Ge,[f(s,{items:t(v),disabled:t(l),onToggle:a[0]||(a[0]=g=>t(y)[g].value=!t(y)[g].value)},null,8,["items","disabled"]),C("div",Ye,[a[3]||(a[3]=C("span",null,"Duration:",-1)),f(J,{duration:t(u),onSelect:a[1]||(a[1]=g=>u.value=g)},null,8,["duration"])]),C("div",Xe,[a[4]||(a[4]=C("span",null,"Interval:",-1)),f(J,{duration:t(m),onSelect:a[2]||(a[2]=g=>m.value=g)},null,8,["duration"])])])]),default:b(()=>[C("div",Je,null,512)]),_:1},8,["loading"])}}}),ze=M(Ze,[["__scopeId","data-v-3c2af1fe"]]),et={class:"dashboard-grid"},tt=D({__name:"MEV",props:{pool:{}},setup(p){const d=V(()=>p.pool.address);return(c,n)=>(k(),N("div",et,[f(ze,{style:{"grid-area":"chart"},pool:t(d)},null,8,["pool"])]))}}),at=M(tt,[["__scopeId","data-v-32e2b296"]]),ot={class:"dashboard"},lt=D({__name:"Pool.page",setup(p){const d=X("chain"),c=X("poolAddr"),{isFetching:n,data:v}=ve(d,c.value),{crumbs:y}=re(ce());ue(v,m=>{y.value=[{id:"pools",label:"Pools",pathName:"pools",params:()=>({chain:d.value})},{id:"pool",label:`Pool: ${(m==null?void 0:m.name)??"?"}`}]},{immediate:!0});const{tabActive:l,tabActiveIndex:u}=$e(["overview","mev"],"poolspool",()=>({chain:d.value,poolAddr:c.value}));return(m,_)=>{const h=me,r=le,w=se;return k(),N("div",ot,[f(h,{loading:t(n)},null,8,["loading"]),!t(n)&&t(v)?(k(),T(w,{key:0,active:t(u),onTab:_[0]||(_[0]=o=>u.value=o.index)},{default:b(()=>[f(r,{header:"Overview"},{default:b(()=>[(k(),T(Y,null,[t(l)==="overview"?(k(),T(xe,{key:0,pool:t(v),chain:t(d)},null,8,["pool","chain"])):U("",!0)],1024))]),_:1}),t(d)==="ethereum"&&t(v)?(k(),T(r,{key:0,header:"MEV"},{default:b(()=>[(k(),T(Y,null,[t(l)==="mev"?(k(),T(at,{key:0,pool:t(v)},null,8,["pool"])):U("",!0)],1024))]),_:1})):U("",!0)]),_:1},8,["active"])):U("",!0)])}}}),St=M(lt,[["__scopeId","data-v-aff87c40"]]);export{St as default};
