import{_ as X,a as Y}from"./TabItem.vue_vue_type_script_setup_true_lang-CCGJjABq.js";import{d as T,g as b,T as D,f as k,V as I,h as y,o as v,_ as R,u as e,w as h,a as g,r as w,b as r,O as Z,e as V,c as F,t as q,W as B,S as H,j as x,a4 as ee,a5 as ae,N as te,R as se,a2 as P}from"./index-5B2tI7Zc.js";import{e as M,u as ne}from"./crvusd-Brn7BR38.js";import{u as j,a as oe,b as re,c as ie,d as le,e as ce,f as de,T as ue,_ as me,g as pe,h as _e,i as he,j as ve,k as ge,l as fe,m as ke,n as be,o as ye,C as Ce,p as $e,q as Te}from"./TableTrades-CoOcp1ss.js";import{u as Q,a as W,c as N}from"./UseLightweightChart-C1SS2I-H.js";import{_ as we}from"./KPI-DKNNQWeY.js";import{_ as Le}from"./AsyncValue-BrxM0dB4.js";import{r as U,u as K}from"./Number-Bqyeu7gj.js";import{_ as qe}from"./InputNumber-G2Hy0n8z.js";import{_ as z,a as Ve}from"./Table-Br42HHVv.js";import{L as G}from"./link-BrTM50fX.js";import{_ as Se}from"./TokenIcon-SHuc7s7h.js";import{a as Ae}from"./index-BuXzwwaP.js";import{u as Fe}from"./UseTabNavigation--tZJLnzK.js";import"./timestamp-Dfir0V72.js";import"./api-DFkSxUea.js";import"./useQuery-Ds_Sub25.js";import"./BtnChartLWFullscreen.vue_vue_type_script_setup_true_lang-B0dd4bO7.js";import"./ButtonToggle-CmOxPJil.js";import"./ChartStylesApex-DiqR34V4.js";import"./Object-DOSYkgA0.js";import"./UseLegend-ifWC3xyM.js";import"./UsePagination-Bav67_-y.js";import"./UseRelativeTime-CazFgpUx.js";const Re={ref:"chartRef",class:"chart"},Be=T({__name:"ChartMarketAvailableCap",props:{market:{}},setup(l){const{isFetching:s,data:p}=M(b(()=>l.market)),_=D(),{chart:n,series:t}=Q({createChartOptions:N(),series:{type:"Area",name:"available",options:k(()=>({priceFormat:{type:"custom",formatter:o=>`$${U(o,0,"dollar")}${K(o)}`},lineWidth:2,lineType:W.WithSteps,lineColor:_.value.colors.blue,topColor:"rgb(32, 129, 240, 0.2)",bottomColor:"rgba(32, 129, 240, 0)",lastValueVisible:!1,priceLineVisible:!1}))}});I(i);function i(){if(!n.value||!t.available)return;const o=p.value.map(a=>({time:a.timestamp.getUTCTimestamp(),value:a.borrowable})).uniqWith((a,c)=>a.time===c.time).orderBy(a=>a.time,"asc").dropWhile(a=>a.value===0);o.length>0&&t.available.setData(o),n.value.timeScale().fitContent()}return(o,a)=>{const c=R;return v(),y(c,{title:"Borrowable & Debt Ceiling",loading:e(s)},{default:h(()=>[g("div",Re,null,512)]),_:1},8,["loading"])}}}),Oe={ref:"chartRef",class:"chart"},We=T({__name:"ChartMarketLoans",props:{market:{}},setup(l){const{isFetching:s,data:p}=M(b(()=>l.market)),_=D(),{chart:n,series:t}=Q({createChartOptions:N(),series:{type:"Histogram",name:"loans",options:k(()=>({color:_.value.colors.yellow,lastValueVisible:!1,priceFormat:{type:"volume"},priceLineVisible:!1}))}});I(i);function i(){if(!n.value||!t.loans)return;const o=p.value.map(a=>({time:a.timestamp.getUTCTimestamp(),value:a.nLoans})).uniqWith((a,c)=>a.time===c.time).orderBy(a=>a.time,"asc");o.length>0&&(t.loans.setData(o),n.value.timeScale().fitContent())}return(o,a)=>{const c=R;return v(),y(c,{title:"Loans",loading:e(s)},{default:h(()=>[g("div",Oe,null,512)]),_:1},8,["loading"])}}}),De={ref:"chartRef",class:"chart"},Ie=T({__name:"ChartMarketRates",props:{market:{}},setup(l){const{isFetching:s,data:p}=M(b(()=>l.market)),_=D(),n=w(null),{chart:t,series:i}=Q({createChartOptions:N(),series:[{type:"Area",name:"rates",options:k(()=>({priceFormat:{type:"custom",formatter:a},lineWidth:2,lineType:W.WithSteps,lineColor:_.value.colors.blue,topColor:"rgb(32, 129, 240, 0.2)",bottomColor:"rgba(32, 129, 240, 0)",lastValueVisible:!1,priceLineVisible:!1}))},{type:"Line",name:"ema",options:k(()=>({priceFormat:{type:"custom",formatter:a},lineWidth:2,lineType:W.WithSteps,color:_.value.colors.yellow,lastValueVisible:!1,priceLineVisible:!1}))}]});I(o);function o(){if(!t.value||!i.rates||!i.ema)return;const u=p.value.map(d=>({time:d.timestamp.getUTCTimestamp(),value:d.rate})).uniqWith((d,C)=>d.time===C.time).orderBy(d=>d.time,"asc"),f=c(u.map(d=>d.value),n.value??31).zip(u).map(d=>({time:d[1].time,value:d[0]}));f.length>0&&i.ema.setData(f),u.length>0&&(i.rates.setData(u),t.value.timeScale().fitContent())}function a(u){return`${U(u*100,0,"percentage")}%`}const c=(u,m=7)=>u.map((f,d)=>{const C=Math.max(d-(m-1),0),S=d+1,L=u.slice(C,S);return L.reduce((O,$)=>O+$,0)/L.length});return(u,m)=>{const f=qe,d=R;return v(),y(d,{title:"Rates",loading:e(s)},{actions:h(()=>[r(f,{modelValue:e(n),"onUpdate:modelValue":m[0]||(m[0]=C=>Z(n)?n.value=C:null),class:"avg-span",placeholder:"Avg span (days)",min:1,max:1/0},null,8,["modelValue"])]),default:h(()=>[g("div",De,null,512)]),_:1},8,["loading"])}}}),Me=V(Ie,[["__scopeId","data-v-646458b1"]]),Qe={ref:"chartRef",class:"chart"},Ne=T({__name:"ChartMarketVolume",props:{market:{},chain:{}},setup(l){const{isFetching:s,data:p}=j("crvusd",k(()=>{var o;return(o=l.market)==null?void 0:o.llamma}),b(()=>l.chain)),_=D(),{chart:n,series:t}=Q({createChartOptions:N(),series:{type:"Area",name:"volume",options:k(()=>({priceFormat:{type:"custom",formatter:o=>`$${U(o,0,"dollar")}${K(o)}`},lineWidth:2,lineType:W.WithSteps,lineColor:_.value.colors.blue,topColor:"rgb(32, 129, 240, 0.2)",bottomColor:"rgba(32, 129, 240, 0)",lastValueVisible:!1,priceLineVisible:!1}))}});I(i);function i(){if(!n.value||!t.volume)return;const o=(p.value??[]).map(a=>({time:a.time.getUTCTimestamp(),value:a.volume})).uniqWith((a,c)=>a.time===c.time).orderBy(a=>a.time,"asc");o.length>0&&t.volume.setData(o),n.value.timeScale().fitContent()}return(o,a)=>{const c=R;return v(),y(c,{title:"Volume",loading:e(s)},{default:h(()=>[g("div",Qe,null,512)]),_:1},8,["loading"])}}}),Ee={class:"dashboard-grid"},Pe=T({__name:"Liquidations",props:{market:{},chain:{}},setup(l){const s=k(()=>{var $;return($=l.market)==null?void 0:$.address}),{isFetching:p,data:_}=oe(w("crvusd"),b(()=>l.chain),s),{isFetching:n,data:t}=M(b(()=>l.market)),i=k(()=>t.value.map(({timestamp:$,priceOracle:A})=>({timestamp:$,priceOracle:A}))),o=k(()=>t.value.map(({timestamp:$,discountLiquidation:A})=>({timestamp:$,discount:A}))),a=k(()=>t.value.map(({timestamp:$,totalCollateralUsd:A,totalDebt:J})=>({timestamp:$,ratio:A/J}))),{isFetching:c,data:u}=re(w("crvusd"),b(()=>l.chain),s),{isFetching:m,data:f}=ie(w("crvusd"),b(()=>l.chain),s),{isFetching:d,data:C}=le(w("crvusd"),b(()=>l.chain),s),{isFetching:S,data:L}=ce(w("crvusd"),b(()=>l.chain),s),{isFetching:E,data:O}=de(w("crvusd"),b(()=>l.chain),s);return($,A)=>(v(),F("div",Ee,[r(e(ue),{overview:e(_),loading:e(p)},null,8,["overview","loading"]),r(e(me),{ratios:e(u),"prices-oracle":e(i),loading:e(c)||e(n)},null,8,["ratios","prices-oracle","loading"]),r(e(pe),{losses:e(O),loading:e(E)},null,8,["losses","loading"]),r(e(_e),{losses:e(O),loading:e(E)},null,8,["losses","loading"]),r(e(he),{deciles:e(L),loading:e(S)},null,8,["deciles","loading"]),r(e(ve),{ratios:e(a),loading:e(n)},null,8,["ratios","loading"]),r(e(ge),{liqs:e(f),loading:e(m)},null,8,["liqs","loading"]),r(e(fe),{liqs:e(C),loading:e(d)},null,8,["liqs","loading"]),r(e(ke),{discounts:e(o),liqs:e(C),loading:e(n)||e(d)},null,8,["discounts","liqs","loading"])]))}}),Ue=V(Pe,[["__scopeId","data-v-6ad4864c"]]),He=["href"],je={key:1},Ke=T({__name:"Addresses",props:{market:{}},setup(l){const s=k(()=>{var n,t,i;return[{description:"Controller",address:(n=l.market)==null?void 0:n.address},{description:"Factory",address:(t=l.market)==null?void 0:t.factoryAddress},{description:"Llamma",address:(i=l.market)==null?void 0:i.llamma}]}),p=n=>`https://etherscan.io/address/${n}`,_=async n=>{await navigator.clipboard.writeText(n)};return(n,t)=>{const i=G,o=H,a=z,c=R;return v(),y(c,{class:"addresses",title:"Addresses"},{default:h(()=>[r(a,{class:"addresses-table",rows:e(s)},{row:h(({item:{description:u,address:m}})=>[g("div",null,q(u),1),g("div",null,[m?(v(),F("a",{key:0,class:"font-mono",target:"_blank",href:p(m)},q(m),9,He)):(v(),F("span",je,"?"))]),g("div",null,[m?(v(),y(o,{key:0,onClick:f=>_(m)},{default:h(()=>[r(i)]),_:2},1032,["onClick"])):B("",!0)])]),_:1},8,["rows"])]),_:1})}}}),ze=V(Ke,[["__scopeId","data-v-2bb26947"]]),Ge={class:"token-info"},Je=["href"],Xe={class:"token-info"},Ye=["href"],Ze=T({__name:"Properties",props:{market:{},chain:{}},setup(l){const s=k(()=>{var t,i,o,a;return{type:"token",symbol:((i=(t=l.market)==null?void 0:t.collateralToken)==null?void 0:i.symbol)??"?",address:((a=(o=l.market)==null?void 0:o.collateralToken)==null?void 0:a.address)??"?"}}),p=k(()=>{var t,i,o,a;return{type:"token",symbol:((i=(t=l.market)==null?void 0:t.stablecoinToken)==null?void 0:i.symbol)??"?",address:((a=(o=l.market)==null?void 0:o.stablecoinToken)==null?void 0:a.address)??"?"}}),_=t=>`https://etherscan.io/address/${t}`,n=async t=>{await navigator.clipboard.writeText(t)};return(t,i)=>{const o=Se,a=G,c=H,u=Ve,m=z,f=R;return v(),y(f,{class:"properties",title:"Properties"},{default:h(()=>[r(m,{class:"properties-table"},{default:h(()=>[r(u,null,{default:h(()=>[i[2]||(i[2]=g("div",null,"Collateral",-1)),g("div",Ge,[r(o,{chain:t.chain,address:e(s).address},null,8,["chain","address"]),g("div",null,q(e(s).symbol),1),g("div",null,[g("a",{class:"font-mono",target:"_blank",href:_(e(s).address)},q(e(s).address),9,Je)]),g("div",null,[r(c,{onClick:i[0]||(i[0]=d=>n(e(s).address))},{default:h(()=>[r(a)]),_:1})])])]),_:1}),r(u,null,{default:h(()=>[i[3]||(i[3]=g("div",null,"Borrowed",-1)),g("div",Xe,[r(o,{chain:t.chain,address:e(p).address},null,8,["chain","address"]),g("div",null,q(e(p).symbol),1),g("div",null,[g("a",{class:"font-mono",target:"_blank",href:_(e(p).address)},q(e(p).address),9,Ye)]),g("div",null,[r(c,{onClick:i[1]||(i[1]=d=>n(e(p).address))},{default:h(()=>[r(a)]),_:1})])])]),_:1})]),_:1})]),_:1})}}}),xe=V(Ze,[["__scopeId","data-v-61c51caa"]]),ea={class:"dashboard-grid"},aa=T({__name:"MarketOverview",props:{market:{},chain:{}},setup(l){return(s,p)=>{const _=Le,n=we;return v(),F("div",ea,[r(n,{style:{"grid-area":"kpi1"},label:"Borrow Rate","has-value":!!s.market},{default:h(()=>{var t;return[r(_,{type:"percentage",value:100*(((t=s.market)==null?void 0:t.rate)??0)},null,8,["value"])]}),_:1},8,["has-value"]),r(n,{style:{"grid-area":"kpi2"},label:"Borrowed","has-value":!!s.market},{default:h(()=>{var t;return[r(_,{type:"dollar",value:(t=s.market)==null?void 0:t.borrowed},null,8,["value"])]}),_:1},8,["has-value"]),r(n,{style:{"grid-area":"kpi3"},label:"Borrowable","has-value":!!s.market},{default:h(()=>{var t;return[r(_,{type:"dollar",value:(t=s.market)==null?void 0:t.borrowable},null,8,["value"])]}),_:1},8,["has-value"]),r(n,{style:{"grid-area":"kpi4"},label:"Loans","has-value":!!s.market},{default:h(()=>{var t;return[x(q(((t=s.market)==null?void 0:t.loans)??0),1)]}),_:1},8,["has-value"]),r(e(Me),{style:{"grid-area":"rates"},market:s.market},null,8,["market"]),r(e(Be),{style:{"grid-area":"cap"},market:s.market},null,8,["market"]),r(e(We),{style:{"grid-area":"loans"},market:s.market},null,8,["market"]),r(e(Ne),{style:{"grid-area":"volume"},market:s.market,chain:s.chain},null,8,["market","chain"]),r(e(xe),{style:{"grid-area":"properties"},market:s.market,chain:s.chain},null,8,["market","chain"]),r(e(ze),{style:{"grid-area":"addresses"},market:s.market,chain:s.chain},null,8,["market","chain"])])}}}),ta=V(aa,[["__scopeId","data-v-efc50c6b"]]),sa={class:"dashboard-grid"},na=T({__name:"Trading",props:{market:{},chain:{}},setup(l){const s=k(()=>{var u;return(u=l.market)==null?void 0:u.llamma}),{isFetching:p,data:_}=j("crvusd",s,b(()=>l.chain)),n=w(1),{isFetching:t,data:i}=be("crvusd",s,b(()=>l.chain),n),o=w(1),{isFetching:a,data:c}=ye("crvusd",s,b(()=>l.chain),o);return(u,m)=>{var f,d,C,S;return v(),F("div",sa,[r(e(Ce),{style:{"grid-area":"ohlc"},ohlc:e(_)??[],loading:e(p)},null,8,["ohlc","loading"]),r(e($e),{style:{"grid-area":"trades"},trades:((f=e(i))==null?void 0:f.trades)??[],count:((d=e(i))==null?void 0:d.count)??0,chain:u.chain,loading:e(t),onPage:m[0]||(m[0]=L=>n.value=L)},null,8,["trades","count","chain","loading"]),r(e(Te),{style:{"grid-area":"events"},events:((C=e(c))==null?void 0:C.events)??[],count:((S=e(c))==null?void 0:S.count)??0,loading:e(a),onPage:m[1]||(m[1]=L=>o.value=L)},null,8,["events","count","loading"])])}}}),oa=V(na,[["__scopeId","data-v-13550918"]]),ra={class:"dashboard"},ia=T({__name:"Market.page",setup(l){const s=Ae("marketAddr"),{isFetching:p,data:_}=ne(),n=k(()=>_.value.find(a=>a.address===s.value)),{crumbs:t}=ee(ae());te(n,a=>{t.value=[{id:"crvusd",label:"crvUSD",pathName:"crvusd"},{id:"market",label:`Market: ${(a==null?void 0:a.name)??"?"}`}]},{immediate:!0});const{tabActive:i,tabActiveIndex:o}=Fe(["overview","trading","liquidations"],"crvusdmarket",()=>({marketAddr:s.value}));return(a,c)=>{const u=se,m=X,f=Y;return v(),F("div",ra,[r(u,{loading:e(p)},null,8,["loading"]),!e(p)&&e(n)?(v(),y(f,{key:0,active:e(o),onTab:c[0]||(c[0]=d=>o.value=d.index)},{default:h(()=>[r(m,{header:"Overview"},{default:h(()=>[(v(),y(P,null,[e(i)==="overview"?(v(),y(ta,{key:0,chain:"ethereum",market:e(n)},null,8,["market"])):B("",!0)],1024))]),_:1}),r(m,{header:"Trading"},{default:h(()=>[(v(),y(P,null,[e(i)==="trading"?(v(),y(oa,{key:0,chain:"ethereum",market:e(n)},null,8,["market"])):B("",!0)],1024))]),_:1}),r(m,{header:"Liquidations"},{default:h(()=>[(v(),y(P,null,[e(i)==="liquidations"?(v(),y(Ue,{key:0,chain:"ethereum",market:e(n)},null,8,["market"])):B("",!0)],1024))]),_:1})]),_:1},8,["active"])):B("",!0)])}}}),Ra=V(ia,[["__scopeId","data-v-3ac83fbe"]]);export{Ra as default};
