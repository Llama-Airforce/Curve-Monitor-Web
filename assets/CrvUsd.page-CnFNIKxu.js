import{d as U,r as x,f as w,T as M,U as R,V as F,h as A,o as L,w as c,a as o,b as t,u as a,j as C,_ as I,e as V,t as $,O as N,a5 as W,a6 as E,$ as O,c as q}from"./index-CVF9rKRH.js";import{u as z,_ as G}from"./UseLegend-B9plua_V.js";import{_ as Q}from"./ButtonToggle-X8OGMTGf.js";import{u as j,c as K,G as P,r as H,a as J,o as X,_ as Y,b as Z}from"./UseLightweightChart-BM3TfZvL.js";import{d as ee,u as se}from"./crvusd-BI49UdPW.js";import{r as te,u as oe}from"./Number-CgtTSdt4.js";/* empty css                                                                         *//* empty css                                                                    */import{_ as ae}from"./Table-D9nxCgCO.js";import{_ as le}from"./AsyncValue-BCIGDDyq.js";import{_ as ne}from"./TokenIcon-L_lPcRfd.js";import{_ as re}from"./IconExpander-B0WZ9UZe.js";import{_ as ie}from"./InputText-CK-O5NIm.js";import"./Object-DOSYkgA0.js";import"./timestamp-CeU_tFUE.js";import"./api-BL5-_Coi.js";import"./useQuery-DlYtpHcB.js";const ue={style:{display:"flex"}},de={class:"actions-secondary"},ce={class:"button-group"},pe={ref:"chartRef",class:"chart"},me=U({__name:"ChartCrvUsdSupply",setup(D){const i=x("3m"),b=w(()=>{switch(i.value){case"7d":return 7;case"1m":return 30;case"3m":return 90;case"6m":return 180;case"1y":return 365;default:return 90}}),u=M(),{items:p}=z(()=>[{id:"supply",label:"Supply",color:u.value.colorsArray[0]},{id:"borrowed",label:"Borrowed",color:u.value.colorsArray[1]}]),{isFetching:k,data:T}=ee(b),m=R("card");let _=null;const{chart:l,series:d}=j({createChartOptions:J(),series:[K({name:"supply",color:w(()=>u.value.colors.blue),formatter:y}),{type:P,name:"debt",options:w(()=>({priceFormat:{type:"custom",formatter:y},lineWidth:2,lineType:H.WithSteps,color:u.value.colors.yellow,lastValueVisible:!1,priceLineVisible:!1}))}]});F(h);function h(){if(!l.value||!d.debt||!d.supply)return;const r=T.value.groupBy(n=>n.timestamp.getTime()).entries().map(([,n])=>{var f;return{time:n[0].timestamp.getUTCTimestamp(),value:n.sumBy(S=>S.supply),debt:((f=n.find(S=>S.market==="Keepers debt"))==null?void 0:f.supply)??0}}).uniqWith((n,f)=>n.time===f.time).orderBy(n=>n.time,"asc"),s=r.map(n=>({time:n.time,value:n.value-n.debt}));d.supply.setData(r),d.debt.setData(s),l.value.timeScale().fitContent();const g=new Date(Date.UTC(2025,2,20)),e=g.getUTCTimestamp(),v=d.supply.data().map(n=>n.time).uniq(),B=(v.length>0&&v[0]<=e&&v.at(-1))??1/0>=e;_&&_.setMarkers([]),B&&(_=X(d.supply,[{time:g.getUTCTimestamp(),position:"aboveBar",color:u.value.colors.red,shape:"arrowDown",text:"Resupply Launch"}]))}function y(r){return`${te(r,0,"dollar")}${oe(r)}`}return(r,s)=>{const g=Y,e=Z,v=Q,B=G,n=I;return L(),A(n,{ref_key:"card",ref:m,title:"crvUSD Supply",class:"stack-actions",loading:a(k)},{actions:c(()=>[o("div",ue,[t(g,{filename:"crvusd_supply",series:a(d)},null,8,["series"]),t(e,{chart:a(l),target:a(m)},null,8,["chart","target"])])]),"actions-secondary":c(()=>[o("div",de,[o("div",ce,[t(v,{"model-value":a(i)==="7d",onClick:s[0]||(s[0]=f=>i.value="7d")},{default:c(()=>s[5]||(s[5]=[C(" 7d ")])),_:1,__:[5]},8,["model-value"]),t(v,{"model-value":a(i)==="1m",onClick:s[1]||(s[1]=f=>i.value="1m")},{default:c(()=>s[6]||(s[6]=[C(" 1m ")])),_:1,__:[6]},8,["model-value"]),t(v,{"model-value":a(i)==="3m",onClick:s[2]||(s[2]=f=>i.value="3m")},{default:c(()=>s[7]||(s[7]=[C(" 3m ")])),_:1,__:[7]},8,["model-value"]),t(v,{"model-value":a(i)==="6m",onClick:s[3]||(s[3]=f=>i.value="6m")},{default:c(()=>s[8]||(s[8]=[C(" 6m ")])),_:1,__:[8]},8,["model-value"]),t(v,{"model-value":a(i)==="1y",onClick:s[4]||(s[4]=f=>i.value="1y")},{default:c(()=>s[9]||(s[9]=[C(" 1y ")])),_:1,__:[9]},8,["model-value"])]),t(B,{items:a(p)},null,8,["items"])])]),default:c(()=>[o("div",pe,null,512)]),_:1},8,["loading"])}}}),_e=V(me,[["__scopeId","data-v-8970e94c"]]),ve={class:"end"},fe={class:"end"},ye={class:"end"},ge={class:"end"},be={class:"end"},he={class:"end"},Ce={class:"end"},ke={class:"end"},we={class:"end"},Te={class:"end"},Be={class:"end"},Se=U({__name:"TableMarkets",emits:["select"],setup(D,{emit:i}){const b=i,u=x(""),p=w(()=>T.value.filter(_=>{const l=u.value.toLocaleLowerCase().split(" "),d=h=>l.some(y=>h.toLocaleLowerCase().includes(y));return d(_.name)||d(_.address)}).orderBy(_=>_.borrowed,"desc")),{isFetching:k,data:T}=se(),m=_=>_>=1e6?2:0;return(_,l)=>{const d=ie,h=re,y=ne,r=le,s=ae,g=I;return L(),A(g,{class:"markets-card",title:"Markets",loading:a(k)},{actions:c(()=>[t(d,{modelValue:a(u),"onUpdate:modelValue":l[0]||(l[0]=e=>N(u)?u.value=e:null),search:"",placeholder:"Search for..."},null,8,["modelValue"])]),default:c(()=>[t(s,{class:"markets-table",rows:a(p),columns:["","","Name",{label:"Loans",align:"end"},{label:"Rate",align:"end"},{label:"Borrowed",align:"end"},{label:"Collateral",align:"end"},{label:"Fees Pending",align:"end"},{label:"Fees Collected",align:"end"}],onSelect:l[1]||(l[1]=e=>b("select",e))},{row:c(({item:e})=>[t(h),t(y,{chain:"ethereum",address:e.collateralToken.address},null,8,["address"]),o("div",null,$(e.name),1),o("div",ve,$(e.loans),1),o("div",fe,[t(r,{type:"percentage",value:e.rate*100,precision:2},null,8,["value"])]),o("div",ye,[t(r,{type:"dollar",value:e.borrowed,precision:m,"show-symbol":!1},null,8,["value"])]),o("div",ge,[t(r,{type:"dollar",value:e.collateralAmountUsd,precision:m},null,8,["value"])]),o("div",be,[t(r,{type:"dollar",value:e.fees.pending,precision:m},null,8,["value"])]),o("div",he,[t(r,{"show-zero":"",type:"dollar",value:e.fees.collected,precision:m},null,8,["value"])])]),"row-aggregation":c(()=>[l[2]||(l[2]=o("div",null,null,-1)),l[3]||(l[3]=o("div",null,null,-1)),l[4]||(l[4]=o("div",null,null,-1)),o("div",Ce,$(a(p).sumBy(e=>e.loans)),1),l[5]||(l[5]=o("div",null,null,-1)),o("div",ke,[t(r,{type:"dollar",value:a(p).sumBy(e=>e.borrowed),precision:m,"show-symbol":!1},null,8,["value"])]),o("div",we,[t(r,{type:"dollar",value:a(p).sumBy(e=>e.collateralAmountUsd),precision:m},null,8,["value"])]),o("div",Te,[t(r,{type:"dollar",value:a(p).sumBy(e=>e.fees.pending),precision:m},null,8,["value"])]),o("div",Be,[t(r,{"show-zero":"",type:"dollar",value:a(p).sumBy(e=>e.fees.collected),precision:m},null,8,["value"])])]),_:1},8,["rows"])]),_:1},8,["loading"])}}}),$e=V(Se,[["__scopeId","data-v-89b20b09"]]),Ue={class:"dashboard"},Le=U({__name:"CrvUsd.page",setup(D){const{crumbs:i}=W(E());i.value=[{id:"crvusd",label:"crvUSD",pathName:"crvusd"},{id:"market",label:"Select market for details",hint:!0}];const b=O(),u=async p=>{await b.push({name:"crvusdmarket",params:{tab:"",marketAddr:p.address}})};return(p,k)=>(L(),q("div",Ue,[t(a($e),{style:{"grid-area":"table"},onSelect:u}),t(a(_e),{style:{"grid-area":"chart"}})]))}}),Ke=V(Le,[["__scopeId","data-v-26d04f0d"]]);export{Ke as default};
