import{_ as ae,a as te}from"./TabItem.vue_vue_type_script_setup_true_lang-DUOKenZp.js";import{d as C,g as $,T as P,f as y,V as D,h as k,o as v,_ as V,u as e,w as m,a as _,r as w,b as t,O as se,e as S,c as R,t as q,W as B,S as H,j as z,i as x,Q as ne,X as oe,a5 as le,a6 as re,N as ie,R as ce,a2 as M}from"./index-r5JEJg_X.js";import{e as Q,f as de,u as ue}from"./crvusd-DDetJaMS.js";import{u as Y,a as me,b as _e,c as pe,d as he,e as ve,f as ge,T as fe,_ as ke,g as be,h as ye,i as $e,j as Ce,k as we,l as Te,m as Le,n as qe,o as Se,C as Fe,p as Ae,q as Be}from"./TableTrades-CdJyQ24K.js";import{u as N,c as j,a as W,y as Re,J as Ve,r as Oe}from"./UseLightweightChart-Dwib-Mn5.js";import"./ChartStylesApex-9G5-iR-E.js";import{_ as Ue}from"./KPI-CxHfdbAk.js";import{_ as Z}from"./AsyncValue-CS5Agycw.js";import"./UseLegend-Bg_RgAMe.js";import{_ as Ie}from"./ButtonToggle-d-x6hyEJ.js";/* empty css                                                                         */import{r as J,u as ee}from"./Number-D0MXVSkz.js";import{_ as Me}from"./InputNumber-Djq9KQF_.js";import{_ as K,a as Pe}from"./Table-D39H-EDg.js";import{L as X}from"./link-DthaubIV.js";import{_ as De}from"./TokenIcon-dpzIQbgm.js";import{_ as Qe}from"./Checkbox-CJUXX0ET.js";import{u as Ne,_ as We}from"./UsePagination-5BlxSGTw.js";import{u as Ee}from"./UseRelativeTime-BPqPbpLx.js";import{u as ze}from"./UseSort-X4e6dNNp.js";import{a as He}from"./index-BHLZBQmf.js";import{u as je}from"./UseTabNavigation-B3QhtHE5.js";import"./timestamp-X9wFVw8g.js";import"./timestamp-DkvXAN4c.js";import"./api-Bhu-jkhy.js";import"./useQuery-zX-TltwA.js";import"./Object-DOSYkgA0.js";/* empty css                                                                    */const Je={ref:"chartRef",class:"chart"},Ke=C({__name:"ChartMarketAvailableCap",props:{market:{}},setup(o){const{isFetching:a,data:d}=Q($(()=>o.market)),p=P(),{chart:n,series:i}=N({createChartOptions:W(),series:j({name:"available",color:y(()=>p.value.colors.blue),formatter:s=>`$${J(s,0,"dollar")}${ee(s)}`})});D(r);function r(){!n.value||!i.available||(i.available.setData(d.value.map(s=>({time:s.timestamp.getUTCTimestamp(),value:s.borrowable})).uniqWith((s,c)=>s.time===c.time).orderBy(s=>s.time,"asc").dropWhile(s=>s.value===0)),n.value.timeScale().fitContent())}return(s,c)=>{const g=V;return v(),k(g,{title:"Borrowable & Debt Ceiling",loading:e(a)},{default:m(()=>[_("div",Je,null,512)]),_:1},8,["loading"])}}}),Xe={ref:"chartRef",class:"chart"},xe=C({__name:"ChartMarketLoans",props:{market:{}},setup(o){const{isFetching:a,data:d}=Q($(()=>o.market)),p=P(),{chart:n,series:i}=N({createChartOptions:W(),series:{type:Re,name:"loans",options:y(()=>({color:p.value.colors.yellow,lastValueVisible:!1,priceFormat:{type:"volume"},priceLineVisible:!1}))}});D(r);function r(){!n.value||!i.loans||(i.loans.setData(d.value.map(s=>({time:s.timestamp.getUTCTimestamp(),value:s.nLoans})).uniqWith((s,c)=>s.time===c.time).orderBy(s=>s.time,"asc")),n.value.timeScale().fitContent())}return(s,c)=>{const g=V;return v(),k(g,{title:"Loans",loading:e(a)},{default:m(()=>[_("div",Xe,null,512)]),_:1},8,["loading"])}}}),Ge={ref:"chartRef",class:"chart"},Ye=C({__name:"ChartMarketRates",props:{market:{}},setup(o){const{isFetching:a,data:d}=Q($(()=>o.market)),p=P(),n=w(null),{chart:i,series:r}=N({createChartOptions:W(),series:[j({name:"rates",color:y(()=>p.value.colors.blue),formatter:c}),{type:Ve,name:"ema",options:y(()=>({priceFormat:{type:"custom",formatter:c},lineWidth:2,lineType:Oe.WithSteps,color:p.value.colors.yellow,lastValueVisible:!1,priceLineVisible:!1}))}]});D(s);function s(){if(!i.value||!r.rates||!r.ema)return;const f=d.value.map(l=>({time:l.timestamp.getUTCTimestamp(),value:l.rate})).uniqWith((l,T)=>l.time===T.time).orderBy(l=>l.time,"asc"),u=g(f.map(l=>l.value),n.value??31).zip(f).map(l=>({time:l[1].time,value:l[0]}));r.ema.setData(u),r.rates.setData(f),i.value.timeScale().fitContent()}function c(f){return`${J(f*100,0,"percentage")}%`}const g=(f,h=7)=>f.map((u,l)=>{const T=Math.max(l-(h-1),0),O=l+1,U=f.slice(T,O);return U.sumBy(L=>L)/U.length});return(f,h)=>{const u=Me,l=V;return v(),k(l,{title:"Rates",loading:e(a)},{actions:m(()=>[t(u,{modelValue:e(n),"onUpdate:modelValue":h[0]||(h[0]=T=>se(n)?n.value=T:null),class:"avg-span",placeholder:"Avg span (days)",min:1,max:1/0},null,8,["modelValue"])]),default:m(()=>[_("div",Ge,null,512)]),_:1},8,["loading"])}}}),Ze=S(Ye,[["__scopeId","data-v-4c10cf91"]]),ea={ref:"chartRef",class:"chart"},aa=C({__name:"ChartMarketVolume",props:{market:{},chain:{}},setup(o){const{isFetching:a,data:d}=Y("crvusd",y(()=>o.market?.llamma),$(()=>o.chain)),p=P(),{chart:n,series:i}=N({createChartOptions:W(),series:j({name:"volume",color:y(()=>p.value.colors.blue),formatter:s=>`$${J(s,0,"dollar")}${ee(s)}`})});D(r);function r(){if(!n.value||!i.volume)return;const s=(d.value??[]).map(c=>({time:c.time.getUTCTimestamp(),value:c.volume})).uniqWith((c,g)=>c.time===g.time).orderBy(c=>c.time,"asc");s.length>0&&i.volume.setData(s),n.value.timeScale().fitContent()}return(s,c)=>{const g=V;return v(),k(g,{title:"Volume",loading:e(a)},{default:m(()=>[_("div",ea,null,512)]),_:1},8,["loading"])}}}),ta={class:"dashboard-grid"},sa=C({__name:"Liquidations",props:{market:{},chain:{}},setup(o){const a=y(()=>o.market?.address),{isFetching:d,data:p}=me(w("crvusd"),$(()=>o.chain),a),{isFetching:n,data:i}=Q($(()=>o.market)),r=y(()=>i.value.map(({timestamp:F,priceOracle:A})=>({timestamp:F,priceOracle:A}))),s=y(()=>i.value.map(({timestamp:F,discountLiquidation:A})=>({timestamp:F,discount:A}))),c=y(()=>i.value.map(({timestamp:F,totalCollateralUsd:A,totalDebt:E})=>({timestamp:F,ratio:A/E}))),{isFetching:g,data:f}=_e(w("crvusd"),$(()=>o.chain),a),{isFetching:h,data:u}=pe(w("crvusd"),$(()=>o.chain),a),{isFetching:l,data:T}=he(w("crvusd"),$(()=>o.chain),a),{isFetching:O,data:U}=ve(w("crvusd"),$(()=>o.chain),a),{isFetching:I,data:L}=ge(w("crvusd"),$(()=>o.chain),a);return(F,A)=>(v(),R("div",ta,[t(e(fe),{overview:e(p),loading:e(d)},null,8,["overview","loading"]),t(e(ke),{ratios:e(f),"prices-oracle":e(r),loading:e(g)||e(n)},null,8,["ratios","prices-oracle","loading"]),t(e(be),{losses:e(L),loading:e(I)},null,8,["losses","loading"]),t(e(ye),{losses:e(L),loading:e(I)},null,8,["losses","loading"]),t(e($e),{deciles:e(U),loading:e(O)},null,8,["deciles","loading"]),t(e(Ce),{ratios:e(c),loading:e(n)},null,8,["ratios","loading"]),t(e(we),{liqs:e(u),loading:e(h)},null,8,["liqs","loading"]),t(e(Te),{liqs:e(T),loading:e(l)},null,8,["liqs","loading"]),t(e(Le),{discounts:e(s),liqs:e(T),loading:e(n)||e(l)},null,8,["discounts","liqs","loading"])]))}}),na=S(sa,[["__scopeId","data-v-6ad4864c"]]),oa=["href"],la={key:1},ra=C({__name:"Addresses",props:{market:{}},setup(o){const a=y(()=>[{description:"Controller",address:o.market?.address},{description:"Factory",address:o.market?.factoryAddress},{description:"Llamma",address:o.market?.llamma}]),d=n=>`https://etherscan.io/address/${n}`,p=async n=>{await navigator.clipboard.writeText(n)};return(n,i)=>{const r=X,s=H,c=K,g=V;return v(),k(g,{class:"addresses",title:"Addresses"},{default:m(()=>[t(c,{class:"addresses-table",rows:e(a)},{row:m(({item:{description:f,address:h}})=>[_("div",null,q(f),1),_("div",null,[h?(v(),R("a",{key:0,class:"font-mono",target:"_blank",href:d(h)},q(h),9,oa)):(v(),R("span",la,"?"))]),_("div",null,[h?(v(),k(s,{key:0,onClick:u=>p(h)},{default:m(()=>[t(r)]),_:2},1032,["onClick"])):B("",!0)])]),_:1},8,["rows"])]),_:1})}}}),ia=S(ra,[["__scopeId","data-v-2bb26947"]]),ca={class:"token-info"},da=["href"],ua={class:"token-info"},ma=["href"],_a=C({__name:"Properties",props:{market:{},chain:{}},setup(o){const a=y(()=>({type:"token",symbol:o.market?.collateralToken?.symbol??"?",address:o.market?.collateralToken?.address??"?"})),d=y(()=>({type:"token",symbol:o.market?.stablecoinToken?.symbol??"?",address:o.market?.stablecoinToken?.address??"?"})),p=i=>`https://etherscan.io/address/${i}`,n=async i=>{await navigator.clipboard.writeText(i)};return(i,r)=>{const s=De,c=X,g=H,f=Pe,h=K,u=V;return v(),k(u,{class:"properties",title:"Properties"},{default:m(()=>[t(h,{class:"properties-table"},{default:m(()=>[t(f,null,{default:m(()=>[r[2]||(r[2]=_("div",null,"Collateral",-1)),_("div",ca,[t(s,{chain:i.chain,address:e(a).address},null,8,["chain","address"]),_("div",null,q(e(a).symbol),1),_("div",null,[_("a",{class:"font-mono",target:"_blank",href:p(e(a).address)},q(e(a).address),9,da)]),_("div",null,[t(g,{onClick:r[0]||(r[0]=l=>n(e(a).address))},{default:m(()=>[t(c)]),_:1})])])]),_:1,__:[2]}),t(f,null,{default:m(()=>[r[3]||(r[3]=_("div",null,"Borrowed",-1)),_("div",ua,[t(s,{chain:i.chain,address:e(d).address},null,8,["chain","address"]),_("div",null,q(e(d).symbol),1),_("div",null,[_("a",{class:"font-mono",target:"_blank",href:p(e(d).address)},q(e(d).address),9,ma)]),_("div",null,[t(g,{onClick:r[1]||(r[1]=l=>n(e(d).address))},{default:m(()=>[t(c)]),_:1})])])]),_:1,__:[3]})]),_:1})]),_:1})}}}),pa=S(_a,[["__scopeId","data-v-61c51caa"]]),ha={class:"dashboard-grid"},va=C({__name:"MarketOverview",props:{market:{},chain:{}},setup(o){return(a,d)=>{const p=Z,n=Ue;return v(),R("div",ha,[t(n,{style:{"grid-area":"kpi1"},label:"Borrow Rate","has-value":!!a.market},{default:m(()=>[t(p,{type:"percentage",value:100*(a.market?.rate??0)},null,8,["value"])]),_:1},8,["has-value"]),t(n,{style:{"grid-area":"kpi2"},label:"Borrowed","has-value":!!a.market},{default:m(()=>[t(p,{type:"dollar",value:a.market?.borrowed},null,8,["value"])]),_:1},8,["has-value"]),t(n,{style:{"grid-area":"kpi3"},label:"Borrowable","has-value":!!a.market},{default:m(()=>[t(p,{type:"dollar",value:a.market?.borrowable},null,8,["value"])]),_:1},8,["has-value"]),t(n,{style:{"grid-area":"kpi4"},label:"Loans","has-value":!!a.market},{default:m(()=>[z(q(a.market?.loans??0),1)]),_:1},8,["has-value"]),t(e(Ze),{style:{"grid-area":"rates"},market:a.market},null,8,["market"]),t(e(Ke),{style:{"grid-area":"cap"},market:a.market},null,8,["market"]),t(e(xe),{style:{"grid-area":"loans"},market:a.market},null,8,["market"]),t(e(aa),{style:{"grid-area":"volume"},market:a.market,chain:a.chain},null,8,["market","chain"]),t(e(pa),{style:{"grid-area":"properties"},market:a.market,chain:a.chain},null,8,["market","chain"]),t(e(ia),{style:{"grid-area":"addresses"},market:a.market,chain:a.chain},null,8,["market","chain"])])}}}),ga=S(va,[["__scopeId","data-v-efc50c6b"]]),fa={class:"dashboard-grid"},ka=C({__name:"Trading",props:{market:{},chain:{}},setup(o){const a=y(()=>o.market?.llamma),{isFetching:d,data:p}=Y("crvusd",a,$(()=>o.chain)),n=w(1),{isFetching:i,data:r}=qe("crvusd",a,$(()=>o.chain),n),s=w(1),{isFetching:c,data:g}=Se("crvusd",a,$(()=>o.chain),s);return(f,h)=>(v(),R("div",fa,[t(e(Fe),{style:{"grid-area":"ohlc"},ohlc:e(p)??[],loading:e(d)},null,8,["ohlc","loading"]),t(e(Ae),{style:{"grid-area":"trades"},trades:e(r)?.trades??[],count:e(r)?.count??0,chain:f.chain,loading:e(i),onPage:h[0]||(h[0]=u=>n.value=u)},null,8,["trades","count","chain","loading"]),t(e(Be),{style:{"grid-area":"events"},events:e(g)?.events??[],count:e(g)?.count??0,loading:e(c),onPage:h[1]||(h[1]=u=>s.value=u)},null,8,["events","count","loading"])]))}}),ba=S(ka,[["__scopeId","data-v-13550918"]]),ya={style:{display:"flex",gap:"1rem"}},$a=["href"],Ca={class:"end"},wa={class:"end"},Ta={class:"end"},La={class:"end"},G=20,qa=C({__name:"TableUsers",props:{users:{}},setup(o){const a=w(!0),d=w(!1),{relativeTime:p}=Ee(),n=["",{id:"user",label:"User",sort:!1},{id:"debt",label:"Debt",sort:!0,align:"end"},{id:"stablecoin",label:"Stablecoin",sort:!0,align:"end"},{id:"loss",label:"Loss",sort:!0,align:"end"},{id:"health_full",label:"Health (Full)",sort:!0,align:"end"},{id:"softLiq",label:"Soft Liq",sort:!1,align:"center"},{id:"lastUpdate",label:"Last Update",sort:!0,align:"end"}],{sorting:i,onSort:r}=ze("debt"),s=y(()=>o.users.filter(u=>a.value?!0:u.healthFull>0).filter(u=>d.value?u.softLiquidation:!0).orderBy(u=>{switch(i.value.column){case"debt":return u.debt;case"stablecoin":return u.stablecoin;case"loss":return u.loss;case"health_full":return u.healthFull;case"lastUpdate":return u.last.getTime()}},i.value.order)),{page:c,rowsPage:g,onPage:f}=Ne(s,G),h=async u=>{await navigator.clipboard.writeText(u)};return(u,l)=>{const T=We,O=Ie,U=X,I=H,L=Z,F=Qe,A=K,E=V;return v(),k(E,{title:"Users"},{actions:m(()=>[t(T,{"items-count":e(s).length,"items-per-page":G,page:e(c),onPage:e(f)},null,8,["items-count","page","onPage"])]),"actions-secondary":m(()=>[_("div",ya,[t(O,{"model-value":e(a),onClick:l[0]||(l[0]=b=>a.value=!e(a))},{default:m(()=>l[4]||(l[4]=[z(" Hard Liq'able ",-1)])),_:1,__:[4]},8,["model-value"]),t(O,{"model-value":e(d),onClick:l[1]||(l[1]=b=>d.value=!e(d))},{default:m(()=>l[5]||(l[5]=[z(" Soft Liq Only ",-1)])),_:1,__:[5]},8,["model-value"])])]),default:m(()=>[t(A,{rows:e(g),columns:n,sorting:e(i),onSortColumn:e(r)},{row:m(({item:b})=>[_("div",null,[t(I,{onClick:Oa=>h(b.user)},{default:m(()=>[t(U)]),_:2},1032,["onClick"])]),_("div",null,[_("a",{target:"_blank",href:`https://etherscan.io/address/${b.user}`,onClick:l[2]||(l[2]=x(()=>{},["stop"]))},q(("addressShort"in u?u.addressShort:e(ne))(b.user)),9,$a)]),_("div",Ca,[t(L,{"show-zero":"",type:"dollar",value:b.debt,precision:2},null,8,["value"])]),_("div",wa,[b.stablecoin>0?(v(),k(L,{key:0,"show-zero":"",type:"dollar",value:b.stablecoin,precision:2},null,8,["value"])):B("",!0)]),_("div",Ta,[b.loss>0?(v(),k(L,{key:0,"show-zero":"",type:"dollar",value:b.loss,precision:2},null,8,["value"])):B("",!0)]),_("div",{class:oe(["end",{bad:b.healthFull<=5,danger:b.healthFull<=15&&b.healthFull>5,good:b.healthFull>15}])},[t(L,{"show-zero":"",type:"percentage",value:b.healthFull,precision:2},null,8,["value"])],2),_("div",{class:"center",onClick:l[3]||(l[3]=x(()=>{},["stop"]))},[t(F,{readonly:"","model-value":b.softLiquidation},null,8,["model-value"])]),_("div",La,q(e(p)(b.last.getUTCTimestamp())),1)]),_:1},8,["rows","sorting","onSortColumn"])]),_:1})}}}),Sa=S(qa,[["__scopeId","data-v-e215c3ff"]]),Fa={class:"dashboard-grid"},Aa=C({__name:"Users",props:{market:{},chain:{}},setup(o){const a=y(()=>o.market?.address),{isFetching:d,data:p}=de($(()=>o.chain),a);return(n,i)=>(v(),R("div",Fa,[t(Sa,{style:{"grid-area":"users"},users:e(p)??[],chain:n.chain,loading:e(d)},null,8,["users","chain","loading"])]))}}),Ba=S(Aa,[["__scopeId","data-v-3bceb58d"]]),Ra={class:"dashboard"},Va=C({__name:"Market.page",setup(o){const a=He("marketAddr"),{isFetching:d,data:p}=ue(),n=y(()=>p.value.find(c=>c.address===a.value)),{crumbs:i}=le(re());ie(n,c=>{i.value=[{id:"crvusd",label:"crvUSD",pathName:"crvusd"},{id:"market",label:`Market: ${c?.name??"?"}`}]},{immediate:!0});const{tabActive:r,tabActiveIndex:s}=je(["overview","trading","liquidations","users"],"crvusdmarket",()=>({marketAddr:a.value}));return(c,g)=>{const f=ce,h=ae,u=te;return v(),R("div",Ra,[t(f,{loading:e(d)},null,8,["loading"]),!e(d)&&e(n)?(v(),k(u,{key:0,active:e(s),onTab:g[0]||(g[0]=l=>s.value=l.index)},{default:m(()=>[t(h,{header:"Overview"},{default:m(()=>[(v(),k(M,null,[e(r)==="overview"?(v(),k(ga,{key:0,chain:"ethereum",market:e(n)},null,8,["market"])):B("",!0)],1024))]),_:1}),t(h,{header:"Trading"},{default:m(()=>[(v(),k(M,null,[e(r)==="trading"?(v(),k(ba,{key:0,chain:"ethereum",market:e(n)},null,8,["market"])):B("",!0)],1024))]),_:1}),t(h,{header:"Liquidations"},{default:m(()=>[(v(),k(M,null,[e(r)==="liquidations"?(v(),k(na,{key:0,chain:"ethereum",market:e(n)},null,8,["market"])):B("",!0)],1024))]),_:1}),t(h,{header:"Users"},{default:m(()=>[(v(),k(M,null,[e(r)==="users"?(v(),k(Ba,{key:0,chain:"ethereum",market:e(n)},null,8,["market"])):B("",!0)],1024))]),_:1})]),_:1},8,["active"])):B("",!0)])}}}),ct=S(Va,[["__scopeId","data-v-576cb77d"]]);export{ct as default};
