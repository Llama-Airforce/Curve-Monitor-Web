var V=e=>{throw TypeError(e)};var k=(e,t,s)=>t.has(e)||V("Cannot "+s);var n=(e,t,s)=>(k(e,t,"read from private field"),s?s.call(e):t.get(e)),d=(e,t,s)=>t.has(e)?V("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,s),c=(e,t,s,r)=>(k(e,t,"write to private field"),r?r.call(e,s):t.set(e,s),s),y=(e,t,s)=>(k(e,t,"access private method"),s);import{au as W,av as S,aw as G,ax as N,ay as X,z as b,u as Y,az as Z,aA as x,J as z,aB as ee,ai as I,ak as C,aj as M,ae as P,aC as te,an as se}from"./index-BYnNAfSP.js";function H(e,t){return e.filter(s=>!t.includes(s))}function re(e,t,s){const r=e.slice(0);return r[t]=s,r}var g,h,q,_,p,m,Q,w,$,l,E,F,K,T,U,A,ie=(A=class extends W{constructor(t,s,r){super();d(this,l);d(this,g);d(this,h);d(this,q);d(this,_);d(this,p);d(this,m);d(this,Q);d(this,w);d(this,$,[]);c(this,g,t),c(this,_,r),c(this,q,[]),c(this,p,[]),c(this,h,[]),this.setQueries(s)}onSubscribe(){this.listeners.size===1&&n(this,p).forEach(t=>{t.subscribe(s=>{y(this,l,T).call(this,t,s)})})}onUnsubscribe(){this.listeners.size||this.destroy()}destroy(){this.listeners=new Set,n(this,p).forEach(t=>{t.destroy()})}setQueries(t,s,r){c(this,q,t),c(this,_,s),S.batch(()=>{const a=n(this,p),i=y(this,l,K).call(this,n(this,q));c(this,$,i),i.forEach(o=>o.observer.setOptions(o.defaultedQueryOptions,r));const u=i.map(o=>o.observer),v=u.map(o=>o.getCurrentResult()),O=u.some((o,f)=>o!==a[f]);a.length===u.length&&!O||(c(this,p,u),c(this,h,v),this.hasListeners()&&(H(a,u).forEach(o=>{o.destroy()}),H(u,a).forEach(o=>{o.subscribe(f=>{y(this,l,T).call(this,o,f)})}),y(this,l,U).call(this)))})}getCurrentResult(){return n(this,h)}getQueries(){return n(this,p).map(t=>t.getCurrentQuery())}getObservers(){return n(this,p)}getOptimisticResult(t,s){const r=y(this,l,K).call(this,t),a=r.map(i=>i.observer.getOptimisticResult(i.defaultedQueryOptions));return[a,i=>y(this,l,F).call(this,i??a,s),()=>y(this,l,E).call(this,a,r)]}},g=new WeakMap,h=new WeakMap,q=new WeakMap,_=new WeakMap,p=new WeakMap,m=new WeakMap,Q=new WeakMap,w=new WeakMap,$=new WeakMap,l=new WeakSet,E=function(t,s){return s.map((r,a)=>{const i=t[a];return r.defaultedQueryOptions.notifyOnChangeProps?i:r.observer.trackResult(i,u=>{s.forEach(v=>{v.observer.trackProp(u)})})})},F=function(t,s){return s?((!n(this,m)||n(this,h)!==n(this,w)||s!==n(this,Q))&&(c(this,Q,s),c(this,w,n(this,h)),c(this,m,G(n(this,m),s(t)))),n(this,m)):t},K=function(t){const s=new Map(n(this,p).map(a=>[a.options.queryHash,a])),r=[];return t.forEach(a=>{const i=n(this,g).defaultQueryOptions(a),u=s.get(i.queryHash);u?r.push({defaultedQueryOptions:i,observer:u}):r.push({defaultedQueryOptions:i,observer:new N(n(this,g),i)})}),r},T=function(t,s){const r=n(this,p).indexOf(t);r!==-1&&(c(this,h,re(n(this,h),r,s)),y(this,l,U).call(this))},U=function(){var t;if(this.hasListeners()){const s=n(this,m),r=y(this,l,E).call(this,n(this,h),n(this,$)),a=y(this,l,F).call(this,r,(t=n(this,_))==null?void 0:t.combine);s!==a&&S.batch(()=>{this.listeners.forEach(i=>{i(n(this,h))})})}},A);function ae({queries:e,...t},s){const r=X(),a=b(()=>Y(e).map(f=>{const R=Z(f);typeof R.enabled=="function"&&(R.enabled=f.enabled());const D=r.defaultQueryOptions(R);return D._optimisticResults=r.isRestoring.value?"isRestoring":"optimistic",D})),i=new ie(r,a.value,t),u=()=>{const[o,f]=i.getOptimisticResult(a.value,t.combine);return f(o.map((R,D)=>({...R,refetch:async(...j)=>{const[{[D]:B}]=i.getOptimisticResult(a.value,t.combine);return B.refetch(...j)}})))},v=x(u());let O=()=>{};return z(r.isRestoring,o=>{o||(O(),O=i.subscribe(()=>{v.value=u()}),v.value=u())},{immediate:!0}),z(a,o=>{i.setQueries(o,t),v.value=u()}),ee(()=>{O()}),v}const ne=e=>({tvl:e.total_tvl,tradingVolume24h:e.trading_volume_24h,tradingFee24h:e.trading_fee_24h,liquidityVolume24h:e.liquidity_volume_24h,liquidityFee24h:e.liquidity_fee_24h}),J=e=>{var t,s;return{name:e.name,address:e.address,numCoins:e.n_coins,tvlUsd:e.tvl_usd,tradingVolume24h:e.trading_volume_24h,tradingFee24h:e.trading_fee_24h,liquidityVolume24h:e.liquidity_volume_24h,liquidityFee24h:e.liquidity_fee_24h,coins:((t=e.coins)==null?void 0:t.map(r=>({poolIndex:r.pool_index,symbol:r.symbol,address:r.address})))??[],baseDailyApr:e.base_daily_apr,baseWeeklyApr:e.base_weekly_apr,virtualPrice:e.virtual_price,poolMethods:((s=e.pool_methods)==null?void 0:s.map(r=>r))??[]}},ue=e=>({timestamp:I(e.timestamp),volume:e.volume,fees:e.fees}),oe=e=>({timestamp:I(e.timestamp),tvlUSD:e.tvl_usd??0,balances:[...e.balances],tokenPrices:[...e.token_prices]});async function le(e,t=1,s=9999,r){const a=M(r),i=await C(`${a}/v1/chains/${e}?page=${t}&per_page=${s}`);return{chain:i.chain,totals:ne(i.total),pools:i.data.map(J)}}async function L(e,t,s){const r=M(s),a=await C(`${r}/v1/pools/${e}/${t}`);return J(a)}async function ce(e,t,s){const r=M(s),a=120*60*1e3,i=Math.floor(new Date().getTime()/1e3),u=Math.floor(i-a);return(await C(`${r}/v1/volume/usd/${e}/${t}?interval=day&start=${u}&end=${i}`)).data.map(ue)}async function he(e,t,s){const r=M(s),a=120*60*1e3,i=Math.floor(new Date().getTime()/1e3),u=Math.floor(i-a);return(await C(`${r}/v1/snapshots/${e}/${t}/tvl?interval=day&start=${u}&end=${i}`)).data.map(oe)}function ye(e){return P({queryKey:["curve-pools",e],queryFn:async({queryKey:[,t]})=>{const s=await se();return le(t,1,9999,{host:s})},placeholderData:te,enabled:b(()=>!!e.value)})}function ve(e,t){return P({queryKey:["curve-pool",t],queryFn:async({queryKey:[,s]})=>L(e.value,s),enabled:b(()=>!!e.value)})}function fe(e,t){const s=b(()=>t.value.map(r=>({queryKey:["curve-pool",r],queryFn:()=>L(e.value,r),enabled:b(()=>!!e.value)})));return ae({queries:s})}function me(e,t){return P({queryKey:["curve-pool-volume",t],queryFn:async({queryKey:[,s]})=>ce(e.value,s),enabled:b(()=>!!e.value&&!!t.value),initialData:[],initialDataUpdatedAt:0})}function be(e,t){return P({queryKey:["curve-pool-tvl",t],queryFn:async({queryKey:[,s]})=>he(e.value,s),enabled:b(()=>!!e.value&&!!t.value),initialData:[],initialDataUpdatedAt:0})}export{me as a,be as b,ve as c,fe as d,ye as u};
