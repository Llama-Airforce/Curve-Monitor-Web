import{_ as L}from"./KPI-Dz8SGusd.js";import{_ as P}from"./AsyncValue-yw7UjBml.js";import{u as b}from"./useQuery-BavYuEWE.js";import{t as $,g as C,f as T,a as N}from"./timestamp-Dfir0V72.js";import{a8 as O,d as h,K as Q,e as w,o as y,w as _,b as i,u as t,f as u,T as H,i as v,h as S,g as k,_ as D,W as V,X as q,c as A,Y as B,a as z}from"./index-CT4FqvTD.js";import{_ as J}from"./Table-JN3v4T5r.js";import{a as M,_ as X}from"./UsePagination-Dz6Yy9GD.js";import{u as G}from"./UseRelativeTime-BbZlP_os.js";import{u as E,a as F,c as j}from"./UseLightweightChart-C0fLCxWV.js";import{_ as R,a as W}from"./BtnChartLWFullscreen.vue_vue_type_script_setup_true_lang-CNbJVnGv.js";import{r as K,u as Z}from"./Number-D6bZlHKQ.js";import"./Object-DOSYkgA0.js";const x=e=>({type:e.action_type,sender:e.sender,owner:e.owner,receiver:e.receiver?e.receiver:void 0,assets:BigInt(e.assets),supply:BigInt(e.shares),blockNumber:e.block_number,timestamp:$(e.timestamp),txHash:e.transaction_hash}),ee=e=>({timestamp:$(e.timestamp),assets:e.assets,supply:e.supply,apyProjected:Number(e.proj_apy)}),te=e=>({lastUpdated:$(e.last_updated),lastUpdatedBlock:e.last_updated_block,aprProjected:e.proj_apr,supply:e.supply});async function ae(e){const a=C(e),l=await T(`${a}/v1/crvusd/savings/statistics`);return te(l)}async function se(e,a){const l=C(a),p=await T(`${l}/v1/crvusd/savings/events?page=${e}&per_page=10`);return{count:p.count,events:p.events.map(x)}}async function ne(e=1,a="hour",l,p,c){const o=C(c),{start:n,end:g}=N({daysRange:10});return(await T(`${o}/v1/crvusd/savings/yield?agg_number=${e}&agg_units=${a}&start=${n}&end=${g}`)).data.map(ee)}function re(){return{initialData:[],initialDataUpdatedAt:0}}function oe(){return b({queryKey:["scrvusd-stats"],queryFn:()=>ae()})}function ie(e){return b({queryKey:["scrvusd-events",e],queryFn:({queryKey:[,a]})=>se(a),placeholderData:O})}function U(){return b({queryKey:["scrvusd-yield"],queryFn:()=>ne(),...re()})}const ce={class:"end"},le=["href"],pe={class:"end"},ue=["href"],de=h({__name:"TableEvents",setup(e){const{page:a,onPage:l}=M(),p=Q(a,200),{isFetching:c,data:o}=ie(p),{relativeTime:n}=G();return(g,s)=>{const r=X,d=P,Y=J,I=k;return y(),w(I,{title:"Events",loading:t(c)},{actions:_(()=>{var f;return[i(r,{"items-count":((f=t(o))==null?void 0:f.count)??0,"items-per-page":10,page:t(a),onPage:t(l)},null,8,["items-count","page","onPage"])]}),default:_(()=>{var f;return[i(Y,{loading:t(c),rows:((f=t(o))==null?void 0:f.events)??[],columns:["Type",{label:"Amount",align:"end"},"Owner",{label:"Time",align:"end"}]},{row:_(({item:m})=>[u("div",{class:H(["type",{green:m.type==="deposit",red:m.type==="withdraw"}])},v(m.type),3),u("div",ce,[i(d,{value:Number(m.assets)/10**18,precision:0},null,8,["value"])]),u("div",null,[u("a",{target:"_blank",href:`https://etherscan.io/address/${m.owner}`,onClick:s[0]||(s[0]=S(()=>{},["stop"]))},v(m.owner),9,le)]),u("div",pe,[u("a",{target:"_blank",href:`https://etherscan.io/tx/${m.txHash}`,onClick:s[1]||(s[1]=S(()=>{},["stop"]))},v(t(n)(m.timestamp.getUTCTimestamp())),9,ue)])]),_:1},8,["loading","rows"])]}),_:1},8,["loading"])}}}),_e=D(de,[["__scopeId","data-v-9b4d465d"]]),me={style:{display:"flex"}},ge={ref:"chartRef",class:"chart"},fe=h({__name:"ChartYield",setup(e){const{isFetching:a,data:l}=U(),p=V(),c=q("card"),{chart:o,series:n}=E({createChartOptions:j(),series:{type:"Area",name:"apy",options:A(()=>({priceFormat:{type:"custom",formatter:s=>`${K(s,0,"percentage")}%`},lineWidth:2,lineType:F.WithSteps,lineColor:p.value.colors.blue,topColor:"rgb(32, 129, 240, 0.2)",bottomColor:"rgba(32, 129, 240, 0)",lastValueVisible:!1,priceLineVisible:!1}))}});B(g);function g(){if(!o.value||!n.apy)return;const s=l.value.map(r=>({time:r.timestamp.getUTCTimestamp(),value:r.apyProjected})).uniqWith((r,d)=>r.time===d.time).orderBy(r=>r.time,"asc");s.length>0&&n.apy.setData(s),o.value.timeScale().fitContent()}return(s,r)=>{const d=k;return y(),w(d,{ref_key:"card",ref:c,title:"Yield",loading:t(a)},{actions:_(()=>[u("div",me,[i(t(R),{filename:"rates",series:t(n)},null,8,["series"]),i(t(W),{chart:t(o),target:t(c)},null,8,["chart","target"])])]),default:_(()=>[u("div",ge,null,512)]),_:1},8,["loading"])}}}),he={style:{display:"flex"}},ye={ref:"chartRef",class:"chart"},ve=h({__name:"ChartTVL",setup(e){const{isFetching:a,data:l}=U(),p=V(),c=q("card"),{chart:o,series:n}=E({createChartOptions:j(),series:{type:"Area",name:"tvl",options:A(()=>({priceFormat:{type:"custom",formatter:s=>`$${K(s,1,"dollar")}${Z(s)}`},lineWidth:2,lineType:F.WithSteps,lineColor:p.value.colors.blue,topColor:"rgb(32, 129, 240, 0.2)",bottomColor:"rgba(32, 129, 240, 0)",lastValueVisible:!1,priceLineVisible:!1}))}});B(g);function g(){if(!o.value||!n.tvl)return;const s=l.value.map(r=>({time:r.timestamp.getUTCTimestamp(),value:r.assets})).uniqWith((r,d)=>r.time===d.time).orderBy(r=>r.time,"asc");s.length>0&&n.tvl.setData(s),o.value.timeScale().fitContent()}return(s,r)=>{const d=k;return y(),w(d,{ref_key:"card",ref:c,title:"TVL",loading:t(a)},{actions:_(()=>[u("div",he,[i(t(R),{filename:"rates",series:t(n)},null,8,["series"]),i(t(W),{chart:t(o),target:t(c)},null,8,["chart","target"])])]),default:_(()=>[u("div",ye,null,512)]),_:1},8,["loading"])}}}),be={class:"dashboard"},$e=h({__name:"Savings.page",setup(e){const{data:a}=oe();return(l,p)=>{const c=P,o=L;return y(),z("div",be,[i(o,{style:{"grid-area":"kpi1"},label:"APR (Projected)","has-value":!!t(a)},{default:_(()=>{var n;return[i(c,{type:"percentage",value:(n=t(a))==null?void 0:n.aprProjected},null,8,["value"])]}),_:1},8,["has-value"]),i(o,{style:{"grid-area":"kpi2"},label:"Shares","has-value":!!t(a)},{default:_(()=>{var n;return[i(c,{value:(n=t(a))==null?void 0:n.supply},null,8,["value"])]}),_:1},8,["has-value"]),i(_e,{style:{"grid-area":"events"}}),i(fe,{style:{"grid-area":"yield"}}),i(ve,{style:{"grid-area":"tvl"}})])}}}),Fe=D($e,[["__scopeId","data-v-fb6a7473"]]);export{Fe as default};
