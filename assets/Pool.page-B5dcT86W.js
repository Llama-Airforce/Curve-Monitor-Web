import{_ as ne,a as re}from"./TabItem.vue_vue_type_script_setup_true_lang-WiI9wihv.js";import{d as B,h as V,o as $,a4 as X,w as f,a as k,t as G,e as M,T as I,f as S,r as K,g as q,U as Q,V as W,_ as R,u as a,b as h,c as x,a7 as H,Y as ie,W as P,j as N,F as ce,l as ue,a5 as de,a6 as me,N as pe,R as ve,a3 as Y}from"./index-D9HG0aMx.js";import{a as _e,b as he,c as fe}from"./pools-BYFVuqD3.js";import{u as Z,_ as ee}from"./UseLegend-CMN9LT78.js";import{u as E,G as te,r as ae,a as U,b as j,x as ge,c as oe,_ as le}from"./UseLightweightChart-Dg18GyEC.js";import{u as be}from"./queries-nCIfsu3j.js";import{r as O,u as F}from"./Number-Ddcsuny1.js";import{_ as ye}from"./AsyncValue-DFPjSn8i.js";import{a as Ce,_ as $e}from"./KPI-lh-O-EX8.js";import{_ as ke}from"./TokenIcon-FdPx6qGk.js";import{_ as se}from"./ButtonToggle-DP4HvLxw.js";import{g as Se}from"./api-BCRV542q.js";import{u as we}from"./useQuery-D63AZpyD.js";import{a as z}from"./index-M9l7MIn3.js";import{u as Ve}from"./UseTabNavigation-BHsy7CRJ.js";import"./timestamp-CoE2HNXc.js";import"./UseHost-B6-gTjqF.js";import"./Object-DOSYkgA0.js";import"./Helper-RwyFKozH.js";const Te={class:"option"},De={class:"label"},Be=B({__name:"SelectDuration",props:{duration:{default:()=>({value:1,unit:"month"})}},emits:["select"],setup(i,{emit:v}){const c=v,s=[{value:1,unit:"hour"},{value:1,unit:"day"},{value:1,unit:"week"},{value:1,unit:"month"},{value:1,unit:"year"}],_=b=>{c("select",b)};return(b,l)=>{const u=X;return $(),V(u,{options:s.map(d=>d),selected:b.duration,onSelect:_},{option:f(({option:d})=>[k("div",Te,[k("div",De,G(d.value)+" "+G(d.unit),1)])]),_:1},8,["options","selected"])}}}),J=M(Be,[["__scopeId","data-v-0bc945d9"]]),Ae={style:{display:"flex"}},Le={style:{display:"flex","flex-wrap":"wrap",gap:"2rem"}},Oe={class:"time"},Me={class:"time"},We={ref:"chartRef",class:"chart"},Fe=B({__name:"ChartMEV",props:{pool:{}},setup(i){function v(t,e){var C;const y=(C=t.replace("#","").match(/.{2}/g))==null?void 0:C.map(g=>parseInt(g,16));return y?`#${y.map(g=>Math.max(0,Math.floor(g*(1-e)))).map(g=>g.toString(16).padStart(2,"0")).join("")}`:t}const c=I(),s=S(()=>({volume:c.value.colors.red,bars:[c.value.colorsArray[1],v(c.value.colorsArray[1],.33),c.value.colorsArray[0],v(c.value.colorsArray[0],.33)]})),{items:_,toggles:b,disabled:l}=Z(()=>[{id:"atomic",label:"Atomic",color:s.value.bars[0],togglable:!0},{id:"cexdex",label:"Cexdex",color:s.value.bars[1],togglable:!0},{id:"within",label:"Within",color:s.value.bars[2],togglable:!0},{id:"outside",label:"Outside",color:s.value.bars[3],togglable:!0},{id:"total",label:"Volume (Total)",color:s.value.volume,togglable:!0}]),u=K({value:1,unit:"week"}),d=K({value:1,unit:"hour"}),{isFetching:n,data:m}=be(q(()=>i.pool),u,d),r=Q("card"),{chart:w,series:o}=E({createChartOptions:U(),series:[{type:"StackedBars",name:"data",options:S(()=>({priceFormat:{type:"custom",formatter:t=>`$${O(t,1,"dollar")}${F(t)}`},colors:_.value.map((t,e)=>({item:t,i:e})).filter(({item:t})=>!l.value.includes(t.id)).map(({i:t})=>t).map(t=>s.value.bars[t]),lastValueVisible:!1,priceLineVisible:!1}))},{type:te,name:"volume",options:S(()=>({priceFormat:{type:"custom",formatter:t=>`${O(t,1,"dollar")}${F(t)}`},lineWidth:2,lineType:ae.Curved,color:s.value.volume,lastValueVisible:!1,priceLineVisible:!1}))}]});W(A);function A(){if(!w.value||!o.volume||!o.data)return;const t=l.value.includes("total")?[]:m.value.map(e=>({time:e.interval_start_unixtime,value:e.full_volume})).uniqWith((e,y)=>e.time===y.time).orderBy(e=>e.time,"asc");t.length>1?(o.volume.setData(t),o.volume.applyOptions({visible:!0})):o.volume.applyOptions({visible:!1}),o.data.setData(m.value.map(e=>({time:e.interval_start_unixtime,values:[...l.value.includes("atomic")?[]:[e.atomicArbVolume],...l.value.includes("cexdex")?[]:[e.cexDexArbVolume],...l.value.includes("within")?[]:[e.sandwichVolume_LossWithin],...l.value.includes("outside")?[]:[e.sandwichVolume_LossOutside]]})).uniqWith((e,y)=>e.time===y.time).orderBy(e=>e.time,"asc")),w.value.timeScale().fitContent()}return(t,e)=>{const y=j,p=ee,C=R;return $(),V(C,{ref_key:"card",ref:r,title:"MEV",loading:a(n)},{actions:f(()=>[k("div",Ae,[h(y,{chart:a(w),target:a(r)},null,8,["chart","target"])])]),"actions-secondary":f(()=>[k("div",Le,[h(p,{items:a(_),disabled:a(l),onToggle:e[0]||(e[0]=g=>a(b)[g].value=!a(b)[g].value)},null,8,["items","disabled"]),k("div",Oe,[e[3]||(e[3]=k("span",null,"Duration:",-1)),h(J,{duration:a(u),onSelect:e[1]||(e[1]=g=>u.value=g)},null,8,["duration"])]),k("div",Me,[e[4]||(e[4]=k("span",null,"Interval:",-1)),h(J,{duration:a(d),onSelect:e[2]||(e[2]=g=>d.value=g)},null,8,["duration"])])])]),default:f(()=>[k("div",We,null,512)]),_:1},8,["loading"])}}}),Pe=M(Fe,[["__scopeId","data-v-7cf8ebb6"]]),Ie={class:"dashboard-grid"},Re=B({__name:"MEV",props:{pool:{}},setup(i){const v=S(()=>i.pool.address);return(c,s)=>($(),x("div",Ie,[h(Pe,{style:{"grid-area":"chart"},pool:a(v)},null,8,["pool"])]))}}),Ee=M(Re,[["__scopeId","data-v-a5261ecc"]]),Ue={class:"actions"},qe={ref:"chartRef",class:"chart"},Ne="chart_pool_balances_dollars",xe="chart_pool_balances_type",Qe=B({__name:"ChartBalances",props:{balances:{},title:{},showDollars:{type:Boolean,default:!0}},setup(i){const v=I(),{items:c,toggles:s,disabled:_}=Z(()=>i.balances.map(({symbol:t},e)=>({id:t,label:t,color:v.value.colorsArray[e],togglable:!0}))),b=Q("card"),l=H(Ne,!1),u=["unstacked","stacked","100%"],d=[{id:"unstacked",label:"Unstacked"},{id:"stacked",label:"Stacked"},{id:"100%",label:"Stacked (100%)"}],n=H(xe,u[0]),{chart:m,series:r}=E({createChartOptions:U(),series:[...i.balances.map(({symbol:t},e)=>({type:te,name:t,options:S(()=>({lineWidth:2,lineType:ae.WithSteps,color:v.value.colorsArray[e],lastValueVisible:!1,priceLineVisible:!1}))})),{type:"StackedArea",name:"stacked",options:S(()=>({colors:c.value.map((t,e)=>({item:t,i:e})).filter(({item:t})=>!_.value.includes(t.id)).map(({i:t})=>t).map(t=>v.value.colorsArray[t]).map(t=>({line:t,area:t+"15"})),lineWidth:2,lastValueVisible:!1,priceLineVisible:!1}))}]});W(()=>{m.value&&m.value.applyOptions({localization:{priceFormatter:n.value==="100%"?t=>`${O(t,0,"percentage")}%`:t=>`${O(t,1,"dollar")}${F(t)}`}})}),W(w);function w(){if(!(!m.value||Object.values(r).length<0)){for(const t of Object.values(r))t==null||t.setData([]);n.value==="unstacked"?o():A(n.value==="100%"),m.value.timeScale().fitContent()}}function o(){var t,e;for(const{symbol:y,balances:p}of i.balances.values()){if(!s[y].value){(t=r[y])==null||t.setData([]);continue}const C=i.showDollars&&l.value,g=p.map(T=>({time:T.timestamp.getUTCTimestamp(),value:C?T.balance*T.tokenPrice:T.balance})).uniqWith((T,L)=>T.time===L.time).orderBy(T=>T.time,"asc");g.length>0&&((e=r[y])==null||e.setData(g))}}function A(t){if(!r.stacked)return;const e=i.showDollars&&l.value,y=[...i.balances.values()].filter(({symbol:p,balances:C})=>s[p].value&&C.length>0).flatMap(({symbol:p,balances:C})=>C.map(g=>({symbol:p,timestamp:g.timestamp,balance:e?g.balance*g.tokenPrice:g.balance}))).groupBy(p=>p.timestamp.getTime()).entries().map(([p,C])=>{const g=t&&C.sumBy(L=>L.balance)||1,T=C.map(L=>t?L.balance/g*100:L.balance);return{time:Number(p)/1e3,values:T}}).uniqWith((p,C)=>p.time===C.time).orderBy(p=>p.time,"asc");y.length>0&&r.stacked.setData(y)}return(t,e)=>{const y=X,p=se,C=Ce,g=j,T=ee,L=R;return $(),V(L,{ref_key:"card",ref:b,class:"stack-actions",title:t.title??"Balances"},{actions:f(()=>[k("div",Ue,[ie(t.$slots,"actions",{},void 0,!0),h(y,{options:d,selected:d.find(D=>D.id===a(n))??d[0],onSelect:e[0]||(e[0]=D=>n.value=D.id)},{option:f(({option:D})=>[N(G(D.label),1)]),_:1},8,["selected"]),t.showDollars?($(),V(C,{key:0},{trigger:f(()=>[h(p,{"model-value":a(l),onClick:e[1]||(e[1]=D=>l.value=!a(l))},{default:f(()=>e[3]||(e[3]=[N(" $ ")])),_:1,__:[3]},8,["model-value"])]),default:f(()=>[e[4]||(e[4]=N(" Show token balances in USD. "))]),_:1,__:[4]})):P("",!0),h(g,{chart:a(m),target:a(b)},null,8,["chart","target"])])]),"actions-secondary":f(()=>[h(T,{items:a(c),disabled:a(_),onToggle:e[2]||(e[2]=D=>a(s)[D].value=!a(s)[D].value)},null,8,["items","disabled"])]),default:f(()=>[k("div",qe,null,512)]),_:3},8,["title"])}}}),je=M(Qe,[["__scopeId","data-v-d45d4cc9"]]),Ge={class:"controls"},Ke={ref:"chartRef",class:"chart"},He=B({__name:"ChartPrice",props:{ohlc:{},minMove:{default:()=>{}}},setup(i){const v=I(),c=K(!1);let s=1,_=0;const{chart:b,series:l}=E({createChartOptions:U(),series:{type:ge,name:"ohlc",options:S(()=>{const{colors:n}=v.value;return{priceFormat:{type:"custom",formatter:d,minMove:i.minMove},upColor:n.green,borderUpColor:n.green,wickUpColor:n.green,downColor:n.red,borderDownColor:n.red,wickDownColor:n.red}})}});W(u);function u(){if(!b.value||!l.ohlc)return;const n=c.value?-1:1,m=i.ohlc.map(r=>({time:r.time.getUTCTimestamp(),open:Math.pow(r.open,n),high:Math.pow(r.high,n),low:Math.pow(r.low,n),close:Math.pow(r.close,n)})).uniqWith((r,w)=>r.time===w.time).orderBy(r=>r.time,"asc");l.ohlc.setData(m),_=Math.min(...m.map(r=>r.low)),s=Math.max(...m.map(r=>r.high)),b.value.timeScale().fitContent()}function d(n){const m=s-_,r=m>1?m-Math.floor(m):m,w=-Math.floor(Math.log10(r)+1)+2;return`${O(n,w,"dollar")}${F(n)}`}return(n,m)=>{const r=se,w=R;return $(),V(w,{title:"Price"},{actions:f(()=>[k("div",Ge,[h(r,{"model-value":a(c),onClick:m[0]||(m[0]=o=>c.value=!a(c))},{default:f(()=>m[1]||(m[1]=[N(" Invert ")])),_:1,__:[1]},8,["model-value"])])]),default:f(()=>[k("div",Ke,null,512)]),_:1})}}}),Ye=M(He,[["__scopeId","data-v-2ec926d9"]]),ze={style:{display:"flex"}},Je={ref:"chartRef",class:"chart"},Xe=B({__name:"ChartTvl",props:{tvl:{}},setup(i){const v=I(),c=Q("card"),{chart:s,series:_}=E({createChartOptions:U(),series:oe({name:"tvl",color:S(()=>v.value.colors.blue),formatter:l=>`$${O(l,1,"dollar")}${F(l)}`})});W(b);function b(){if(!s.value||!_.tvl)return;const l=i.tvl.map(u=>({time:u.timestamp.getUTCTimestamp(),value:u.tvl})).uniqWith((u,d)=>u.time===d.time).orderBy(u=>u.time,"asc");l.length>0&&_.tvl.setData(l),s.value.timeScale().fitContent()}return(l,u)=>{const d=le,n=j,m=R;return $(),V(m,{ref_key:"card",ref:c,title:"TVL"},{actions:f(()=>[k("div",ze,[h(d,{filename:"tvl",series:a(_)},null,8,["series"]),h(n,{chart:a(s),target:a(c)},null,8,["chart","target"])])]),default:f(()=>[k("div",Je,null,512)]),_:1},512)}}}),Ze={style:{display:"flex"}},et={ref:"chartRef",class:"chart"},tt=B({__name:"ChartVolume",props:{volume:{}},setup(i){const v=I(),c=Q("card"),{chart:s,series:_}=E({createChartOptions:U(),series:oe({name:"volume",color:S(()=>v.value.colors.blue),formatter:l=>`$${O(l,1,"dollar")}${F(l)}`})});W(b);function b(){if(!s.value||!_.volume)return;const l=i.volume.map(u=>({time:u.timestamp.getUTCTimestamp(),value:u.volume})).uniqWith((u,d)=>u.time===d.time).orderBy(u=>u.time,"asc");l.length>0&&_.volume.setData(l),s.value.timeScale().fitContent()}return(l,u)=>{const d=le,n=j,m=R;return $(),V(m,{ref_key:"card",ref:c,title:"Volume"},{actions:f(()=>[k("div",Ze,[h(d,{filename:"volume",series:a(_)},null,8,["series"]),h(n,{chart:a(s),target:a(c)},null,8,["chart","target"])])]),default:f(()=>[k("div",et,null,512)]),_:1},512)}}});function at(i,v,c,s){return we({queryKey:["curve-token-price",v,c,s],queryFn:({queryKey:[,_,b,l]})=>Se(i.value,_,b,l),enabled:S(()=>!!i.value&&!!v.value&&!!c.value&&!!s.value),initialData:[],initialDataUpdatedAt:0})}const ot={class:"dashboard-grid"},lt={class:"tokens"},st=B({__name:"PoolOverview",props:{pool:{},chain:{}},setup(i){const v=S(()=>{var o;return(o=i.pool)==null?void 0:o.address}),c=S(()=>{var o;return(o=i.pool)==null?void 0:o.coins[0].address}),s=S(()=>{var o;return(o=i.pool)==null?void 0:o.coins[1].address}),{isFetching:_,data:b}=at(q(()=>i.chain),v,c,s),{isFetching:l,data:u}=_e(q(()=>i.chain),v),{isFetching:d,data:n}=he(q(()=>i.chain),v),m=S(()=>u.value.map(o=>({timestamp:o.timestamp,volume:o.volume}))),r=S(()=>n.value.map(o=>({timestamp:o.timestamp,tvl:o.tvlUSD}))),w=S(()=>i.pool?i.pool.coins.map(o=>({symbol:o.symbol,balances:n.value.map(A=>({timestamp:A.timestamp,balance:A.balances[o.poolIndex],tokenPrice:A.tokenPrices[o.poolIndex]}))})):[]);return(o,A)=>{const t=ke,e=$e,y=ye;return $(),x("div",ot,[h(e,{style:{"grid-area":"kpi1"},label:"Tokens","has-value":!!o.pool},{default:f(()=>{var p;return[k("div",lt,[($(!0),x(ce,null,ue(((p=o.pool)==null?void 0:p.coins)??[],C=>($(),V(t,{key:C.address,clickable:"",chain:o.chain,address:C.address},null,8,["chain","address"]))),128))])]}),_:1},8,["has-value"]),h(e,{style:{"grid-area":"kpi2"},label:"TVL","has-value":!!o.pool},{default:f(()=>{var p;return[h(y,{type:"dollar",value:((p=o.pool)==null?void 0:p.tvlUsd)??0},null,8,["value"])]}),_:1},8,["has-value"]),h(e,{style:{"grid-area":"kpi3"},label:"Volume (24h)","has-value":!!o.pool},{default:f(()=>{var p;return[h(y,{type:"dollar",value:((p=o.pool)==null?void 0:p.tradingVolume24h)??0},null,8,["value"])]}),_:1},8,["has-value"]),h(e,{style:{"grid-area":"kpi4"},label:"Fees (24h)","has-value":!!o.pool},{default:f(()=>{var p;return[h(y,{type:"dollar",value:((p=o.pool)==null?void 0:p.tradingFee24h)??0},null,8,["value"])]}),_:1},8,["has-value"]),h(Ye,{style:{"grid-area":"price"},ohlc:a(b),loading:a(_)},null,8,["ohlc","loading"]),h(tt,{style:{"grid-area":"volume"},volume:a(m),loading:a(l)},null,8,["volume","loading"]),h(Xe,{style:{"grid-area":"tvl"},tvl:a(r),loading:a(d)},null,8,["tvl","loading"]),h(je,{style:{"grid-area":"balances"},balances:a(w),loading:a(d)},null,8,["balances","loading"])])}}}),nt=M(st,[["__scopeId","data-v-334879c5"]]),rt={class:"dashboard"},it=B({__name:"Pool.page",setup(i){const v=z("chain"),c=z("poolAddr"),{isFetching:s,data:_}=fe(v,c.value),{crumbs:b}=de(me());pe(_,d=>{b.value=[{id:"pools",label:"Pools",pathName:"pools",params:()=>({chain:v.value})},{id:"pool",label:`Pool: ${(d==null?void 0:d.name)??"?"}`}]},{immediate:!0});const{tabActive:l,tabActiveIndex:u}=Ve(["overview","mev"],"poolspool",()=>({chain:v.value,poolAddr:c.value}));return(d,n)=>{const m=ve,r=ne,w=re;return $(),x("div",rt,[h(m,{loading:a(s)},null,8,["loading"]),!a(s)&&a(_)?($(),V(w,{key:0,active:a(u),onTab:n[0]||(n[0]=o=>u.value=o.index)},{default:f(()=>[h(r,{header:"Overview"},{default:f(()=>[($(),V(Y,null,[a(l)==="overview"?($(),V(nt,{key:0,pool:a(_),chain:a(v)},null,8,["pool","chain"])):P("",!0)],1024))]),_:1}),a(v)==="ethereum"&&a(_)?($(),V(r,{key:0,header:"MEV"},{default:f(()=>[($(),V(Y,null,[a(l)==="mev"?($(),V(Ee,{key:0,pool:a(_)},null,8,["pool"])):P("",!0)],1024))]),_:1})):P("",!0)]),_:1},8,["active"])):P("",!0)])}}}),Dt=M(it,[["__scopeId","data-v-e7d124fd"]]);export{Dt as default};
