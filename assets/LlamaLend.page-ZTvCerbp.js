import{d as U,I as N,z as B,h as k,o as v,w as m,u as n,b as d,a as i,V as M,t as R,c as P,T as C,F,_ as z,g as D,ac as E,ad as O,a1 as Q,L as x,aa as K}from"./index-BYnNAfSP.js";import{_ as j}from"./SelectChain-JCHea49Q.js";import{_ as q}from"./InputText-B41kNJQc.js";import{c as G,d as H}from"./llamalend-CGVbv_rh.js";import{_ as J}from"./NoData-CzV1FGdv.js";import{_ as W}from"./Table-CkrHHA0S.js";import{_ as X}from"./TokenIcon-CTWhTb_X.js";import{_ as Y}from"./IconExpander-Cg0RjqCc.js";import{a as Z,_ as ee}from"./TabItem.vue_vue_type_script_setup_true_lang-aHLn9g5N.js";import{t as S}from"./util-M70Hx2OY.js";import{u as ae}from"./UseSort-BgHBlkv6.js";import{a as oe}from"./index-CQR0y8Z1.js";import"./Chain-DEbNFSfB.js";const te={class:"end"},ne={class:"end"},se={class:"end"},le={class:"end"},re={class:"end"},ie={class:"end"},ue=U({__name:"TableMarkets",props:{pairs:{default:()=>[]},loading:{type:Boolean},chain:{}},emits:["select"],setup(A,{emit:L}){const _=L,h=["","","Name",{id:"borrow",label:"Borrow Rate",align:"end",sort:!0},{id:"lend",label:"Lend Rate",align:"end",sort:!0},{id:"tvl",label:"TVL",align:"end",sort:!0},{id:"loans",label:"Loans",align:"end",sort:!0}],{sorting:f,onSort:T}=ae("tvl"),c=N("long");function $(t){t===0?c.value="long":t===1?c.value="short":c.value="long"}const y=B(()=>A.pairs.map(({long:t,short:s})=>c.value==="long"?t:s).filter(t=>!!t).orderBy(t=>{switch(f.value.column){case"borrow":return t.apyBorrow;case"lend":return t.apyLend;case"tvl":return S(t);case"loans":return t.nLoans}},f.value.order));function V(t){return t.name.replace(/(-long|-short)/i,"")}const I=t=>c.value==="long"?t.tokenCollateral.address:t.tokenBorrowed.address;return(t,s)=>{const w=ee,l=Z,a=Y,r=X,u=M,o=W,p=J,g=z;return v(),k(g,{title:"Markets",loading:t.loading},{actions:m(()=>[i(l,{class:"types",onTab:s[0]||(s[0]=e=>$(e.index))},{default:m(()=>[i(w,{header:"Long"}),i(w,{header:"Short"})]),_:1})]),default:m(()=>[n(y).length>0?(v(),k(o,{key:0,class:"markets-table",rows:n(y),columns:h,sorting:n(f),onSortColumn:n(T),onSelect:s[1]||(s[1]=e=>_("select",e))},{row:m(({item:e})=>[e?(v(),P(F,{key:0},[i(a),i(r,{chain:t.chain,address:I(e)},null,8,["chain","address"]),d("div",null,R(V(e)),1),d("div",te,[e.apyBorrow?(v(),k(u,{key:0,type:"percentage",value:e.apyBorrow},null,8,["value"])):C("",!0)]),d("div",ne,[e.apyLend?(v(),k(u,{key:0,type:"percentage",value:e.apyLend},null,8,["value"])):C("",!0)]),d("div",se,[n(S)(e)?(v(),k(u,{key:0,type:"dollar",value:n(S)(e)},null,8,["value"])):C("",!0)]),d("div",le,R(e.nLoans),1)],64)):C("",!0)]),"row-aggregation":m(()=>[s[2]||(s[2]=d("div",null,null,-1)),s[3]||(s[3]=d("div",null,null,-1)),s[4]||(s[4]=d("div",null,null,-1)),s[5]||(s[5]=d("div",null,null,-1)),s[6]||(s[6]=d("div",null,null,-1)),d("div",re,[i(u,{type:"dollar",value:n(y).filter(e=>e).map(e=>e).reduce((e,b)=>e+n(S)(b),0)},null,8,["value"])]),d("div",ie,R(n(y).filter(e=>e).map(e=>e).reduce((e,b)=>e+b.nLoans,0)),1)]),_:1},8,["rows","sorting","onSortColumn"])):(v(),k(p,{key:1,message:`There are no ${n(c)} markets for ${t.chain}`},null,8,["message"]))]),_:1},8,["loading"])}}}),de=D(ue,[["__scopeId","data-v-5903de9f"]]),ce={class:"dashboard"},pe={class:"toolbar"},me=U({__name:"LlamaLend.page",setup(A){const L=oe("chain"),_=B({get(){return L.value?L.value:"ethereum"},set(l){L.value=l}}),h=N(""),f=B(()=>T.value.filter(({long:l,short:a})=>{const r=h.value.toLocaleLowerCase().split(" ");return(o=>r.some(p=>o.toLocaleLowerCase().includes(p)))(`${(l==null?void 0:l.name)??""}${(a==null?void 0:a.name)??""}`)})),T=B(()=>{const l=["crvusd"],a=($.value??[]).map(o=>({market:o,isLong:l.includes(o.tokenBorrowed.symbol.toLocaleLowerCase()),isShort:l.includes(o.tokenCollateral.symbol.toLocaleLowerCase())})).filter(({isLong:o,isShort:p})=>o||p),r=[],u=new Set;for(const{market:o,isLong:p,isShort:g}of a){if(u.has(o.controller))continue;u.add(o.controller);const e=a.find(b=>b.market.tokenBorrowed.address===o.tokenCollateral.address&&b.market.tokenCollateral.address===o.tokenBorrowed.address);e&&u.add(e.market.controller),r.push({long:p?o:e==null?void 0:e.market,short:g?o:e==null?void 0:e.market})}return r}),{isFetching:c,data:$}=G(_),{data:y}=H(),{crumbs:V}=E(O());V.value=[{id:"llamalend",label:"Llama Lend",pathName:"llamalend",params:()=>({chain:_.value})},{id:"market",label:"Select market for details",hint:!0}];const I=Q(),t=async l=>{l&&await I.push({name:"llamalendmarket",params:{tab:"",chain:_.value,marketAddr:l.controller}})},s=l=>f.value.map(a=>l==="long"?a.long:a.short).filter(a=>!!a).reduce((a,r)=>a+r.totalDebtUsd,0),w=l=>{const a=f.value.map(r=>l==="long"?r.long:r.short).filter(r=>!!r).reduce(({debt:r,assets:u},o)=>({debt:r+o.totalDebtUsd,assets:u+o.totalAssetsUsd}),{debt:0,assets:0});return a.assets===0?0:a.debt/a.assets*100};return(l,a)=>{const r=q,u=j,o=M,p=K;return v(),P("div",ce,[d("div",pe,[i(r,{modelValue:n(h),"onUpdate:modelValue":a[0]||(a[0]=g=>x(h)?h.value=g:null),search:"",placeholder:"Search for..."},null,8,["modelValue"]),i(u,{class:"chain-select",chain:n(_),chains:n(y),onSelectChain:a[1]||(a[1]=g=>_.value=g==="all"?"ethereum":g)},null,8,["chain","chains"])]),i(p,{style:{"grid-area":"kpi1"},label:"Open Interest (long)","has-value":!n(c)},{default:m(()=>[i(o,{type:"dollar",value:s("long")},null,8,["value"])]),_:1},8,["has-value"]),i(p,{style:{"grid-area":"kpi2"},label:"Open Interest (short)","has-value":!n(c)},{default:m(()=>[i(o,{type:"dollar",value:s("short")},null,8,["value"])]),_:1},8,["has-value"]),i(p,{style:{"grid-area":"kpi3"},"tooltip-type":"icon",label:"Average Utilization Rate (long)",tooltip:"Aggregate debt divided by aggregate assets","has-value":!n(c)},{default:m(()=>[i(o,{type:"percentage",value:w("long")},null,8,["value"])]),_:1},8,["has-value"]),i(p,{style:{"grid-area":"kpi4"},"tooltip-type":"icon",label:"Average Utilization Rate (short)",tooltip:"Aggregate debt divided by aggregate assets","has-value":!n(c)},{default:m(()=>[i(o,{type:"percentage",value:w("short")},null,8,["value"])]),_:1},8,["has-value"]),i(n(de),{style:{"grid-area":"markets"},pairs:n(f),loading:n(c),chain:n(_),onSelect:t},null,8,["pairs","loading","chain"])])}}}),Te=D(me,[["__scopeId","data-v-38d3869c"]]);export{Te as default};
