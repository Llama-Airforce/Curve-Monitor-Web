import{d as k,T as V,r as U,h,o as _,w as y,a2 as $,W as T,u as s,a as l,b as n,j as x,_ as D,e as S,f as C,V as N,c as A,t as B,O,a4 as R,a5 as E,$ as z}from"./index-5B2tI7Zc.js";import{u as K,_ as Q}from"./UseLegend-ifWC3xyM.js";import{_ as j}from"./ButtonToggle-CmOxPJil.js";import{d as q,u as P}from"./crvusd-Brn7BR38.js";import{c as X,_ as Y}from"./ChartStylesApex-DiqR34V4.js";import{r as I,u as W}from"./Number-Bqyeu7gj.js";import{u as G,a as L,c as H}from"./UseLightweightChart-C1SS2I-H.js";import{_ as J}from"./Table-Br42HHVv.js";import{_ as Z}from"./AsyncValue-BrxM0dB4.js";import{_ as ee}from"./TokenIcon-SHuc7s7h.js";import{_ as te}from"./IconExpander-xZLtL_3V.js";import{_ as ae}from"./InputText-PEq0sSRg.js";import"./timestamp-Dfir0V72.js";import"./api-DFkSxUea.js";import"./useQuery-Ds_Sub25.js";import"./Object-DOSYkgA0.js";const se={class:"chart-types button-group"},oe=k({__name:"ChartCrvUsdSupply",setup(b){const p=V(),r=U("line"),{items:i}=K(()=>[{id:"supply",label:"Supply",color:p.value.colorsArray[0]},{id:"borrowed",label:"Borrowed",color:p.value.colorsArray[1]}]),{isFetching:d,data:m}=q(),c=e=>{r.value!==e&&(r.value=e)};return(e,t)=>{const a=j,u=Q,v=D;return _(),h(v,{title:"crvUSD Supply",loading:s(d)},{actions:y(()=>[l("div",se,[n(a,{"model-value":s(r)==="line",onClick:t[0]||(t[0]=w=>c("line"))},{default:y(()=>t[2]||(t[2]=[x(" Line ")])),_:1},8,["model-value"]),n(a,{"model-value":s(r)==="breakdown",onClick:t[1]||(t[1]=w=>c("breakdown"))},{default:y(()=>t[3]||(t[3]=[x(" Breakdown ")])),_:1},8,["model-value"])])]),"actions-secondary":y(()=>[s(r)==="line"?(_(),h(u,{key:0,items:s(i)},null,8,["items"])):T("",!0)]),default:y(()=>[(_(),h($,null,[s(r)==="line"?(_(),h(s(de),{key:0,data:s(m)},null,8,["data"])):T("",!0)],1024)),(_(),h($,null,[s(r)==="breakdown"?(_(),h(s(re),{key:0,data:s(m)},null,8,["data"])):T("",!0)],1024))]),_:1},8,["loading"])}}}),le=S(oe,[["__scopeId","data-v-8595a23d"]]),ne=k({__name:"ChartCrvUsdSupplyBreakdown",props:{data:{}},setup(b){const p=C(()=>X({chart:{type:"bar",stacked:!0,animations:{enabled:!1}},xaxis:{categories:r.value,labels:{formatter:m,rotate:0},axisBorder:{show:!1},axisTicks:{show:!1}},yaxis:{labels:{formatter:c},min:0,max:d.value},plotOptions:{bar:{columnWidth:"75%",dataLabels:{position:"top",hideOverflowingLabels:!1}}},legend:{show:!1},dataLabels:{enabled:!1},tooltip:{followCursor:!1,enabled:!0}})),r=C(()=>b.data.orderBy(e=>e.timestamp.getTime(),"asc").groupBy(e=>e.timestamp.getTime()).entries().map(([e])=>new Date(parseInt(e,10)).toLocaleDateString(void 0,{day:"2-digit",month:"2-digit"})).map((e,t)=>t%8===0?e:"")),i=C(()=>b.data.groupBy(e=>e.market).entries().map(([e,t])=>({name:e,data:t.groupBy(a=>a.timestamp.getTime()).entries().map(([a,u])=>({x:new Date(parseInt(a,10)).toLocaleDateString(),y:u.reduce((v,w)=>v+w.supply,0)})).orderBy(a=>a.x,"asc")}))),d=C(()=>Math.max(...b.data.groupBy(e=>e.timestamp.getTime()).entries().map(([,e])=>e.reduce((t,a)=>t+a.supply,0)))*1.1),m=e=>e,c=e=>`${I(e,1,"dollar")}${W(e)}`;return(e,t)=>{const a=Y;return _(),h(a,{options:s(p),series:s(i)},null,8,["options","series"])}}}),re=S(ne,[["__scopeId","data-v-560b96b9"]]),ie={ref:"chartRef",class:"chart"},de=k({__name:"ChartCrvUsdSupplyLine",props:{data:{}},setup(b){const p=V(),{chart:r,series:i}=G({createChartOptions:H(),series:[{type:"Area",name:"supply",options:C(()=>({priceFormat:{type:"custom",formatter:m},lineWidth:2,lineType:L.WithSteps,lineColor:p.value.colors.blue,topColor:"rgb(32, 129, 240, 0.2)",bottomColor:"rgba(32, 129, 240, 0)",lastValueVisible:!1,priceLineVisible:!1}))},{type:"Line",name:"debt",options:C(()=>({priceFormat:{type:"custom",formatter:m},lineWidth:2,lineType:L.WithSteps,color:p.value.colors.yellow,lastValueVisible:!1,priceLineVisible:!1}))}]});N(d);function d(){if(!r.value||!i.debt||!i.supply)return;const c=b.data.groupBy(t=>t.timestamp.getTime()).entries().map(([,t])=>{var a;return{time:t[0].timestamp.getUTCTimestamp(),value:t.reduce((u,v)=>u+v.supply,0),debt:((a=t.find(u=>u.market==="Keepers debt"))==null?void 0:a.supply)??0}}).uniqWith((t,a)=>t.time===a.time).orderBy(t=>t.time,"asc"),e=c.map(t=>({time:t.time,value:t.value-t.debt}));c.length>0&&i.supply.setData(c),e.length>0&&i.debt.setData(e),r.value.timeScale().fitContent()}function m(c){return`${I(c,0,"dollar")}${W(c)}`}return(c,e)=>(_(),A("div",ie,null,512))}}),ce={class:"end"},ue={class:"end"},pe={class:"end"},me={class:"end"},_e={class:"end"},ve={class:"end"},fe={class:"end"},ge={class:"end"},ye={class:"end"},be={class:"end"},he={class:"end"},we=k({__name:"TableMarkets",emits:["select"],setup(b,{emit:p}){const r=p,i=U(""),d=C(()=>c.value.filter(t=>{const a=i.value.toLocaleLowerCase().split(" "),u=v=>a.some(w=>v.toLocaleLowerCase().includes(w));return u(t.name)||u(t.address)}).orderBy(t=>t.borrowed,"desc")),{isFetching:m,data:c}=P(),e=t=>t>=1e6?2:0;return(t,a)=>{const u=ae,v=te,w=ee,f=Z,F=J,M=D;return _(),h(M,{class:"markets-card",title:"Markets",loading:s(m)},{actions:y(()=>[n(u,{modelValue:s(i),"onUpdate:modelValue":a[0]||(a[0]=o=>O(i)?i.value=o:null),search:"",placeholder:"Search for..."},null,8,["modelValue"])]),default:y(()=>[n(F,{class:"markets-table",rows:s(d),columns:["","","Name",{label:"Loans",align:"end"},{label:"Rate",align:"end"},{label:"Borrowed",align:"end"},{label:"Collateral",align:"end"},{label:"Fees Pending",align:"end"},{label:"Fees Collected",align:"end"}],onSelect:a[1]||(a[1]=o=>r("select",o))},{row:y(({item:o})=>[n(v),n(w,{chain:"ethereum",address:o.collateralToken.address},null,8,["address"]),l("div",null,B(o.name),1),l("div",ce,B(o.loans),1),l("div",ue,[n(f,{type:"percentage",value:o.rate*100,precision:2},null,8,["value"])]),l("div",pe,[n(f,{type:"dollar",value:o.borrowed,precision:e,"show-symbol":!1},null,8,["value"])]),l("div",me,[n(f,{type:"dollar",value:o.collateralAmountUsd,precision:e},null,8,["value"])]),l("div",_e,[n(f,{type:"dollar",value:o.fees.pending,precision:e},null,8,["value"])]),l("div",ve,[n(f,{"show-zero":"",type:"dollar",value:o.fees.collected,precision:e},null,8,["value"])])]),"row-aggregation":y(()=>[a[2]||(a[2]=l("div",null,null,-1)),a[3]||(a[3]=l("div",null,null,-1)),a[4]||(a[4]=l("div",null,null,-1)),l("div",fe,B(s(d).reduce((o,g)=>o+g.loans,0)),1),a[5]||(a[5]=l("div",null,null,-1)),l("div",ge,[n(f,{type:"dollar",value:s(d).reduce((o,g)=>o+g.borrowed,0),precision:e,"show-symbol":!1},null,8,["value"])]),l("div",ye,[n(f,{type:"dollar",value:s(d).reduce((o,g)=>o+g.collateralAmountUsd,0),precision:e},null,8,["value"])]),l("div",be,[n(f,{type:"dollar",value:s(d).reduce((o,g)=>o+g.fees.pending,0),precision:e},null,8,["value"])]),l("div",he,[n(f,{"show-zero":"",type:"dollar",value:s(d).reduce((o,g)=>o+g.fees.collected,0),precision:e},null,8,["value"])])]),_:1},8,["rows"])]),_:1},8,["loading"])}}}),Ce=S(we,[["__scopeId","data-v-f583e6f5"]]),ke={class:"dashboard"},Se=k({__name:"CrvUsd.page",setup(b){const{crumbs:p}=R(E());p.value=[{id:"crvusd",label:"crvUSD",pathName:"crvusd"},{id:"market",label:"Select market for details",hint:!0}];const r=z(),i=async d=>{await r.push({name:"crvusdmarket",params:{tab:"",marketAddr:d.address}})};return(d,m)=>(_(),A("div",ke,[n(s(Ce),{style:{"grid-area":"table"},onSelect:i}),n(s(le),{style:{"grid-area":"chart"}})]))}}),Ee=S(Se,[["__scopeId","data-v-26d04f0d"]]);export{Ee as default};
