import{_ as I}from"./KPI-DOF055xo.js";import{_ as P}from"./AsyncValue-BL6mrwNv.js";import{t as b,g as C,f as w,a as N}from"./timestamp-DkvXAN4c.js";import{u as T}from"./useQuery-DaXkcnuD.js";import{a9 as Y,d as v,T as D,U as E,f as q,V as A,h as k,o as y,w as d,a as p,b as o,u as a,_ as S,K as O,X as Q,t as $,i as B,e as F,c as H}from"./index-8S3F9N49.js";import{u as j,c as L,a as R,_ as U,b as V}from"./UseLightweightChart-YjpO5gKB.js";import{r as K,u as z}from"./Number-BTEZFKBa.js";import{_ as J}from"./Table-Bukb5G_Q.js";import{a as M,_ as X}from"./UsePagination-EjExv51k.js";import{u as G}from"./UseRelativeTime-DgXRfvdU.js";import"./Object-DOSYkgA0.js";const Z=e=>({type:e.action_type,sender:e.sender,owner:e.owner,receiver:e.receiver?e.receiver:void 0,assets:BigInt(e.assets),supply:BigInt(e.shares),blockNumber:e.block_number,timestamp:b(e.timestamp),txHash:e.transaction_hash}),x=e=>({timestamp:b(e.timestamp),assets:e.assets,supply:e.supply,apyProjected:Number(e.proj_apy)}),ee=e=>({lastUpdated:b(e.last_updated),lastUpdatedBlock:e.last_updated_block,aprProjected:e.proj_apr,supply:e.supply});async function te(e){const t=C(e),c=await w(`${t}/v1/crvusd/savings/statistics`);return ee(c)}async function ae(e,t){const c=C(t),u=await w(`${c}/v1/crvusd/savings/events?page=${e}&per_page=10`);return{count:u.count,events:u.events.map(Z)}}async function se(e=1,t="hour",c,u,i){const r=C(i),{start:l,end:g}=N({daysRange:10});return(await w(`${r}/v1/crvusd/savings/yield?agg_number=${e}&agg_units=${t}&start=${l}&end=${g}`)).data.map(x)}function ne(){return{initialData:[],initialDataUpdatedAt:0}}function re(){return T({queryKey:["scrvusd-stats"],queryFn:()=>te()})}function oe(e){return T({queryKey:["scrvusd-events",e],queryFn:({queryKey:[,t]})=>ae(t),placeholderData:Y})}function W(){return T({queryKey:["scrvusd-yield"],queryFn:()=>se(),...ne()})}const ie={style:{display:"flex"}},ce={ref:"chartRef",class:"chart"},le=v({__name:"ChartTVL",setup(e){const{isFetching:t,data:c}=W(),u=D(),i=E("card"),{chart:r,series:l}=j({createChartOptions:R(),series:L({name:"tvl",color:q(()=>u.value.colors.blue),formatter:s=>`$${K(s,1,"dollar")}${z(s)}`})});A(g);function g(){if(!r.value||!l.tvl)return;const s=c.value.map(n=>({time:n.timestamp.getUTCTimestamp(),value:n.assets})).uniqWith((n,_)=>n.time===_.time).orderBy(n=>n.time,"asc");s.length>0&&l.tvl.setData(s),r.value.timeScale().fitContent()}return(s,n)=>{const _=U,h=V,f=S;return y(),k(f,{ref_key:"card",ref:i,title:"TVL",loading:a(t)},{actions:d(()=>[p("div",ie,[o(_,{filename:"rates",series:a(l)},null,8,["series"]),o(h,{chart:a(r),target:a(i)},null,8,["chart","target"])])]),default:d(()=>[p("div",ce,null,512)]),_:1},8,["loading"])}}}),ue={style:{display:"flex"}},pe={ref:"chartRef",class:"chart"},_e=v({__name:"ChartYield",setup(e){const{isFetching:t,data:c}=W(),u=D(),i=E("card"),{chart:r,series:l}=j({createChartOptions:R(),series:L({name:"apy",color:q(()=>u.value.colors.blue),formatter:s=>`${K(s,0,"percentage")}%`})});A(g);function g(){if(!r.value||!l.apy)return;const s=c.value.map(n=>({time:n.timestamp.getUTCTimestamp(),value:n.apyProjected})).uniqWith((n,_)=>n.time===_.time).orderBy(n=>n.time,"asc");s.length>0&&l.apy.setData(s),r.value.timeScale().fitContent()}return(s,n)=>{const _=U,h=V,f=S;return y(),k(f,{ref_key:"card",ref:i,title:"Yield",loading:a(t)},{actions:d(()=>[p("div",ue,[o(_,{filename:"rates",series:a(l)},null,8,["series"]),o(h,{chart:a(r),target:a(i)},null,8,["chart","target"])])]),default:d(()=>[p("div",pe,null,512)]),_:1},8,["loading"])}}}),de={class:"end"},me=["href"],ge={class:"end"},he=["href"],fe=v({__name:"TableEvents",setup(e){const{page:t,onPage:c}=M(),u=O(t,200),{isFetching:i,data:r}=oe(u),{relativeTime:l}=G();return(g,s)=>{const n=X,_=P,h=J,f=S;return y(),k(f,{title:"Events",loading:a(i)},{actions:d(()=>[o(n,{"items-count":a(r)?.count??0,"items-per-page":10,page:a(t),onPage:a(c)},null,8,["items-count","page","onPage"])]),default:d(()=>[o(h,{loading:a(i),rows:a(r)?.events??[],columns:["Type",{label:"Amount",align:"end"},"Owner",{label:"Time",align:"end"}]},{row:d(({item:m})=>[p("div",{class:Q(["type",{green:m.type==="deposit",red:m.type==="withdraw"}])},$(m.type),3),p("div",de,[o(_,{value:Number(m.assets)/10**18,precision:0},null,8,["value"])]),p("div",null,[p("a",{target:"_blank",href:`https://etherscan.io/address/${m.owner}`,onClick:s[0]||(s[0]=B(()=>{},["stop"]))},$(m.owner),9,me)]),p("div",ge,[p("a",{target:"_blank",href:`https://etherscan.io/tx/${m.txHash}`,onClick:s[1]||(s[1]=B(()=>{},["stop"]))},$(a(l)(m.timestamp.getUTCTimestamp())),9,he)])]),_:1},8,["loading","rows"])]),_:1},8,["loading"])}}}),ve=F(fe,[["__scopeId","data-v-9b4d465d"]]),ye={class:"dashboard"},$e=v({__name:"Savings.page",setup(e){const{data:t}=re();return(c,u)=>{const i=P,r=I;return y(),H("div",ye,[o(r,{style:{"grid-area":"kpi1"},label:"APR (Projected)","has-value":!!a(t)},{default:d(()=>[o(i,{type:"percentage",value:a(t)?.aprProjected},null,8,["value"])]),_:1},8,["has-value"]),o(r,{style:{"grid-area":"kpi2"},label:"Shares","has-value":!!a(t)},{default:d(()=>[o(i,{value:a(t)?.supply},null,8,["value"])]),_:1},8,["has-value"]),o(ve,{style:{"grid-area":"events"}}),o(_e,{style:{"grid-area":"yield"}}),o(le,{style:{"grid-area":"tvl"}})])}}}),Ae=F($e,[["__scopeId","data-v-d3c76d88"]]);export{Ae as default};
