var U=e=>{throw TypeError(e)};var E=(e,t,s)=>t.has(e)||U("Cannot "+s);var n=(e,t,s)=>(E(e,t,"read from private field"),s?s.call(e):t.get(e)),f=(e,t,s)=>t.has(e)?U("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,s),c=(e,t,s,a)=>(E(e,t,"write to private field"),a?a.call(e,s):t.set(e,s),s),y=(e,t,s)=>(E(e,t,"access private method"),s);import{f as I}from"./fetch-bVCl_krR.js";import{t as W,f as V,g as Q,a as Y}from"./timestamp-CeU_tFUE.js";import{Q as B,u as D}from"./useQuery-DD55_qKH.js";import{ab as X,ac as A,ad as x,ae as ee,f as m,u as N,af as te,ag as se,N as H,ah as ae,ai as re,aj as ie,a9 as ne}from"./index-C0zPo2qD.js";import{u as oe}from"./UseHost-Q14ZtuwU.js";function z(e,t){const s=new Set(t);return e.filter(a=>!s.has(a))}function ue(e,t,s){const a=e.slice(0);return a[t]=s,a}var _,h,g,q,p,b,R,O,$,u,T,k,C,K,M,j,le=(j=class extends X{constructor(t,s,a){super();f(this,u);f(this,_);f(this,h);f(this,g);f(this,q);f(this,p);f(this,b);f(this,R);f(this,O);f(this,$,[]);c(this,_,t),c(this,q,a),c(this,g,[]),c(this,p,[]),c(this,h,[]),this.setQueries(s)}onSubscribe(){this.listeners.size===1&&n(this,p).forEach(t=>{t.subscribe(s=>{y(this,u,K).call(this,t,s)})})}onUnsubscribe(){this.listeners.size||this.destroy()}destroy(){this.listeners=new Set,n(this,p).forEach(t=>{t.destroy()})}setQueries(t,s){c(this,g,t),c(this,q,s),A.batch(()=>{const a=n(this,p),i=y(this,u,C).call(this,n(this,g));c(this,$,i),i.forEach(o=>o.observer.setOptions(o.defaultedQueryOptions));const r=i.map(o=>o.observer),l=r.map(o=>o.getCurrentResult()),d=r.some((o,v)=>o!==a[v]);a.length===r.length&&!d||(c(this,p,r),c(this,h,l),this.hasListeners()&&(z(a,r).forEach(o=>{o.destroy()}),z(r,a).forEach(o=>{o.subscribe(v=>{y(this,u,K).call(this,o,v)})}),y(this,u,M).call(this)))})}getCurrentResult(){return n(this,h)}getQueries(){return n(this,p).map(t=>t.getCurrentQuery())}getObservers(){return n(this,p)}getOptimisticResult(t,s){const a=y(this,u,C).call(this,t),i=a.map(r=>r.observer.getOptimisticResult(r.defaultedQueryOptions));return[i,r=>y(this,u,k).call(this,r??i,s),()=>y(this,u,T).call(this,i,a)]}},_=new WeakMap,h=new WeakMap,g=new WeakMap,q=new WeakMap,p=new WeakMap,b=new WeakMap,R=new WeakMap,O=new WeakMap,$=new WeakMap,u=new WeakSet,T=function(t,s){return s.map((a,i)=>{const r=t[i];return a.defaultedQueryOptions.notifyOnChangeProps?r:a.observer.trackResult(r,l=>{s.forEach(d=>{d.observer.trackProp(l)})})})},k=function(t,s){return s?((!n(this,b)||n(this,h)!==n(this,O)||s!==n(this,R))&&(c(this,R,s),c(this,O,n(this,h)),c(this,b,x(n(this,b),s(t)))),n(this,b)):t},C=function(t){const s=new Map(n(this,p).map(i=>[i.options.queryHash,i])),a=[];return t.forEach(i=>{const r=n(this,_).defaultQueryOptions(i),l=s.get(r.queryHash);l?a.push({defaultedQueryOptions:r,observer:l}):a.push({defaultedQueryOptions:r,observer:new B(n(this,_),r)})}),a},K=function(t,s){const a=n(this,p).indexOf(t);a!==-1&&(c(this,h,ue(n(this,h),a,s)),y(this,u,M).call(this))},M=function(){var t;if(this.hasListeners()){const s=n(this,b),a=y(this,u,T).call(this,n(this,h),n(this,$)),i=y(this,u,k).call(this,a,(t=n(this,q))==null?void 0:t.combine);s!==i&&A.batch(()=>{this.listeners.forEach(r=>{r(n(this,h))})})}},j);function ce({queries:e,...t},s){const a=ee(),i=m(()=>N(e).map(F=>{var S;const w=te(F);typeof w.enabled=="function"&&(w.enabled=F.enabled());const P=a.defaultQueryOptions(w);return P._optimisticResults=(S=a.isRestoring)!=null&&S.value?"isRestoring":"optimistic",P})),r=new le(a,i.value,t),l=()=>{const[v,F]=r.getOptimisticResult(i.value,t.combine);return F(v.map((w,P)=>({...w,refetch:async(...S)=>{const[{[P]:G}]=r.getOptimisticResult(i.value,t.combine);return G.refetch(...S)}})))},d=se(l());let o=()=>{};return a.isRestoring&&H(a.isRestoring,v=>{v||(o(),o=r.subscribe(()=>{d.value=l()}),d.value=l())},{immediate:!0}),H(i,v=>{r.setQueries(v,t),d.value=l()}),ae(()=>{o()}),t.shallow?re(d):ie(d)}const he=e=>({tvl:e.total_tvl,tradingVolume24h:e.trading_volume_24h,tradingFee24h:e.trading_fee_24h,liquidityVolume24h:e.liquidity_volume_24h,liquidityFee24h:e.liquidity_fee_24h}),Z=e=>{var t,s;return{name:e.name,address:e.address,numCoins:e.n_coins,tvlUsd:e.tvl_usd,tradingVolume24h:e.trading_volume_24h,tradingFee24h:e.trading_fee_24h,liquidityVolume24h:e.liquidity_volume_24h,liquidityFee24h:e.liquidity_fee_24h,coins:((t=e.coins)==null?void 0:t.map(a=>({poolIndex:a.pool_index,symbol:a.symbol,address:a.address})))??[],baseDailyApr:e.base_daily_apr,baseWeeklyApr:e.base_weekly_apr,virtualPrice:e.virtual_price,poolMethods:((s=e.pool_methods)==null?void 0:s.map(a=>a))??[]}},pe=e=>({timestamp:W(e.timestamp),volume:e.volume,fees:e.fees}),de=e=>({timestamp:W(e.timestamp),tvlUSD:e.tvl_usd??0,balances:[...e.balances],tokenPrices:[...e.token_prices]});async function fe(e,t=1,s=9999,a){const i=Q(a),r=await V(`${i}/v1/chains/${e}?page=${t}&per_page=${s}`);return{chain:r.chain,totals:he(r.total),pools:r.data.map(Z)}}async function J(e,t,s){const a=Q(s),i=await V(`${a}/v1/pools/${e}/${t}`);return Z(i)}async function ye(e,t,s){const a=Q(s),{start:i,end:r}=Y({daysRange:90});return(await V(`${a}/v1/snapshots/${e}/${t}/tvl?interval=day&start=${i}&end=${r}`)).data.map(de)}const ve=/[+-]\d{2}:?\d{2}$/;function me(e){if(typeof e=="number")return new Date(e*1e3);const t=Number(e);if(!Number.isNaN(t))return new Date(t*1e3);const a=e.endsWith("Z")||ve.test(e)?e:`${e}Z`;return new Date(a)}const be=24*60*60;function L({end:e,start:t,daysRange:s=10}={}){return e??(e=Math.floor(Date.now()/1e3)),t??(t=e-s*be),{end:e,start:t}}function Fe(e){return D({queryKey:["curve-pools",e],queryFn:async({queryKey:[,t]})=>{const s=await oe();return fe(t,1,9999,{host:s})},placeholderData:ne,enabled:m(()=>!!e.value)})}function Pe(e,t){return D({queryKey:["curve-pool",t],queryFn:async({queryKey:[,s]})=>J(e.value,s),enabled:m(()=>!!e.value)})}function Se(e,t){const s=m(()=>t.value.map(a=>({queryKey:["curve-pool",a],queryFn:()=>J(e.value,a),enabled:m(()=>!!e.value)})));return ce({queries:s})}async function _e(e,t,s,a){const i=Q(a),{start:r,end:l}=L({daysRange:s});return(await I(`${i}/v1/volume/usd/${e}/${t}?interval=day&start=${r}&end=${l}`)).data.map(pe)}function Ee(e,t,s=90){const a=m(()=>N(s));return D({queryKey:["curve-pool-volume",t,a],queryFn:async({queryKey:[,i]})=>_e(e.value,i,a.value),enabled:m(()=>!!e.value&&!!t.value),initialData:[],initialDataUpdatedAt:0})}function Te(e,t){return D({queryKey:["curve-pool-tvl",t],queryFn:async({queryKey:[,s]})=>ye(e.value,s),enabled:m(()=>!!e.value&&!!t.value),initialData:[],initialDataUpdatedAt:0})}const ge=e=>({timestamp:me(e.timestamp),a:e.a,fee:e.fee,adminFee:e.admin_fee,virtualPrice:e.virtual_price,xcpProfit:e.xcp_profit??void 0,xcpProfitA:e.xcp_profit_a??void 0,baseDailyApr:e.base_daily_apr,baseWeeklyApr:e.base_weekly_apr,offpegFeeMultiplier:e.offpeg_fee_multiplier??void 0,gamma:e.gamma??void 0,midFee:e.mid_fee??void 0,outFee:e.out_fee??void 0,feeGamma:e.fee_gamma??void 0,allowedExtraProfit:e.allowed_extra_profit??void 0,adjustmentStep:e.adjustment_step??void 0,maHalfTime:e.ma_half_time??void 0,priceScale:[...e.price_scale??[]],priceOracle:[...e.price_oracle??[]]});async function qe(e,t,s,a){const i=Q(a),{start:r,end:l}=L({daysRange:s});return(await I(`${i}/v1/snapshots/${e}/${t}?start=${r}&end=${l}`)).data.map(ge)}function ke(e,t,s=90){const a=m(()=>N(s));return D({queryKey:["curve-pool-snapshots",t,a],queryFn:async({queryKey:[,i]})=>qe(e.value,i,a.value),enabled:m(()=>!!e.value&&!!t.value),initialData:[],initialDataUpdatedAt:0})}export{Ee as a,ke as b,Te as c,Pe as d,Se as e,Fe as u};
