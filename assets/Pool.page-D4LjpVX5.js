import{_ as ne,a as se}from"./TabItem.vue_vue_type_script_setup_true_lang-B_O_p1Ga.js";import{d as B,h as V,o as k,a4 as Z,w as g,a as $,t as H,e as W,T as F,f as S,r as K,g as q,U as Q,V as P,_ as I,u as t,b as f,c as N,a7 as G,j as x,F as re,l as ie,a5 as ce,a6 as ue,N as me,W as U,R as de,a3 as Y}from"./index-BQLunFHs.js";import{a as pe,b as ve,c as _e}from"./pools-BYXbF4J0.js";import{u as z,_ as ee}from"./UseLegend-BoA2RrHS.js";import{u as R,d as te,a as E,b as j,c as ae,_ as oe}from"./UseLightweightChart-BmE4U9L3.js";import{u as he}from"./queries-DebPkvkS.js";import{r as O,u as M}from"./Number-BynZIa1V.js";import{_ as fe}from"./AsyncValue-zD0lFhv8.js";import{a as ge,_ as be}from"./KPI-DZsIdWbR.js";import{_ as ye}from"./TokenIcon-DMvelSua.js";import{_ as le}from"./ButtonToggle-STZetdPl.js";import{g as Ce}from"./api-DFkSxUea.js";import{u as $e}from"./useQuery-DIn02iD8.js";import{a as J}from"./index-CWBUWG3-.js";import{u as ke}from"./UseTabNavigation-CEZpaUlH.js";import"./timestamp-Dfir0V72.js";import"./UseHost-KyH7y6oP.js";import"./Object-DOSYkgA0.js";import"./Helper-yLlNrDny.js";const Se={class:"option"},we={class:"label"},Ve=B({__name:"SelectDuration",props:{duration:{default:()=>({value:1,unit:"month"})}},emits:["select"],setup(p,{emit:v}){const u=v,s=[{value:1,unit:"hour"},{value:1,unit:"day"},{value:1,unit:"week"},{value:1,unit:"month"},{value:1,unit:"year"}],h=y=>{u("select",y)};return(y,l)=>{const m=Z;return k(),V(m,{options:s.map(d=>d),selected:y.duration,onSelect:h},{option:g(({option:d})=>[$("div",Se,[$("div",we,H(d.value)+" "+H(d.unit),1)])]),_:1},8,["options","selected"])}}}),X=W(Ve,[["__scopeId","data-v-0bc945d9"]]),Te={style:{display:"flex"}},Le={style:{display:"flex","flex-wrap":"wrap",gap:"2rem"}},Be={class:"time"},De={class:"time"},Ae={ref:"chartRef",class:"chart"},Oe=B({__name:"ChartMEV",props:{pool:{}},setup(p){function v(e,a){var C;const n=(C=e.replace("#","").match(/.{2}/g))==null?void 0:C.map(b=>parseInt(b,16));return n?`#${n.map(b=>Math.max(0,Math.floor(b*(1-a)))).map(b=>b.toString(16).padStart(2,"0")).join("")}`:e}const u=F(),s=S(()=>({volume:u.value.colors.red,bars:[u.value.colorsArray[1],v(u.value.colorsArray[1],.33),u.value.colorsArray[0],v(u.value.colorsArray[0],.33)]})),{items:h,toggles:y,disabled:l}=z(()=>[{id:"atomic",label:"Atomic",color:s.value.bars[0],togglable:!0},{id:"cexdex",label:"Cexdex",color:s.value.bars[1],togglable:!0},{id:"within",label:"Within",color:s.value.bars[2],togglable:!0},{id:"outside",label:"Outside",color:s.value.bars[3],togglable:!0},{id:"total",label:"Volume (Total)",color:s.value.volume,togglable:!0}]),m=K({value:1,unit:"week"}),d=K({value:1,unit:"hour"}),{isFetching:i,data:_}=he(q(()=>p.pool),m,d),c=Q("card"),{chart:w,series:o}=R({createChartOptions:E(),series:[{type:"StackedBars",name:"data",options:S(()=>({priceFormat:{type:"custom",formatter:e=>`$${O(e,1,"dollar")}${M(e)}`},colors:h.value.map((e,a)=>({item:e,i:a})).filter(({item:e})=>!l.value.includes(e.id)).map(({i:e})=>e).map(e=>s.value.bars[e]),lastValueVisible:!1,priceLineVisible:!1}))},{type:"Line",name:"volume",options:S(()=>({priceFormat:{type:"custom",formatter:e=>`${O(e,1,"dollar")}${M(e)}`},lineWidth:2,lineType:te.Curved,color:s.value.volume,lastValueVisible:!1,priceLineVisible:!1}))}]});P(D);function D(){if(!w.value||!o.volume||!o.data)return;const e=l.value.includes("total")?[]:_.value.map(n=>({time:n.interval_start_unixtime,value:n.full_volume})).uniqWith((n,r)=>n.time===r.time).orderBy(n=>n.time,"asc");e.length>1?(o.volume.setData(e),o.volume.applyOptions({visible:!0})):o.volume.applyOptions({visible:!1});const a=_.value.map(n=>({time:n.interval_start_unixtime,values:[...l.value.includes("atomic")?[]:[n.atomicArbVolume],...l.value.includes("cexdex")?[]:[n.cexDexArbVolume],...l.value.includes("within")?[]:[n.sandwichVolume_LossWithin],...l.value.includes("outside")?[]:[n.sandwichVolume_LossOutside]]})).uniqWith((n,r)=>n.time===r.time).orderBy(n=>n.time,"asc");a.length>0&&o.data.setData(a),w.value.timeScale().fitContent()}return(e,a)=>{const n=j,r=ee,C=I;return k(),V(C,{ref_key:"card",ref:c,title:"MEV",loading:t(i)},{actions:g(()=>[$("div",Te,[f(n,{chart:t(w),target:t(c)},null,8,["chart","target"])])]),"actions-secondary":g(()=>[$("div",Le,[f(r,{items:t(h),disabled:t(l),onToggle:a[0]||(a[0]=b=>t(y)[b].value=!t(y)[b].value)},null,8,["items","disabled"]),$("div",Be,[a[3]||(a[3]=$("span",null,"Duration:",-1)),f(X,{duration:t(m),onSelect:a[1]||(a[1]=b=>m.value=b)},null,8,["duration"])]),$("div",De,[a[4]||(a[4]=$("span",null,"Interval:",-1)),f(X,{duration:t(d),onSelect:a[2]||(a[2]=b=>d.value=b)},null,8,["duration"])])])]),default:g(()=>[$("div",Ae,null,512)]),_:1},8,["loading"])}}}),Me=W(Oe,[["__scopeId","data-v-e3d04b7f"]]),We={class:"dashboard-grid"},Fe=B({__name:"MEV",props:{pool:{}},setup(p){const v=S(()=>p.pool.address);return(u,s)=>(k(),N("div",We,[f(Me,{style:{"grid-area":"chart"},pool:t(v)},null,8,["pool"])]))}}),Pe=W(Fe,[["__scopeId","data-v-a5261ecc"]]),Ie={style:{display:"flex"}},Re={ref:"chartRef",class:"chart"},Ee="chart_pool_balances_dollars",Ue="chart_pool_balances_type",qe=B({__name:"ChartBalances",props:{balances:{}},setup(p){const v=F(),{items:u,toggles:s,disabled:h}=z(()=>p.balances.map(({symbol:e},a)=>({id:e,label:e,color:v.value.colorsArray[a],togglable:!0}))),y=Q("card"),l=G(Ee,!1),m=["unstacked","stacked","100%"],d=[{id:"unstacked",label:"Unstacked"},{id:"stacked",label:"Stacked"},{id:"100%",label:"Stacked (100%)"}],i=G(Ue,m[0]),{chart:_,series:c}=R({createChartOptions:E(),series:[...p.balances.map(({symbol:e},a)=>({type:"Line",name:e,options:S(()=>({priceFormat:{type:"custom",formatter:n=>`${O(n,1,"dollar")}${M(n)}`},lineWidth:2,lineType:te.WithSteps,color:v.value.colorsArray[a],lastValueVisible:!1,priceLineVisible:!1}))})),{type:"StackedArea",name:"stacked",options:S(()=>({priceFormat:{type:"custom",formatter:e=>`${O(e,1,"dollar")}${M(e)}`},colors:u.value.map((e,a)=>({item:e,i:a})).filter(({item:e})=>!h.value.includes(e.id)).map(({i:e})=>e).map(e=>v.value.colorsArray[e]).map(e=>({line:e,area:e+"15"})),lineWidth:2,lastValueVisible:!1,priceLineVisible:!1}))}]});P(w);function w(){if(!(!_.value||Object.values(c).length<0)){for(const e of Object.values(c))e==null||e.setData([]);i.value==="unstacked"?o():D(i.value==="100%"),_.value.timeScale().fitContent()}}function o(){var e,a;for(const{symbol:n,balances:r}of p.balances.values()){if(!s[n].value){(e=c[n])==null||e.setData([]);continue}const C=l.value,b=r.map(T=>({time:T.timestamp.getUTCTimestamp(),value:C?T.balance*T.tokenPrice:T.balance})).uniqWith((T,A)=>T.time===A.time).orderBy(T=>T.time,"asc");b.length>0&&((a=c[n])==null||a.setData(b))}}function D(e){if(!c.stacked)return;const a=l.value,n=[...p.balances.values()].filter(({symbol:r,balances:C})=>s[r].value&&C.length>0).flatMap(({symbol:r,balances:C})=>C.map(b=>({symbol:r,timestamp:b.timestamp,balance:a?b.balance*b.tokenPrice:b.balance}))).groupBy(r=>r.timestamp.getTime()).entries().map(([r,C])=>{const b=e?C.reduce((A,L)=>A+L.balance,0):1,T=C.map(A=>e?A.balance/b*100:A.balance);return{time:Number(r)/1e3,values:T}}).uniqWith((r,C)=>r.time===C.time).orderBy(r=>r.time,"asc");n.length>0&&c.stacked.setData(n)}return(e,a)=>{const n=Z,r=le,C=ge,b=j,T=ee,A=I;return k(),V(A,{ref_key:"card",ref:y,class:"stack-actions",title:"Balances"},{actions:g(()=>[$("div",Ie,[f(n,{options:d,selected:d.find(L=>L.id===t(i))??d[0],onSelect:a[0]||(a[0]=L=>i.value=L.id)},{option:g(({option:L})=>[x(H(L.label),1)]),_:1},8,["selected"]),f(C,null,{trigger:g(()=>[f(r,{style:{"margin-right":"1rem"},"model-value":t(l),onClick:a[1]||(a[1]=L=>l.value=!t(l))},{default:g(()=>a[3]||(a[3]=[x(" $ ")])),_:1},8,["model-value"])]),default:g(()=>[a[4]||(a[4]=x(" Show token balances in USD. "))]),_:1}),f(b,{chart:t(_),target:t(y)},null,8,["chart","target"])])]),"actions-secondary":g(()=>[f(T,{items:t(u),disabled:t(h),onToggle:a[2]||(a[2]=L=>t(s)[L].value=!t(s)[L].value)},null,8,["items","disabled"])]),default:g(()=>[$("div",Re,null,512)]),_:1},512)}}}),xe=W(qe,[["__scopeId","data-v-e9381c7d"]]),Ne={class:"controls"},Qe={ref:"chartRef",class:"chart"},je=B({__name:"ChartPrice",props:{ohlc:{},minMove:{}},setup(p){const v=F(),u=K(!1);let s=1,h=0;const{chart:y,series:l}=R({createChartOptions:E(),series:{type:"Candlestick",name:"ohlc",options:S(()=>{const{colors:i}=v.value;return{priceFormat:{type:"custom",formatter:d,minMove:p.minMove},upColor:i.green,borderUpColor:i.green,wickUpColor:i.green,downColor:i.red,borderDownColor:i.red,wickDownColor:i.red}})}});P(m);function m(){if(!y.value||!l.ohlc)return;const i=u.value?-1:1,_=p.ohlc.map(c=>({time:c.time.getUTCTimestamp(),open:Math.pow(c.open,i),high:Math.pow(c.high,i),low:Math.pow(c.low,i),close:Math.pow(c.close,i)})).uniqWith((c,w)=>c.time===w.time).orderBy(c=>c.time,"asc");_.length>0&&(l.ohlc.setData(_),h=Math.min(..._.map(c=>c.low)),s=Math.max(..._.map(c=>c.high))),y.value.timeScale().fitContent()}function d(i){const _=s-h,c=_>1?_-Math.floor(_):_,w=-Math.floor(Math.log10(c)+1)+2;return`${O(i,w,"dollar")}${M(i)}`}return(i,_)=>{const c=le,w=I;return k(),V(w,{title:"Price"},{actions:g(()=>[$("div",Ne,[f(c,{"model-value":t(u),onClick:_[0]||(_[0]=o=>u.value=!t(u))},{default:g(()=>_[1]||(_[1]=[x(" Invert ")])),_:1},8,["model-value"])])]),default:g(()=>[$("div",Qe,null,512)]),_:1})}}}),He=W(je,[["__scopeId","data-v-c58213e5"]]),Ke={style:{display:"flex"}},Ge={ref:"chartRef",class:"chart"},Ye=B({__name:"ChartTvl",props:{tvl:{}},setup(p){const v=F(),u=Q("card"),{chart:s,series:h}=R({createChartOptions:E(),series:ae({name:"tvl",color:S(()=>v.value.colors.blue),formatter:l=>`$${O(l,1,"dollar")}${M(l)}`})});P(y);function y(){if(!s.value||!h.tvl)return;const l=p.tvl.map(m=>({time:m.timestamp.getUTCTimestamp(),value:m.tvl})).uniqWith((m,d)=>m.time===d.time).orderBy(m=>m.time,"asc");l.length>0&&h.tvl.setData(l),s.value.timeScale().fitContent()}return(l,m)=>{const d=oe,i=j,_=I;return k(),V(_,{ref_key:"card",ref:u,title:"TVL"},{actions:g(()=>[$("div",Ke,[f(d,{filename:"tvl",series:t(h)},null,8,["series"]),f(i,{chart:t(s),target:t(u)},null,8,["chart","target"])])]),default:g(()=>[$("div",Ge,null,512)]),_:1},512)}}}),Je={style:{display:"flex"}},Xe={ref:"chartRef",class:"chart"},Ze=B({__name:"ChartVolume",props:{volume:{}},setup(p){const v=F(),u=Q("card"),{chart:s,series:h}=R({createChartOptions:E(),series:ae({name:"volume",color:S(()=>v.value.colors.blue),formatter:l=>`$${O(l,1,"dollar")}${M(l)}`})});P(y);function y(){if(!s.value||!h.volume)return;const l=p.volume.map(m=>({time:m.timestamp.getUTCTimestamp(),value:m.volume})).uniqWith((m,d)=>m.time===d.time).orderBy(m=>m.time,"asc");l.length>0&&h.volume.setData(l),s.value.timeScale().fitContent()}return(l,m)=>{const d=oe,i=j,_=I;return k(),V(_,{ref_key:"card",ref:u,title:"Volume"},{actions:g(()=>[$("div",Je,[f(d,{filename:"volume",series:t(h)},null,8,["series"]),f(i,{chart:t(s),target:t(u)},null,8,["chart","target"])])]),default:g(()=>[$("div",Xe,null,512)]),_:1},512)}}});function ze(p,v,u,s){return $e({queryKey:["curve-token-price",v,u,s],queryFn:({queryKey:[,h,y,l]})=>Ce(p.value,h,y,l),enabled:S(()=>!!p.value&&!!v.value&&!!u.value&&!!s.value),initialData:[],initialDataUpdatedAt:0})}const et={class:"dashboard-grid"},tt={class:"tokens"},at=B({__name:"PoolOverview",props:{pool:{},chain:{}},setup(p){const v=S(()=>{var o;return(o=p.pool)==null?void 0:o.address}),u=S(()=>{var o;return(o=p.pool)==null?void 0:o.coins[0].address}),s=S(()=>{var o;return(o=p.pool)==null?void 0:o.coins[1].address}),{isFetching:h,data:y}=ze(q(()=>p.chain),v,u,s),{isFetching:l,data:m}=pe(q(()=>p.chain),v),{isFetching:d,data:i}=ve(q(()=>p.chain),v),_=S(()=>m.value.map(o=>({timestamp:o.timestamp,volume:o.volume}))),c=S(()=>i.value.map(o=>({timestamp:o.timestamp,tvl:o.tvlUSD}))),w=S(()=>p.pool?p.pool.coins.map(o=>({symbol:o.symbol,balances:i.value.map(D=>({timestamp:D.timestamp,balance:D.balances[o.poolIndex],tokenPrice:D.tokenPrices[o.poolIndex]}))})):[]);return(o,D)=>{const e=ye,a=be,n=fe;return k(),N("div",et,[f(a,{style:{"grid-area":"kpi1"},label:"Tokens","has-value":!!o.pool},{default:g(()=>{var r;return[$("div",tt,[(k(!0),N(re,null,ie(((r=o.pool)==null?void 0:r.coins)??[],C=>(k(),V(e,{key:C.address,clickable:"",chain:o.chain,address:C.address},null,8,["chain","address"]))),128))])]}),_:1},8,["has-value"]),f(a,{style:{"grid-area":"kpi2"},label:"TVL","has-value":!!o.pool},{default:g(()=>{var r;return[f(n,{type:"dollar",value:((r=o.pool)==null?void 0:r.tvlUsd)??0},null,8,["value"])]}),_:1},8,["has-value"]),f(a,{style:{"grid-area":"kpi3"},label:"Volume (24h)","has-value":!!o.pool},{default:g(()=>{var r;return[f(n,{type:"dollar",value:((r=o.pool)==null?void 0:r.tradingVolume24h)??0},null,8,["value"])]}),_:1},8,["has-value"]),f(a,{style:{"grid-area":"kpi4"},label:"Fees (24h)","has-value":!!o.pool},{default:g(()=>{var r;return[f(n,{type:"dollar",value:((r=o.pool)==null?void 0:r.tradingFee24h)??0},null,8,["value"])]}),_:1},8,["has-value"]),f(He,{style:{"grid-area":"price"},ohlc:t(y),loading:t(h)},null,8,["ohlc","loading"]),f(Ze,{style:{"grid-area":"volume"},volume:t(_),loading:t(l)},null,8,["volume","loading"]),f(Ye,{style:{"grid-area":"tvl"},tvl:t(c),loading:t(d)},null,8,["tvl","loading"]),f(xe,{style:{"grid-area":"balances"},balances:t(w),loading:t(d)},null,8,["balances","loading"])])}}}),ot=W(at,[["__scopeId","data-v-334879c5"]]),lt={class:"dashboard"},nt=B({__name:"Pool.page",setup(p){const v=J("chain"),u=J("poolAddr"),{isFetching:s,data:h}=_e(v,u.value),{crumbs:y}=ce(ue());me(h,d=>{y.value=[{id:"pools",label:"Pools",pathName:"pools",params:()=>({chain:v.value})},{id:"pool",label:`Pool: ${(d==null?void 0:d.name)??"?"}`}]},{immediate:!0});const{tabActive:l,tabActiveIndex:m}=ke(["overview","mev"],"poolspool",()=>({chain:v.value,poolAddr:u.value}));return(d,i)=>{const _=de,c=ne,w=se;return k(),N("div",lt,[f(_,{loading:t(s)},null,8,["loading"]),!t(s)&&t(h)?(k(),V(w,{key:0,active:t(m),onTab:i[0]||(i[0]=o=>m.value=o.index)},{default:g(()=>[f(c,{header:"Overview"},{default:g(()=>[(k(),V(Y,null,[t(l)==="overview"?(k(),V(ot,{key:0,pool:t(h),chain:t(v)},null,8,["pool","chain"])):U("",!0)],1024))]),_:1}),t(v)==="ethereum"&&t(h)?(k(),V(c,{key:0,header:"MEV"},{default:g(()=>[(k(),V(Y,null,[t(l)==="mev"?(k(),V(Pe,{key:0,pool:t(h)},null,8,["pool"])):U("",!0)],1024))]),_:1})):U("",!0)]),_:1},8,["active"])):U("",!0)])}}}),wt=W(nt,[["__scopeId","data-v-e7d124fd"]]);export{wt as default};
