import{_ as J,a as X}from"./TabItem.vue_vue_type_script_setup_true_lang-BuFEKzPC.js";import{d as T,t as b,W as D,c as k,Y as I,e as y,o as v,g as R,u as e,w as h,f as g,r as w,b as i,O as Z,_ as V,i as q,a as F,V as B,S as H,j as x,a4 as ee,a5 as ae,N as te,R as se,a2 as P}from"./index-CT4FqvTD.js";import{e as M,u as ne}from"./crvusd-CgA_xUU9.js";import{_ as oe}from"./KPI-Dz8SGusd.js";import{_ as ie}from"./AsyncValue-yw7UjBml.js";import"./UseLegend-zAyqFCAc.js";import"./ButtonToggle-BRVkT_JC.js";/* empty css                                                                         */import"./ChartStylesApex-niCLd5Y0.js";import{u as Q,a as W,c as N}from"./UseLightweightChart-C0fLCxWV.js";import{r as U,u as j}from"./Number-D6bZlHKQ.js";import{_ as re}from"./InputNumber-DFtmTrb_.js";import{u as K,a as le,b as ce,c as de,d as ue,e as me,f as pe,T as _e,_ as he,g as ve,h as ge,i as fe,j as ke,k as be,l as ye,m as Ce,n as $e,o as Te,C as we,p as Le,q as qe}from"./TableTrades-CN6iPhgq.js";import{_ as z,a as Ve}from"./Table-JN3v4T5r.js";import{L as Y}from"./link-C0yHzBzL.js";import{_ as Se}from"./TokenIcon-DyiEeLSy.js";import"./BtnChartLWFullscreen.vue_vue_type_script_setup_true_lang-CNbJVnGv.js";import{a as Ae}from"./index-Dadv2CiL.js";import{u as Fe}from"./UseTabNavigation-BFbUsXn1.js";import"./api-DFkSxUea.js";import"./timestamp-Dfir0V72.js";import"./useQuery-BavYuEWE.js";import"./Object-DOSYkgA0.js";/* empty css                                                                    */import"./UsePagination-Dz6Yy9GD.js";import"./UseRelativeTime-BbZlP_os.js";const Re={ref:"chartRef",class:"chart"},Be=T({__name:"ChartMarketAvailableCap",props:{market:{}},setup(l){const{isFetching:s,data:p}=M(b(()=>l.market)),_=D(),{chart:n,series:t}=Q({createChartOptions:N(),series:{type:"Area",name:"available",options:k(()=>({priceFormat:{type:"custom",formatter:o=>`$${U(o,0,"dollar")}${j(o)}`},lineWidth:2,lineType:W.WithSteps,lineColor:_.value.colors.blue,topColor:"rgb(32, 129, 240, 0.2)",bottomColor:"rgba(32, 129, 240, 0)",lastValueVisible:!1,priceLineVisible:!1}))}});I(r);function r(){if(!n.value||!t.available)return;const o=p.value.map(a=>({time:a.timestamp.getUTCTimestamp(),value:a.borrowable})).uniqWith((a,c)=>a.time===c.time).orderBy(a=>a.time,"asc").dropWhile(a=>a.value===0);o.length>0&&t.available.setData(o),n.value.timeScale().fitContent()}return(o,a)=>{const c=R;return v(),y(c,{title:"Borrowable & Debt Ceiling",loading:e(s)},{default:h(()=>[g("div",Re,null,512)]),_:1},8,["loading"])}}}),Oe={ref:"chartRef",class:"chart"},We=T({__name:"ChartMarketLoans",props:{market:{}},setup(l){const{isFetching:s,data:p}=M(b(()=>l.market)),_=D(),{chart:n,series:t}=Q({createChartOptions:N(),series:{type:"Histogram",name:"loans",options:k(()=>({color:_.value.colors.yellow,lastValueVisible:!1,priceFormat:{type:"volume"},priceLineVisible:!1}))}});I(r);function r(){if(!n.value||!t.loans)return;const o=p.value.map(a=>({time:a.timestamp.getUTCTimestamp(),value:a.nLoans})).uniqWith((a,c)=>a.time===c.time).orderBy(a=>a.time,"asc");o.length>0&&(t.loans.setData(o),n.value.timeScale().fitContent())}return(o,a)=>{const c=R;return v(),y(c,{title:"Loans",loading:e(s)},{default:h(()=>[g("div",Oe,null,512)]),_:1},8,["loading"])}}}),De={ref:"chartRef",class:"chart"},Ie=T({__name:"ChartMarketRates",props:{market:{}},setup(l){const{isFetching:s,data:p}=M(b(()=>l.market)),_=D(),n=w(null),{chart:t,series:r}=Q({createChartOptions:N(),series:[{type:"Area",name:"rates",options:k(()=>({priceFormat:{type:"custom",formatter:a},lineWidth:2,lineType:W.WithSteps,lineColor:_.value.colors.blue,topColor:"rgb(32, 129, 240, 0.2)",bottomColor:"rgba(32, 129, 240, 0)",lastValueVisible:!1,priceLineVisible:!1}))},{type:"Line",name:"ema",options:k(()=>({priceFormat:{type:"custom",formatter:a},lineWidth:2,lineType:W.WithSteps,color:_.value.colors.yellow,lastValueVisible:!1,priceLineVisible:!1}))}]});I(o);function o(){if(!t.value||!r.rates||!r.ema)return;const u=p.value.map(d=>({time:d.timestamp.getUTCTimestamp(),value:d.rate})).uniqWith((d,C)=>d.time===C.time).orderBy(d=>d.time,"asc"),f=c(u.map(d=>d.value),n.value??31).zip(u).map(d=>({time:d[1].time,value:d[0]}));f.length>0&&r.ema.setData(f),u.length>0&&(r.rates.setData(u),t.value.timeScale().fitContent())}function a(u){return`${U(u*100,0,"percentage")}%`}const c=(u,m=7)=>u.map((f,d)=>{const C=Math.max(d-(m-1),0),S=d+1,L=u.slice(C,S);return L.reduce((O,$)=>O+$,0)/L.length});return(u,m)=>{const f=re,d=R;return v(),y(d,{title:"Rates",loading:e(s)},{actions:h(()=>[i(f,{modelValue:e(n),"onUpdate:modelValue":m[0]||(m[0]=C=>Z(n)?n.value=C:null),class:"avg-span",placeholder:"Avg span (days)",min:1,max:1/0},null,8,["modelValue"])]),default:h(()=>[g("div",De,null,512)]),_:1},8,["loading"])}}}),Me=V(Ie,[["__scopeId","data-v-646458b1"]]),Qe={ref:"chartRef",class:"chart"},Ne=T({__name:"ChartMarketVolume",props:{market:{},chain:{}},setup(l){const{isFetching:s,data:p}=K("crvusd",k(()=>{var o;return(o=l.market)==null?void 0:o.llamma}),b(()=>l.chain)),_=D(),{chart:n,series:t}=Q({createChartOptions:N(),series:{type:"Area",name:"volume",options:k(()=>({priceFormat:{type:"custom",formatter:o=>`$${U(o,0,"dollar")}${j(o)}`},lineWidth:2,lineType:W.WithSteps,lineColor:_.value.colors.blue,topColor:"rgb(32, 129, 240, 0.2)",bottomColor:"rgba(32, 129, 240, 0)",lastValueVisible:!1,priceLineVisible:!1}))}});I(r);function r(){if(!n.value||!t.volume)return;const o=(p.value??[]).map(a=>({time:a.time.getUTCTimestamp(),value:a.volume})).uniqWith((a,c)=>a.time===c.time).orderBy(a=>a.time,"asc");o.length>0&&t.volume.setData(o),n.value.timeScale().fitContent()}return(o,a)=>{const c=R;return v(),y(c,{title:"Volume",loading:e(s)},{default:h(()=>[g("div",Qe,null,512)]),_:1},8,["loading"])}}}),Ee=["href"],Pe={key:1},Ue=T({__name:"Addresses",props:{market:{}},setup(l){const s=k(()=>{var n,t,r;return[{description:"Controller",address:(n=l.market)==null?void 0:n.address},{description:"Factory",address:(t=l.market)==null?void 0:t.factoryAddress},{description:"Llamma",address:(r=l.market)==null?void 0:r.llamma}]}),p=n=>`https://etherscan.io/address/${n}`,_=async n=>{await navigator.clipboard.writeText(n)};return(n,t)=>{const r=Y,o=H,a=z,c=R;return v(),y(c,{class:"addresses",title:"Addresses"},{default:h(()=>[i(a,{class:"addresses-table",rows:e(s)},{row:h(({item:{description:u,address:m}})=>[g("div",null,q(u),1),g("div",null,[m?(v(),F("a",{key:0,class:"font-mono",target:"_blank",href:p(m)},q(m),9,Ee)):(v(),F("span",Pe,"?"))]),g("div",null,[m?(v(),y(o,{key:0,onClick:f=>_(m)},{default:h(()=>[i(r)]),_:2},1032,["onClick"])):B("",!0)])]),_:1},8,["rows"])]),_:1})}}}),He=V(Ue,[["__scopeId","data-v-2bb26947"]]),je={class:"token-info"},Ke=["href"],ze={class:"token-info"},Ye=["href"],Ge=T({__name:"Properties",props:{market:{},chain:{}},setup(l){const s=k(()=>{var t,r,o,a;return{type:"token",symbol:((r=(t=l.market)==null?void 0:t.collateralToken)==null?void 0:r.symbol)??"?",address:((a=(o=l.market)==null?void 0:o.collateralToken)==null?void 0:a.address)??"?"}}),p=k(()=>{var t,r,o,a;return{type:"token",symbol:((r=(t=l.market)==null?void 0:t.stablecoinToken)==null?void 0:r.symbol)??"?",address:((a=(o=l.market)==null?void 0:o.stablecoinToken)==null?void 0:a.address)??"?"}}),_=t=>`https://etherscan.io/address/${t}`,n=async t=>{await navigator.clipboard.writeText(t)};return(t,r)=>{const o=Se,a=Y,c=H,u=Ve,m=z,f=R;return v(),y(f,{class:"properties",title:"Properties"},{default:h(()=>[i(m,{class:"properties-table"},{default:h(()=>[i(u,null,{default:h(()=>[r[2]||(r[2]=g("div",null,"Collateral",-1)),g("div",je,[i(o,{chain:t.chain,address:e(s).address},null,8,["chain","address"]),g("div",null,q(e(s).symbol),1),g("div",null,[g("a",{class:"font-mono",target:"_blank",href:_(e(s).address)},q(e(s).address),9,Ke)]),g("div",null,[i(c,{onClick:r[0]||(r[0]=d=>n(e(s).address))},{default:h(()=>[i(a)]),_:1})])])]),_:1}),i(u,null,{default:h(()=>[r[3]||(r[3]=g("div",null,"Borrowed",-1)),g("div",ze,[i(o,{chain:t.chain,address:e(p).address},null,8,["chain","address"]),g("div",null,q(e(p).symbol),1),g("div",null,[g("a",{class:"font-mono",target:"_blank",href:_(e(p).address)},q(e(p).address),9,Ye)]),g("div",null,[i(c,{onClick:r[1]||(r[1]=d=>n(e(p).address))},{default:h(()=>[i(a)]),_:1})])])]),_:1})]),_:1})]),_:1})}}}),Je=V(Ge,[["__scopeId","data-v-61c51caa"]]),Xe={class:"dashboard-grid"},Ze=T({__name:"MarketOverview",props:{market:{},chain:{}},setup(l){return(s,p)=>{const _=ie,n=oe;return v(),F("div",Xe,[i(n,{style:{"grid-area":"kpi1"},label:"Borrow Rate","has-value":!!s.market},{default:h(()=>{var t;return[i(_,{type:"percentage",value:100*(((t=s.market)==null?void 0:t.rate)??0)},null,8,["value"])]}),_:1},8,["has-value"]),i(n,{style:{"grid-area":"kpi2"},label:"Borrowed","has-value":!!s.market},{default:h(()=>{var t;return[i(_,{type:"dollar",value:(t=s.market)==null?void 0:t.borrowed},null,8,["value"])]}),_:1},8,["has-value"]),i(n,{style:{"grid-area":"kpi3"},label:"Borrowable","has-value":!!s.market},{default:h(()=>{var t;return[i(_,{type:"dollar",value:(t=s.market)==null?void 0:t.borrowable},null,8,["value"])]}),_:1},8,["has-value"]),i(n,{style:{"grid-area":"kpi4"},label:"Loans","has-value":!!s.market},{default:h(()=>{var t;return[x(q(((t=s.market)==null?void 0:t.loans)??0),1)]}),_:1},8,["has-value"]),i(e(Me),{style:{"grid-area":"rates"},market:s.market},null,8,["market"]),i(e(Be),{style:{"grid-area":"cap"},market:s.market},null,8,["market"]),i(e(We),{style:{"grid-area":"loans"},market:s.market},null,8,["market"]),i(e(Ne),{style:{"grid-area":"volume"},market:s.market,chain:s.chain},null,8,["market","chain"]),i(e(Je),{style:{"grid-area":"properties"},market:s.market,chain:s.chain},null,8,["market","chain"]),i(e(He),{style:{"grid-area":"addresses"},market:s.market,chain:s.chain},null,8,["market","chain"])])}}}),xe=V(Ze,[["__scopeId","data-v-efc50c6b"]]),ea={class:"dashboard-grid"},aa=T({__name:"Liquidations",props:{market:{},chain:{}},setup(l){const s=k(()=>{var $;return($=l.market)==null?void 0:$.address}),{isFetching:p,data:_}=le(w("crvusd"),b(()=>l.chain),s),{isFetching:n,data:t}=M(b(()=>l.market)),r=k(()=>t.value.map(({timestamp:$,priceOracle:A})=>({timestamp:$,priceOracle:A}))),o=k(()=>t.value.map(({timestamp:$,discountLiquidation:A})=>({timestamp:$,discount:A}))),a=k(()=>t.value.map(({timestamp:$,totalCollateralUsd:A,totalDebt:G})=>({timestamp:$,ratio:A/G}))),{isFetching:c,data:u}=ce(w("crvusd"),b(()=>l.chain),s),{isFetching:m,data:f}=de(w("crvusd"),b(()=>l.chain),s),{isFetching:d,data:C}=ue(w("crvusd"),b(()=>l.chain),s),{isFetching:S,data:L}=me(w("crvusd"),b(()=>l.chain),s),{isFetching:E,data:O}=pe(w("crvusd"),b(()=>l.chain),s);return($,A)=>(v(),F("div",ea,[i(e(_e),{overview:e(_),loading:e(p)},null,8,["overview","loading"]),i(e(he),{ratios:e(u),"prices-oracle":e(r),loading:e(c)||e(n)},null,8,["ratios","prices-oracle","loading"]),i(e(ve),{losses:e(O),loading:e(E)},null,8,["losses","loading"]),i(e(ge),{losses:e(O),loading:e(E)},null,8,["losses","loading"]),i(e(fe),{deciles:e(L),loading:e(S)},null,8,["deciles","loading"]),i(e(ke),{ratios:e(a),loading:e(n)},null,8,["ratios","loading"]),i(e(be),{liqs:e(f),loading:e(m)},null,8,["liqs","loading"]),i(e(ye),{liqs:e(C),loading:e(d)},null,8,["liqs","loading"]),i(e(Ce),{discounts:e(o),liqs:e(C),loading:e(n)||e(d)},null,8,["discounts","liqs","loading"])]))}}),ta=V(aa,[["__scopeId","data-v-630382c1"]]),sa={class:"dashboard-grid"},na=T({__name:"Trading",props:{market:{},chain:{}},setup(l){const s=k(()=>{var u;return(u=l.market)==null?void 0:u.llamma}),{isFetching:p,data:_}=K("crvusd",s,b(()=>l.chain)),n=w(1),{isFetching:t,data:r}=$e("crvusd",s,b(()=>l.chain),n),o=w(1),{isFetching:a,data:c}=Te("crvusd",s,b(()=>l.chain),o);return(u,m)=>{var f,d,C,S;return v(),F("div",sa,[i(e(we),{style:{"grid-area":"ohlc"},ohlc:e(_)??[],loading:e(p)},null,8,["ohlc","loading"]),i(e(Le),{style:{"grid-area":"trades"},trades:((f=e(r))==null?void 0:f.trades)??[],count:((d=e(r))==null?void 0:d.count)??0,chain:u.chain,loading:e(t),onPage:m[0]||(m[0]=L=>n.value=L)},null,8,["trades","count","chain","loading"]),i(e(qe),{style:{"grid-area":"events"},events:((C=e(c))==null?void 0:C.events)??[],count:((S=e(c))==null?void 0:S.count)??0,loading:e(a),onPage:m[1]||(m[1]=L=>o.value=L)},null,8,["events","count","loading"])])}}}),oa=V(na,[["__scopeId","data-v-3b5dcdb4"]]),ia={class:"dashboard"},ra=T({__name:"Market.page",setup(l){const s=Ae("marketAddr"),{isFetching:p,data:_}=ne(),n=k(()=>_.value.find(a=>a.address===s.value)),{crumbs:t}=ee(ae());te(n,a=>{t.value=[{id:"crvusd",label:"crvUSD",pathName:"crvusd"},{id:"market",label:`Market: ${(a==null?void 0:a.name)??"?"}`}]},{immediate:!0});const{tabActive:r,tabActiveIndex:o}=Fe(["overview","trading","liquidations"],"crvusdmarket",()=>({marketAddr:s.value}));return(a,c)=>{const u=se,m=J,f=X;return v(),F("div",ia,[i(u,{loading:e(p)},null,8,["loading"]),!e(p)&&e(n)?(v(),y(f,{key:0,active:e(o),onTab:c[0]||(c[0]=d=>o.value=d.index)},{default:h(()=>[i(m,{header:"Overview"},{default:h(()=>[(v(),y(P,null,[e(r)==="overview"?(v(),y(xe,{key:0,chain:"ethereum",market:e(n)},null,8,["market"])):B("",!0)],1024))]),_:1}),i(m,{header:"Trading"},{default:h(()=>[(v(),y(P,null,[e(r)==="trading"?(v(),y(oa,{key:0,chain:"ethereum",market:e(n)},null,8,["market"])):B("",!0)],1024))]),_:1}),i(m,{header:"Liquidations"},{default:h(()=>[(v(),y(P,null,[e(r)==="liquidations"?(v(),y(ta,{key:0,chain:"ethereum",market:e(n)},null,8,["market"])):B("",!0)],1024))]),_:1})]),_:1},8,["active"])):B("",!0)])}}}),Oa=V(ra,[["__scopeId","data-v-238e7ead"]]);export{Oa as default};
