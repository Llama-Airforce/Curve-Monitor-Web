var N=e=>{throw TypeError(e)};var S=(e,t,s)=>t.has(e)||N("Cannot "+s);var n=(e,t,s)=>(S(e,t,"read from private field"),s?s.call(e):t.get(e)),d=(e,t,s)=>t.has(e)?N("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,s),l=(e,t,s,a)=>(S(e,t,"write to private field"),a?a.call(e,s):t.set(e,s),s),f=(e,t,s)=>(S(e,t,"access private method"),s);import{f as L}from"./fetch-bVCl_krR.js";import{t as z,f as E,g as Q,a as j}from"./timestamp-CoE2HNXc.js";import{Q as G,u as D}from"./useQuery-7yGPp_5J.js";import{ab as Y,ac as U,ad as B,ae as X,f as b,u as x,af as ee,ag as te,N as V,ah as se,ai as ae,aj as re,a9 as ie}from"./index-CB5ZtNTk.js";import{u as ne}from"./UseHost-Bh0sXYu9.js";function A(e,t){return e.filter(s=>!t.includes(s))}function oe(e,t,s){const a=e.slice(0);return a[t]=s,a}var _,p,g,q,h,m,w,O,$,u,T,k,C,K,M,H,ue=(H=class extends Y{constructor(t,s,a){super();d(this,u);d(this,_);d(this,p);d(this,g);d(this,q);d(this,h);d(this,m);d(this,w);d(this,O);d(this,$,[]);l(this,_,t),l(this,q,a),l(this,g,[]),l(this,h,[]),l(this,p,[]),this.setQueries(s)}onSubscribe(){this.listeners.size===1&&n(this,h).forEach(t=>{t.subscribe(s=>{f(this,u,K).call(this,t,s)})})}onUnsubscribe(){this.listeners.size||this.destroy()}destroy(){this.listeners=new Set,n(this,h).forEach(t=>{t.destroy()})}setQueries(t,s){l(this,g,t),l(this,q,s),U.batch(()=>{const a=n(this,h),i=f(this,u,C).call(this,n(this,g));l(this,$,i),i.forEach(o=>o.observer.setOptions(o.defaultedQueryOptions));const r=i.map(o=>o.observer),c=r.map(o=>o.getCurrentResult()),v=r.some((o,y)=>o!==a[y]);a.length===r.length&&!v||(l(this,h,r),l(this,p,c),this.hasListeners()&&(A(a,r).forEach(o=>{o.destroy()}),A(r,a).forEach(o=>{o.subscribe(y=>{f(this,u,K).call(this,o,y)})}),f(this,u,M).call(this)))})}getCurrentResult(){return n(this,p)}getQueries(){return n(this,h).map(t=>t.getCurrentQuery())}getObservers(){return n(this,h)}getOptimisticResult(t,s){const a=f(this,u,C).call(this,t),i=a.map(r=>r.observer.getOptimisticResult(r.defaultedQueryOptions));return[i,r=>f(this,u,k).call(this,r??i,s),()=>f(this,u,T).call(this,i,a)]}},_=new WeakMap,p=new WeakMap,g=new WeakMap,q=new WeakMap,h=new WeakMap,m=new WeakMap,w=new WeakMap,O=new WeakMap,$=new WeakMap,u=new WeakSet,T=function(t,s){return s.map((a,i)=>{const r=t[i];return a.defaultedQueryOptions.notifyOnChangeProps?r:a.observer.trackResult(r,c=>{s.forEach(v=>{v.observer.trackProp(c)})})})},k=function(t,s){return s?((!n(this,m)||n(this,p)!==n(this,O)||s!==n(this,w))&&(l(this,w,s),l(this,O,n(this,p)),l(this,m,B(n(this,m),s(t)))),n(this,m)):t},C=function(t){const s=new Map(n(this,h).map(i=>[i.options.queryHash,i])),a=[];return t.forEach(i=>{const r=n(this,_).defaultQueryOptions(i),c=s.get(r.queryHash);c?a.push({defaultedQueryOptions:r,observer:c}):a.push({defaultedQueryOptions:r,observer:new G(n(this,_),r)})}),a},K=function(t,s){const a=n(this,h).indexOf(t);a!==-1&&(l(this,p,oe(n(this,p),a,s)),f(this,u,M).call(this))},M=function(){var t;if(this.hasListeners()){const s=n(this,m),a=f(this,u,T).call(this,n(this,p),n(this,$)),i=f(this,u,k).call(this,a,(t=n(this,q))==null?void 0:t.combine);s!==i&&U.batch(()=>{this.listeners.forEach(r=>{r(n(this,p))})})}},H);function le({queries:e,...t},s){const a=X(),i=b(()=>x(e).map(F=>{const R=ee(F);typeof R.enabled=="function"&&(R.enabled=F.enabled());const P=a.defaultQueryOptions(R);return P._optimisticResults=a.isRestoring.value?"isRestoring":"optimistic",P})),r=new ue(a,i.value,t),c=()=>{const[y,F]=r.getOptimisticResult(i.value,t.combine);return F(y.map((R,P)=>({...R,refetch:async(...Z)=>{const[{[P]:J}]=r.getOptimisticResult(i.value,t.combine);return J.refetch(...Z)}})))},v=te(c());let o=()=>{};return V(a.isRestoring,y=>{y||(o(),o=r.subscribe(()=>{v.value=c()}),v.value=c())},{immediate:!0}),V(i,y=>{r.setQueries(y,t),v.value=c()}),se(()=>{o()}),t.shallow?ae(v):re(v)}const ce=e=>({tvl:e.total_tvl,tradingVolume24h:e.trading_volume_24h,tradingFee24h:e.trading_fee_24h,liquidityVolume24h:e.liquidity_volume_24h,liquidityFee24h:e.liquidity_fee_24h}),I=e=>{var t,s;return{name:e.name,address:e.address,numCoins:e.n_coins,tvlUsd:e.tvl_usd,tradingVolume24h:e.trading_volume_24h,tradingFee24h:e.trading_fee_24h,liquidityVolume24h:e.liquidity_volume_24h,liquidityFee24h:e.liquidity_fee_24h,coins:((t=e.coins)==null?void 0:t.map(a=>({poolIndex:a.pool_index,symbol:a.symbol,address:a.address})))??[],baseDailyApr:e.base_daily_apr,baseWeeklyApr:e.base_weekly_apr,virtualPrice:e.virtual_price,poolMethods:((s=e.pool_methods)==null?void 0:s.map(a=>a))??[]}},pe=e=>({timestamp:z(e.timestamp),volume:e.volume,fees:e.fees}),he=e=>({timestamp:z(e.timestamp),tvlUSD:e.tvl_usd??0,balances:[...e.balances],tokenPrices:[...e.token_prices]});async function de(e,t=1,s=9999,a){const i=Q(a),r=await E(`${i}/v1/chains/${e}?page=${t}&per_page=${s}`);return{chain:r.chain,totals:ce(r.total),pools:r.data.map(I)}}async function W(e,t,s){const a=Q(s),i=await E(`${a}/v1/pools/${e}/${t}`);return I(i)}async function fe(e,t,s){const a=Q(s),{start:i,end:r}=j({daysRange:90});return(await E(`${a}/v1/volume/usd/${e}/${t}?interval=day&start=${i}&end=${r}`)).data.map(pe)}async function ye(e,t,s){const a=Q(s),{start:i,end:r}=j({daysRange:90});return(await E(`${a}/v1/snapshots/${e}/${t}/tvl?interval=day&start=${i}&end=${r}`)).data.map(he)}const ve=/[+-]\d{2}:?\d{2}$/;function me(e){if(typeof e=="number")return new Date(e*1e3);const t=Number(e);if(!Number.isNaN(t))return new Date(t*1e3);const a=e.endsWith("Z")||ve.test(e)?e:`${e}Z`;return new Date(a)}const be=24*60*60;function _e({end:e,start:t,daysRange:s=10}={}){return e??(e=Math.floor(Date.now()/1e3)),t??(t=e-s*be),{end:e,start:t}}function Fe(e){return D({queryKey:["curve-pools",e],queryFn:async({queryKey:[,t]})=>{const s=await ne();return de(t,1,9999,{host:s})},placeholderData:ie,enabled:b(()=>!!e.value)})}function Pe(e,t){return D({queryKey:["curve-pool",t],queryFn:async({queryKey:[,s]})=>W(e.value,s),enabled:b(()=>!!e.value)})}function Ee(e,t){const s=b(()=>t.value.map(a=>({queryKey:["curve-pool",a],queryFn:()=>W(e.value,a),enabled:b(()=>!!e.value)})));return le({queries:s})}function Se(e,t){return D({queryKey:["curve-pool-volume",t],queryFn:async({queryKey:[,s]})=>fe(e.value,s),enabled:b(()=>!!e.value&&!!t.value),initialData:[],initialDataUpdatedAt:0})}function Te(e,t){return D({queryKey:["curve-pool-tvl",t],queryFn:async({queryKey:[,s]})=>ye(e.value,s),enabled:b(()=>!!e.value&&!!t.value),initialData:[],initialDataUpdatedAt:0})}const ge=e=>({timestamp:me(e.timestamp),a:e.a,fee:e.fee,adminFee:e.admin_fee,virtualPrice:e.virtual_price,xcpProfit:e.xcp_profit??void 0,xcpProfitA:e.xcp_profit_a??void 0,baseDailyApr:e.base_daily_apr,baseWeeklyApr:e.base_weekly_apr,offpegFeeMultiplier:e.offpeg_fee_multiplier??void 0,gamma:e.gamma??void 0,midFee:e.mid_fee??void 0,outFee:e.out_fee??void 0,feeGamma:e.fee_gamma??void 0,allowedExtraProfit:e.allowed_extra_profit??void 0,adjustmentStep:e.adjustment_step??void 0,maHalfTime:e.ma_half_time??void 0,priceScale:[...e.price_scale??[]],priceOracle:[...e.price_oracle??[]]});async function qe(e,t,s){const a=Q(s),{start:i,end:r}=_e({daysRange:90});return(await L(`${a}/v1/snapshots/${e}/${t}?start=${i}&end=${r}`)).data.map(ge)}function ke(e,t){return D({queryKey:["curve-pool-snapshots",t],queryFn:async({queryKey:[,s]})=>qe(e.value,s),enabled:b(()=>!!e.value&&!!t.value),initialData:[],initialDataUpdatedAt:0})}export{Se as a,Te as b,ke as c,Pe as d,Ee as e,Fe as u};
