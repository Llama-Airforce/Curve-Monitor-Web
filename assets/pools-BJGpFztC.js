import{f as q}from"./fetch-bVCl_krR.js";import{t as w,f as v,g as p,a as F}from"./timestamp-DkvXAN4c.js";import{Q as P,u as d}from"./useQuery-GHjouMSi.js";import{ab as S,ac as b,ad as E,ae as T,f as u,u as m,af as k,ag as C,N as _,ah as K,ai as M,aj as V,a9 as N}from"./index-CXYbPx9b.js";import{u as U}from"./UseHost-weJ1M0IQ.js";function g(e,t){const s=new Set(t);return e.filter(a=>!s.has(a))}function A(e,t,s){const a=e.slice(0);return a[t]=s,a}var H=class extends S{#a;#e;#r;#i;#t;#s;#n;#o;#u=[];constructor(e,t,s){super(),this.#a=e,this.#i=s,this.#r=[],this.#t=[],this.#e=[],this.setQueries(t)}onSubscribe(){this.listeners.size===1&&this.#t.forEach(e=>{e.subscribe(t=>{this.#p(e,t)})})}onUnsubscribe(){this.listeners.size||this.destroy()}destroy(){this.listeners=new Set,this.#t.forEach(e=>{e.destroy()})}setQueries(e,t){this.#r=e,this.#i=t,b.batch(()=>{const s=this.#t,a=this.#h(this.#r);this.#u=a,a.forEach(n=>n.observer.setOptions(n.defaultedQueryOptions));const r=a.map(n=>n.observer),i=r.map(n=>n.getCurrentResult()),o=r.some((n,l)=>n!==s[l]);s.length===r.length&&!o||(this.#t=r,this.#e=i,this.hasListeners()&&(g(s,r).forEach(n=>{n.destroy()}),g(r,s).forEach(n=>{n.subscribe(l=>{this.#p(n,l)})}),this.#d()))})}getCurrentResult(){return this.#e}getQueries(){return this.#t.map(e=>e.getCurrentQuery())}getObservers(){return this.#t}getOptimisticResult(e,t){const s=this.#h(e),a=s.map(r=>r.observer.getOptimisticResult(r.defaultedQueryOptions));return[a,r=>this.#c(r??a,t),()=>this.#l(a,s)]}#l(e,t){return t.map((s,a)=>{const r=e[a];return s.defaultedQueryOptions.notifyOnChangeProps?r:s.observer.trackResult(r,i=>{t.forEach(o=>{o.observer.trackProp(i)})})})}#c(e,t){return t?((!this.#s||this.#e!==this.#o||t!==this.#n)&&(this.#n=t,this.#o=this.#e,this.#s=E(this.#s,t(e))),this.#s):e}#h(e){const t=new Map(this.#t.map(a=>[a.options.queryHash,a])),s=[];return e.forEach(a=>{const r=this.#a.defaultQueryOptions(a),i=t.get(r.queryHash);i?s.push({defaultedQueryOptions:r,observer:i}):s.push({defaultedQueryOptions:r,observer:new P(this.#a,r)})}),s}#p(e,t){const s=this.#t.indexOf(e);s!==-1&&(this.#e=A(this.#e,s,t),this.#d())}#d(){if(this.hasListeners()){const e=this.#s,t=this.#l(this.#e,this.#u),s=this.#c(t,this.#i?.combine);e!==s&&b.batch(()=>{this.listeners.forEach(a=>{a(this.#e)})})}}};function z({queries:e,...t},s){const a=T(),r=u(()=>m(e).map(f=>{const h=k(f);typeof h.enabled=="function"&&(h.enabled=f.enabled());const y=a.defaultQueryOptions(h);return y._optimisticResults=a.isRestoring?.value?"isRestoring":"optimistic",y})),i=new H(a,r.value,t),o=()=>{const[c,f]=i.getOptimisticResult(r.value,t.combine);return f(c.map((h,y)=>({...h,refetch:async(...Q)=>{const[{[y]:D}]=i.getOptimisticResult(r.value,t.combine);return D.refetch(...Q)}})))},n=C(o());let l=()=>{};return a.isRestoring&&_(a.isRestoring,c=>{c||(l(),l=i.subscribe(()=>{n.value=o()}),n.value=o())},{immediate:!0}),_(r,c=>{i.setQueries(c,t),n.value=o()}),K(()=>{l()}),t.shallow?M(n):V(n)}const j=e=>({tvl:e.total_tvl,tradingVolume24h:e.trading_volume_24h,tradingFee24h:e.trading_fee_24h,liquidityVolume24h:e.liquidity_volume_24h,liquidityFee24h:e.liquidity_fee_24h}),R=e=>({name:e.name,address:e.address,numCoins:e.n_coins,tvlUsd:e.tvl_usd,tradingVolume24h:e.trading_volume_24h,tradingFee24h:e.trading_fee_24h,liquidityVolume24h:e.liquidity_volume_24h,liquidityFee24h:e.liquidity_fee_24h,coins:e.coins?.map(t=>({poolIndex:t.pool_index,symbol:t.symbol,address:t.address}))??[],baseDailyApr:e.base_daily_apr,baseWeeklyApr:e.base_weekly_apr,virtualPrice:e.virtual_price,poolMethods:e.pool_methods?.map(t=>t)??[]}),I=e=>({timestamp:w(e.timestamp),volume:e.volume,fees:e.fees}),W=e=>({timestamp:w(e.timestamp),tvlUSD:e.tvl_usd??0,balances:[...e.balances],tokenPrices:[...e.token_prices]});async function Z(e,t=1,s=9999,a){const r=p(a),i=await v(`${r}/v1/chains/${e}?page=${t}&per_page=${s}`);return{chain:i.chain,totals:j(i.total),pools:i.data.map(R)}}async function O(e,t,s){const a=p(s),r=await v(`${a}/v1/pools/${e}/${t}`);return R(r)}async function J(e,t,s){const a=p(s),{start:r,end:i}=F({daysRange:90});return(await v(`${a}/v1/snapshots/${e}/${t}/tvl?interval=day&start=${r}&end=${i}`)).data.map(W)}const L=/[+-]\d{2}:?\d{2}$/;function G(e){if(typeof e=="number")return new Date(e*1e3);const t=Number(e);if(!Number.isNaN(t))return new Date(t*1e3);const a=e.endsWith("Z")||L.test(e)?e:`${e}Z`;return new Date(a)}const Y=24*60*60;function $({end:e,start:t,daysRange:s=10}={}){return e??=Math.floor(Date.now()/1e3),t??=e-s*Y,{end:e,start:t}}function ie(e){return d({queryKey:["curve-pools",e],queryFn:async({queryKey:[,t]})=>{const s=await U();return Z(t,1,9999,{host:s})},placeholderData:N,enabled:u(()=>!!e.value)})}function ne(e,t){return d({queryKey:["curve-pool",t],queryFn:async({queryKey:[,s]})=>O(e.value,s),enabled:u(()=>!!e.value)})}function oe(e,t){const s=u(()=>t.value.map(a=>({queryKey:["curve-pool",a],queryFn:()=>O(e.value,a),enabled:u(()=>!!e.value)})));return z({queries:s})}async function B(e,t,s,a){const r=p(a),{start:i,end:o}=$({daysRange:s});return(await q(`${r}/v1/volume/usd/${e}/${t}?interval=day&start=${i}&end=${o}`)).data.map(I)}function ue(e,t,s=90){const a=u(()=>m(s));return d({queryKey:["curve-pool-volume",t,a],queryFn:async({queryKey:[,r]})=>B(e.value,r,a.value),enabled:u(()=>!!e.value&&!!t.value),initialData:[],initialDataUpdatedAt:0})}function le(e,t){return d({queryKey:["curve-pool-tvl",t],queryFn:async({queryKey:[,s]})=>J(e.value,s),enabled:u(()=>!!e.value&&!!t.value),initialData:[],initialDataUpdatedAt:0})}const X=e=>({timestamp:G(e.timestamp),a:e.a,fee:e.fee,adminFee:e.admin_fee,virtualPrice:e.virtual_price,xcpProfit:e.xcp_profit??void 0,xcpProfitA:e.xcp_profit_a??void 0,baseDailyApr:e.base_daily_apr,baseWeeklyApr:e.base_weekly_apr,offpegFeeMultiplier:e.offpeg_fee_multiplier??void 0,gamma:e.gamma??void 0,midFee:e.mid_fee??void 0,outFee:e.out_fee??void 0,feeGamma:e.fee_gamma??void 0,allowedExtraProfit:e.allowed_extra_profit??void 0,adjustmentStep:e.adjustment_step??void 0,maHalfTime:e.ma_half_time??void 0,priceScale:[...e.price_scale??[]],priceOracle:[...e.price_oracle??[]]});async function x(e,t,s,a){const r=p(a),{start:i,end:o}=$({daysRange:s});return(await q(`${r}/v1/snapshots/${e}/${t}?unit=day&start=${i}&end=${o}`)).data.map(X)}function ce(e,t,s=90){const a=u(()=>m(s));return d({queryKey:["curve-pool-snapshots",t,a],queryFn:async({queryKey:[,r]})=>x(e.value,r,a.value),enabled:u(()=>!!e.value&&!!t.value),initialData:[],initialDataUpdatedAt:0})}export{ue as a,ce as b,le as c,ne as d,oe as e,ie as u};
