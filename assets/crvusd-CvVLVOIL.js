import{g as _}from"./api-Bfvlvlrj.js";import{t as d,f as c,g as u}from"./timestamp-C4C6eGnP.js";import{u as n}from"./useQuery-bzXZhUsG.js";import{c as o}from"./index-jdaCXud5.js";const v=e=>({name:e.collateral_token.symbol,address:e.address,factory:e.factory_address,llamma:e.llamma,rate:e.rate,borrowed:e.total_debt,borrowable:e.borrowable,collateral:e.collateral_amount,collateralUsd:e.collateral_amount_usd,debtCeiling:e.debt_ceiling,loans:e.n_loans,tokenCollateral:{symbol:e.collateral_token.symbol,address:e.collateral_token.address},tokenStablecoin:{symbol:e.stablecoin_token.symbol,address:e.stablecoin_token.address},fees:{pending:e.pending_fees,collected:e.collected_fees}}),y=e=>({timestamp:d(e.dt),rate:e.rate,nLoans:e.n_loans,minted:e.minted,redeemed:e.redeemed,totalCollateral:e.total_collateral,totalCollateralUsd:e.total_collateral_usd,totalStablecoin:e.total_stablecoin,totalDebt:e.total_debt,priceAMM:e.amm_price,priceOracle:e.price_oracle,borrowable:e.borrowable,discountLiquidation:e.liquidation_discount,discountLoan:e.loan_discount}),b=e=>({address:e.address,pool:e.pool,poolAddress:e.pool_address,pair:e.pair.map(t=>({symbol:t.symbol,address:t.address})),active:e.active,totalDebt:e.total_debt,totalProfit:e.total_profit}),h=e=>({timestamp:d(e.timestamp),market:e.market,supply:e.supply,borrowable:e.borrowable}),f=e=>e.markets.map(t=>({collateral:t.collateral,controller:t.controller,snapshotFirst:d(t.first_snapshot),snapshotLast:d(t.last_snapshot)})),g=e=>({health:e.health,healthFull:e.health_full,n:e.n,n1:e.n1,n2:e.n2,debt:e.debt,collateral:e.collateral,collateralUp:e.collateral_up,stablecoin:e.stablecoin,softLiquidation:e.soft_liquidation,totalDeposited:e.total_deposited,loss:e.loss,lossPct:e.loss_pct,oraclePrice:e.oracle_price,blockNumber:e.block_number,timestamp:d(e.timestamp)}),q=e=>e.data.map(g),k=e=>({controller:e.controller,user:e.user,totalDeposit:e.total_deposit,totalDepositPrecise:e.total_deposit_precise,totalDepositUsd:e.total_deposit_usd_value,totalBorrowed:e.total_borrowed,totalBorrowedPrecise:e.total_borrowed_precise,events:e.data.map(t=>({timestamp:d(t.dt),txHash:t.transaction_hash,type:t.type,user:t.user,collateralChange:t.collateral_change,collateralChangeUsd:t.collateral_change_usd??void 0,loanChange:t.loan_change,loanChangeUsd:t.loan_change_usd??void 0,liquidation:t.liquidation===null?void 0:{user:t.liquidation.user,liquidator:t.liquidation.liquidator,collateralReceived:t.liquidation.collateral_received,collateralReceivedUsd:t.liquidation.collateral_received_usd,stablecoinReceived:t.liquidation.stablecoin_received,debt:t.liquidation.debt},n1:t.n1,n2:t.n2,oraclePrice:t.oracle_price}))});async function U(e,t,a){const s=u(a);return(await c(`${s}/v1/crvusd/markets/${e}?fetch_on_chain=true&page=${t}&per_page=10`)).data.map(v)}async function w(e,t,a){const s=u(a);return(await c(`${s}/v1/crvusd/markets/${e}/${t}/snapshots?fetch_on_chain=true&agg=day`)).data.map(y)}async function $(e,t){const a=u(t);return(await c(`${a}/v1/crvusd/markets/${e}/supply`)).data.map(h)}async function K(e,t){const a=u(t);return(await c(`${a}/v1/crvusd/pegkeepers/${e}`)).keepers.map(b)}async function C(e,t,a){const s=u(a),r=await c(`${s}/v1/crvusd/users/${t}/${e}?page=1&per_page=100`);return f(r)}async function M(e,t,a,s){const r=u(s),l=await c(`${r}/v1/crvusd/users/${t}/${e}/${a}/snapshots?page=1&per_page=100`);return q(l)}async function S(e,t,a,s){const r=u(s),l=await c(`${r}/v1/crvusd/collateral_events/${t}/${a}/${e}`);return k(l)}function p(){return{initialData:[],initialDataUpdatedAt:0}}function L(){return n({queryKey:["crvusd-supply"],queryFn:()=>$("ethereum"),...p()})}function E(e){return n({queryKey:["crvusd-market-snapshots",o(()=>{var t;return(t=e.value)==null?void 0:t.address})],queryFn:({queryKey:[,t]})=>w("ethereum",t),enabled:o(()=>!!e.value),...p()})}function R(e){return n({queryKey:["crvusd-keepers-prices",o(()=>[...new Set(e.value.map(t=>t.poolAddress))])],queryFn:async()=>{const t=e.value.map(async r=>{const l=r.pair.find(i=>i.symbol!=="crvUSD"),m=r.pair.find(i=>i.symbol==="crvUSD");return!l||!m?[]:(await _("ethereum",r.poolAddress,l.address,m.address)).map(i=>({time:i.time,price:(i.high+i.low)/2,coin:l.symbol}))}),s=(await Promise.all(t)).flat().groupBy(r=>r.time.getTime()).entries().map(([r,l])=>({timestamp:Number(r)/1e3,...Object.fromEntries(l.map(m=>[m.coin,m.price]))}));return s.length>0?s:[{timestamp:0}]},initialData:[{timestamp:0}],initialDataUpdatedAt:0})}function B(){return n({queryKey:["crvusd-markets"],queryFn:()=>U("ethereum",1),...p()})}function H(){return n({queryKey:["crvusd-keepers"],queryFn:()=>K("ethereum"),...p()})}function O(e,t){return n({queryKey:["crvusd-user-markets",o(()=>e.value),o(()=>t.value)],queryFn:({queryKey:[,a,s]})=>C(a,s),enabled:o(()=>!!e.value&&!!t.value),...p()})}function N(e,t,a){return n({queryKey:["crvusd-user-market-snapshots",o(()=>e.value),o(()=>t.value),o(()=>a.value)],queryFn:({queryKey:[,s,r,l]})=>M(s,r,l),enabled:o(()=>!!e.value&&!!t.value&&!!a.value),...p()})}function T(e,t,a){return n({queryKey:["crvusd-user-market-events",o(()=>e.value),o(()=>t.value),o(()=>a.value)],queryFn:({queryKey:[,s,r,l]})=>S(s,r,l),enabled:o(()=>!!e.value&&!!t.value&&!!a.value)})}export{T as a,N as b,O as c,H as d,L as e,R as f,E as g,B as u};
