import{f as m,a as b,t as p}from"./timestamp-X9wFVw8g.js";import{t as i,f as u,g as n,b as _}from"./timestamp-DkvXAN4c.js";import{u as d}from"./useQuery-DI0f2pKh.js";import{f as r}from"./index-_TFeqcMs.js";const v=e=>({name:e.name,controller:e.controller,vault:e.vault,llamma:e.llamma,policy:e.policy,oracle:e.oracle,oraclePools:e.oracle_pools,rate:e.rate,apyBorrow:e.borrow_apy,apyLend:e.lend_apy,nLoans:e.n_loans,priceOracle:e.price_oracle,ammPrice:e.amm_price,basePrice:e.base_price,totalDebt:e.total_debt,totalAssets:e.total_assets,totalDebtUsd:e.total_debt_usd,totalAssetsUsd:e.total_assets_usd,minted:e.minted,redeemed:e.redeemed,mintedUsd:e.minted_usd,redeemedUsd:e.redeemed_usd,loanDiscount:e.loan_discount,liquidationDiscount:e.liquidation_discount,minBand:e.min_band,maxBand:e.max_band,collateralBalance:e.collateral_balance,borrowedBalance:e.borrowed_balance,collateralBalanceUsd:e.collateral_balance_usd,borrowedBalanceUsd:e.borrowed_balance_usd,collateralToken:{symbol:e.collateral_token.symbol,address:e.collateral_token.address},borrowedToken:{symbol:e.borrowed_token.symbol,address:e.borrowed_token.address},leverage:e.leverage}),h=e=>({rate:parseFloat(e.rate),borrowApy:parseFloat(e.borrow_apy)/100,lendApy:parseFloat(e.lend_apy)/100,numLoans:e.n_loans,priceOracle:parseFloat(e.price_oracle),ammPrice:parseFloat(e.amm_price),totalDebt:parseFloat(e.total_debt),totalDebtUsd:parseFloat(e.total_debt_usd),totalAssets:parseFloat(e.total_assets),totalAssetsUsd:parseFloat(e.total_assets_usd),minted:parseFloat(e.minted),redeemed:parseFloat(e.redeemed),collateralBalance:parseFloat(e.collateral_balance),collateralBalanceUsd:parseFloat(e.collateral_balance_usd),borrowedBalance:parseFloat(e.borrowed_balance),borrowedBalanceUsd:parseFloat(e.borrowed_balance_usd),timestamp:i(e.timestamp),discountLiquidation:e.liquidation_discount,discountLoan:e.loan_discount}),g=e=>e.markets.map(a=>({name:a.market_name,controller:a.controller,snapshotFirst:i(a.first_snapshot),snapshotLast:i(a.last_snapshot)})),f=e=>({health:e.health,healthFull:e.health_full,n:e.n,n1:e.n1,n2:e.n2,debt:e.debt,collateral:e.collateral,collateralUp:e.collateral_up,borrowed:e.borrowed,softLiquidation:e.soft_liquidation,totalDeposited:e.total_deposited,loss:e.loss,lossPct:e.loss_pct,oraclePrice:e.oracle_price,blockNumber:e.block_number,timestamp:i(e.timestamp)}),q=e=>e.data.map(f),y=e=>({controller:e.controller,user:e.user,totalDeposit:e.total_deposit,totalDepositUsd:e.total_deposit_usd_value,totalDepositFromUser:e.total_deposit_from_user,totalDepositFromUserPrecise:e.total_deposit_from_user_precise,totalDepositPrecise:e.total_deposit_precise,totalBorrowed:e.total_borrowed,totalBorrowedPrecise:e.total_borrowed_precise,events:e.data.map(a=>({timestamp:i(a.dt),txHash:a.transaction_hash,type:a.type,user:a.user,collateralChange:a.collateral_change,collateralChangeUsd:a.collateral_change_usd??void 0,loanChange:a.loan_change,loanChangeUsd:a.loan_change_usd??void 0,liquidation:a.liquidation===null?void 0:{user:a.liquidation.user,liquidator:a.liquidation.liquidator,collateralReceived:a.liquidation.collateral_received,collateralReceivedUsd:a.liquidation.collateral_received_usd,stablecoinReceived:a.liquidation.stablecoin_received,stablecoinReceivedUsd:a.liquidation.stablecoin_received_usd,debt:a.liquidation.debt,debtUsd:a.liquidation.debt_usd},leverage:a.leverage===null?void 0:{type:a.leverage.event_type,user:a.leverage.user,userCollateral:a.leverage.user_collateral,userCollateralFromBorrowed:a.leverage.user_collateral_from_borrowed,userCollateralUsed:a.leverage.user_collateral_used,userBorrowed:a.leverage.user_borrowed,debt:a.leverage.debt,leverageCollateral:a.leverage.leverage_collateral,stateCollateralUsed:a.leverage.state_collateral_used,borrowedFromStateCollateral:a.leverage.borrowed_from_state_collateral,borrowedFromUserCollateral:a.leverage.borrowed_from_user_collateral},n1:a.n1,n2:a.n2,oraclePrice:a.oracle_price}))});async function w(e){const a=n(e);return u(`${a}/v1/lending/chains`).then(t=>t.data)}async function U(e,a={fetch_on_chain:!0},t){const l=n(t);return(await u(`${l}/v1/lending/markets/${e}${_(a)}`)).data.map(v)}async function F(e,a,t={fetch_on_chain:!0,agg:"day"},l){const o=n(l);return(await u(`${o}/v1/lending/markets/${e}/${a}/snapshots${_(t)}`)).data.map(h)}async function k(e,a,t){const l=n(t),o=await u(`${l}/v1/lending/users/${a}/${e}?page=1&per_page=100&include_closed=false`);return g(o)}async function $(e,a,t,l){const o=n(l),s=await u(`${o}/v1/lending/users/${a}/${e}/${t}/snapshots?page=1&per_page=100`);return q(s)}async function D(e,a,t,l){const o=n(l),s=await u(`${o}/v1/lending/collateral_events/${a}/${t}/${e}`);return y(s)}function c(){return{initialData:[],initialDataUpdatedAt:0}}function Q(){return d({queryKey:["llamalend-chains"],queryFn:()=>w(),initialData:["ethereum","arbitrum"],initialDataUpdatedAt:0})}function S(e){return d({queryKey:["llamalend-markets",e],queryFn:({queryKey:[,a]})=>U(a)})}function L(e,a){return d({queryKey:["llamalend-market-snapshots",r(()=>e.value?.controller)],queryFn:({queryKey:[,t]})=>F(a.value,t),...c(),enabled:r(()=>!!e.value&&!!a.value)})}function E(e,a){return d({queryKey:["llamalend-user-markets",r(()=>e.value),r(()=>a.value)],queryFn:({queryKey:[,t,l]})=>k(t,l),enabled:r(()=>!!e.value&&!!a.value),...c()})}function R(e,a,t){return d({queryKey:["llamalend-user-market-snapshots",r(()=>e.value),r(()=>a.value),r(()=>t.value)],queryFn:({queryKey:[,l,o,s]})=>$(l,o,s),enabled:r(()=>!!e.value&&!!a.value&&!!t.value),...c()})}function H(e,a,t){return d({queryKey:["llamalend-user-market-events",r(()=>e.value),r(()=>a.value),r(()=>t.value)],queryFn:({queryKey:[,l,o,s]})=>D(l,o,s),enabled:r(()=>!!e.value&&!!a.value&&!!t.value)})}const C=e=>({user:e.user,first:p(e.first),last:p(e.last),debt:parseFloat(e.debt),health:parseFloat(e.health),healthFull:parseFloat(e.health_full),loss:parseFloat(e.loss),borrowed:parseFloat(e.borrowed),collateral:parseFloat(e.collateral),softLiquidation:e.soft_liquidation});async function B(e,a,t,l){const o=n(l);return(await m(`${o}/v1/lending/users/${e}/${a}/users${b(t)}`)).data.map(C)}function J(e,a){return d({queryKey:["llamalend-market-all-users",r(()=>e.value),r(()=>a.value)],queryFn:({queryKey:[,t,l]})=>B(t,l,{per_page:1e3}),enabled:r(()=>!!e.value&&!!a.value)})}export{H as a,E as b,S as c,Q as d,L as e,J as f,R as u};
